{
  "version": 3,
  "sources": ["../src/index.ts", "../src/types.ts", "../src/utils/math.ts", "../src/config.ts", "../src/utils/configUtils.ts", "../src/eventBus.ts", "../src/gameSetup.ts", "../src/utils/ui.ts", "../src/ai/playerVision.ts", "../src/types/events.ts", "../src/setpieces/integration.ts", "../src/rendering/particles.ts", "../src/ui/goalAnimation.ts", "../src/ai/decisions.ts", "../src/behavior/BehaviorSystem.ts", "../src/ai/MovementPatterns.ts", "../src/rendering/canvasSetup.ts", "../src/rendering/drawPitch.ts", "../src/rendering/drawEntities.ts", "../src/rendering/gameRenderer.ts", "../src/rendering/index.ts", "../src/setpieces/enforcement.ts", "../src/core.ts", "../src/setpieces/config.ts", "../src/ui/utils.ts", "../src/ui/uiScreens.ts", "../src/ui/uiComponents.ts", "../src/ui/uiManager.ts", "../src/main.ts", "../src/ai/goalkeeper.ts", "../src/ai/movement.ts", "../src/setpieces/utils.ts", "../src/setpieces/behaviors/kickoff.ts", "../src/setpieces/behaviors/penalty.ts", "../src/setpieces/behaviors/throwIn.ts", "../src/setpieces/behaviors/cornerKick.ts", "../src/setpieces/behaviors/freeKick.ts", "../src/setpieces/behaviors/goalKick.ts", "../src/setpieces/SetPieceBehaviorSystem.ts", "../src/setpieces/execution.ts", "../src/rules/offside.ts", "../src/rules/ballControl.ts", "../src/physics.ts", "../src/ai/playerFirstTouch.ts", "../src/batch-simulator.ts", "../src/globalExports.ts", "../src/behavior/setPieceBehavior.ts", "../src/behavior/system.ts"],
  "sourcesContent": ["/**\r\n * Football Simulation - TypeScript Entry Point\r\n *\r\n * This is the main entry point for the TypeScript version of the football simulation.\r\n * It imports and initializes all game systems in the correct order.\r\n *\r\n * @module index\r\n * @version 2.0.0-typescript\r\n */\r\n\r\n// ============================================================================\r\n// CORE TYPES (Import first to ensure types are available)\r\n// ============================================================================\r\nexport * from './types';\r\n\r\n// ============================================================================\r\n// UTILITIES (No dependencies)\r\n// ============================================================================\r\nexport * from './utils/math';\r\nexport * from './utils/configUtils';\r\n\r\n// ============================================================================\r\n// CONFIGURATION (Depends on types)\r\n// ============================================================================\r\nexport * from './config';\r\nexport * from './eventBus';\r\nexport * from './globalExports';\r\n\r\n// ============================================================================\r\n// PHYSICS SYSTEM (Phase 2)\r\n// ============================================================================\r\nexport * from './physics';\r\n\r\n// ============================================================================\r\n// RULES SYSTEMS (Phase 2)\r\n// ============================================================================\r\nexport * from './rules';\r\n\r\n// ============================================================================\r\n// AI SYSTEMS (Phase 3)\r\n// ============================================================================\r\nexport * from './ai';\r\n\r\n// ============================================================================\r\n// SET PIECE SYSTEMS (Phase 4)\r\n// ============================================================================\r\nexport * from './setpieces';\r\n\r\n// ============================================================================\r\n// BEHAVIOR SYSTEMS (Phase 4)\r\n// ============================================================================\r\nexport * from './behavior';\r\n\r\n// ============================================================================\r\n// UI SYSTEMS (Phase 5)\r\n// ============================================================================\r\nexport * from './ui';\r\n\r\n// ============================================================================\r\n// RENDERING SYSTEMS (Phase 5)\r\n// ============================================================================\r\nexport * from './rendering';\r\n\r\n// ============================================================================\r\n// GAME SETUP (Team selection, formation, player initialization)\r\n// ============================================================================\r\nexport * from './gameSetup';\r\n\r\n// ============================================================================\r\n// CORE GAME LOOP (Phase 7 - FINAL)\r\n// ============================================================================\r\nexport * from './core';\r\nexport * from './main';\r\n\r\n// ============================================================================\r\n// MODULE INITIALIZATION\r\n// ============================================================================\r\n\r\n/**\r\n * Initialize the football simulation system\r\n * Call this function when the DOM is ready\r\n */\r\nexport function initializeSimulation(): void {\r\n  console.log('\uD83D\uDE80 Football Simulation (TypeScript) Initializing...');\r\n  console.log('\u2705 Type system: LOADED');\r\n  console.log('\u2705 Configuration: LOADED');\r\n  console.log('\u2705 Event system: LOADED');\r\n  console.log('\u2705 Math utilities: LOADED');\r\n  console.log('\u2705 Physics system: LOADED');\r\n  console.log('\u2705 Rules systems: LOADED');\r\n  console.log('\u2705 AI systems: LOADED');\r\n  console.log('\u2705 Set piece systems: LOADED');\r\n  console.log('\u2705 Behavior systems: LOADED');\r\n  console.log('\u2705 UI systems: LOADED');\r\n  console.log('\u2705 Rendering systems: LOADED');\r\n  console.log('\u2705 Core game loop: LOADED');\r\n  console.log('\u2705 Main initialization: LOADED');\r\n  console.log('\uD83C\uDFAE Ready to start simulation');\r\n  console.log('\uD83C\uDF89 MIGRATION COMPLETE - ALL SYSTEMS OPERATIONAL!');\r\n}\r\n\r\n// Auto-initialize when module loads in browser\r\nif (typeof window !== 'undefined') {\r\n  // Wait for DOM to be ready\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', initializeSimulation);\r\n  } else {\r\n    initializeSimulation();\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// GLOBAL DECLARATIONS FOR BROWSER\r\n// ============================================================================\r\n\r\ndeclare global {\r\n  interface Window {\r\n    FootballSim: typeof import('./index');\r\n    initializeSimulation: typeof initializeSimulation;\r\n  }\r\n}\r\n\r\nif (typeof window !== 'undefined') {\r\n  window.initializeSimulation = initializeSimulation;\r\n}\r\n\r\nconsole.log('\u2705 Football Simulation Core Module loaded (TypeScript v2.0.0)');\r\n", "\nexport interface GameLoopConfig {\n    FIXED_TIMESTEP: number;\n    MAX_FRAME_TIME: number;\n    GAME_SPEED: number;\n}\n\nexport interface PhysicsConfig {\n    MAX_SPEED: number;\n    SPRINT_MULTIPLIER: number;\n    ACCELERATION: number;\n    FRICTION: number;\n    DRIBBLE_SPEED_PENALTY: number;\n    COLLISION_RADIUS: number;\n    BALL_CONTROL_DISTANCE: number;\n    PASS_INTERCEPT_DISTANCE: number;\n    MOVEMENT_THRESHOLD: number;\n    POSITIONING_SMOOTHNESS: number;\n    LONG_PASS_THRESHOLD: number;\n    HEADER_HEIGHT_THRESHOLD: number;\n    PLAYER_MASS: number;\n    BALL_MASS: number;\n}\n\nexport interface BallPhysicsConfig {\n    MAX_SPEED: number;\n    FRICTION: number;\n    GRAVITY: number;\n    BOUNCE: number;\n    SPIN_EFFECT: number;\n}\n\nexport interface GameConfig {\n    GOAL_CHECK_DISTANCE: number;\n    SHOOTING_CHANCE_BASE: number;\n    PASSING_CHANCE: number;\n    EVENT_PROBABILITY: number;\n    DECISION_COOLDOWN: number;\n    GK_HOLD_TIME: number;\n    HIGH_DPI_SCALE_FACTOR: number;\n    GOAL_Y_TOP: number;\n    GOAL_Y_BOTTOM: number;\n    PITCH_WIDTH: number;\n    PITCH_HEIGHT: number;\n    AVERAGE_SPRINT_TIME_TO_GOAL: number;\n    REACTION_TIME_MIN: number;\n    REACTION_TIME_MAX: number;\n    GAME_SPEED: number;\n    GOAL_X_LEFT: number;\n    GOAL_X_RIGHT: number;\n}\n\nexport interface BehaviorTreeConfig {\n    PRIORITY_SHOOT: number;\n    PRIORITY_PASS: number;\n    PRIORITY_DRIBBLE: number;\n    PRIORITY_TACKLE: number;\n    PRIORITY_MARK: number;\n    PRIORITY_POSITION: number;\n    BALL_CLOSE_DISTANCE: number;\n    OPPONENT_CLOSE_DISTANCE: number;\n    TEAMMATE_SUPPORT_DISTANCE: number;\n    MAX_BALL_HOLD_TIME: number;\n    MAX_BALL_HOLD_TIME_UNDER_PRESSURE: number;\n    SHOOT_CHANCE_IN_BOX: number;\n    SHOOT_CHANCE_OUTSIDE_BOX: number;\n    PASS_CHANCE_UNDER_PRESSURE: number;\n    DRIBBLE_CHANCE_IN_SPACE: number;\n}\n\nexport type PlayerRole = 'GK' | 'CB' | 'LCB' | 'RCB' | 'RB' | 'LB' | 'CDM' | 'CM' | 'LCM' | 'RCM' | 'RM' | 'LM' | 'CAM' | 'RW' | 'LW' | 'ST' | 'CF';\n\nexport interface PositionConfig {\n    defensiveness: number;\n    attackRange: number;\n    ballChasePriority: number;\n    idealWidth: number;\n    pushUpOnAttack: number;\n    pressAggression: number;\n    zoneCoverage: number;\n    supportDistance: number;\n    maxSpeed: number;\n}\n\nexport type PositionConfigsMap = {\n    [key in PlayerRole]: PositionConfig;\n};\n\nexport interface FormationPosition {\n    x: number;\n    y: number;\n    role: PlayerRole;\n}\n\nexport type FormationsMap = {\n    [key: string]: FormationPosition[];\n};\n\nexport interface Tactic {\n    name: string;\n    description: string;\n    pressIntensity: number;\n    defensiveLineDepth: number;\n    counterAttackSpeed: number;\n    possessionPriority: number;\n    passingRisk: number;\n    preferHighPress: boolean;\n    preferCounterAttack: boolean;\n    compactness: number;\n}\n\nexport type TacticsMap = {\n    [key: string]: Tactic;\n};\n\nexport interface TeamStateModifier {\n    speedMultiplier: number;\n    positioningAggression: number;\n    riskTolerance: number;\n    pressTriggerDistance: number;\n}\n\nexport type TeamStateModifiersMap = {\n    [key: string]: TeamStateModifier;\n};\n\nexport type PositionToRoleMap = {\n    [key: string]: PlayerRole;\n};\n\nexport interface Player {\n    id: string | number;\n    name: string;\n    x: number;\n    y: number;\n    isHome: boolean;\n    role: PlayerRole;\n    shooting: number;\n    vx: number;\n    vy: number;\n    targetX: number;\n    targetY: number;\n    speedBoost: number;\n    hasBallControl: boolean;\n    isChasingBall: boolean;\n    dribbling: number;\n    physicality: number;\n    pace: number;\n    defending: number;\n    rating: number;\n    ballReceivedTime: number | null;\n    realStats: any;\n    stamina: number;\n    passing: number;\n    effectivePace: number;\n    effectiveShooting: number;\n    effectivePassing: number;\n    chaseStartTime: number | null;\n    targetLocked: boolean;\n    lastDecisionTime: number;\n    stunnedUntil: number;\n    isInWall: boolean;\n    isDefCBLine: boolean;\n    isMarker: boolean;\n    isKicker: boolean;\n    targetLockTime: number;\n    position: string;\n    lockUntil: number;\n    setPieceTarget: { x: number; y: number } | null;\n    intent: string;\n    goalkeeping: number;\n    homeX: number;\n    homeY: number;\n    currentBehavior: string;\n    team: string;\n    goalkeeper: any;\n}\n\nexport interface GameState {\n    stats: any;\n    canvases?: {\n        background: HTMLCanvasElement | null;\n        game: HTMLCanvasElement | null;\n        ui: HTMLCanvasElement | null;\n    };\n    contexts?: {\n        background: CanvasRenderingContext2D | null;\n        game: CanvasRenderingContext2D | null;\n        ui: CanvasRenderingContext2D | null;\n    };\n    isVertical: boolean;\n    orientationChanged: boolean;\n    backgroundDrawn: boolean;\n    status: string;\n    homeTeam: string;\n    awayTeam: string;\n    homeScore: number;\n    awayScore: number;\n    timeElapsed: number;\n    currentHalf: number;\n    commentary: any[];\n    goalEvents: any[];\n    cardEvents: any[];\n    players: any[];\n    homePlayers: any[];\n    awayPlayers: any[];\n    setPiece: any;\n    teamLogos: Record<string, string>;\n    homeTactic: string;\n    awayTactic: string;\n    ballTrajectory: any;\n    ballPosition: Vector2D;\n    ballVelocity: Vector2D;\n    ballHolder: Player | null;\n    homeTeamState: TeamState;\n    awayTeamState: TeamState;\n    lastTouchedBy: any;\n    ballHeight: number;\n    currentPassReceiver: Player | null;\n    ballChasers: Set<Player>;\n    lastPossessionChange: number;\n    shotInProgress: boolean;\n    shooter: Player | null;\n    homeJerseyColor: string;\n    awayJerseyColor: string;\n    offscreenPitch: any;\n    cameraShake: any;\n    particles: Particle[];\n    lastTeamStateUpdate: number;\n    postKickOffCalmPeriod: boolean;\n    kickOffCompletedTime: number;\n    currentShotXG: number | null;\n    lastGoalScorer: string | null;\n    homeDefensiveLine: number;\n    awayDefensiveLine: number;\n    homeFormation: string;\n    awayFormation: string;\n    homeTacticManuallySet: boolean;\n    awayTacticManuallySet: boolean;\n    lastEventTime: number;\n    totalPasses: number;\n    totalShots: number;\n    fouls: number;\n    yellowCards: any[];\n    redCards: any[];\n    setPieceExecuting: boolean;\n    lastControlAttempt: number;\n    possessionChanges: number;\n    gameUIDisplayed: boolean;\n    summaryDrawn: boolean;\n    teams: string[];\n    teamJerseys: Record<string, { jersey1: string; jersey2: string; }>;\n    teamCoaches: Record<string, string>;\n    totalTackles: number;\n    commentaryFadeTimeout: any;\n    _teamCacheVersion: number;\n}\n\nexport interface Vector2D {\n    x: number;\n    y: number;\n}\n\nexport interface MutableVector2D {\n    x: number;\n    y: number;\n}\n\nexport interface PositionWithMovement {\n    x: number;\n    y: number;\n}\n\nexport interface Particle {\n    x: number;\n    y: number;\n    vx: number;\n    vy: number;\n    radius: number;\n    color: string;\n    alpha: number;\n    type: string;\n    size: number;\n    rotation: number;\n    life: number;\n    createdAt: number;\n    draw: (ctx: CanvasRenderingContext2D) => void;\n}\n\nexport interface BallTrajectory {\n    x: number;\n    y: number;\n    z: number;\n    endX: number;\n    startX: number;\n    duration: number;\n    endY: number;\n    startY: number;\n}\n\nexport type TeamState = 'ATTACKING' | 'DEFENDING' | 'HIGH_PRESS' | 'COUNTER_ATTACK' | 'BALANCED';\n\nexport enum EVENT_TYPES {\n    MATCH_START = 'MATCH_START',\n    HALF_TIME = 'HALF_TIME',\n    MATCH_END = 'MATCH_END',\n    BALL_PASSED = 'BALL_PASSED',\n    GOAL_SCORED = 'GOAL_SCORED',\n    SHOT_SAVED = 'SHOT_SAVED',\n    FOUL_COMMITTED = 'FOUL_COMMITTED',\n    SHOT_TAKEN = 'SHOT_TAKEN',\n    TEAM_STATE_CHANGED = 'TEAM_STATE_CHANGED',\n    POSSESSION_CHANGED = 'POSSESSION_CHANGED',\n    BALL_LOST = 'BALL_LOST',\n}\n\nexport interface EventBus {\n    subscribe<T>(eventType: string | EVENT_TYPES, listener: EventListener<T>): () => void;\n    unsubscribe<T>(eventType: string | EVENT_TYPES, listener: EventListener<T>): void;\n    publish<T>(eventType: string | EVENT_TYPES, data: T): void;\n    events: Record<string, EventListener<any>[]>;\n    getListenerCount(eventType: string | EVENT_TYPES): number;\n    clear(eventType?: string | EVENT_TYPES): void;\n    hasListeners(eventType: string | EVENT_TYPES): boolean;\n}\n\nexport type EventListener<T> = (data: T) => void;\n\nexport interface GoalEventPayload {\n    scorer: Player;\n    assist: Player | null;\n    team: string;\n    time: number;\n    xG: number;\n}\n\nexport interface ShotEventPayload {\n    shooter: Player;\n    team: string;\n    time: number;\n    isOnTarget: boolean;\n    xG: number;\n}\n\nexport interface FoulEventPayload {\n    foulingPlayer: Player;\n    victim: Player;\n    fouler: Player;\n    fouled: Player;\n    team: string;\n    time: number;\n}\n\nexport interface TeamStateChangePayload {\n    team: string;\n    newState: TeamState;\n    previousState: TeamState;\n    time: number;\n}\n\nexport interface PossessionChangePayload {\n    newTeam: string;\n    previousTeam: string;\n    newHolder: Player;\n    time: number;\n}\n\nexport interface Foul {\n    fouler: Player;\n    fouled: Player;\n    severity: number;\n}\n", "/**\r\n * Safe Math Utilities - Prevents NaN Propagation\r\n *\r\n * Purpose: Provide NaN-safe mathematical operations for physics calculations\r\n * All functions handle edge cases and prevent NaN/Infinity propagation\r\n */\r\n\r\nimport type { Vector2D, MutableVector2D } from '../types';\r\n\r\n// ============================================================================\r\n// BASIC MATH OPERATIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Safe division that returns fallback value instead of NaN/Infinity\r\n */\r\nexport function safeDiv(numerator: number, denominator: number, fallback: number = 0): number {\r\n  if (!isFinite(numerator) || !isFinite(denominator)) return fallback;\r\n  if (denominator === 0) return fallback;\r\n  const result = numerator / denominator;\r\n  return isFinite(result) ? result : fallback;\r\n}\r\n\r\n/**\r\n * Safe square root that returns fallback for negative or invalid values\r\n */\r\nexport function safeSqrt(value: number, fallback: number = 0): number {\r\n  if (!isFinite(value) || value < 0) return fallback;\r\n  return Math.sqrt(value);\r\n}\r\n\r\n/**\r\n * Clamp value between min and max\r\n */\r\nexport function clamp(value: number, min: number, max: number): number {\r\n  if (!isFinite(value)) return min;\r\n  return Math.max(min, Math.min(max, value));\r\n}\r\n\r\n// ============================================================================\r\n// GEOMETRY OPERATIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Calculate distance between two points safely\r\n */\r\nexport function distance(p1: Vector2D | null | undefined, p2: Vector2D | null | undefined): number {\r\n  if (!p1 || !p2) return 0;\r\n  const dx = (p2.x ?? 0) - (p1.x ?? 0);\r\n  const dy = (p2.y ?? 0) - (p1.y ?? 0);\r\n  return safeSqrt(dx * dx + dy * dy, 0);\r\n}\r\n\r\n/**\r\n * Normalize a 2D vector safely\r\n */\r\nexport function normalize(x: number, y: number): MutableVector2D {\r\n  const len = safeSqrt(x * x + y * y, 1); // Fallback to 1 to avoid div by 0\r\n  return {\r\n    x: safeDiv(x, len, 0),\r\n    y: safeDiv(y, len, 0)\r\n  };\r\n}\r\n\r\n/**\r\n * Linear interpolation between two values\r\n */\r\nexport function lerp(start: number, end: number, t: number): number {\r\n  const clampedT = clamp(t, 0, 1);\r\n  return start + (end - start) * clampedT;\r\n}\r\n\r\n/**\r\n * Calculate angle between two points in radians\r\n */\r\nexport function angleTo(from: Vector2D | null | undefined, to: Vector2D | null | undefined): number {\r\n  if (!from || !to) return 0;\r\n  const dx = (to.x ?? 0) - (from.x ?? 0);\r\n  const dy = (to.y ?? 0) - (from.y ?? 0);\r\n  return Math.atan2(dy, dx);\r\n}\r\n\r\n/**\r\n * Point-to-line distance calculation\r\n */\r\nexport function pointToLineDistance(\r\n  point: Vector2D | null | undefined,\r\n  lineStart: Vector2D | null | undefined,\r\n  lineEnd: Vector2D | null | undefined\r\n): number {\r\n  if (!point || !lineStart || !lineEnd) return Infinity;\r\n\r\n  const dx = (lineEnd.x ?? 0) - (lineStart.x ?? 0);\r\n  const dy = (lineEnd.y ?? 0) - (lineStart.y ?? 0);\r\n  const lenSq = dx * dx + dy * dy;\r\n\r\n  if (lenSq === 0) return distance(point, lineStart);\r\n\r\n  const t = clamp(\r\n    ((point.x - lineStart.x) * dx + (point.y - lineStart.y) * dy) / lenSq,\r\n    0,\r\n    1\r\n  );\r\n\r\n  const closestPoint: MutableVector2D = {\r\n    x: lineStart.x + t * dx,\r\n    y: lineStart.y + t * dy\r\n  };\r\n\r\n  return distance(point, closestPoint);\r\n}\r\n\r\n// ============================================================================\r\n// VALIDATION\r\n// ============================================================================\r\n\r\n/**\r\n * Check if value is safe for calculations\r\n */\r\nexport function isSafeNumber(value: unknown): value is number {\r\n  return typeof value === 'number' && isFinite(value);\r\n}\r\n\r\n// ============================================================================\r\n// VECTOR OPERATIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Safe vector addition\r\n */\r\nexport function addVectors(v1: Vector2D, v2: Vector2D): MutableVector2D {\r\n  return {\r\n    x: (v1.x ?? 0) + (v2.x ?? 0),\r\n    y: (v1.y ?? 0) + (v2.y ?? 0)\r\n  };\r\n}\r\n\r\n/**\r\n * Safe vector subtraction\r\n */\r\nexport function subtractVectors(v1: Vector2D, v2: Vector2D): MutableVector2D {\r\n  return {\r\n    x: (v1.x ?? 0) - (v2.x ?? 0),\r\n    y: (v1.y ?? 0) - (v2.y ?? 0)\r\n  };\r\n}\r\n\r\n/**\r\n * Safe vector scaling\r\n */\r\nexport function scaleVector(v: Vector2D, scalar: number): MutableVector2D {\r\n  const safeScalar = isSafeNumber(scalar) ? scalar : 1;\r\n  return {\r\n    x: (v.x ?? 0) * safeScalar,\r\n    y: (v.y ?? 0) * safeScalar\r\n  };\r\n}\r\n\r\n/**\r\n * Get vector magnitude (length)\r\n */\r\nexport function magnitude(v: Vector2D): number {\r\n  return safeSqrt((v.x ?? 0) * (v.x ?? 0) + (v.y ?? 0) * (v.y ?? 0), 0);\r\n}\r\n\r\n// ============================================================================\r\n// GLOBAL EXPORT FOR BROWSER COMPATIBILITY\r\n// ============================================================================\r\n\r\ndeclare global {\r\n  interface Window {\r\n    MathUtils: {\r\n      safeDiv: typeof safeDiv;\r\n      safeSqrt: typeof safeSqrt;\r\n      clamp: typeof clamp;\r\n      distance: typeof distance;\r\n      normalize: typeof normalize;\r\n      lerp: typeof lerp;\r\n      angleTo: typeof angleTo;\r\n      pointToLineDistance: typeof pointToLineDistance;\r\n      isSafeNumber: typeof isSafeNumber;\r\n      addVectors: typeof addVectors;\r\n      subtractVectors: typeof subtractVectors;\r\n      scaleVector: typeof scaleVector;\r\n      magnitude: typeof magnitude;\r\n    };\r\n  }\r\n}\r\n\r\n// Export to window for backward compatibility\r\nif (typeof window !== 'undefined') {\r\n  window.MathUtils = {\r\n    safeDiv,\r\n    safeSqrt,\r\n    clamp,\r\n    distance,\r\n    normalize,\r\n    lerp,\r\n    angleTo,\r\n    pointToLineDistance,\r\n    isSafeNumber,\r\n    addVectors,\r\n    subtractVectors,\r\n    scaleVector,\r\n    magnitude\r\n  };\r\n  console.log('\u2705 Safe Math Utilities loaded (TypeScript)');\r\n}\r\n", "/**\n * Main Game Configuration\n * Complete, type-safe configuration for the football simulation\n *\n * \u2705 Fully migrated from JavaScript with zero functional changes\n * \u2705 Maximum type safety with strict TypeScript\n * \u2705 Browser-compatible with global window exports\n */\n\nimport type * as types from './types';\n\n// ============================================================================\n// GAME LOOP CONFIGURATION\n// ============================================================================\n\nexport const GAME_LOOP: types.GameLoopConfig = {\n  FIXED_TIMESTEP: 3 / 60,\n  MAX_FRAME_TIME: 0.25,\n  GAME_SPEED: 1.0  // 1.0 = 1 game minute = 1 real second\n} as const;\n\n// ============================================================================\n// PHYSICS CONFIGURATION\n// ============================================================================\n\nexport const PHYSICS: types.PhysicsConfig = {\n  // \u2705 Speeds doubled to compensate for removed GAME_SPEED multiplier in physics\n  MAX_SPEED: 152,              // pixels/second\n  SPRINT_MULTIPLIER: 1.3,      // Sprint = 198 px/s\n  ACCELERATION: 700,           // pixels/s\u00B2 (doubled from 350)\n  FRICTION: 0.88,              // Per second decay\n  DRIBBLE_SPEED_PENALTY: 0.75, // 25% slower when dribbling\n  COLLISION_RADIUS: 18,\n  BALL_CONTROL_DISTANCE: 28,\n  PASS_INTERCEPT_DISTANCE: 40,\n  MOVEMENT_THRESHOLD: 5.0,\n  POSITIONING_SMOOTHNESS: 0.04,\n  LONG_PASS_THRESHOLD: 150,    // ~20m in real world\n  HEADER_HEIGHT_THRESHOLD: 0.3,\n  PLAYER_MASS: 75,\n  BALL_MASS: 0.45\n} as const;\n\nexport const BALL_PHYSICS: types.BallPhysicsConfig = {\n  MAX_SPEED: 650,              // pixels/second\n  FRICTION: 0.44,              // Rolls to stop realistically\n  GRAVITY: 600,                // Unchanged - feels right\n  BOUNCE: 0.6,\n  SPIN_EFFECT: 0.05\n} as const;\n\n// ============================================================================\n// GAME CONFIGURATION\n// ============================================================================\n\nexport const GAME_CONFIG: types.GameConfig = {\n  GOAL_CHECK_DISTANCE: 200,\n  SHOOTING_CHANCE_BASE: 0.3,\n  PASSING_CHANCE: 0.70,\n  EVENT_PROBABILITY: 0.5,\n  DECISION_COOLDOWN: 600,\n  GK_HOLD_TIME: 1800,\n  HIGH_DPI_SCALE_FACTOR: 1,\n  GOAL_Y_TOP: 240,\n  GOAL_Y_BOTTOM: 360,\n  PITCH_WIDTH: 800,\n  PITCH_HEIGHT: 600,\n  AVERAGE_SPRINT_TIME_TO_GOAL: 10,  // seconds\n  REACTION_TIME_MIN: 150,            // ms\n  REACTION_TIME_MAX: 350,            // ms\n  GAME_SPEED: 1.0,\n  GOAL_X_LEFT: 50,\n  GOAL_X_RIGHT: 750\n} as const;\n\n// ============================================================================\n// POSITION TO ROLE MAPPING\n// ============================================================================\n\nexport const positionToRoleMap: types.PositionToRoleMap = {\n  // Goalkeepers\n  'Goalkeeper': 'GK',\n  'Keeper': 'GK',\n  // Defenders\n  'Centre-Back': 'CB',\n  'Center Back': 'CB',\n  'Defender (Centre)': 'CB',\n  'Right-Back': 'RB',\n  'Right Back': 'RB',\n  'Defender (Right)': 'RB',\n  'Left-Back': 'LB',\n  'Left Back': 'LB',\n  'Defender (Left)': 'LB',\n  'Wing-Back (Right)': 'RB',\n  'Wing-Back (Left)': 'LB',\n  // Midfielders\n  'Defensive Midfield': 'CDM',\n  'Midfielder (Defensive)': 'CDM',\n  'Central Midfield': 'CM',\n  'Midfielder (Centre)': 'CM',\n  'Right Midfield': 'RM',\n  'Midfielder (Right)': 'RM',\n  'Left Midfield': 'LM',\n  'Midfielder (Left)': 'LM',\n  'Attacking Midfield': 'CAM',\n  'Midfielder (Attacking)': 'CAM',\n  // Forwards\n  'Right Winger': 'RW',\n  'Forward (Right)': 'RW',\n  'Winger (Right)': 'RW',\n  'Left Winger': 'LW',\n  'Forward (Left)': 'LW',\n  'Winger (Left)': 'LW',\n  'Second Striker': 'ST',\n  'Striker': 'ST',\n  'Centre-Forward': 'ST',\n  'Forward (Centre)': 'ST'\n} as const;\n\n/**\n * Convert position string to tactical role\n */\nexport function getRoleFromPosition(positionString: string | null | undefined): types.PlayerRole {\n  if (!positionString) return 'CM'; // Default role\n  const primaryPosition = positionString.split(',')[0]?.trim() ?? '';\n  return positionToRoleMap[primaryPosition] || 'CM';\n}\n\n// ============================================================================\n// POSITION-SPECIFIC CONFIGURATIONS\n// ============================================================================\n\nexport const POSITION_CONFIGS: types.PositionConfigsMap = {\n  'GK': {\n    defensiveness: 1.0,\n    attackRange: 0,\n    ballChasePriority: 0.1,\n    idealWidth: 0,\n    pushUpOnAttack: 0,\n    pressAggression: 0.0,\n    zoneCoverage: 1.0,\n    supportDistance: 0,\n    maxSpeed: 140\n  },\n  'CB': {\n    defensiveness: 0.9,\n    attackRange: 0.15,\n    ballChasePriority: 0.3,\n    idealWidth: 0.15,\n    pushUpOnAttack: 90,\n    pressAggression: 0.5,\n    zoneCoverage: 0.7,\n    supportDistance: 40,\n    maxSpeed: 144\n  },\n  'LCB': {\n    defensiveness: 0.9,\n    attackRange: 0.15,\n    ballChasePriority: 0.3,\n    idealWidth: 0.2,\n    pushUpOnAttack: 90,\n    pressAggression: 0.5,\n    zoneCoverage: 0.7,\n    supportDistance: 40,\n    maxSpeed: 144\n  },\n  'RCB': {\n    defensiveness: 0.9,\n    attackRange: 0.15,\n    ballChasePriority: 0.3,\n    idealWidth: 0.2,\n    pushUpOnAttack: 90,\n    pressAggression: 0.5,\n    zoneCoverage: 0.7,\n    supportDistance: 40,\n    maxSpeed: 144\n  },\n  'RB': {\n    defensiveness: 0.7,\n    attackRange: 0.75,\n    ballChasePriority: 0.4,\n    idealWidth: 0.35,\n    pushUpOnAttack: 160,\n    pressAggression: 0.5,\n    zoneCoverage: 0.7,\n    supportDistance: 60,\n    maxSpeed: 156\n  },\n  'LB': {\n    defensiveness: 0.7,\n    attackRange: 0.75,\n    ballChasePriority: 0.4,\n    idealWidth: 0.35,\n    pushUpOnAttack: 160,\n    pressAggression: 0.5,\n    zoneCoverage: 0.7,\n    supportDistance: 60,\n    maxSpeed: 156\n  },\n  'CDM': {\n    defensiveness: 0.65,\n    attackRange: 0.45,\n    ballChasePriority: 0.6,\n    idealWidth: 0.2,\n    pushUpOnAttack: 120,\n    pressAggression: 0.6,\n    zoneCoverage: 0.8,\n    supportDistance: 50,\n    maxSpeed: 148\n  },\n  'CM': {\n    defensiveness: 0.5,\n    attackRange: 0.6,\n    ballChasePriority: 0.7,\n    idealWidth: 0.25,\n    pushUpOnAttack: 160,\n    pressAggression: 0.7,\n    zoneCoverage: 0.6,\n    supportDistance: 70,\n    maxSpeed: 152\n  },\n  'LCM': {\n    defensiveness: 0.5,\n    attackRange: 0.6,\n    ballChasePriority: 0.7,\n    idealWidth: 0.3,\n    pushUpOnAttack: 160,\n    pressAggression: 0.7,\n    zoneCoverage: 0.6,\n    supportDistance: 70,\n    maxSpeed: 152\n  },\n  'RCM': {\n    defensiveness: 0.5,\n    attackRange: 0.6,\n    ballChasePriority: 0.7,\n    idealWidth: 0.3,\n    pushUpOnAttack: 160,\n    pressAggression: 0.7,\n    zoneCoverage: 0.6,\n    supportDistance: 70,\n    maxSpeed: 152\n  },\n  'RM': {\n    defensiveness: 0.4,\n    attackRange: 0.7,\n    ballChasePriority: 0.75,\n    idealWidth: 0.35,\n    pushUpOnAttack: 180,\n    pressAggression: 0.6,\n    zoneCoverage: 0.5,\n    supportDistance: 80,\n    maxSpeed: 160\n  },\n  'LM': {\n    defensiveness: 0.4,\n    attackRange: 0.7,\n    ballChasePriority: 0.75,\n    idealWidth: 0.35,\n    pushUpOnAttack: 180,\n    pressAggression: 0.6,\n    zoneCoverage: 0.5,\n    supportDistance: 80,\n    maxSpeed: 160\n  },\n  'CAM': {\n    defensiveness: 0.3,\n    attackRange: 0.75,\n    ballChasePriority: 0.85,\n    idealWidth: 0.15,\n    pushUpOnAttack: 200,\n    pressAggression: 0.8,\n    zoneCoverage: 0.4,\n    supportDistance: 90,\n    maxSpeed: 154\n  },\n  'RW': {\n    defensiveness: 0.25,\n    attackRange: 0.85,\n    ballChasePriority: 0.8,\n    idealWidth: 0.4,\n    pushUpOnAttack: 200,\n    pressAggression: 0.5,\n    zoneCoverage: 0.3,\n    supportDistance: 100,\n    maxSpeed: 164\n  },\n  'LW': {\n    defensiveness: 0.25,\n    attackRange: 0.85,\n    ballChasePriority: 0.8,\n    idealWidth: 0.4,\n    pushUpOnAttack: 200,\n    pressAggression: 0.5,\n    zoneCoverage: 0.3,\n    supportDistance: 100,\n    maxSpeed: 164\n  },\n  'ST': {\n    defensiveness: 0.10,\n    attackRange: 0.9,\n    ballChasePriority: 0.9,\n    idealWidth: 0.1,\n    pushUpOnAttack: 240,\n    pressAggression: 0.4,\n    zoneCoverage: 0.2,\n    supportDistance: 110,\n    maxSpeed: 158\n  },\n  'CF': {\n    defensiveness: 0.10,\n    attackRange: 0.9,\n    ballChasePriority: 0.9,\n    idealWidth: 0.1,\n    pushUpOnAttack: 240,\n    pressAggression: 0.4,\n    zoneCoverage: 0.2,\n    supportDistance: 110,\n    maxSpeed: 158\n  }\n} as const;\n\n// ============================================================================\n// TACTICS\n// ============================================================================\n\nexport const TACTICS: types.TacticsMap = {\n  balanced: {\n    name: 'Balanced',\n    description: 'Flexible approach adapting to game situation',\n    pressIntensity: 0.5,\n    defensiveLineDepth: 0.5,\n    counterAttackSpeed: 1.1,\n    possessionPriority: 0.5,\n    passingRisk: 0.5,\n    preferHighPress: false,\n    preferCounterAttack: false,\n    compactness: 0.5\n  },\n  high_press: {\n    name: 'High Press',\n    description: 'Aggressive pressing to win ball high up the pitch',\n    pressIntensity: 0.9,\n    defensiveLineDepth: 0.7,\n    counterAttackSpeed: 1.2,\n    possessionPriority: 0.4,\n    passingRisk: 0.6,\n    preferHighPress: true,\n    preferCounterAttack: false,\n    compactness: 0.8\n  },\n  possession: {\n    name: 'Possession',\n    description: 'Control the game through patient build-up play',\n    pressIntensity: 0.4,\n    defensiveLineDepth: 0.6,\n    counterAttackSpeed: 1.0,\n    possessionPriority: 0.9,\n    passingRisk: 0.3,\n    preferHighPress: false,\n    preferCounterAttack: false,\n    compactness: 0.7\n  },\n  counter_attack: {\n    name: 'Counter-Attack',\n    description: 'Absorb pressure and strike on the break',\n    pressIntensity: 0.3,\n    defensiveLineDepth: 0.3,\n    counterAttackSpeed: 1.4,\n    possessionPriority: 0.3,\n    passingRisk: 0.7,\n    preferHighPress: false,\n    preferCounterAttack: true,\n    compactness: 0.9\n  },\n  park_the_bus: {\n    name: 'Park the Bus',\n    description: 'Ultra-defensive, protect the lead at all costs',\n    pressIntensity: 0.2,\n    defensiveLineDepth: 0.2,\n    counterAttackSpeed: 1.3,\n    possessionPriority: 0.2,\n    passingRisk: 0.8,\n    preferHighPress: false,\n    preferCounterAttack: true,\n    compactness: 1.0\n  },\n  total_football: {\n    name: 'Total Football',\n    description: 'Fluid positional play with high technical demands',\n    pressIntensity: 0.8,\n    defensiveLineDepth: 0.7,\n    counterAttackSpeed: 1.25,\n    possessionPriority: 0.8,\n    passingRisk: 0.5,\n    preferHighPress: true,\n    preferCounterAttack: false,\n    compactness: 0.6\n  }\n} as const;\n\n// ============================================================================\n// TEAM STATE MODIFIERS\n// ============================================================================\n\nexport const TEAM_STATE_MODIFIERS: types.TeamStateModifiersMap = {\n  ATTACKING: {\n    speedMultiplier: 1.08,\n    positioningAggression: 0.8,\n    riskTolerance: 0.7,\n    pressTriggerDistance: 100\n  },\n  DEFENDING: {\n    speedMultiplier: 1.0,\n    positioningAggression: 0.3,\n    riskTolerance: 0.2,\n    pressTriggerDistance: 60\n  },\n  HIGH_PRESS: {\n    speedMultiplier: 1.25,\n    positioningAggression: 0.9,\n    riskTolerance: 0.5,\n    pressTriggerDistance: 120\n  },\n  COUNTER_ATTACK: {\n    speedMultiplier: 1.4,\n    positioningAggression: 0.9,\n    riskTolerance: 0.8,\n    pressTriggerDistance: 40\n  },\n  BALANCED: {\n    speedMultiplier: 1.0,\n    positioningAggression: 0.5,\n    riskTolerance: 0.5,\n    pressTriggerDistance: 80\n  }\n} as const;\n\n// ============================================================================\n// BEHAVIOR TREE CONFIGURATION\n// ============================================================================\n\nexport const BT_CONFIG: types.BehaviorTreeConfig = {\n  PRIORITY_SHOOT: 100,\n  PRIORITY_PASS: 70,\n  PRIORITY_DRIBBLE: 50,\n  PRIORITY_TACKLE: 90,\n  PRIORITY_MARK: 60,\n  PRIORITY_POSITION: 40,\n  BALL_CLOSE_DISTANCE: 100,\n  OPPONENT_CLOSE_DISTANCE: 35,\n  TEAMMATE_SUPPORT_DISTANCE: 150,\n  MAX_BALL_HOLD_TIME: 2000,\n  MAX_BALL_HOLD_TIME_UNDER_PRESSURE: 800,\n  SHOOT_CHANCE_IN_BOX: 0.75,\n  SHOOT_CHANCE_OUTSIDE_BOX: 0.25,\n  PASS_CHANCE_UNDER_PRESSURE: 0.75,\n  DRIBBLE_CHANCE_IN_SPACE: 0.55\n} as const;\n\n// ============================================================================\n// FORMATIONS (Normalized 0-1 coordinates)\n// ============================================================================\n\nexport const FORMATIONS: types.FormationsMap = {\n  '4-4-2': [\n    { x: 0.08, y: 0.5, role: 'GK' },\n    { x: 0.22, y: 0.15, role: 'RB' },\n    { x: 0.22, y: 0.38, role: 'CB' },\n    { x: 0.22, y: 0.62, role: 'CB' },\n    { x: 0.22, y: 0.85, role: 'LB' },\n    { x: 0.5, y: 0.15, role: 'RM' },\n    { x: 0.5, y: 0.38, role: 'CM' },\n    { x: 0.5, y: 0.62, role: 'CM' },\n    { x: 0.5, y: 0.85, role: 'LM' },\n    { x: 0.75, y: 0.4, role: 'ST' },\n    { x: 0.75, y: 0.6, role: 'ST' }\n  ],\n  '4-3-3': [\n    { x: 0.08, y: 0.5, role: 'GK' },\n    { x: 0.22, y: 0.15, role: 'RB' },\n    { x: 0.22, y: 0.38, role: 'CB' },\n    { x: 0.22, y: 0.62, role: 'CB' },\n    { x: 0.22, y: 0.85, role: 'LB' },\n    { x: 0.45, y: 0.25, role: 'CM' },\n    { x: 0.45, y: 0.5, role: 'CDM' },\n    { x: 0.45, y: 0.75, role: 'CM' },\n    { x: 0.75, y: 0.2, role: 'RW' },\n    { x: 0.75, y: 0.5, role: 'ST' },\n    { x: 0.75, y: 0.8, role: 'LW' }\n  ],\n  '4-4-1-1': [\n    { x: 0.08, y: 0.5, role: 'GK' },\n    { x: 0.22, y: 0.15, role: 'RB' },\n    { x: 0.22, y: 0.38, role: 'CB' },\n    { x: 0.22, y: 0.62, role: 'CB' },\n    { x: 0.22, y: 0.85, role: 'LB' },\n    { x: 0.5, y: 0.15, role: 'RM' },\n    { x: 0.5, y: 0.38, role: 'CM' },\n    { x: 0.5, y: 0.62, role: 'CM' },\n    { x: 0.5, y: 0.85, role: 'LM' },\n    { x: 0.68, y: 0.5, role: 'CAM' },\n    { x: 0.82, y: 0.5, role: 'ST' }\n  ],\n  '4-4-2-diamond': [\n    { x: 0.08, y: 0.5, role: 'GK' },\n    { x: 0.22, y: 0.15, role: 'RB' },\n    { x: 0.22, y: 0.38, role: 'CB' },\n    { x: 0.22, y: 0.62, role: 'CB' },\n    { x: 0.22, y: 0.85, role: 'LB' },\n    { x: 0.42, y: 0.5, role: 'CDM' },\n    { x: 0.55, y: 0.3, role: 'CM' },\n    { x: 0.55, y: 0.7, role: 'CM' },\n    { x: 0.68, y: 0.5, role: 'CAM' },\n    { x: 0.8, y: 0.4, role: 'ST' },\n    { x: 0.8, y: 0.6, role: 'ST' }\n  ],\n  '4-3-1-2': [\n    { x: 0.08, y: 0.5, role: 'GK' },\n    { x: 0.22, y: 0.15, role: 'RB' },\n    { x: 0.22, y: 0.38, role: 'CB' },\n    { x: 0.22, y: 0.62, role: 'CB' },\n    { x: 0.22, y: 0.85, role: 'LB' },\n    { x: 0.45, y: 0.25, role: 'CM' },\n    { x: 0.45, y: 0.5, role: 'CDM' },\n    { x: 0.45, y: 0.75, role: 'CM' },\n    { x: 0.65, y: 0.5, role: 'CAM' },\n    { x: 0.8, y: 0.4, role: 'ST' },\n    { x: 0.8, y: 0.6, role: 'ST' }\n  ],\n  '4-3-2-1': [\n    { x: 0.08, y: 0.5, role: 'GK' },\n    { x: 0.22, y: 0.15, role: 'RB' },\n    { x: 0.22, y: 0.38, role: 'CB' },\n    { x: 0.22, y: 0.62, role: 'CB' },\n    { x: 0.22, y: 0.85, role: 'LB' },\n    { x: 0.45, y: 0.25, role: 'CM' },\n    { x: 0.45, y: 0.5, role: 'CDM' },\n    { x: 0.45, y: 0.75, role: 'CM' },\n    { x: 0.65, y: 0.35, role: 'CAM' },\n    { x: 0.65, y: 0.65, role: 'CAM' },\n    { x: 0.82, y: 0.5, role: 'ST' }\n  ]\n} as const;\n\n// ============================================================================\n// HELPER FUNCTIONS\n// ============================================================================\n\n/**\n * Draw ground shadow for ball (with height)\n */\nexport function drawGroundShadow(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  size: number,\n  ballHeight: number\n): void {\n  const shadowY = y + size / 2;\n  const shadowRadiusX = size * 1.2 * (1 - ballHeight * 0.4);\n  const shadowRadiusY = shadowRadiusX * 0.3;\n  const shadowOpacity = 0.4 * (1 - ballHeight * 0.5);\n\n  if (shadowOpacity > 0) {\n    ctx.save();\n    ctx.fillStyle = `rgba(0, 0, 0, ${shadowOpacity})`;\n    ctx.beginPath();\n    ctx.ellipse(x, shadowY, shadowRadiusX, shadowRadiusY, 0, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.restore();\n  }\n}\n\n/**\n * Toggle screen orientation (vertical/horizontal)\n * Requires gameState and render function to be available globally\n */\nexport function toggleOrientation(): void {\n  console.log('Toggling orientation...');\n\n  if (typeof window === 'undefined' || !window.gameState) {\n    console.error('toggleOrientation: gameState not available');\n    return;\n  }\n\n  // Toggle the state\n  window.gameState.isVertical = !window.gameState.isVertical;\n\n  // Set flag to force background cache rebuild\n  window.gameState.orientationChanged = true;\n\n  // Clear canvas and context references\n  window.gameState.canvases = { background: null, game: null, ui: null };\n  window.gameState.contexts = { background: null, game: null, ui: null };\n  window.gameState.backgroundDrawn = false;\n\n  // Re-render the entire UI structure\n  if (typeof window.render === 'function') {\n    window.render();\n  }\n}\n\n/**\n * Validate physics realism (development only)\n */\nexport function validatePhysicsRealism(): void {\n  console.log('=== PHYSICS REALISM VALIDATION ===');\n\n  // Test 1: Time to cross pitch\n  const pitchWidth = GAME_CONFIG.PITCH_WIDTH;\n  const maxSpeed = PHYSICS.MAX_SPEED;\n  const timeToCross = pitchWidth / maxSpeed;\n  console.log(`\u2713 Time to cross pitch: ${timeToCross.toFixed(1)}s (target: 10-12s)`);\n  console.assert(timeToCross >= 9 && timeToCross <= 13, 'Pitch crossing time unrealistic!');\n\n  // Test 2: Ball faster than players\n  const ballSpeed = BALL_PHYSICS.MAX_SPEED;\n  console.log(`\u2713 Ball max speed: ${ballSpeed} px/s (${(ballSpeed / maxSpeed).toFixed(1)}x player speed)`);\n  console.assert(ballSpeed > maxSpeed * 2, 'Ball should be significantly faster than players!');\n\n  // Test 3: Acceleration time\n  const timeToMaxSpeed = maxSpeed / PHYSICS.ACCELERATION;\n  console.log(`\u2713 Time to max speed: ${timeToMaxSpeed.toFixed(1)}s (target: 2-3s)`);\n  console.assert(timeToMaxSpeed >= 1.5 && timeToMaxSpeed <= 3.5, 'Acceleration unrealistic!');\n\n  // Test 4: Sprint multiplier\n  const sprintSpeed = maxSpeed * PHYSICS.SPRINT_MULTIPLIER;\n  console.log(`\u2713 Sprint speed: ${sprintSpeed.toFixed(0)} px/s`);\n  console.assert(sprintSpeed < 250, 'Sprint speed too high!');\n\n  console.log('=== ALL TESTS PASSED ===');\n}\n\n// Continuation in next block...\n", "/**\r\n * Centralized Config Access - Single Source of Truth\r\n *\r\n * Purpose: Provide safe, centralized access to all game configuration\r\n * Supports fallback values, type validation, and caching\r\n */\r\n\r\nimport type {\r\n  GameConfig\r\n} from '../types';\r\nimport { GAME_CONFIG, PHYSICS, BALL_PHYSICS, GAME_LOOP } from '../config';\r\n\r\n// ============================================================================\r\n// TYPE DEFINITIONS\r\n// ============================================================================\r\n\r\n/** Cache for frequently accessed config values */\r\nconst configCache = new Map<string, unknown>();\r\n\r\n// ============================================================================\r\n// GLOBAL DECLARATIONS\r\n// ============================================================================\r\n\r\ndeclare global {\r\n  interface Window {\r\n    CFG: typeof CFG;\r\n    CFG_BATCH: typeof CFG_BATCH;\r\n    CFG_TYPED: typeof CFG_TYPED;\r\n    CFG_NUMBER: typeof CFG_NUMBER;\r\n    CFG_PATH: typeof CFG_PATH;\r\n    CFG_CACHED: typeof CFG_CACHED;\r\n    VALIDATE_CONFIG: typeof VALIDATE_CONFIG;\r\n    CLEAR_CFG_CACHE: typeof CLEAR_CFG_CACHE;\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// PRIMARY CONFIG ACCESSOR\r\n// ============================================================================\r\n\r\n/**\r\n * Centralized config accessor with fallback support\r\n * @param key - Config key to retrieve (e.g., 'PITCH_WIDTH', 'MAX_SPEED')\r\n * @param defaultValue - Fallback value if key not found\r\n * @returns Config value or default\r\n */\r\nexport function CFG(): GameConfig | Record<string, never>;\r\nexport function CFG<T>(key: string, defaultValue?: T): T;\r\nexport function CFG<T>(key?: string, defaultValue?: T): T | GameConfig | Record<string, never> {\r\n  // If no key provided, return entire GAME_CONFIG\r\n  if (!key) {\r\n    if (typeof window !== 'undefined' && typeof GAME_CONFIG !== 'undefined') {\r\n      return GAME_CONFIG;\r\n    }\r\n    console.warn('GAME_CONFIG not loaded yet');\r\n    return {};\r\n  }\r\n\r\n  // Search order: GAME_CONFIG \u2192 PHYSICS \u2192 BALL_PHYSICS \u2192 GAME_LOOP\r\n  const configSources: (Record<string, unknown> | undefined)[] = [\r\n    typeof window !== 'undefined' && GAME_CONFIG ? (GAME_CONFIG as unknown as Record<string, unknown>) : undefined,\r\n    typeof window !== 'undefined' && PHYSICS ? (PHYSICS as unknown as Record<string, unknown>) : undefined,\r\n    typeof window !== 'undefined' && BALL_PHYSICS ? (BALL_PHYSICS as unknown as Record<string, unknown>) : undefined,\r\n    typeof window !== 'undefined' && GAME_LOOP ? (GAME_LOOP as unknown as Record<string, unknown>) : undefined\r\n  ];\r\n\r\n  for (const source of configSources) {\r\n    if (source && key in source && source[key] !== undefined) {\r\n      return source[key] as T;\r\n    }\r\n  }\r\n\r\n  // Not found in any source\r\n  if (defaultValue === undefined) {\r\n    console.warn(`Config key \"${key}\" not found and no default provided`);\r\n  }\r\n\r\n  return defaultValue as T;\r\n}\r\n\r\n// ============================================================================\r\n// BATCH CONFIG ACCESSOR\r\n// ============================================================================\r\n\r\n/**\r\n * Get multiple config values at once\r\n * @param keys - Array of config keys\r\n * @returns Object with requested key-value pairs\r\n */\r\nexport function CFG_BATCH(keys: readonly string[]): Record<string, unknown> {\r\n  const result: Record<string, unknown> = {};\r\n  keys.forEach(key => {\r\n    result[key] = CFG(key);\r\n  });\r\n  return result;\r\n}\r\n\r\n// ============================================================================\r\n// TYPED CONFIG ACCESSORS\r\n// ============================================================================\r\n\r\n/**\r\n * Get config with type validation\r\n * @param key - Config key\r\n * @param expectedType - Expected JavaScript type\r\n * @param defaultValue - Fallback value\r\n * @returns Config value or default\r\n */\r\nexport function CFG_TYPED<T>(\r\n  key: string,\r\n  expectedType: 'number' | 'string' | 'object' | 'boolean' | 'function',\r\n  defaultValue: T\r\n): T {\r\n  const value = CFG(key, defaultValue);\r\n\r\n  if (typeof value !== expectedType) {\r\n    console.warn(`Config key \"${key}\" expected type ${expectedType}, got ${typeof value}`);\r\n    return defaultValue;\r\n  }\r\n\r\n  return value;\r\n}\r\n\r\n/**\r\n * Safe config getter for numeric values with bounds checking\r\n * @param key - Config key\r\n * @param defaultValue - Default numeric value\r\n * @param min - Minimum allowed value\r\n * @param max - Maximum allowed value\r\n * @returns Bounded config value\r\n */\r\nexport function CFG_NUMBER(\r\n  key: string,\r\n  defaultValue: number,\r\n  min: number = -Infinity,\r\n  max: number = Infinity\r\n): number {\r\n  const value = CFG(key, defaultValue);\r\n\r\n  if (typeof value !== 'number' || !isFinite(value)) {\r\n    console.warn(`Config key \"${key}\" is not a valid number, using default ${defaultValue}`);\r\n    return defaultValue;\r\n  }\r\n\r\n  if (value < min || value > max) {\r\n    console.warn(`Config key \"${key}\" value ${value} out of bounds [${min}, ${max}], clamping`);\r\n    return Math.max(min, Math.min(max, value));\r\n  }\r\n\r\n  return value;\r\n}\r\n\r\n// ============================================================================\r\n// PATH-BASED CONFIG ACCESSOR\r\n// ============================================================================\r\n\r\n/**\r\n * Get nested config value using dot notation\r\n * @param path - Dot-separated path (e.g., 'TACTICS.balanced.pressIntensity')\r\n * @param defaultValue - Fallback value\r\n * @returns Nested config value or default\r\n */\r\nexport function CFG_PATH<T>(path: string, defaultValue?: T): T | undefined {\r\n  const keys = path.split('.');\r\n  let current: unknown;\r\n\r\n  // Try GAME_CONFIG first\r\n  if (typeof window !== 'undefined' && typeof GAME_CONFIG !== 'undefined') {\r\n    current = GAME_CONFIG;\r\n    for (const key of keys) {\r\n      if (current && typeof current === 'object' && key in current) {\r\n        current = (current as Record<string, unknown>)[key];\r\n      } else {\r\n        current = undefined;\r\n        break;\r\n      }\r\n    }\r\n    if (current !== undefined) return current as T;\r\n  }\r\n\r\n  // Try window object\r\n  if (typeof window !== 'undefined') {\r\n    current = window;\r\n    for (const key of keys) {\r\n      if (current && typeof current === 'object' && key in current) {\r\n        current = (current as Record<string, unknown>)[key];\r\n      } else {\r\n        current = undefined;\r\n        break;\r\n      }\r\n    }\r\n    if (current !== undefined) return current as T;\r\n  }\r\n\r\n  return defaultValue;\r\n}\r\n\r\n// ============================================================================\r\n// CACHED CONFIG ACCESSOR\r\n// ============================================================================\r\n\r\n/**\r\n * Get config with caching for performance\r\n * @param key - Config key\r\n * @param defaultValue - Fallback value\r\n * @returns Cached config value\r\n */\r\nexport function CFG_CACHED<T>(key: string, defaultValue?: T): T {\r\n  if (configCache.has(key)) {\r\n    return configCache.get(key) as T;\r\n  }\r\n\r\n  const value = CFG(key, defaultValue);\r\n  configCache.set(key, value);\r\n  return value;\r\n}\r\n\r\n/**\r\n * Clear config cache (use when configs change dynamically)\r\n */\r\nexport function CLEAR_CFG_CACHE(): void {\r\n  configCache.clear();\r\n  console.log('\u2705 Config cache cleared');\r\n}\r\n\r\n// ============================================================================\r\n// VALIDATION\r\n// ============================================================================\r\n\r\n/**\r\n * Validate that required configs exist\r\n * @param requiredKeys - Array of required config keys\r\n * @throws Error if any required key is missing\r\n */\r\nexport function VALIDATE_CONFIG(requiredKeys: readonly string[]): void {\r\n  const missing: string[] = [];\r\n\r\n  requiredKeys.forEach(key => {\r\n    if (CFG(key) === undefined) {\r\n      missing.push(key);\r\n    }\r\n  });\r\n\r\n  if (missing.length > 0) {\r\n    throw new Error(`\u274C Missing required config keys: ${missing.join(', ')}`);\r\n  }\r\n\r\n  console.log(`\u2705 Config validation passed (${requiredKeys.length} keys)`);\r\n}\r\n\r\n// ============================================================================\r\n// GLOBAL EXPORT FOR BROWSER COMPATIBILITY\r\n// ============================================================================\r\n\r\n// Export to window for backward compatibility\r\nif (typeof window !== 'undefined') {\r\n  window.CFG = CFG;\r\n  window.CFG_BATCH = CFG_BATCH;\r\n  window.CFG_TYPED = CFG_TYPED;\r\n  window.CFG_NUMBER = CFG_NUMBER;\r\n  window.CFG_PATH = CFG_PATH;\r\n  window.CFG_CACHED = CFG_CACHED;\r\n  window.VALIDATE_CONFIG = VALIDATE_CONFIG;\r\n  window.CLEAR_CFG_CACHE = CLEAR_CFG_CACHE;\r\n\r\n  console.log('\u2705 Centralized Config Utilities loaded (TypeScript)');\r\n}\r\n", "/**\r\n * Event Bus System\r\n * Type-safe event bus for decoupled architecture\r\n */\r\n\r\nimport type { EventBus, EventListener } from './types';\r\nimport { EVENT_TYPES } from './types';\r\n\r\n// ============================================================================\r\n// STANDARD EVENTS\r\n// ============================================================================\r\n\r\nexport const STANDARD_EVENTS = {\r\n  BALL_POSITION_CHANGED: 'ball:positionChanged',\r\n  BALL_HOLDER_CHANGED: 'ball:holderChanged',\r\n  POSSESSION_CHANGED: 'possession:changed',\r\n  GOAL_SCORED: 'goal:scored',\r\n  SHOT_ATTEMPTED: 'shot:attempted',\r\n  PASS_ATTEMPTED: 'pass:attempted',\r\n  FOUL_COMMITTED: 'foul:committed',\r\n  OFFSIDE_CALLED: 'offside:called',\r\n  SET_PIECE_STARTED: 'setPiece:started',\r\n  SET_PIECE_EXECUTED: 'setPiece:executed',\r\n  PLAYER_SUBSTITUTED: 'player:substituted',\r\n  MATCH_STARTED: 'match:started',\r\n  MATCH_FINISHED: 'match:finished'\r\n} as const;\r\n\r\n// ============================================================================\r\n// EVENT BUS IMPLEMENTATION\r\n// ============================================================================\r\n\r\nexport const eventBus: EventBus = {\r\n  events: {},\r\n\r\n  /**\r\n   * Subscribe to an event\r\n   */\r\n  subscribe<T = unknown>(eventName: string, listener: EventListener<T>): () => void {\r\n    if (!this.events[eventName]) {\r\n      this.events[eventName] = [];\r\n    }\r\n    this.events[eventName]!.push(listener as EventListener<any>);\r\n\r\n    // Return unsubscribe function for cleanup\r\n    return () => {\r\n      if (this.events[eventName]) {\r\n        this.events[eventName] = this.events[eventName]!.filter(l => l !== listener);\r\n      }\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Unsubscribe from an event\r\n   */\r\n  unsubscribe<T = unknown>(eventName: string, listener: EventListener<T>): void {\r\n    if (this.events[eventName]) {\r\n      this.events[eventName] = this.events[eventName]!.filter(l => l !== listener);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Publish an event to all subscribers\r\n   */\r\n  publish<T = unknown>(eventName: string, data: T): void {\r\n    const listeners = this.events[eventName];\r\n    if (listeners) {\r\n      listeners.forEach(listener => {\r\n        try {\r\n          listener(data);\r\n        } catch (error) {\r\n          console.error(`Error in event listener for ${eventName}:`, error);\r\n        }\r\n      });\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Clear event listeners\r\n   */\r\n  clear(eventName?: string): void {\r\n    if (eventName) {\r\n      delete this.events[eventName];\r\n    } else {\r\n      this.events = {};\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get listener count for an event\r\n   */\r\n  getListenerCount(eventName: string): number {\r\n    return this.events[eventName]?.length ?? 0;\r\n  },\r\n\r\n  /**\r\n   * Check if event has listeners\r\n   */\r\n  hasListeners(eventName: string): boolean {\r\n    return this.getListenerCount(eventName) > 0;\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// CONFIG MANAGER\r\n// ============================================================================\r\n\r\nexport const ConfigManager = {\r\n  /**\r\n   * Get configuration value with guaranteed return\r\n   */\r\n  get<T = unknown>(key: string, defaultValue?: T): T | undefined {\r\n    // Try GAME_CONFIG first\r\n    if (typeof window !== 'undefined' && window.GAME_CONFIG && key in window.GAME_CONFIG) {\r\n      const value = (window.GAME_CONFIG as unknown as Record<string, unknown>)[key];\r\n      if (value !== undefined) {\r\n        return value as T;\r\n      }\r\n    }\r\n\r\n    // Log warning for debugging\r\n    if (defaultValue === undefined) {\r\n      console.error(`\u274C Config.get(\"${key}\"): Missing and no default provided!`);\r\n    } else {\r\n      console.debug(`Config.get(\"${key}\"): Using default value ${defaultValue}`);\r\n    }\r\n\r\n    return defaultValue;\r\n  },\r\n\r\n  /**\r\n   * Get multiple config values at once\r\n   */\r\n  getBatch(keys: readonly string[]): Record<string, unknown> {\r\n    const result: Record<string, unknown> = {};\r\n    keys.forEach(key => {\r\n      result[key] = this.get(key);\r\n    });\r\n    return result;\r\n  },\r\n\r\n  /**\r\n   * Check if configuration is valid\r\n   */\r\n  validate(): void {\r\n    const required = [\r\n      'PITCH_WIDTH',\r\n      'PITCH_HEIGHT',\r\n      'GOAL_CHECK_DISTANCE',\r\n      'SHOOTING_CHANCE_BASE',\r\n      'PASSING_CHANCE'\r\n    ];\r\n\r\n    const missing = required.filter(key => {\r\n      if (typeof window === 'undefined' || !window.GAME_CONFIG) return true;\r\n      return !(key in window.GAME_CONFIG);\r\n    });\r\n\r\n    if (missing.length > 0) {\r\n      throw new Error(`\u274C Config validation failed. Missing: ${missing.join(', ')}`);\r\n    }\r\n\r\n    console.log('\u2713 Configuration validated successfully');\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// DEPENDENCY REGISTRY\r\n// ============================================================================\r\n\r\ninterface DependencyRegistryType {\r\n  loaded: Record<string, unknown>;\r\n  required: Record<string, string[]>;\r\n  register(moduleName: string, exports: unknown): void;\r\n  require(moduleName: string, dependencies: string[]): void;\r\n  get(moduleName: string): unknown;\r\n}\r\n\r\nexport const DependencyRegistry: DependencyRegistryType = {\r\n  loaded: {},\r\n  required: {},\r\n\r\n  register(moduleName: string, exports: unknown): void {\r\n    this.loaded[moduleName] = exports;\r\n    console.log(`\u2713 Module registered: ${moduleName}`);\r\n  },\r\n\r\n  require(moduleName: string, dependencies: string[]): void {\r\n    this.required[moduleName] = dependencies;\r\n  },\r\n\r\n  get(moduleName: string): unknown {\r\n    if (!this.loaded[moduleName]) {\r\n      throw new Error(`Module not loaded: ${moduleName}`);\r\n    }\r\n    return this.loaded[moduleName];\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// TACTICAL SYSTEM\r\n// ============================================================================\r\n\r\ninterface TacticDefinition {\r\n  systemType: string;\r\n  pressIntensity: number;\r\n  defensiveLineDepth: number;\r\n  counterAttackSpeed: number;\r\n  possessionPriority: number;\r\n  passingRisk: number;\r\n}\r\n\r\ninterface TacticalSystemType {\r\n  tactics: Record<string, TacticDefinition>;\r\n  getTactic(tacticName: string): TacticDefinition;\r\n  getSystemType(tacticName: string): string;\r\n  getAllTactics(): string[];\r\n}\r\n\r\nexport const TacticalSystem: TacticalSystemType = {\r\n  tactics: {\r\n    'balanced': {\r\n      systemType: 'balanced',\r\n      pressIntensity: 0.5,\r\n      defensiveLineDepth: 0.5,\r\n      counterAttackSpeed: 1.0,\r\n      possessionPriority: 0.5,\r\n      passingRisk: 0.5\r\n    },\r\n    'possession': {\r\n      systemType: 'possession',\r\n      pressIntensity: 0.3,\r\n      defensiveLineDepth: 0.7,\r\n      counterAttackSpeed: 0.8,\r\n      possessionPriority: 0.9,\r\n      passingRisk: 0.3\r\n    },\r\n    'high_press': {\r\n      systemType: 'high_press',\r\n      pressIntensity: 0.8,\r\n      defensiveLineDepth: 0.8,\r\n      counterAttackSpeed: 1.2,\r\n      possessionPriority: 0.6,\r\n      passingRisk: 0.6\r\n    },\r\n    'gegenpress': {\r\n      systemType: 'high_press',\r\n      pressIntensity: 0.9,\r\n      defensiveLineDepth: 0.9,\r\n      counterAttackSpeed: 1.3,\r\n      possessionPriority: 0.7,\r\n      passingRisk: 0.7\r\n    },\r\n    'counter_attack': {\r\n      systemType: 'counter_attack',\r\n      pressIntensity: 0.4,\r\n      defensiveLineDepth: 0.2,\r\n      counterAttackSpeed: 1.5,\r\n      possessionPriority: 0.3,\r\n      passingRisk: 0.8\r\n    },\r\n    'defensive': {\r\n      systemType: 'low_block',\r\n      pressIntensity: 0.4,\r\n      defensiveLineDepth: 0.3,\r\n      counterAttackSpeed: 1.1,\r\n      possessionPriority: 0.4,\r\n      passingRisk: 0.4\r\n    },\r\n    'park_bus': {\r\n      systemType: 'low_block',\r\n      pressIntensity: 0.2,\r\n      defensiveLineDepth: 0.1,\r\n      counterAttackSpeed: 1.0,\r\n      possessionPriority: 0.2,\r\n      passingRisk: 0.2\r\n    }\r\n  },\r\n\r\n  getTactic(tacticName: string): TacticDefinition {\r\n    const tactic = this.tactics[tacticName];\r\n    if (!tactic) {\r\n      console.warn(`Unknown tactic: ${tacticName}, using balanced`);\r\n      return this.tactics['balanced']!;\r\n    }\r\n    return tactic;\r\n  },\r\n\r\n  getSystemType(tacticName: string): string {\r\n    return this.getTactic(tacticName).systemType;\r\n  },\r\n\r\n  getAllTactics(): string[] {\r\n    return Object.keys(this.tactics);\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// GLOBAL DECLARATIONS\r\n// ============================================================================\r\n\r\ndeclare global {\r\n  interface Window {\r\n    STANDARD_EVENTS: typeof STANDARD_EVENTS;\r\n    eventBus: EventBus;\r\n    EVENT_TYPES: typeof EVENT_TYPES;\r\n    ConfigManager: typeof ConfigManager;\r\n    DependencyRegistry: typeof DependencyRegistry;\r\n    TacticalSystem: typeof TacticalSystem;\r\n    SHOW_OFFSIDE_LINES: boolean;\r\n    render?: () => void;\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// GLOBAL EXPORT FOR BROWSER COMPATIBILITY\r\n// ============================================================================\r\n\r\nif (typeof window !== 'undefined') {\r\n  window.STANDARD_EVENTS = STANDARD_EVENTS;\r\n  window.eventBus = eventBus;\r\n  window.EVENT_TYPES = EVENT_TYPES;\r\n  window.ConfigManager = ConfigManager;\r\n  window.DependencyRegistry = DependencyRegistry;\r\n  window.TacticalSystem = TacticalSystem;\r\n  window.SHOW_OFFSIDE_LINES = false;\r\n\r\n  console.log('\u2705 Event Bus System loaded (TypeScript)');\r\n}\r\n", "/**\r\n * Game Setup - Team Selection, Formation, and Player Initialization\r\n * Handles team composition, tactical selection, and player positioning\r\n */\r\n\r\nimport type { Player, GameState, PlayerRole, MutableVector2D } from './types';\r\nimport { FORMATIONS, GAME_CONFIG } from './config';\r\nimport { gameState } from './globalExports';\r\n\r\n// ============================================================================\r\n// HELPER FUNCTIONS\r\n// ============================================================================\r\n\r\nfunction initIfUndef<T>(obj: any, key: string, value: T): void {\r\n  if (obj[key] === undefined) obj[key] = value;\r\n}\r\n\r\n// ============================================================================\r\n// FORMATION STRUCTURES\r\n// ============================================================================\r\n\r\ninterface FormationStructure {\r\n  [role: string]: number;\r\n}\r\n\r\nconst FORMATION_STRUCTURES: Record<string, FormationStructure> = {\r\n  '4-3-3': {\r\n    'GK': 1, 'CB': 2, 'RB': 1, 'LB': 1, 'CDM': 1, 'CM': 1, 'CAM': 1, 'RW': 1, 'LW': 1, 'ST': 1\r\n  },\r\n  '4-2-3-1': {\r\n    'GK': 1, 'CB': 2, 'RB': 1, 'LB': 1, 'CDM': 2, 'CM': 1, 'CAM': 1, 'RW': 1, 'LW': 1, 'ST': 1\r\n  },\r\n  '3-5-2': {\r\n    'GK': 1, 'CB': 3, 'RB': 1, 'LB': 1, 'CM': 1, 'CAM': 1, 'RM': 1, 'LM': 1, 'ST': 2\r\n  },\r\n  '5-4-1': {\r\n    'GK': 1, 'CB': 3, 'RB': 1, 'LB': 1, 'CM': 2, 'CAM': 1, 'RW': 1, 'LW': 1, 'ST': 1\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// FORMATION POSITIONING\r\n// ============================================================================\r\n\r\n/**\r\n * Get ideal position for a player based on formation\r\n */\r\nexport function getFormationPosition(\r\n  player: Player,\r\n  team: string,\r\n  _formation: string,\r\n  gameState: GameState\r\n): MutableVector2D {\r\n  const sameRolePlayers = (team === 'home' ? gameState.homePlayers : gameState.awayPlayers)\r\n    .filter(p => p.role === player.role);\r\n  const roleIndex = sameRolePlayers.findIndex(p => p.id === player.id);\r\n\r\n  // Formation zones (Y spacing for players with same role)\r\n  const zones: Record<string, MutableVector2D> = {\r\n    'GK': { x: team === 'home' ? 50 : 750, y: 300 },\r\n    'CB': { x: team === 'home' ? 150 : 650, y: roleIndex === 0 ? 180 : roleIndex === 1 ? 300 : 420 },\r\n    'RB': { x: team === 'home' ? 150 : 650, y: 100 },\r\n    'LB': { x: team === 'home' ? 150 : 650, y: 500 },\r\n    'CDM': { x: team === 'home' ? 300 : 500, y: 300 },\r\n    'CM': { x: team === 'home' ? 350 : 450, y: roleIndex === 0 ? 200 : 400 },\r\n    'CAM': { x: team === 'home' ? 450 : 350, y: 300 },\r\n    'RW': { x: team === 'home' ? 500 : 300, y: 100 },\r\n    'LW': { x: team === 'home' ? 500 : 300, y: 500 },\r\n    'RM': { x: team === 'home' ? 500 : 300, y: 100 },\r\n    'LM': { x: team === 'home' ? 500 : 300, y: 500 },\r\n    'ST': { x: team === 'home' ? 650 : 150, y: roleIndex === 0 ? 250 : 350 }\r\n  };\r\n\r\n  return zones[player.role] || { x: 400, y: 300 };\r\n}\r\n\r\n/**\r\n * Apply formation constraint with smooth blending\r\n */\r\nexport function applyFormationConstraint(\r\n  player: Player,\r\n  team: string,\r\n  formation: string,\r\n  gameState: GameState\r\n): Player {\r\n  if (!formation || !FORMATION_STRUCTURES[formation]) return player;\r\n\r\n  const targetPos = getFormationPosition(player, team, formation, gameState);\r\n  const formationAdhesion = 0.08;  // How much to follow formation (0-1)\r\n\r\n  // Initialize formation position tracking\r\n  if (!(player as any).formationX) (player as any).formationX = player.x;\r\n  if (!(player as any).formationY) (player as any).formationY = player.y;\r\n\r\n  // Smoothly blend current position toward formation target\r\n  (player as any).formationX += (targetPos.x - (player as any).formationX) * formationAdhesion;\r\n  (player as any).formationY += (targetPos.y - (player as any).formationY) * formationAdhesion;\r\n\r\n  return player;\r\n}\r\n\r\n// ============================================================================\r\n// FORMATION POSITIONS\r\n// ============================================================================\r\n\r\ninterface FormationPosition {\r\n  x: number;\r\n  y: number;\r\n  role: string;\r\n}\r\n\r\nexport function getFormationPositions(\r\n  isHome: boolean,\r\n  isSecondHalf: boolean,\r\n  formationName: string\r\n): FormationPosition[] {\r\n  console.log('--- getFormationPositions \u0130\u00C7\u0130NDE ---');\r\n  console.log('Do\u011Frudan global FORMATIONS kontrol\u00FC, typeof:', typeof FORMATIONS);\r\n  console.log('formationName:', formationName);\r\n\r\n  const activeConfig = GAME_CONFIG;\r\n  const effectiveFormation = FORMATIONS[formationName] || FORMATIONS['4-3-3'];\r\n\r\n  console.log('Se\u00E7ilen formation:', effectiveFormation);\r\n  if (!effectiveFormation) {\r\n    console.error(`Formasyon bulunamad\u0131: ${formationName}. Varsay\u0131lan kullan\u0131l\u0131yor.`);\r\n    return FORMATIONS['4-3-3']!.map(pos => ({\r\n      x: pos.x * activeConfig.PITCH_WIDTH,\r\n      y: pos.y * activeConfig.PITCH_HEIGHT,\r\n      role: pos.role\r\n    }));\r\n  }\r\n\r\n  const shouldFlip = (isHome && isSecondHalf) || (!isHome && !isSecondHalf);\r\n\r\n  return effectiveFormation.map(pos => ({\r\n    x: shouldFlip ? (1 - pos.x) * activeConfig.PITCH_WIDTH : pos.x * activeConfig.PITCH_WIDTH,\r\n    y: pos.y * activeConfig.PITCH_HEIGHT,\r\n    role: pos.role\r\n  }));\r\n}\r\n\r\n// ============================================================================\r\n// PLAYER INITIALIZATION\r\n// ============================================================================\r\n\r\nexport function initializePlayers(\r\n  home: Player[],\r\n  away: Player[],\r\n  homeFormation: string,\r\n  awayFormation: string\r\n): { home: Player[]; away: Player[] } {\r\n  const homePositions = getFormationPositions(true, false, homeFormation);\r\n  const awayPositions = getFormationPositions(false, false, awayFormation);\r\n\r\n  const initPlayer = (player: Player, pos: FormationPosition, isHome: boolean, index: number): Player => ({\r\n    ...player,\r\n    id: `${isHome ? 'home' : 'away'}_${index}`,\r\n    x: pos.x,\r\n    y: pos.y,\r\n    homeX: pos.x,\r\n    homeY: pos.y,\r\n    targetX: pos.x,\r\n    targetY: pos.y,\r\n    vx: 0,\r\n    vy: 0,\r\n    isHome,\r\n    role: pos.role.toUpperCase() as PlayerRole,\r\n    lastDecisionTime: 0,\r\n    hasBallControl: false,\r\n    ballReceivedTime: null,\r\n    speedBoost: 1.0,\r\n    stamina: 100,\r\n    distanceCovered: 0,\r\n    targetLocked: false,\r\n    targetLockTime: 0,\r\n    facingAngle: 0,\r\n    scanState: null,\r\n  } as Player);\r\n\r\n  return {\r\n    home: home.map((p, i) => initPlayer(p, homePositions[i]!, true, i)),\r\n    away: away.map((p, i) => initPlayer(p, awayPositions[i]!, false, i))\r\n  };\r\n}\r\n\r\n// ============================================================================\r\n// FORMATION SELECTION\r\n// ============================================================================\r\n\r\nfunction calculateFormationScore(\r\n  positionCounts: { defenders: number; midfielders: number; attackers: number },\r\n  required: [number, number, number],\r\n  avgQualities: [number, number, number]\r\n): number {\r\n  const [reqDef, reqMid, reqAtt] = required;\r\n  const [qualDef, qualMid, qualAtt] = avgQualities;\r\n\r\n  const availabilityScore =\r\n    ((Math.min(positionCounts.defenders / reqDef, 1) +\r\n      Math.min(positionCounts.midfielders / reqMid, 1) +\r\n      Math.min(positionCounts.attackers / reqAtt, 1)) / 3) * 100;\r\n\r\n  const qualityScore = (qualDef + qualMid + qualAtt) / 6;\r\n  return availabilityScore * 0.5 + qualityScore * 0.5;\r\n}\r\n\r\nexport function selectBestFormation(teamPlayers: Player[]): string {\r\n  const positionCounts = { defenders: 0, midfielders: 0, attackers: 0, keepers: 0 };\r\n  const positionQuality = { defenders: 0, midfielders: 0, attackers: 0 };\r\n\r\n  teamPlayers.forEach(p => {\r\n    const pos = p.position.toLowerCase();\r\n    const quality = p.rating * 10 + (p.pace + p.shooting + p.passing + p.dribbling + p.defending) / 5;\r\n\r\n    if (pos.includes('keeper') || pos.includes('gk')) {\r\n      positionCounts.keepers++;\r\n    } else if (pos.includes('back') || pos.includes('cb') || pos.includes('rb') || pos.includes('lb')) {\r\n      positionCounts.defenders++;\r\n      positionQuality.defenders += quality;\r\n    } else if (pos.includes('mid') || pos.includes('cdm') || pos.includes('cm') || pos.includes('cam')) {\r\n      positionCounts.midfielders++;\r\n      positionQuality.midfielders += quality;\r\n    } else if (pos.includes('wing') || pos.includes('striker') || pos.includes('forward') || pos.includes('st')) {\r\n      positionCounts.attackers++;\r\n      positionQuality.attackers += quality;\r\n    }\r\n  });\r\n\r\n  // Calculate average quality per position\r\n  const avgDefQuality = positionCounts.defenders > 0 ? positionQuality.defenders / positionCounts.defenders : 0;\r\n  const avgMidQuality = positionCounts.midfielders > 0 ? positionQuality.midfielders / positionCounts.midfielders : 0;\r\n  const avgAttQuality = positionCounts.attackers > 0 ? positionQuality.attackers / positionCounts.attackers : 0;\r\n\r\n  const formationScores = {\r\n    '4-3-3': calculateFormationScore(positionCounts, [4, 3, 3], [avgDefQuality, avgMidQuality, avgAttQuality]),\r\n    '4-4-2': calculateFormationScore(positionCounts, [4, 4, 2], [avgDefQuality, avgMidQuality, avgAttQuality]),\r\n    '4-4-1-1': calculateFormationScore(positionCounts, [4, 5, 1], [avgDefQuality, avgMidQuality, avgAttQuality]),\r\n    '4-4-2-diamond': calculateFormationScore(positionCounts, [4, 4, 2], [avgDefQuality, avgMidQuality, avgAttQuality]),\r\n    '4-3-1-2': calculateFormationScore(positionCounts, [4, 4, 2], [avgDefQuality, avgMidQuality, avgAttQuality]),\r\n    '4-3-2-1': calculateFormationScore(positionCounts, [4, 5, 1], [avgDefQuality, avgMidQuality, avgAttQuality])\r\n  };\r\n\r\n  let bestFormation = '4-3-3';\r\n  let bestScore = 0;\r\n\r\n  for (const [formation, score] of Object.entries(formationScores)) {\r\n    if (score > bestScore) {\r\n      bestScore = score;\r\n      bestFormation = formation;\r\n    }\r\n  }\r\n\r\n  console.log(` Best formation for team: ${bestFormation} (score: ${bestScore.toFixed(2)})`);\r\n  return bestFormation;\r\n}\r\n\r\n// ============================================================================\r\n// TACTIC SELECTION\r\n// ============================================================================\r\n\r\nexport function selectBestTactic(teamPlayers: Player[]): string {\r\n  if (!teamPlayers || teamPlayers.length === 0) return 'balanced';\r\n\r\n  // Calculate team averages\r\n  const avgPace = teamPlayers.reduce((sum, p) => sum + p.pace, 0) / teamPlayers.length;\r\n  const avgPassing = teamPlayers.reduce((sum, p) => sum + p.passing, 0) / teamPlayers.length;\r\n  const avgDribbling = teamPlayers.reduce((sum, p) => sum + p.dribbling, 0) / teamPlayers.length;\r\n  const avgDefending = teamPlayers.reduce((sum, p) => sum + p.defending, 0) / teamPlayers.length;\r\n  const avgPhysicality = teamPlayers.reduce((sum, p) => sum + p.physicality, 0) / teamPlayers.length;\r\n  const avgShooting = teamPlayers.reduce((sum, p) => sum + p.shooting, 0) / teamPlayers.length;\r\n  const avgRating = teamPlayers.reduce((sum, p) => sum + p.rating, 0) / teamPlayers.length;\r\n\r\n  const tacticScores = {\r\n    balanced: 50, // Baseline\r\n    high_press: (avgPhysicality * 0.4 + avgDefending * 0.3 + avgPace * 0.3) * (avgRating / 10),\r\n    possession: (avgPassing * 0.5 + avgDribbling * 0.3 + avgDefending * 0.2) * (avgRating / 10),\r\n    counter_attack: (avgPace * 0.5 + avgShooting * 0.3 + avgDefending * 0.2) * (avgRating / 10),\r\n    park_the_bus: (avgDefending * 0.6 + avgPhysicality * 0.4) * (avgRating / 10),\r\n    total_football: (avgPassing * 0.3 + avgPace * 0.3 + avgDefending * 0.2 + avgShooting * 0.2) * (avgRating / 10)\r\n  };\r\n\r\n  // Find best tactic\r\n  let bestTactic = 'balanced';\r\n  let bestScore = tacticScores.balanced;\r\n\r\n  for (const [tactic, score] of Object.entries(tacticScores)) {\r\n    if (score > bestScore) {\r\n      bestScore = score;\r\n      bestTactic = tactic;\r\n    }\r\n  }\r\n\r\n  console.log(` Best tactic for team: ${bestTactic} (score: ${bestScore.toFixed(2)})`);\r\n  return bestTactic;\r\n}\r\n\r\n// ============================================================================\r\n// TEAM SELECTION\r\n// ============================================================================\r\n\r\nfunction getPositionFitness(player: Player, targetRole: string): number {\r\n  const playerPos = player.position.trim();\r\n  let fitnessScore = player.rating;\r\n\r\n  const positionMatches: Record<string, string[]> = {\r\n    'RB': ['Right-back', 'Right Back', 'Right Wing-Back', 'Wing-Back'],\r\n    'CB': ['Center-back', 'Centre-back', 'Defender'],\r\n    'LB': ['Left-back', 'Left Back', 'Left Wing-Back'],\r\n    'CDM': ['Defensive Midfielder', 'Midfielder'],\r\n    'CM': ['Midfielder', 'Central Midfielder'],\r\n    'RM': ['Right Midfielder', 'Midfielder'],\r\n    'LM': ['Left Midfielder', 'Midfielder'],\r\n    'CAM': ['Attacking Midfielder', 'Midfielder'],\r\n    'RW': ['Right Winger', 'Winger', 'Forward'],\r\n    'LW': ['Left Winger', 'Winger', 'Forward'],\r\n    'ST': ['Striker', 'Forward', 'Center Forward']\r\n  };\r\n\r\n  const exactMatches = positionMatches[targetRole] || [targetRole];\r\n  if (exactMatches.some(pos => playerPos.includes(pos) || pos.includes(playerPos))) {\r\n    fitnessScore += 2.0;\r\n  }\r\n\r\n  if (targetRole === 'CB') {\r\n    fitnessScore += (player.defending / 100) * 1.0 + (player.physicality / 100) * 0.5;\r\n  } else if (targetRole === 'RB' || targetRole === 'LB') {\r\n    fitnessScore += (player.defending / 100) * 0.7 + (player.pace / 100) * 0.5;\r\n  } else if (targetRole === 'CDM') {\r\n    fitnessScore += (player.defending / 100) * 0.6 + (player.passing / 100) * 0.4;\r\n  } else if (targetRole === 'CM') {\r\n    fitnessScore += (player.passing / 100) * 0.6 + (player.dribbling / 100) * 0.3;\r\n  } else if (targetRole === 'CAM') {\r\n    fitnessScore += (player.passing / 100) * 0.5 + (player.shooting / 100) * 0.4;\r\n  } else if (targetRole === 'RW' || targetRole === 'LW' || targetRole === 'RM' || targetRole === 'LM') {\r\n    fitnessScore += (player.pace / 100) * 0.5 + (player.dribbling / 100) * 0.4;\r\n  } else if (targetRole === 'ST') {\r\n    fitnessScore += (player.shooting / 100) * 0.8 + (player.pace / 100) * 0.3;\r\n  }\r\n\r\n  return fitnessScore;\r\n}\r\n\r\nexport function selectBestTeam(teamName: string): { players: Player[]; formation: string } {\r\n  const teamPlayers = gameState.players.filter(p => p.team === teamName) as unknown as Player[];\r\n  const formation = selectBestFormation(teamPlayers);\r\n\r\n  const selected: Player[] = [];\r\n  const positions = getFormationPositions(true, false, formation);\r\n\r\n  // Select best goalkeeper first\r\n  const gkPosition = positions.find(pos => pos.role === 'GK');\r\n  if (gkPosition) {\r\n    const goalkeepers = teamPlayers\r\n      .filter(p => {\r\n        const pos = (p as any).position?.toLowerCase() || '';\r\n        return pos.includes('keeper') || pos.includes('gk');\r\n      })\r\n      .sort((a, b) => {\r\n        const scoreA = ((a as any).goalkeeping * 0.7 + (a as any).rating * 30);\r\n        const scoreB = ((b as any).goalkeeping * 0.7 + (b as any).rating * 30);\r\n        return scoreB - scoreA;\r\n      });\r\n\r\n    if (goalkeepers.length > 0) {\r\n      selected.push(goalkeepers[0]!);\r\n    }\r\n  }\r\n\r\n  positions.forEach(pos => {\r\n    if (pos.role === 'GK') return;\r\n\r\n    const candidates = teamPlayers\r\n      .filter(p => !selected.includes(p) && (p as any).position?.toLowerCase() !== 'coach')\r\n      .map(p => ({\r\n        player: p,\r\n        fitness: getPositionFitness(p, pos.role)\r\n      }))\r\n      .sort((a, b) => b.fitness - a.fitness);\r\n\r\n    if (candidates.length > 0) {\r\n      selected.push(candidates[0]!.player);\r\n    }\r\n  });\r\n\r\n  return { players: selected.slice(0, 11), formation };\r\n}\r\n\r\n// ============================================================================\r\n// INITIALIZATION\r\n// ============================================================================\r\n\r\n/**\r\n * Initialize game state with proper defaults\r\n */\r\nexport function initializeGameSetup(gameState: GameState): void {\r\n  initIfUndef(gameState, 'stats', {});\r\n  const s = gameState.stats as any;\r\n\r\n  // Canonical containers\r\n  if (!s.home || typeof s.home !== 'object') s.home = {};\r\n  if (!s.away || typeof s.away !== 'object') s.away = {};\r\n\r\n  if (typeof s.home.possession !== 'number') s.home.possession = 0;\r\n  if (typeof s.away.possession !== 'number') s.away.possession = 0;\r\n\r\n  if (typeof s.home.passesCompleted !== 'number') s.home.passesCompleted = 0;\r\n  if (typeof s.home.passesAttempted !== 'number') s.home.passesAttempted = 0;\r\n  if (typeof s.away.passesCompleted !== 'number') s.away.passesCompleted = 0;\r\n  if (typeof s.away.passesAttempted !== 'number') s.away.passesAttempted = 0;\r\n\r\n  // Possession tracking\r\n  if (!s.possessionTimer || typeof s.possessionTimer !== 'object') {\r\n    s.possessionTimer = { home: 0, away: 0 };\r\n  }\r\n  if (typeof s.lastPossessionUpdate !== 'number') s.lastPossessionUpdate = Date.now();\r\n\r\n  // Basic state initialization\r\n  initIfUndef(gameState, 'status', 'upload');\r\n  initIfUndef(gameState, 'homeTeam', '');\r\n  initIfUndef(gameState, 'awayTeam', '');\r\n  initIfUndef(gameState, 'setPiece', null);\r\n  initIfUndef(gameState, 'ballPosition', { x: 400, y: 300 });\r\n  initIfUndef(gameState, 'ballVelocity', { x: 0, y: 0 });\r\n  initIfUndef(gameState, 'ballHeight', 0);\r\n  initIfUndef(gameState, 'ballTrajectory', null);\r\n  initIfUndef(gameState, 'ballHolder', null);\r\n  initIfUndef(gameState, 'lastTouchedBy', null);\r\n  initIfUndef(gameState, 'commentary', []);\r\n  initIfUndef(gameState, 'timeElapsed', 0);\r\n  initIfUndef(gameState, 'teams', []);\r\n  initIfUndef(gameState, 'players', []);\r\n  initIfUndef(gameState, 'teamJerseys', {});\r\n  initIfUndef(gameState, 'teamCoaches', {});\r\n  initIfUndef(gameState, 'teamLogos', {});\r\n  initIfUndef(gameState, 'homeJerseyColor', '#ef4444');\r\n  initIfUndef(gameState, 'awayJerseyColor', '#3b82f6');\r\n  initIfUndef(gameState, 'currentHalf', 1);\r\n  initIfUndef(gameState, 'homeScore', 0);\r\n  initIfUndef(gameState, 'awayScore', 0);\r\n  initIfUndef(gameState, 'homePlayers', []);\r\n  initIfUndef(gameState, 'awayPlayers', []);\r\n  initIfUndef(gameState, 'homeFormation', '4-3-3');\r\n  initIfUndef(gameState, 'awayFormation', '4-3-3');\r\n  initIfUndef(gameState, 'homeTactic', 'balanced');\r\n  initIfUndef(gameState, 'awayTactic', 'balanced');\r\n  initIfUndef(gameState, 'homeTeamState', 'BALANCED');\r\n  initIfUndef(gameState, 'awayTeamState', 'BALANCED');\r\n  initIfUndef(gameState, 'lastEventTime', 0);\r\n  initIfUndef(gameState, 'particles', []);\r\n  initIfUndef(gameState, 'cameraShake', 0);\r\n  initIfUndef(gameState, 'ballChasers', new Set());\r\n  initIfUndef(gameState, 'totalPasses', 0);\r\n  initIfUndef(gameState, 'totalShots', 0);\r\n  initIfUndef(gameState, 'shotInProgress', false);\r\n  initIfUndef(gameState, 'shooter', null);\r\n  initIfUndef(gameState, 'homeDefensiveLine', 200);\r\n  initIfUndef(gameState, 'awayDefensiveLine', 600);\r\n  initIfUndef(gameState, 'lastPossessionChange', 0);\r\n  initIfUndef(gameState, 'currentShotXG', null);\r\n  initIfUndef(gameState, 'currentPassReceiver', null);\r\n  initIfUndef(gameState, 'fouls', 0);\r\n  initIfUndef(gameState, 'yellowCards', []);\r\n  initIfUndef(gameState, 'redCards', []);\r\n  initIfUndef(gameState, 'lastGoalScorer', null);\r\n  initIfUndef(gameState, 'goalEvents', []);\r\n  initIfUndef(gameState, 'cardEvents', []);\r\n  initIfUndef(gameState, 'lastTeamStateUpdate', Date.now());\r\n  initIfUndef(gameState, 'possessionChanges', 0);\r\n  initIfUndef(gameState, 'isVertical', false);\r\n  initIfUndef(gameState, 'canvases', { background: null, game: null, ui: null });\r\n  initIfUndef(gameState, 'contexts', { background: null, game: null, ui: null });\r\n  initIfUndef(gameState, 'backgroundDrawn', false);\r\n  initIfUndef(gameState, 'gameUIDisplayed', false);\r\n  initIfUndef(gameState, 'offscreenPitch', null);\r\n}\r\n", "import type { GameState, Player } from '../types';\nimport { GAME_CONFIG } from '../config';\nimport { gameState } from '../globalExports';\n\nexport function ensureStatsShape(gs: GameState): void {\n  gs.stats = gs.stats || {};\n  const s = gs.stats;\n  s.home = s.home || {};\n  s.away = s.away || {};\n  if (typeof s.home.possession !== 'number') s.home.possession = 0;\n  if (typeof s.away.possession !== 'number') s.away.possession = 0;\n\n  s.possessionTimer = s.possessionTimer || { home: 0, away: 0 };\n  if (typeof s.lastPossessionUpdate !== 'number') s.lastPossessionUpdate = Date.now();\n\n  // keep legacy mirror in sync\n  s.possession = s.possession || { home: 0, away: 0 };\n  s.possession.home = s.home.possession;\n  s.possession.away = s.away.possession;\n}\n\nexport function setPossession(gs: GameState, homePct: number, awayPct: number): void {\n    const s = gs.stats;\n    s.home.possession = Math.max(0, Math.min(100, homePct));\n    s.away.possession = Math.max(0, Math.min(100, awayPct));\n    // update legacy mirror\n    s.possession.home = s.home.possession;\n    s.possession.away = s.away.possession;\n}\n\nexport const SET_PIECE_STATUSES = Object.freeze([\n    'GOAL_KICK',\n    'CORNER_KICK',\n    'THROW_IN',\n    'FREE_KICK',\n    'PENALTY',\n    'KICK_OFF'\n]);\n\nexport function isSetPieceStatus(status: string): boolean {\n    if (!status) return false;\n    return SET_PIECE_STATUSES.includes(status);\n}\n\nexport function getDistance(a: { x: number; y: number }, b: { x: number; y: number }): number {\n    const ax = Number(a?.x) || 0, ay = Number(a?.y) || 0;\n    const bx = Number(b?.x) || 0, by = Number(b?.y) || 0;\n    return Math.hypot(ax - bx, ay - by);\n}\n\nexport function getAttackingGoalX(isHome: boolean, currentHalf: number): number {\n    const GOAL_X_LEFT_DEFAULT = 50;\n    const GOAL_X_RIGHT_DEFAULT = 750;\n\n    const goalLeft = GAME_CONFIG.GOAL_X_LEFT ?? GOAL_X_LEFT_DEFAULT;\n    const goalRight = GAME_CONFIG.GOAL_X_RIGHT ?? GOAL_X_RIGHT_DEFAULT;\n\n    if (currentHalf === 1) {\n        return isHome ? goalRight : goalLeft;\n    } else {\n        return isHome ? goalLeft : goalRight;\n    }\n}\n\nexport function getNearestAttacker(x: number, y: number, allPlayers: Player[], attackingTeamIsHome: boolean): Player | null {\n    const attackers = allPlayers.filter(p =>\n        p.isHome === attackingTeamIsHome &&\n        p.role !== 'GK'\n    );\n\n    let nearest: Player | null = null;\n    let minDist = Infinity;\n\n    attackers.forEach(player => {\n        const dist = Math.sqrt((player.x - x) ** 2 + (player.y - y) ** 2);\n        if (dist < minDist) {\n            minDist = dist;\n            nearest = player;\n        }\n    });\n\n    return nearest;\n}\n\nexport function calculateXG(shooter: Player, goalX: number, goalY: number, opponents: Player[]): number {\n    const distToGoal = Math.sqrt(Math.pow(shooter.x - goalX, 2) + Math.pow(shooter.y - goalY, 2));\n    const angleToGoalCenter = Math.abs(shooter.y - 300);\n\n    const maxAngle = 150;\n    const angleQuality = Math.max(0, 1 - (angleToGoalCenter / maxAngle));\n\n    const normalizedDistance = Math.min(distToGoal / 400, 1);\n    const distanceQuality = Math.pow(1 - normalizedDistance, 1.5);\n\n    const nearbyDefenders = opponents.filter(opp => getDistance(shooter, opp) < 30);\n    const pressureMultiplier = Math.max(0.4, 1 - (nearbyDefenders.length * 0.18));\n\n    const shooterAbility = 0.2 + (shooter.shooting / 100) * 0.8;\n\n    const speed = Math.sqrt(shooter.vx * shooter.vx + shooter.vy * shooter.vy);\n    const movementPenalty = speed > 100 ? 0.9 : 1.0;\n\n    const fatiguePenalty = (shooter as any).stamina < 40 ? 0.95 : 1.0;\n\n    let xG = (distanceQuality * 0.35 + angleQuality * 0.30 + shooterAbility * 0.35) * pressureMultiplier * movementPenalty * fatiguePenalty;\n\n    xG = Math.max(0.03, Math.min(0.92, xG));\n\n    return xG;\n}\n\nexport function pointToLineDistance(point: { x: number; y: number }, lineStart: { x: number; y: number }, lineEnd: { x: number; y: number }): number {\n    const A = point.x - lineStart.x;\n    const B = point.y - lineStart.y;\n    const C = lineEnd.x - lineStart.x;\n    const D = lineEnd.y - lineStart.y;\n\n    const dot = A * C + B * D;\n    const lenSq = C * C + D * D;\n    let param = -1;\n\n    if (lenSq !== 0) param = dot / lenSq;\n\n    let xx, yy;\n\n    if (param < 0) {\n        xx = lineStart.x;\n        yy = lineStart.y;\n    } else if (param > 1) {\n        xx = lineEnd.x;\n        yy = lineEnd.y;\n    } else {\n        xx = lineStart.x + param * C;\n        yy = lineStart.y + param * D;\n    }\n\n    const dx = point.x - xx;\n    const dy = point.y - yy;\n    return Math.sqrt(dx * dx + dy * dy);\n}\n\nexport function getValidStat(statValue: any, defaultValue = 0): number {\n    const num = parseFloat(statValue);\n    return isNaN(num) ? defaultValue : num;\n}\n\nexport function resolveSide(value: any): 'home' | 'away' | null {\n    try {\n        if (value === true || value === 'home') return 'home';\n        if (value === false || value === 'away') return 'away';\n\n        if (typeof value === 'string') {\n            if (value === (gameState?.homeTeam || '').trim()) return 'home';\n            if (value === (gameState?.awayTeam || '').trim()) return 'away';\n        }\n\n        if (value && typeof value === 'object') {\n            if ('isHome' in value) return value.isHome ? 'home' : 'away';\n            if ('team' in value && value.team !== value) return resolveSide(value.team);\n            if ('side' in value && value.side !== value) return resolveSide(value.side);\n        }\n    } catch (error) {\n        console.error('[resolveSide] Error resolving side:', error, 'Input value:', value);\n    }\n\n    return null;\n}\n\nexport function invertSide(side: 'home' | 'away' | null): 'home' | 'away' | null {\n    if (side === 'home') return 'away';\n    if (side === 'away') return 'home';\n    return null;\n}\n", "import type { Player } from '../types';\nimport { getDistance, pointToLineDistance, getAttackingGoalX } from '../utils/ui';\nimport { gameState } from '../globalExports';\nimport { TACTICS } from '../config';\n\nexport const VISION_CONFIG = {\n    // Vision angles (in radians)\n    NORMAL_VISION_ANGLE: Math.PI * 0.9,      // 162\u00C2\u00B0 (0.9\u00CF\u20AC)\n    BALL_CARRIER_ANGLE: Math.PI * 0.75,      // 135\u00C2\u00B0 (narrower when dribbling)\n    UNDER_PRESSURE_ANGLE: Math.PI * 0.6,     // 108\u00C2\u00B0 (tunnel vision under pressure)\n\n    // Vision ranges\n    MAX_VISION_RANGE: 300,                    // pixels\n    PERIPHERAL_RANGE: 200,                    // Reduced detail in periphery\n\n    // Scan frequency (how often players \"check shoulder\")\n    SCAN_INTERVAL_MIN: 800,                   // ms\n    SCAN_INTERVAL_MAX: 2000,                  // ms\n    SCAN_DURATION: 300,                       // ms (time spent looking around)\n\n    // Ball is always visible (within reason)\n    BALL_ALWAYS_VISIBLE_RANGE: 400,\n\n    // Awareness modifiers\n    VISION_STAT_BONUS: 0.15,                  // Better players see more\n    COMPOSURE_BONUS: 0.1                      // Composure helps under pressure\n};\n\nexport function getPlayerFacingDirection(player: Player): number {\n    if (player.role === 'GK') {\n        if (player.vx !== 0 || player.vy !== 0) {\n            const speed = Math.sqrt(player.vx * player.vx + player.vy * player.vy);\n            if (speed > 10) {\n                return Math.atan2(player.vy, player.vx);\n            }\n        }\n        if (gameState.ballPosition) {\n            const distToBall = getDistance(player, gameState.ballPosition);\n            if (distToBall < 350) {\n                return Math.atan2(\n                    gameState.ballPosition.y - player.y,\n                    gameState.ballPosition.x - player.x\n                );\n            }\n        }\n        const opponentGoalX = getAttackingGoalX(player.isHome, gameState.currentHalf);\n        return Math.atan2(\n            300 - player.y,\n            opponentGoalX - player.x\n        );\n    }\n    if (player.vx !== 0 || player.vy !== 0) {\n        const speed = Math.sqrt(player.vx * player.vx + player.vy * player.vy);\n        if (speed > 10) {\n            return Math.atan2(player.vy, player.vx);\n        }\n    }\n\n    if (gameState.ballPosition && !player.hasBallControl) {\n        return Math.atan2(\n            gameState.ballPosition.y - player.y,\n            gameState.ballPosition.x - player.x\n        );\n    }\n\n    const opponentGoalX = getAttackingGoalX(player.isHome, gameState.currentHalf);\n    return Math.atan2(\n        300 - player.y,\n        opponentGoalX - player.x\n    );\n}\n\nexport function canPlayerSee(player: Player, target: { x: number, y: number, id?: string | number, isVisibleTo?: { [key: string]: boolean } }, detailLevel = 'full'): boolean {\n    // Distance check\n    const distance = getDistance(player, target);\n\n    // Ball is always visible at close range\n    if (target === gameState.ballPosition && distance < VISION_CONFIG.BALL_ALWAYS_VISIBLE_RANGE) {\n        return true;\n    }\n\n    // Check if within maximum vision range\n    const maxRange = detailLevel === 'peripheral' ?\n        VISION_CONFIG.PERIPHERAL_RANGE :\n        VISION_CONFIG.MAX_VISION_RANGE;\n\n    if (distance > maxRange) {\n        return false;\n    }\n\n    // Calculate angle to target\n    const angleToTarget = Math.atan2(\n        target.y - player.y,\n        target.x - player.x\n    );\n\n    // Get player's facing direction\n    const facingAngle = (player as any).facingAngle || getPlayerFacingDirection(player);\n\n    // Calculate angle difference (handle wraparound)\n    let angleDiff = Math.abs(angleToTarget - facingAngle);\n    if (angleDiff > Math.PI) {\n        angleDiff = 2 * Math.PI - angleDiff;\n    }\n\n    // Determine vision cone based on player state\n    let visionAngle = VISION_CONFIG.NORMAL_VISION_ANGLE;\n\n    // Ball carrier has narrower vision\n    if (player.hasBallControl) {\n        visionAngle = VISION_CONFIG.BALL_CARRIER_ANGLE;\n    }\n\n    // Under pressure? Even narrower\n    const nearbyOpponents = [...gameState.homePlayers, ...gameState.awayPlayers]\n        .filter(p => p.isHome !== player.isHome && getDistance(player, p) < 50);\n\n    if (nearbyOpponents.length > 1) {\n        visionAngle = VISION_CONFIG.UNDER_PRESSURE_ANGLE;\n    }\n\n    // Apply player skill modifiers\n    const awarenessBonus = (player.passing / 100) * VISION_CONFIG.VISION_STAT_BONUS;\n    visionAngle *= (1 + awarenessBonus);\n\n    // Is target within vision cone?\n    const inVisionCone = angleDiff < (visionAngle / 2);\n\n    // Store visibility info for debugging\n    if (target.id) {\n        target.isVisibleTo = target.isVisibleTo || {};\n        target.isVisibleTo[player.id] = inVisionCone;\n    }\n\n    return inVisionCone;\n}\n\nexport function updatePlayerScanning(player: Player): void {\n    const now = Date.now();\n\n    if (!(player as any).scanState) {\n        (player as any).scanState = {\n            lastScanTime: now,\n            nextScanTime: now + Math.random() * VISION_CONFIG.SCAN_INTERVAL_MAX,\n            isScanning: false,\n            scanStartTime: 0,\n            originalFacingAngle: 0\n        };\n    }\n\n    const scan = (player as any).scanState;\n\n    // FIX: If player gains ball control while scanning, immediately stop the scan.\n    if (player.hasBallControl && scan.isScanning) {\n        scan.isScanning = false;\n        (player as any).facingAngle = scan.originalFacingAngle;\n        return;\n    }\n\n    const scanFrequency = 1 - (player.passing / 100) * 0.3;\n    const scanInterval = VISION_CONFIG.SCAN_INTERVAL_MIN +\n        (VISION_CONFIG.SCAN_INTERVAL_MAX - VISION_CONFIG.SCAN_INTERVAL_MIN) * scanFrequency;\n\n    if (!scan.isScanning && now >= scan.nextScanTime) {\n        if (player.hasBallControl && player.speedBoost > 1.2) {\n            scan.nextScanTime = now + scanInterval;\n            return;\n        }\n\n        scan.isScanning = true;\n        scan.scanStartTime = now;\n        scan.originalFacingAngle = getPlayerFacingDirection(player);\n\n        const scanDirection = Math.random() < 0.5 ? 1 : -1;\n        (player as any).facingAngle = scan.originalFacingAngle + (Math.PI * 0.4 * scanDirection);\n    }\n\n    if (scan.isScanning) {\n        const scanDuration = now - scan.scanStartTime;\n\n        if (scanDuration >= VISION_CONFIG.SCAN_DURATION) {\n            scan.isScanning = false;\n            scan.lastScanTime = now;\n            scan.nextScanTime = now + scanInterval;\n            (player as any).facingAngle = scan.originalFacingAngle;\n        }\n    }\n}\n\nexport function getVisibleTeammates(player: Player, allPlayers: Player[]): Player[] {\n    const teammates = allPlayers.filter(p =>\n        p.isHome === player.isHome &&\n        p.id !== player.id &&\n        p.role !== 'GK'\n    );\n\n    // Filter by vision\n    return teammates.filter(teammate => {\n        // Basic visibility check\n        if (!canPlayerSee(player, teammate)) {\n            return false;\n        }\n\n        // FIXED: Better line of sight blocking\n        const opponents = allPlayers.filter(p => p.isHome !== player.isHome);\n        const distToTeammate = getDistance(player, teammate);\n\n        for (const opp of opponents) {\n            const distToOpp = getDistance(player, opp);\n\n            // Only check opponents that are between player and teammate\n            if (distToOpp < distToTeammate) {\n                const distToLine = pointToLineDistance(opp, player, teammate);\n\n                // Opponent blocking view? (closer threshold)\n                if (distToLine < 25) { // Increased from 20 for less strict blocking\n                    return false;\n                }\n            }\n        }\n\n        return true;\n    });\n}\n\nexport function findBestPassOption_WithVision(passer: Player, teammates: Player[], opponents: Player[]): Player | null {\n    const tactic = TACTICS[passer.isHome ? gameState.homeTactic : gameState.awayTactic]!;\n    if (!tactic) return null;\n    const teamState = passer.isHome ? gameState.homeTeamState : gameState.awayTeamState;\n    const opponentGoalX = getAttackingGoalX(passer.isHome, gameState.currentHalf);\n    const nearbyOpponentsPressure = opponents.filter(opp => getDistance(passer, opp) < 70);\n    const isUnderPressure = nearbyOpponentsPressure.length > 0;\n\n    const visibleTeammates = teammates.filter(t => canPlayerSee(passer, t));\n\n    if (visibleTeammates.length === 0) {\n        return null;\n    }\n\n    let bestOption: Player | null = null;\n    let bestScore = -1;\n\n    visibleTeammates.forEach(teammate => {\n        const dist = getDistance(passer, teammate);\n        const minDist = tactic.possessionPriority > 0.7 ? 40 : 40;\n        const maxDist = tactic.possessionPriority > 0.7 ? 200 : 300;\n\n        if (dist < minDist || dist > maxDist) return;\n\n        let passBlocked = false;\n        opponents.forEach(opp => {\n            const distToLine = pointToLineDistance(opp, passer, teammate);\n            if (distToLine < 30 && getDistance(passer, opp) < dist) {\n                passBlocked = true;\n            }\n        });\n\n        if (passBlocked) return;\n\n        let score = 100 - dist / 3;\n\n        const isForwardPass = (opponentGoalX > 400 && teammate.x > passer.x) ||\n            (opponentGoalX < 400 && teammate.x < passer.x);\n        if (isForwardPass) {\n            score += 40 * tactic.passingRisk;\n        }\n        // Bu, oyuncunun gereksiz yere ileriye olan momentumunu kesmesini engeller.\n        const facingAngle = getPlayerFacingDirection(passer);\n        const angleToTeammate = Math.atan2(teammate.y - passer.y, teammate.x - passer.x);\n        let angleDiff = Math.abs(angleToTeammate - facingAngle);\n        if (angleDiff > Math.PI) angleDiff = 2 * Math.PI - angleDiff;\n\n        // E\u00C4\u0178er pas, oyuncunun bakt\u00C4\u00B1\u00C4\u0178\u00C4\u00B1 y\u00C3\u00B6nden 90 dereceden fazla sap\u00C4\u00B1yorsa (yani yana veya geriye ise)\n        // ve oyuncu bask\u00C4\u00B1 alt\u00C4\u00B1nda de\u00C4\u0178ilse, bu pas\u00C4\u00B1n skorunu d\u00C3\u00BC\u00C5\u0178\u00C3\u00BCr.\n        if (!isUnderPressure && angleDiff > Math.PI / 2) { // Math.PI / 2 = 90 derece\n            score -= 60; // Geri d\u00C3\u00B6nmeyi daha az cazip hale getiren a\u00C4\u0178\u00C4\u00B1r bir ceza puan\u00C4\u00B1\n        }\n\n        const visionQuality = 1 - (angleDiff / Math.PI); // 1 = directly ahead, 0 = behind\n        score *= (0.7 + visionQuality * 0.3); // Up to 30% bonus for clear vision\n\n\n        if (teamState === 'COUNTER_ATTACK' && (teammate.role === 'ST' || teammate.role === 'RW' || teammate.role === 'LW')) {\n            score += 50;\n        } else if (teamState === 'DEFENDING' && (teammate.role === 'CM' || teammate.role === 'CDM')) {\n            score += 40;\n        }\n\n        if (tactic.possessionPriority > 0.7) {\n            if (teammate.role === 'CM' || teammate.role === 'CDM' || teammate.role === 'CAM') {\n                score += 30;\n            }\n        }\n\n        const nearbyOpps = opponents.filter(o => getDistance(o, teammate) < 40);\n        score -= nearbyOpps.length * 15;\n\n        if (score > bestScore) {\n            bestScore = score;\n            bestOption = teammate;\n        }\n    });\n\n    return bestOption;\n}\n\nexport function getPerceivedThreats(player: Player, opponents: Player[]): Player[] {\n    return opponents.filter(opp => {\n        if (getDistance(player, opp) < 30) {\n            return true;\n        }\n        return canPlayerSee(player, opp);\n    });\n}\n\nexport function drawVisionCones(ctx: CanvasRenderingContext2D): void {\n    if (!gameState.contexts || !gameState.contexts.game) return;\n\n    const allPlayers = [...gameState.homePlayers, ...gameState.awayPlayers];\n\n    allPlayers.forEach(player => {\n        const facingAngle = (player as any).facingAngle || getPlayerFacingDirection(player);\n\n        let visionAngle = VISION_CONFIG.NORMAL_VISION_ANGLE;\n        if (player.hasBallControl) {\n            visionAngle = VISION_CONFIG.BALL_CARRIER_ANGLE;\n        }\n\n        // Draw vision cone\n        ctx.save();\n        ctx.globalAlpha = 0.15;\n        ctx.fillStyle = player.isHome ? '#ef4444' : '#3b82f6';\n\n        ctx.beginPath();\n        ctx.moveTo(player.x, player.y);\n        ctx.arc(\n            player.x,\n            player.y,\n            VISION_CONFIG.MAX_VISION_RANGE,\n            facingAngle - visionAngle / 2,\n            facingAngle + visionAngle / 2\n        );\n        ctx.closePath();\n        ctx.fill();\n\n        // Draw facing direction\n        ctx.globalAlpha = 0.5;\n        ctx.strokeStyle = player.isHome ? '#ef4444' : '#3b82f6';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(player.x, player.y);\n        ctx.lineTo(\n            player.x + Math.cos(facingAngle) * 40,\n            player.y + Math.sin(facingAngle) * 40\n        );\n        ctx.stroke();\n\n        ctx.restore();\n    });\n}\n", "/**\r\n * Event System Type Definitions\r\n * Type-safe event bus and event payload definitions\r\n */\r\n\r\nimport type { Player } from './core';\r\n\r\n// ============================================================================\r\n// EVENT TYPES ENUM\r\n// ============================================================================\r\n\r\nexport const EVENT_TYPES = {\r\n  // Match events\r\n  MATCH_START: 'match:start',\r\n  MATCH_PAUSE: 'match:pause',\r\n  MATCH_RESUME: 'match:resume',\r\n  MATCH_END: 'match:end',\r\n  HALF_TIME: 'match:halftime',\r\n  KICKOFF: 'match:kickoff',\r\n\r\n  // Ball events\r\n  BALL_KICKED: 'ball:kicked',\r\n  BALL_PASSED: 'ball:passed',\r\n  BALL_INTERCEPTED: 'ball:intercepted',\r\n  BALL_OUT: 'ball:out',\r\n  BALL_WON: 'ball:won',\r\n  BALL_LOST: 'ball:lost',\r\n  BALL_POSITION_CHANGED: 'ball:positionChanged',\r\n  BALL_HOLDER_CHANGED: 'ball:holderChanged',\r\n\r\n  // Goal events\r\n  GOAL_SCORED: 'goal:scored',\r\n  SHOT_TAKEN: 'shot:taken',\r\n  SHOT_SAVED: 'shot:saved',\r\n  SHOT_MISSED: 'shot:missed',\r\n  SHOT_BLOCKED: 'shot:blocked',\r\n  SHOT_ATTEMPTED: 'shot:attempted',\r\n\r\n  // Player events\r\n  PLAYER_COLLISION: 'player:collision',\r\n  PLAYER_TACKLE: 'player:tackle',\r\n  PLAYER_DRIBBLE: 'player:dribble',\r\n  PLAYER_HEADER: 'player:header',\r\n  PLAYER_SUBSTITUTED: 'player:substituted',\r\n\r\n  // Foul events\r\n  FOUL_COMMITTED: 'foul:committed',\r\n  CARD_SHOWN: 'card:shown',\r\n  PENALTY_AWARDED: 'penalty:awarded',\r\n  FREE_KICK_AWARDED: 'freekick:awarded',\r\n\r\n  // Team events\r\n  TEAM_STATE_CHANGED: 'team:stateChanged',\r\n  FORMATION_CHANGED: 'team:formationChanged',\r\n  TACTIC_CHANGED: 'team:tacticChanged',\r\n  POSSESSION_CHANGED: 'team:possessionChanged',\r\n\r\n  // AI events\r\n  AI_DECISION_MADE: 'ai:decisionMade',\r\n  BT_NODE_EXECUTED: 'ai:btNodeExecuted',\r\n  ZONE_ASSIGNED: 'ai:zoneAssigned',\r\n\r\n  // Rendering events\r\n  RENDER_BACKGROUND: 'render:background',\r\n  RENDER_GAME: 'render:game',\r\n  RENDER_UI: 'render:ui',\r\n\r\n  // Stats events\r\n  STAT_UPDATED: 'stat:updated',\r\n  XG_CALCULATED: 'stat:xgCalculated',\r\n  PASS_COMPLETED: 'stat:passCompleted',\r\n  PASS_FAILED: 'stat:passFailed',\r\n\r\n  // Offside events\r\n  OFFSIDE_CALLED: 'offside:called',\r\n\r\n  // Set piece events\r\n  SET_PIECE_STARTED: 'setPiece:started',\r\n  SET_PIECE_EXECUTED: 'setPiece:executed',\r\n\r\n  // Match lifecycle\r\n  MATCH_STARTED: 'match:started',\r\n  MATCH_FINISHED: 'match:finished'\r\n} as const;\r\n\r\nexport type EventType = typeof EVENT_TYPES[keyof typeof EVENT_TYPES];\r\n\r\n// ============================================================================\r\n// EVENT PAYLOAD TYPES\r\n// ============================================================================\r\n\r\nexport interface FoulEventPayload {\r\n  readonly fouler: Player;\r\n  readonly fouled: Player;\r\n  readonly severity?: number;\r\n}\r\n\r\nexport interface GoalEventPayload {\r\n  readonly scorer: Player;\r\n  readonly isHome: boolean;\r\n  readonly time: number;\r\n  readonly xG: number;\r\n}\r\n\r\nexport interface ShotEventPayload {\r\n  readonly shooter: Player;\r\n  readonly targetX: number;\r\n  readonly targetY: number;\r\n  readonly xG: number;\r\n}\r\n\r\nexport interface PassEventPayload {\r\n  readonly passer: Player;\r\n  readonly receiver: Player | null;\r\n  readonly completed: boolean;\r\n}\r\n\r\nexport interface PossessionChangePayload {\r\n  readonly newHolder: Player;\r\n  readonly previousHolder: Player | null;\r\n}\r\n\r\nexport interface CardEventPayload {\r\n  readonly player: Player;\r\n  readonly cardType: 'yellow' | 'red';\r\n  readonly reason: string;\r\n}\r\n\r\nexport interface TeamStateChangePayload {\r\n  readonly team: 'home' | 'away';\r\n  readonly newState: string;\r\n  readonly previousState: string;\r\n}\r\n\r\n// ============================================================================\r\n// EVENT LISTENER TYPES\r\n// ============================================================================\r\n\r\nexport type EventListener<T = unknown> = (data: T) => void;\r\n\r\nexport type EventListenerMap = Map<EventType, EventListener[]>;\r\n\r\n// ============================================================================\r\n// EVENT BUS INTERFACE\r\n// ============================================================================\r\n\r\nexport interface EventBus {\r\n  events: Record<string, EventListener[]>;\r\n\r\n  /**\r\n   * Subscribe to an event\r\n   * @param eventName - Event to subscribe to\r\n   * @param listener - Callback function\r\n   * @returns Unsubscribe function\r\n   */\r\n  subscribe<T = unknown>(eventName: string, listener: EventListener<T>): () => void;\r\n\r\n  /**\r\n   * Publish an event\r\n   * @param eventName - Event to publish\r\n   * @param data - Event payload\r\n   */\r\n  publish<T = unknown>(eventName: string, data: T): void;\r\n\r\n  /**\r\n   * Clear event listeners\r\n   * @param eventName - Event to clear (or all if undefined)\r\n   */\r\n  clear(eventName?: string): void;\r\n\r\n  /**\r\n   * Get listener count for an event\r\n   * @param eventName - Event name\r\n   * @returns Number of listeners\r\n   */\r\n  getListenerCount(eventName: string): number;\r\n\r\n  /**\r\n   * Check if event has listeners\r\n   * @param eventName - Event name\r\n   * @returns True if has listeners\r\n   */\r\n  hasListeners(eventName: string): boolean;\r\n}\r\n\r\nexport type * from './events';\r\n", "import type { Player, GameState } from '../types';\nimport { getDistance } from '../utils/ui';\nimport { gameState } from '../globalExports';\nimport { GAME_CONFIG } from '../config';\nimport { SetPieceBehaviorSystem } from './SetPieceBehaviorSystem';\n\n// Re-export for external use\nexport { executeSetPiece_Router } from './execution';\n\ndeclare const PITCH_WIDTH: number;\ndeclare const PITCH_HEIGHT: number;\n\nexport const SET_PIECE_RULES = {\n    MIN_DISTANCE_PIXELS: 70,\n    THROW_IN_DISTANCE_PIXELS: 15\n};\n\n// Module-level telemetry tracking (replaces window.SET_PIECE_TELEMETRY)\nconst SET_PIECE_TELEMETRY = {\n    systemNotLoaded: 0,\n    noGameState: 0,\n    invalidPosition: 0,\n    successfulPositions: 0\n};\n\n// Debug flag (replaces window.DEBUG_SET_PIECES)\nconst DEBUG_SET_PIECES = false;\n\n// Original function backup (replaces window._originalSetPieceFunctions)\nlet _originalSetPieceFunctions: Record<string, any> | null = null;\n\nexport function ensureCorrectSetPiecePlacement(gameState: GameState): void {\n    try {\n        const sp = gameState?.setPiece;\n        if (!sp?.position) return;\n\n        const W = GAME_CONFIG.PITCH_WIDTH;\n        const H = GAME_CONFIG.PITCH_HEIGHT;\n\n        let x = Number(sp.position.x);\n        let y = Number(sp.position.y);\n\n        if (!isFinite(x) || !isFinite(y)) {\n            x = W / 2;\n            y = H / 2;\n        }\n\n        const M = 6;\n        x = Math.min(W - M, Math.max(M, x));\n        y = Math.min(H - M, Math.max(M, y));\n\n        sp.position.x = x;\n        sp.position.y = y;\n\n        gameState.ballPosition = { x, y };\n        gameState.ballVelocity = { x: 0, y: 0 };\n\n        const t = (sp as any).executionTime;\n        const traj = gameState.ballTrajectory;\n        const keep = !!(traj && typeof traj.startTime === \"number\" && typeof t === \"number\" && (t - traj.startTime) <= 200);\n\n        if (!keep) gameState.ballTrajectory = null;\n\n    } catch (err) {\n        console.error(\"ensureCorrectSetPiecePlacement failed\", err);\n    }\n}\n\nexport function assignSetPieceKicker(player: Player | null): void {\n    if (typeof gameState === 'undefined' || !gameState || !gameState.setPiece) {\n        return;\n    }\n\n    (gameState.setPiece as any).kicker = player || null;\n}\n\nexport function getCornerKickPosition(isLeftCorner: boolean, isTopCorner: boolean): { x: number; y: number } {\n    const CORNER_MARGIN = 5;\n    const pitchWidth = GAME_CONFIG.PITCH_WIDTH || 800;\n    const pitchHeight = GAME_CONFIG.PITCH_HEIGHT || 600;\n\n    return {\n        x: isLeftCorner ? CORNER_MARGIN : pitchWidth - CORNER_MARGIN,\n        y: isTopCorner ? CORNER_MARGIN : pitchHeight - CORNER_MARGIN\n    };\n}\n\nexport function getGoalKickPosition(goalX: number, preferredSide = 'center'): { x: number; y: number } {\n    const GOAL_KICK_DISTANCE = 52;\n    const direction = Math.sign((GAME_CONFIG.PITCH_WIDTH / 2 || 400) - goalX);\n    const goalYTop = GAME_CONFIG.GOAL_Y_TOP || 240;\n    const goalYBottom = GAME_CONFIG.GOAL_Y_BOTTOM || 360;\n    const pitchHeight = GAME_CONFIG.PITCH_HEIGHT || 600;\n\n    let y = pitchHeight / 2;\n    if (preferredSide === 'left') y = goalYTop + 20;\n    else if (preferredSide === 'right') y = goalYBottom - 20;\n\n    return {\n        x: goalX + direction * GOAL_KICK_DISTANCE,\n        y: y\n    };\n}\n\nexport function positionForSetPiece_Unified(player: Player, allPlayers: Player[]): void {\n    if (typeof SetPieceBehaviorSystem === 'undefined' || !SetPieceBehaviorSystem.getSetPiecePosition) {\n        SET_PIECE_TELEMETRY.systemNotLoaded++;\n        console.error(`\u274C CRITICAL: SetPieceBehaviorSystem not loaded! Falling back to legacy positioning for ${player.name}`);\n        console.error(`   This should NEVER happen - check script load order! (Count: ${SET_PIECE_TELEMETRY.systemNotLoaded})`);\n        return positionForSetPiece_Legacy(player, allPlayers);\n    }\n\n    if (!gameState || !gameState.setPiece) {\n        SET_PIECE_TELEMETRY.noGameState++;\n        console.warn(`\u26A0\uFE0F positionForSetPiece_Unified called without gameState or setPiece for ${player.name}`);\n        console.warn(`   gameState exists: ${!!gameState}, setPiece exists: ${!!gameState?.setPiece} (Count: ${SET_PIECE_TELEMETRY.noGameState})`);\n        return positionForSetPiece_Legacy(player, allPlayers);\n    }\n\n    const position = SetPieceBehaviorSystem.getSetPiecePosition(player, gameState);\n\n    if (!position || typeof position.x !== 'number' || typeof position.y !== 'number' || isNaN(position.x) || isNaN(position.y)) {\n        SET_PIECE_TELEMETRY.invalidPosition++;\n        console.error(`\u274C getSetPiecePosition INVALID POSITION for ${player.name} (${player.role}) during ${gameState.setPiece.type}`);\n        console.error(`   Returned position:`, position);\n        console.error(`   Expected: {x: number, y: number}, got: {x: ${typeof (position as any)?.x}, y: ${typeof (position as any)?.y}} (Count: ${SET_PIECE_TELEMETRY.invalidPosition})`);\n        return positionForSetPiece_Legacy(player, allPlayers);\n    }\n\n    SET_PIECE_TELEMETRY.successfulPositions++;\n    if (DEBUG_SET_PIECES && SET_PIECE_TELEMETRY.successfulPositions % 50 === 0) {\n        console.log(`[SetPiece] Telemetry: ${SET_PIECE_TELEMETRY.successfulPositions} successful positions, ${SET_PIECE_TELEMETRY.invalidPosition} invalid, ${SET_PIECE_TELEMETRY.noGameState} missing state, ${SET_PIECE_TELEMETRY.systemNotLoaded} system not loaded`);\n    }\n\n    player.targetX = position.x;\n    player.targetY = position.y;\n    (player as any).setPieceTarget = { x: position.x, y: position.y };\n\n    const timeUntilExecution = (gameState.setPiece as any).executionTime ?\n        (gameState.setPiece as any).executionTime - Date.now() : 3000;\n\n    const isUrgent = timeUntilExecution < 2000;\n    const movementTag = typeof (position as any).movement === 'string' ? (position as any).movement.toLowerCase() : '';\n    const isKickerOrThrower =\n        movementTag.includes('kicker') ||\n        movementTag.includes('thrower') ||\n        movementTag.includes('take_kick');\n\n    if (isKickerOrThrower) {\n        player.speedBoost = 2.0;\n        (player as any).setPieceLocked = getDistance(player, (gameState.setPiece as any).position) < 8;\n    } else if (isUrgent) {\n        player.speedBoost = 1.8;\n        (player as any).setPieceLocked = false;\n    } else {\n        player.speedBoost = 1.5;\n        (player as any).setPieceLocked = false;\n    }\n\n    (player as any).setPieceMovement = (position as any).movement;\n    (player as any).setPieceRole = (position as any).role;\n\n    if ((position as any).targetX && (position as any).targetY) {\n        (player as any).setPieceRunTarget = { x: (position as any).targetX, y: (position as any).targetY };\n    } else {\n        (player as any).setPieceRunTarget = null;\n    }\n}\n\nexport function positionForSetPiece_Legacy(player: Player, allPlayers: Player[]): void {\n    const status = gameState.status;\n\n    if (!_originalSetPieceFunctions) {\n        player.targetX = player.x;\n        player.targetY = player.y;\n        return;\n    }\n\n    const originals = _originalSetPieceFunctions;\n\n    try {\n        if (status === 'CORNER_KICK' && typeof originals['positionForCornerKick'] === 'function') {\n            originals['positionForCornerKick'](player, allPlayers);\n        } else if (status === 'FREE_KICK' && typeof originals['positionForFreeKick'] === 'function') {\n            originals['positionForFreeKick'](player, allPlayers);\n        } else if (status === 'THROW_IN' && typeof originals['positionForThrowIn'] === 'function') {\n            originals['positionForThrowIn'](player, allPlayers);\n        } else if (status === 'GOAL_KICK' && typeof originals['positionForGoalKick'] === 'function') {\n            originals['positionForGoalKick'](player, allPlayers);\n        } else {\n            player.targetX = player.x;\n            player.targetY = player.y;\n        }\n    } catch (error) {\n        console.error(`\u274C Error executing legacy function for ${status}:`, error);\n        player.targetX = player.x;\n        player.targetY = player.y;\n    }\n}\n\nexport function updatePlayerAI_V2_SetPieceEnhancement(player: Player, allPlayers: Player[], gameState: GameState): boolean {\n    if (!gameState?.setPiece || !(gameState.setPiece as any)?.type) {\n        if (gameState?.status && ['KICK_OFF', 'FREE_KICK', 'CORNER_KICK', 'THROW_IN', 'GOAL_KICK', 'PENALTY'].includes(gameState.status)) {\n            console.warn(`\u26A0\uFE0F SET-PIECE AI: Set-piece status (${gameState.status}) active but no setPiece object for player ${player.name}`);\n        }\n        return false;\n    }\n\n    if (!(player as any).setPieceTarget) {\n        positionForSetPiece_Unified(player, allPlayers);\n\n        if (!(player as any).setPieceTarget) {\n            console.error(`\u274C SET-PIECE AI ERROR: positionForSetPiece_Unified FAILED for ${player.name} (${player.role}) during ${gameState.setPiece.type}`);\n            console.error(`   Player:`, { id: player.id, isHome: player.isHome, x: player.x, y: player.y });\n            console.error(`   SetPiece:`, gameState.setPiece);\n        }\n    }\n\n    const now = Date.now();\n    const executionTime = (gameState.setPiece as any).executionTime || now;\n    const timeUntilKick = executionTime - now;\n\n    if ((player as any).lockUntil && now < (player as any).lockUntil) {\n        if ((player as any).setPieceTarget) {\n            const isKickerLocked = (player as any).isKicker && timeUntilKick < 500;\n            if (isKickerLocked) {\n                player.x = (player as any).setPieceTarget.x;\n                player.y = (player as any).setPieceTarget.y;\n                player.targetX = (player as any).setPieceTarget.x;\n                player.targetY = (player as any).setPieceTarget.y;\n                player.vx = 0;\n                player.vy = 0;\n                (player as any).intent = \"SET_PIECE_HOLD\";\n                return true;\n            }\n        }\n    }\n\n    if ((player as any).lockUntil && now >= (player as any).lockUntil) {\n        (player as any).lockUntil = 0;\n        if ((gameState.setPiece as any).executed || gameState.status === 'playing') {\n            (player as any).setPieceTarget = null;\n        }\n        (player as any).isInWall = false;\n        (player as any).isDefCBLine = false;\n        (player as any).isMarker = false;\n        (player as any).isKicker = false;\n        return false;\n    }\n\n    if ((player as any).isKicker && timeUntilKick <= 800 && timeUntilKick > -200) {\n        const bx = gameState.ballPosition.x;\n        const by = gameState.ballPosition.y;\n        const dx = player.x - bx;\n        const dy = player.y - by;\n        const dist = Math.hypot(dx, dy);\n\n        if (dist > 8) {\n            player.targetX = bx;\n            player.targetY = by;\n            player.speedBoost = 2.5;\n            (player as any).intent = \"KICKER_APPROACHING\";\n            return true;\n        } else {\n            player.x = bx;\n            player.y = by;\n            player.targetX = bx;\n            player.targetY = by;\n            player.vx = 0;\n            player.vy = 0;\n            (player as any).intent = \"KICKER_READY\";\n            return true;\n        }\n    }\n\n    if ((player as any).setPieceTarget) {\n        const dist = Math.hypot(player.x - (player as any).setPieceTarget.x, player.y - (player as any).setPieceTarget.y);\n\n        const wasCloseLastFrame = (player as any)._setPieceWasClose || false;\n        const threshold = wasCloseLastFrame ? 3 : 8;\n\n        if (dist > threshold) {\n            player.targetX = (player as any).setPieceTarget.x;\n            player.targetY = (player as any).setPieceTarget.y;\n            player.speedBoost = dist > 50 ? 1.8 : 1.3;\n            (player as any).intent = \"SET_PIECE_POSITIONING\";\n            (player as any)._setPieceWasClose = false;\n            return true;\n        } else {\n            player.targetX = (player as any).setPieceTarget.x;\n            player.targetY = (player as any).setPieceTarget.y;\n            (player as any).intent = \"SET_PIECE_READY\";\n            (player as any)._setPieceWasClose = true;\n            return true;\n        }\n    }\n\n    console.error(`\u274C SET-PIECE AI CRITICAL: Player ${player.name} has NO setPieceTarget during ${gameState.setPiece.type}!`);\n    console.error(`   This means positionForSetPiece_Unified failed silently. THIS IS A BUG.`);\n    console.error(`   Player:`, { id: player.id, role: player.role, isHome: player.isHome, x: player.x, y: player.y });\n    console.error(`   SetPiece:`, gameState.setPiece);\n    console.error(`   Stack:`, new Error().stack);\n\n    player.targetX = player.x;\n    player.targetY = player.y;\n    return true;\n}\n\nexport function executeSetPiece_PostExecution(): void {\n    const setPieceToClear = gameState.setPiece;\n\n    if (!setPieceToClear) {\n        console.warn(\"\u26A0\uFE0F PostExecution: setPiece already null, skipping cleanup\");\n        (gameState as any).setPieceExecuting = false;\n        if (gameState.status !== 'playing' && gameState.status !== 'finished' && gameState.status !== 'halftime') {\n            gameState.status = 'playing';\n        }\n        return;\n    }\n\n    (setPieceToClear as any).executed = true;\n    (gameState as any).setPieceExecuting = false;\n\n    if (gameState.ballTrajectory) {\n        const trajectory = gameState.ballTrajectory;\n        const hasValidStartTime = typeof trajectory.startTime === 'number' && !isNaN(trajectory.startTime);\n        const executionTime = (setPieceToClear as any)?.executionTime;\n\n        const shouldClearTrajectory =\n            !hasValidStartTime ||\n            (typeof executionTime === 'number' && trajectory.startTime < executionTime - 200);\n\n        if (shouldClearTrajectory) {\n            console.log(\"Clearing stale ball trajectory\");\n            gameState.ballTrajectory = null;\n        }\n    }\n\n    console.log(`\u2713 Set piece ${setPieceToClear.type} executed. Transitioning to playing...`);\n\n    const needsImmediateTransition = ['KICK_OFF', 'GOAL_KICK'].includes(setPieceToClear.type);\n    const CLEANUP_DELAY_MS = needsImmediateTransition ? 0 : 150;\n\n    const cleanupFunction = () => {\n        if (gameState.setPiece === setPieceToClear) {\n            gameState.setPiece = null;\n        }\n\n        if (gameState.status === setPieceToClear.type) {\n            gameState.status = 'playing';\n        }\n\n        const allPlayers = [...(gameState.homePlayers || []), ...(gameState.awayPlayers || [])];\n        allPlayers.forEach(player => {\n            if (player) {\n                (player as any).setPieceLocked = false;\n                (player as any).setPieceMovement = null;\n                (player as any).setPieceRole = null;\n                (player as any).setPieceRunTarget = null;\n                (player as any).setPieceTarget = null;\n                (player as any)._setPieceWasClose = false;\n                player.speedBoost = 1.0;\n                (player as any).lockUntil = 0;\n                (player as any).isKicker = false;\n                (player as any).isInWall = false;\n                (player as any).isDefCBLine = false;\n                (player as any).isMarker = false;\n            }\n        });\n\n        cleanupSetPieceManagers();\n\n        console.log(`\u2705 Set piece cleanup complete. Status: ${gameState.status}`);\n    };\n\n    if (CLEANUP_DELAY_MS === 0) {\n        if (typeof requestAnimationFrame !== 'undefined') {\n            requestAnimationFrame(cleanupFunction);\n        } else {\n            cleanupFunction();\n        }\n    } else {\n        setTimeout(cleanupFunction, CLEANUP_DELAY_MS);\n    }\n}\n\nfunction cleanupSetPieceManagers(): void {\n    delete (gameState as any)._fkAttPosManager;\n    delete (gameState as any)._fkDefPosManager;\n    delete (gameState as any)._cornerPosManager;\n    delete (gameState as any)._cornerDefPosManager;\n    delete (gameState as any)._goalKickPosManager;\n    delete (gameState as any)._goalKickDefPosManager;\n    delete (gameState as any)._throwInPosManager;\n\n    delete (gameState as any)._fkJobAssignments;\n    delete (gameState as any)._fkDefJobAssignments;\n    delete (gameState as any)._cornerJobAssignments;\n    delete (gameState as any)._cornerDefJobAssignments;\n    delete (gameState as any)._goalKickJobAssignments;\n    delete (gameState as any)._goalKickDefJobAssignments;\n    delete (gameState as any)._throwInJobAssignments;\n\n    delete (gameState as any)._fkOpponentMap;\n    delete (gameState as any)._cornerOpponentMap;\n    delete (gameState as any)._goalKickOpponentMap;\n\n    delete (gameState as any)._currentWallSize;\n}\n\n// Functions are now exported via ES6 modules - no window exports needed\n", "/**\r\n * Particle System\r\n * Handles visual effects particles for goals, passes, saves, and ball trails\r\n *\r\n * @migrated-from js/rendering/particles.js\r\n * \u2705 Migrated from JavaScript with zero functional changes\r\n * \u2705 Full type safety with strict TypeScript\r\n */\r\n\r\nimport type { GameState, Particle as ParticleInterface } from '../types';\r\nimport { gameState } from '../globalExports';\r\n\r\n// ============================================================================\r\n// GLOBAL DECLARATIONS\r\n// ============================================================================\r\n\r\ndeclare global {\r\n  interface Window {\r\n    gameState: GameState;\r\n    Particle?: typeof Particle;\r\n    createGoalExplosion?: typeof createGoalExplosion;\r\n    createBallTrail?: typeof createBallTrail;\r\n    createPassEffect?: typeof createPassEffect;\r\n    createSaveEffect?: typeof createSaveEffect;\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// PARTICLE CLASS\r\n// ============================================================================\r\n\r\n/**\r\n * Particle class for visual effects\r\n */\r\nexport class Particle implements ParticleInterface {\r\n  x: number;\r\n  y: number;\r\n  vx: number;\r\n  vy: number;\r\n  color: string;\r\n  life: number;\r\n  decay: number;\r\n  size: number;\r\n  radius: number;\r\n  alpha: number;\r\n  type: string;\r\n  rotation: number;\r\n  gravity: number;\r\n  createdAt: number;\r\n\r\n  constructor(x: number, y: number, color: string, velocityX: number = 0, velocityY: number = 0) {\r\n    this.x = x;\r\n    this.y = y;\r\n    this.vx = velocityX;\r\n    this.vy = velocityY;\r\n    this.color = color;\r\n    this.life = 1.0;\r\n    this.alpha = 1.0;\r\n    this.decay = 0.02 + Math.random() * 0.02;\r\n    this.size = 3 + Math.random() * 5;\r\n    this.radius = this.size;\r\n    this.type = 'default';\r\n    this.rotation = 0;\r\n    this.gravity = 300; // pixels/second^2\r\n    this.createdAt = Date.now();\r\n  }\r\n\r\n  update(dt: number): void {\r\n    // Apply velocity and gravity, scaled by delta time (seconds)\r\n    this.x += this.vx * dt;\r\n    this.y += this.vy * dt;\r\n    this.vy += this.gravity * dt;\r\n\r\n    // FIX: Unify time scaling for all physics properties.\r\n    // Both friction and decay are now consistently scaled by dt.\r\n    const frameMultiplier = dt * 60; // Assumes a 60fps baseline for decay values\r\n    this.vx *= Math.pow(0.98, frameMultiplier);\r\n    this.life -= this.decay * frameMultiplier;\r\n    this.alpha = this.life;\r\n    this.size *= Math.pow(0.98, frameMultiplier);\r\n    this.radius = this.size;\r\n  }\r\n\r\n  draw(ctx: CanvasRenderingContext2D): void {\r\n    if (this.life <= 0) return;\r\n\r\n    ctx.save();\r\n    ctx.globalAlpha = this.life;\r\n    ctx.shadowColor = this.color;\r\n    ctx.shadowBlur = 10;\r\n    ctx.fillStyle = this.color;\r\n    ctx.beginPath();\r\n    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);\r\n    ctx.fill();\r\n    ctx.restore();\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// PARTICLE EFFECT FUNCTIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Create goal explosion effect\r\n */\r\nexport function createGoalExplosion(x: number, y: number, color: string): void {\r\n  const particleCount = 80; // Increased from 60\r\n\r\n  // Main explosion burst\r\n  for (let i = 0; i < particleCount; i++) {\r\n    const angle = (Math.PI * 2 * i) / particleCount;\r\n    const speed = 250 + Math.random() * 350; // Increased speed\r\n    const velocityX = Math.cos(angle) * speed;\r\n    const velocityY = Math.sin(angle) * speed - 250;\r\n\r\n    const particle = new Particle(x, y, color, velocityX, velocityY);\r\n    particle.size = 4 + Math.random() * 6; // Larger particles\r\n    gameState.particles.push(particle);\r\n  }\r\n\r\n  // Secondary white burst\r\n  for (let i = 0; i < 40; i++) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = 150 + Math.random() * 250;\r\n    const velocityX = Math.cos(angle) * speed;\r\n    const velocityY = Math.sin(angle) * speed - 150;\r\n\r\n    const particle = new Particle(x, y, '#ffffff', velocityX, velocityY);\r\n    particle.size = 3;\r\n    gameState.particles.push(particle);\r\n  }\r\n\r\n  // Sparkle layer\r\n  for (let i = 0; i < 30; i++) {\r\n    const offsetX = (Math.random() - 0.5) * 120;\r\n    const offsetY = (Math.random() - 0.5) * 120;\r\n    const particle = new Particle(x + offsetX, y + offsetY, color, 0, -120);\r\n    particle.decay = 0.03;\r\n    particle.size = 4;\r\n    gameState.particles.push(particle);\r\n  }\r\n\r\n  gameState.cameraShake = 12; // Reduced for shorter duration\r\n}\r\n\r\n/**\r\n * Create ball trail effect\r\n */\r\nexport function createBallTrail(x: number, y: number): void {\r\n  // Enhanced ball trail with motion blur effect\r\n  if (Math.random() < 0.5) { // More frequent trails\r\n    const particle = new Particle(\r\n      x + (Math.random() - 0.5) * 8,\r\n      y + (Math.random() - 0.5) * 8,\r\n      '#ffffff',\r\n      (Math.random() - 0.5) * 20,\r\n      (Math.random() - 0.5) * 20\r\n    );\r\n    // Make the particle fade out much slower for a longer trail\r\n    particle.decay = 0.02; // Slower fade (was 0.08)\r\n    particle.size = 3 + Math.random() * 2;\r\n    gameState.particles.push(particle);\r\n  }\r\n}\r\n\r\n/**\r\n * Create pass effect\r\n */\r\nexport function createPassEffect(x: number, y: number, color: string): void {\r\n  for (let i = 0; i < 5; i++) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = 50 + Math.random() * 100;\r\n    const velocityX = Math.cos(angle) * speed;\r\n    const velocityY = Math.sin(angle) * speed;\r\n\r\n    const particle = new Particle(x, y, color, velocityX, velocityY);\r\n    particle.size = 2 + Math.random() * 3;\r\n    particle.decay = 0.04;\r\n    gameState.particles.push(particle);\r\n  }\r\n}\r\n\r\n/**\r\n * Create save effect\r\n */\r\nexport function createSaveEffect(x: number, y: number): void {\r\n  for (let i = 0; i < 15; i++) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = 100 + Math.random() * 200;\r\n    const velocityX = Math.cos(angle) * speed;\r\n    const velocityY = Math.sin(angle) * speed;\r\n\r\n    const colors = ['#3b82f6', '#60a5fa', '#93c5fd'];\r\n    const color = colors[Math.floor(Math.random() * colors.length)] || '#3b82f6';\r\n\r\n    const particle = new Particle(x, y, color, velocityX, velocityY);\r\n    particle.size = 3 + Math.random() * 4;\r\n    particle.decay = 0.03;\r\n    gameState.particles.push(particle);\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// BROWSER EXPORTS\r\n// ============================================================================\r\n\r\n// Functions are now exported via ES6 modules - no window exports needed\r\n", "import { gameState } from '../globalExports';\n\nlet confettiParticles: ConfettiParticle[] = [];\nconst gravity = 0.4;\nlet confettiAnimationId: number | null = null;\n\nclass ConfettiParticle {\n    x: number;\n    y: number;\n    color: string;\n    size: number;\n    vx: number;\n    vy: number;\n    rotation: number;\n    rotationSpeed: number;\n    opacity: number;\n\n    constructor(x: number, y: number, color: string) {\n        this.x = x;\n        this.y = y;\n        this.color = color;\n        this.size = Math.random() * 8 + 4;\n        this.vx = Math.random() * 8 - 4;\n        this.vy = Math.random() * -10 - 5; // Start moving upwards\n        this.rotation = Math.random() * 360;\n        this.rotationSpeed = Math.random() * 20 - 10;\n        this.opacity = 1;\n    }\n\n    update() {\n        this.vy += gravity;\n        this.x += this.vx;\n        this.y += this.vy;\n        this.rotation += this.rotationSpeed;\n        if (gameState && gameState.canvases && gameState.canvases.ui && this.y > gameState.canvases.ui.height + this.size) {\n            this.opacity = 0;\n        } else if (this.opacity > 0) {\n            // this.opacity -= 0.005;\n        }\n    }\n\n    draw(ctx: CanvasRenderingContext2D) {\n        if (this.opacity <= 0) return;\n\n        ctx.save();\n        ctx.globalAlpha = this.opacity;\n        ctx.fillStyle = this.color;\n        ctx.translate(this.x, this.y);\n        ctx.rotate(this.rotation * Math.PI / 180);\n        ctx.fillRect(-this.size / 2, -this.size / 2, this.size, this.size * 1.5);\n        ctx.restore();\n    }\n}\n\nfunction createConfetti(colors: string[]) {\n    if (!gameState || !gameState.canvases || !gameState.canvases.ui) {\n        console.error(\"Confetti creation failed: UI canvas not ready.\");\n        return;\n    }\n    if (colors.length === 0) {\n        return;\n    }\n    const uiCanvas = gameState.canvases.ui;\n    confettiParticles = [];\n    const amount = 250;\n\n    for (let i = 0; i < amount; i++) {\n        const x = Math.random() * uiCanvas.width;\n        const y = Math.random() * uiCanvas.height * 0.5 - 50;\n        const color = colors[Math.floor(Math.random() * colors.length)];\n        if (color) {\n            confettiParticles.push(new ConfettiParticle(x, y, color));\n        }\n    }\n}\n\nfunction animateConfetti() {\n    if (!gameState || !gameState.contexts || !gameState.contexts.ui) {\n        console.error(\"Confetti animation failed: UI context not ready.\");\n        if (confettiAnimationId) cancelAnimationFrame(confettiAnimationId);\n        confettiAnimationId = null;\n        return;\n    }\n    const uiCtx = gameState.contexts.ui;\n\n    uiCtx.clearRect(0, 0, uiCtx.canvas.width, uiCtx.canvas.height);\n\n    confettiParticles.forEach(p => {\n        p.update();\n        p.draw(uiCtx);\n    });\n\n    confettiParticles = confettiParticles.filter(p => p.opacity > 0);\n\n    if (confettiParticles.length > 0) {\n        confettiAnimationId = requestAnimationFrame(animateConfetti);\n    } else {\n        uiCtx.clearRect(0, 0, uiCtx.canvas.width, uiCtx.canvas.height);\n        confettiAnimationId = null;\n    }\n}\n\nexport function showGoalAnimation(scorerName: string, teamColors: string[]): void {\n    const container = document.getElementById('goal-animation-container');\n    const goalText = document.getElementById('goal-text');\n    const scorerText = document.getElementById('scorer-name');\n\n    if (!container || !goalText || !scorerText) {\n        console.error(\"Goal animation elements not found!\");\n        return;\n    }\n\n    const color1 = (teamColors && teamColors.length > 0 && teamColors[0]) ? teamColors[0] : '#ff4500';\n    const color2 = (teamColors && teamColors.length > 1 && teamColors[1]) ? teamColors[1] : '#ffd700';\n\n    goalText.style.setProperty('--color1', color1);\n    goalText.style.setProperty('--color2', color2);\n\n    scorerText.textContent = scorerName || '';\n\n    container.style.display = 'flex';\n    goalText.classList.remove('animate');\n    scorerText.classList.remove('animate');\n\n    void goalText.offsetWidth;\n\n    goalText.classList.add('animate');\n    scorerText.classList.add('animate');\n\n    if (confettiAnimationId) {\n        cancelAnimationFrame(confettiAnimationId);\n        confettiAnimationId = null;\n    }\n    createConfetti([color1, color2, '#ffffff']);\n    animateConfetti();\n\n    setTimeout(() => {\n        container.style.display = 'none';\n        goalText.classList.remove('animate');\n        scorerText.classList.remove('animate');\n    }, 4000);\n}\n", "/**\r\n * AI Decision System - TypeScript Migration\r\n *\r\n * Handles all player decision-making:\r\n * - Pass/shoot/dribble decisions\r\n * - Pass quality and success calculation\r\n * - Through ball detection\r\n * - Vision-based decision making\r\n * - First-touch decision system\r\n *\r\n * @module ai/decisions\r\n * @migrated-from js/ai/aidecisions.js\r\n */\r\n\r\nimport type { Player, Vector2D } from '../types';\r\nimport { distance } from '../utils/math';\r\nimport { canPlayerActOnBall } from './playerFirstTouch';\r\nimport { getAttackingGoalX, getValidStat, isSetPieceStatus, calculateXG } from '../utils/ui';\r\nimport { recordOffsidePositions } from '../rules/offside';\r\nimport { getPlayerFacingDirection, findBestPassOption_WithVision } from './playerVision';\r\nimport { handleShotAttempt } from '../main';\r\nimport { gameState } from '../globalExports';\r\nimport { GAME_CONFIG, PHYSICS } from '../config';\r\n\r\n// ============================================================================\r\n// TYPE DEFINITIONS\r\n// ============================================================================\r\n\r\ninterface ThroughBallOpportunity {\r\n  target: Player;\r\n  targetPos: Vector2D;\r\n  isThroughBall: true;\r\n}\r\n\r\ninterface RealStats {\r\n  dribblesSucceeded?: number;\r\n  dispossessed?: number;\r\n  duelWonPercent?: number;\r\n  passAccuracy?: number;\r\n  longBallAccuracy?: number;\r\n  chancesCreated?: number;\r\n  xA?: number;\r\n  [key: string]: any;\r\n}\r\n\r\n// ============================================================================\r\n// HELPER FUNCTIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Safe distance calculation wrapper\r\n */\r\nfunction getDistance(p1: Vector2D | Player, p2: Vector2D | Player): number {\r\n  return distance(p1, p2);\r\n}\r\n\r\n// getAttackingGoalX, getValidStat, isSetPieceStatus, recordOffsidePositions, and getPlayerFacingDirection\r\n// are now imported from their respective modules\r\n\r\n// ============================================================================\r\n// TEAM STATISTICS\r\n// ============================================================================\r\n\r\n/**\r\n * Calculate average dribbling skill for a team\r\n */\r\nexport function calculateAvgDribbling(teamPlayers: Player[]): number {\r\n  if (teamPlayers.length === 0) return 0;\r\n  return teamPlayers.reduce((sum, p) => sum + p.dribbling, 0) / teamPlayers.length;\r\n}\r\n\r\n// ============================================================================\r\n// BALL PASSING MECHANICS\r\n// ============================================================================\r\n\r\n/**\r\n * Execute a pass or shot\r\n *\r\n * @param passingPlayer - Player making the pass\r\n * @param fromX - Start X coordinate\r\n * @param fromY - Start Y coordinate\r\n * @param toX - Target X coordinate\r\n * @param toY - Target Y coordinate\r\n * @param passQuality - Quality of pass (0-1)\r\n * @param speed - Pass speed\r\n * @param isShot - Whether this is a shot\r\n */\r\nexport function passBall(\r\n  passingPlayer: Player | null,\r\n  fromX: number,\r\n  fromY: number,\r\n  toX: number,\r\n  toY: number,\r\n  passQuality: number = 0.7,\r\n  speed: number = 400,\r\n  isShot: boolean = false\r\n): void {\r\n  // Using imported gameState from globalExports\r\n\r\n  if (passingPlayer && !isShot) {\r\n    // --- 1. STATS: PASS ATTEMPTED ---\r\n    const teamStats = passingPlayer.isHome ? gameState.stats.home : gameState.stats.away;\r\n    teamStats.passesAttempted++;\r\n\r\n    // --- 2. STATS: SET UP FOR PASS COMPLETION ---\r\n    // We set this so we know who passed it when it's received\r\n    gameState.lastTouchedBy = passingPlayer;\r\n\r\n    // Offside logic\r\n    const isSetPiece = isSetPieceStatus(gameState.status);\r\n\r\n    if (!isShot && (gameState.status === 'playing' || isSetPiece)) {\r\n      const allPlayers = [...gameState.homePlayers, ...gameState.awayPlayers];\r\n      recordOffsidePositions(passingPlayer, allPlayers);\r\n    }\r\n  } else if (passingPlayer && isShot) {\r\n    // Also track who shot the ball for rebounds/saves\r\n    gameState.lastTouchedBy = passingPlayer;\r\n  }\r\n\r\n  const dist = Math.sqrt((toX - fromX) ** 2 + (toY - fromY) ** 2);\r\n  const duration = (dist / speed) * 1000;\r\n  let maxHeight = 0;\r\n  let passType: 'ground' | 'aerial' | 'shot' = 'ground';\r\n\r\n  // Using imported PHYSICS from config\r\n  const LONG_PASS_THRESHOLD = (PHYSICS as any).LONG_PASS_THRESHOLD ?? 150;\r\n\r\n  if (isShot) {\r\n    maxHeight = 0.6;\r\n    passType = 'shot';\r\n  } else if (dist > LONG_PASS_THRESHOLD) {\r\n    maxHeight = 0.7 + (dist / 300) * 0.3;\r\n    passType = 'aerial';\r\n  }\r\n\r\n  gameState.ballTrajectory = {\r\n    startX: fromX,\r\n    startY: fromY,\r\n    endX: toX,\r\n    endY: toY,\r\n    startTime: Date.now(),\r\n    duration: duration,\r\n    maxHeight: maxHeight,\r\n    isShot: isShot,\r\n    passType: passType,\r\n    passQuality: passQuality,\r\n    dist: dist,\r\n    speed: speed\r\n  } as any;\r\n\r\n  gameState.ballHolder = null;\r\n  if (passingPlayer) {\r\n    passingPlayer.hasBallControl = false;\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// SUCCESS PROBABILITY CALCULATIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Calculate dribble success probability\r\n *\r\n * Factors:\r\n * - Base dribbling skill (exponential)\r\n * - Physical attributes (pace, physicality)\r\n * - Composure under pressure\r\n * - Real stats (dribbles succeeded, dispossessed, duels won)\r\n * - Pressure penalty (mitigated by composure)\r\n *\r\n * @param player - Dribbling player\r\n * @param opponents - Nearby opponents\r\n * @returns Success probability (0-1)\r\n */\r\nexport function calculateDribbleSuccess(player: Player, opponents: Player[]): number {\r\n  const realStats: RealStats = (player as any).realStats || {};\r\n\r\n  // 1. Base skill (exponential calculation amplifies skill differences)\r\n  // E.g: (0.95^0.8) = 0.96 | (0.80^0.8) = 0.84 | (0.60^0.8) = 0.67\r\n  const baseDribbling = Math.pow(player.dribbling / 100, 0.8);\r\n\r\n  // 2. Physical attributes\r\n  const paceBonus = (player.pace / 100) * 0.15; // Critical for acceleration\r\n  const physicalityBonus = (player.physicality / 100) * 0.10; // Ball shielding and duels\r\n\r\n  // 3. Mental attributes\r\n  // Composure directly reduces pressure penalty\r\n  const composure = ((player as any).composure || 60) / 100; // Default 60\r\n\r\n  // 4. Real stat impact (1.5x effect)\r\n  const dribbleModifier = realStats.dribblesSucceeded ? Math.min(realStats.dribblesSucceeded / 10, 0.25) : 0;\r\n  const dispossessedPenalty = realStats.dispossessed ? Math.min(realStats.dispossessed / 20, 0.15) : 0;\r\n  const duelBonus = realStats.duelWonPercent ? (realStats.duelWonPercent / 100) * 0.1 : 0;\r\n\r\n  const realStatImpact = (dribbleModifier + duelBonus - dispossessedPenalty) * 1.5;\r\n\r\n  // 5. Situational penalties (pressure penalty balanced by composure)\r\n  const nearbyOpponents = opponents.filter(opp => getDistance(player, opp) < 40);\r\n  const pressurePenalty = (nearbyOpponents.length * 0.20) * (1 - composure);\r\n\r\n  // 6. Final calculation\r\n  const successChance = baseDribbling +\r\n    paceBonus +\r\n    physicalityBonus +\r\n    realStatImpact -\r\n    pressurePenalty;\r\n\r\n  // 7. Extended range (good players better, bad players worse)\r\n  return Math.max(0.10, Math.min(0.95, successChance));\r\n}\r\n\r\n/**\r\n * Calculate pass success probability\r\n *\r\n * Blends player abilities (passing, vision, composure) with real statistics\r\n * (pass accuracy, long ball accuracy) for more accurate pass success prediction.\r\n *\r\n * @param passer - Passing player\r\n * @param receiver - Receiving player\r\n * @param distance - Pass distance\r\n * @param isUnderPressure - Whether passer is under pressure\r\n * @returns Success probability (0-1)\r\n */\r\nexport function calculatePassSuccess(\r\n  passer: Player,\r\n  _receiver: Player,\r\n  distance: number,\r\n  isUnderPressure: boolean\r\n): number {\r\n  const realStats: RealStats = (passer as any).realStats || {};\r\n\r\n  // 1. Base skill (exponential calculation amplifies skill differences)\r\n  // E.g: (0.90^0.7) = 0.93 | (0.70^0.7) = 0.79\r\n  const basePassing = Math.pow(passer.passing / 100, 0.7);\r\n\r\n  // 2. Effective accuracy (blend base skill with real stats)\r\n  const passAccuracyStat = getValidStat(realStats.passAccuracy, 0);\r\n  let effectiveAccuracy: number;\r\n  if (passAccuracyStat > 0) {\r\n    // 50% base skill, 50% real world performance\r\n    effectiveAccuracy = (basePassing * 0.5) + ((passAccuracyStat / 100) * 0.5);\r\n  } else {\r\n    // No realStats, 90% trust in base skill\r\n    effectiveAccuracy = basePassing * 0.9;\r\n  }\r\n\r\n  // 3. Creativity and vision bonuses\r\n  const visionBonus = (((passer as any).vision || 60) / 100) * 0.15; // Default 60\r\n  const chancesCreated = getValidStat(realStats.chancesCreated, 0);\r\n  const xA = getValidStat(realStats.xA, 0);\r\n\r\n  const creativityBonus = chancesCreated > 0 ? Math.min(chancesCreated / 8, 0.15) : 0;\r\n  const xABonus = xA > 0 ? Math.min(xA / 4, 0.10) : 0;\r\n\r\n  // 4. Situational penalties\r\n\r\n  // Pressure penalty (directly reduced by composure)\r\n  const composure = ((passer as any).composure || 60) / 100; // Default 60\r\n  const pressurePenalty = isUnderPressure ? (0.25 * (1 - composure)) : 0; // Max 0.25 penalty\r\n  // E.g: 90 Composure -> 0.25 * (1 - 0.9) = 0.025 penalty\r\n  // E.g: 50 Composure -> 0.25 * (1 - 0.5) = 0.125 penalty\r\n\r\n  // Distance penalty (directly reduced by long ball skill)\r\n  const longBallAccuracy = getValidStat(realStats.longBallAccuracy, 60); // Default 60\r\n  const longBallSkill = longBallAccuracy / 100;\r\n\r\n  let distancePenalty = 0;\r\n  if (distance > 120) { // Only passes over 120px get penalty\r\n    distancePenalty = Math.min((distance - 120) / 400, 0.30); // Max 0.30 penalty\r\n    distancePenalty *= (1 - longBallSkill * 0.8); // 100 LBA removes 80% of penalty\r\n  }\r\n\r\n  // 5. Final calculation\r\n  const successChance = effectiveAccuracy +\r\n    visionBonus + creativityBonus + xABonus -\r\n    pressurePenalty - distancePenalty;\r\n\r\n  // 6. Extended range (minimum 20% instead of 40%)\r\n  return Math.max(0.20, Math.min(0.98, successChance));\r\n}\r\n\r\n// ============================================================================\r\n// TACTICAL OPPORTUNITIES\r\n// ============================================================================\r\n\r\n/**\r\n * Check for through ball opportunities\r\n *\r\n * Looks for teammates ahead with space behind defense\r\n *\r\n * @param passer - Player with ball\r\n * @param teammates - Teammate players\r\n * @param opponents - Opponent players\r\n * @param opponentGoalX - Opponent goal X coordinate\r\n * @returns Through ball opportunity or null\r\n */\r\nexport function checkForThroughBall(\r\n  passer: Player,\r\n  teammates: Player[],\r\n  opponents: Player[],\r\n  opponentGoalX: number\r\n): ThroughBallOpportunity | null {\r\n  const direction = opponentGoalX > 400 ? 1 : -1;\r\n\r\n  for (const teammate of teammates) {\r\n    if (teammate.role === 'GK') continue;\r\n\r\n    const isAhead = (direction > 0 && teammate.x > passer.x) ||\r\n      (direction < 0 && teammate.x < passer.x);\r\n\r\n    if (!isAhead) continue;\r\n\r\n    const distToGoal = Math.abs(teammate.x - opponentGoalX);\r\n    if (distToGoal > 250) continue;\r\n\r\n    const targetX = teammate.x + direction * 60;\r\n    const targetY = teammate.y;\r\n\r\n    const defendersInPath = opponents.filter(opp => {\r\n      const oppIsAhead = (direction > 0 && opp.x > passer.x && opp.x < targetX) ||\r\n        (direction < 0 && opp.x < passer.x && opp.x > targetX);\r\n      return oppIsAhead && Math.abs(opp.y - targetY) < 50;\r\n    });\r\n\r\n    if (defendersInPath.length === 0) {\r\n      return {\r\n        target: teammate,\r\n        targetPos: { x: targetX, y: targetY },\r\n        isThroughBall: true\r\n      };\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n// ============================================================================\r\n// PASS EXECUTION\r\n// ============================================================================\r\n\r\n/**\r\n * Initiate a pass to a target player\r\n */\r\nexport function initiatePass(player: Player, target: Player | null): void {\r\n  if (!target) {\r\n    console.warn('\u26A0\uFE0F No pass target provided');\r\n    return;\r\n  }\r\n\r\n  // Using imported gameState from globalExports\r\n  const distance = getDistance(player, target);\r\n  const allPlayers = [...gameState.homePlayers, ...gameState.awayPlayers];\r\n  const nearbyOpponents = allPlayers\r\n    .filter(p => p.isHome !== player.isHome && getDistance(player, p) < 50);\r\n\r\n  const isUnderPressure = nearbyOpponents.length > 0;\r\n\r\n  // Calculate pass quality\r\n  const quality = calculatePassSuccess(player, target, distance, isUnderPressure);\r\n\r\n  // Vary pass speed based on situation\r\n  let passSpeed = 400;\r\n\r\n  if (distance > 150) {\r\n    // Long pass - faster\r\n    passSpeed = 500 + player.passing * 3;\r\n  } else if (isUnderPressure) {\r\n    // Under pressure - quick pass\r\n    passSpeed = 450 + player.passing * 2;\r\n  } else {\r\n    // Normal pass\r\n    passSpeed = 400 + player.passing * 2.5;\r\n  }\r\n\r\n  // \u2705 FIX: Reduce pass power immediately after kick-off to prevent wild passes\r\n  if ((gameState as any).postKickOffCalmPeriod && (gameState as any).kickOffCompletedTime) {\r\n    const timeSinceKickOff = Date.now() - (gameState as any).kickOffCompletedTime;\r\n    if (timeSinceKickOff < 4000) {\r\n      passSpeed = Math.min(passSpeed, 450); // Cap speed at 450 during calm period\r\n    }\r\n  }\r\n\r\n  // Execute pass\r\n  gameState.currentPassReceiver = target;\r\n  const teamStats = player.isHome ? gameState.stats.home : gameState.stats.away;\r\n  teamStats.passesAttempted++;\r\n\r\n  passBall(player, player.x, player.y, target.x, target.y, quality, passSpeed, false);\r\n  (gameState as any).totalPasses = ((gameState as any).totalPasses || 0) + 1;\r\n\r\n  // Log for debugging\r\n  console.log(`\uD83D\uDCE4 ${player.name} \u2192 ${target.name} (${distance.toFixed(0)}px, ${(quality * 100).toFixed(0)}% quality)`);\r\n}\r\n\r\n/**\r\n * Initiate a through ball\r\n */\r\nexport function initiateThroughBall(player: Player, throughBall: ThroughBallOpportunity): void {\r\n  // Using imported gameState from globalExports\r\n  let passSpeed = 600 + player.passing * 5;\r\n\r\n  // \u2705 FIX: Reduce pass power immediately after kick-off to prevent wild passes\r\n  if ((gameState as any).postKickOffCalmPeriod && (gameState as any).kickOffCompletedTime) {\r\n    const timeSinceKickOff = Date.now() - (gameState as any).kickOffCompletedTime;\r\n    if (timeSinceKickOff < 4000) {\r\n      passSpeed = Math.min(passSpeed, 450); // Cap speed at 450 during calm period\r\n    }\r\n  }\r\n\r\n  const quality = calculatePassSuccess(player, throughBall.target, getDistance(player, throughBall.targetPos), false);\r\n  gameState.currentPassReceiver = throughBall.target;\r\n  passBall(player, player.x, player.y, throughBall.targetPos.x, throughBall.targetPos.y, quality, passSpeed, false);\r\n  (gameState as any).totalPasses = ((gameState as any).totalPasses || 0) + 1;\r\n  (throughBall.target as any).speedBoost = 1.4;\r\n  throughBall.target.targetX = throughBall.targetPos.x;\r\n  throughBall.target.targetY = throughBall.targetPos.y;\r\n}\r\n\r\n/**\r\n * Initiate a dribble move\r\n */\r\nexport function initiateDribble(player: Player, goalX: number): void {\r\n  const direction = Math.sign(goalX - player.x) || 1;\r\n  const dribbleSkill = player.dribbling / 100;\r\n\r\n  // More variety in dribble movements\r\n  const moveTypes = [\r\n    { name: 'forward', x: direction * 70, y: 0 },\r\n    { name: 'diagonal', x: direction * 60, y: (Math.random() - 0.5) * 50 },\r\n    { name: 'cut_inside', x: direction * 50, y: Math.sign(300 - player.y) * 40 }\r\n  ];\r\n\r\n  // Choose move based on skill\r\n  const moveChoice = dribbleSkill > 0.75 ?\r\n    moveTypes[Math.floor(Math.random() * moveTypes.length)]! :\r\n    moveTypes[0]!;\r\n\r\n  player.targetX = player.x + moveChoice.x * dribbleSkill;\r\n  player.targetY = player.y + moveChoice.y * dribbleSkill;\r\n\r\n  // Speed boost based on skill\r\n  (player as any).speedBoost = 1.0 + (dribbleSkill * 0.4);\r\n\r\n  // Boundaries\r\n  player.targetX = Math.max(50, Math.min(750, player.targetX));\r\n  player.targetY = Math.max(50, Math.min(550, player.targetY));\r\n\r\n  console.log(`\uD83C\uDFAF ${player.name} dribbles ${moveChoice.name}`);\r\n}\r\n\r\n// ============================================================================\r\n// DECISION MAKING: FIRST TOUCH SYSTEM\r\n// ============================================================================\r\n\r\n/**\r\n * Handle player with ball using first touch decision system\r\n *\r\n * Simpler decision tree focused on quick reactions\r\n */\r\nexport function handlePlayerWithBall_WithFirstTouch(\r\n  player: Player,\r\n  opponents: Player[],\r\n  teammates: Player[]\r\n): void {\r\n  // Using imported gameState from globalExports\r\n  // Using imported GAME_CONFIG from config\r\n\r\n  // Can't act if still settling the ball\r\n  if (!canPlayerActOnBall(player)) {\r\n    // Just hold position while controlling\r\n    player.targetX = player.x;\r\n    player.targetY = player.y;\r\n    return;\r\n  }\r\n\r\n  const goalX = getAttackingGoalX(player.isHome, gameState.currentHalf);\r\n  const distToGoal = Math.abs(player.x - goalX);\r\n  const angleToGoal = Math.abs(player.y - 300);\r\n\r\n  const nearbyOpponents = opponents.filter(opp => getDistance(player, opp) < 50);\r\n  const underPressure = nearbyOpponents.length > 0;\r\n  const underHeavyPressure = nearbyOpponents.length > 1;\r\n\r\n  const shootingChance = (player.shooting / 100) * (1 - angleToGoal / 400);\r\n  const isInBox = distToGoal < 180 && angleToGoal < 120;\r\n\r\n  // Adjust angle threshold based on proximity to goal\r\n  let adjustedAngleThreshold = 150;\r\n  if (distToGoal < 120) {\r\n    const closenessFactor = (120 - distToGoal) / 120;\r\n    adjustedAngleThreshold += 80 * closenessFactor;\r\n  }\r\n\r\n  const isGoodPosition = distToGoal < (GAME_CONFIG as any).GOAL_CHECK_DISTANCE && angleToGoal < adjustedAngleThreshold;\r\n\r\n  const hasPathToGoal = !opponents.some(opp => {\r\n    const oppDistToGoal = Math.abs(opp.x - goalX);\r\n    return oppDistToGoal < distToGoal &&\r\n      Math.abs(opp.y - player.y) < 40 &&\r\n      getDistance(player, opp) < 80;\r\n  });\r\n\r\n  const now = Date.now();\r\n  const holdTime = (player as any).ballReceivedTime ? now - (player as any).ballReceivedTime : 0;\r\n  const maxHoldTime = underHeavyPressure ? 800 : underPressure ? 1500 : 2000;\r\n\r\n  if (holdTime > maxHoldTime) {\r\n    if (underHeavyPressure && Math.random() < 0.6) {\r\n      const passTarget = findBestPassOption_WithVision(player, teammates, opponents);\r\n      if (passTarget) {\r\n        initiatePass(player, passTarget);\r\n        return;\r\n      }\r\n    }\r\n    if (underPressure) {\r\n      if (calculateDribbleSuccess(player, nearbyOpponents) > 0.5) {\r\n        initiateDribble(player, goalX);\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  const decision = Math.random();\r\n  const allPlayers = [...teammates, ...opponents];\r\n\r\n  if (isInBox && hasPathToGoal && !underHeavyPressure && decision < 0.8) {\r\n    handleShotAttempt(player, goalX, allPlayers);\r\n    return;\r\n  }\r\n\r\n  if (isGoodPosition && decision < shootingChance * 1.5 && hasPathToGoal) {\r\n    handleShotAttempt(player, goalX, allPlayers);\r\n    return;\r\n  }\r\n\r\n  if (underHeavyPressure) {\r\n    if (decision < 0.7) {\r\n      const passTarget = findBestPassOption_WithVision(player, teammates, opponents);\r\n      if (passTarget) {\r\n        initiatePass(player, passTarget);\r\n      } else {\r\n        initiateDribble(player, goalX);\r\n      }\r\n    } else {\r\n      initiateDribble(player, goalX);\r\n    }\r\n    return;\r\n  }\r\n\r\n  if (!underPressure && distToGoal < 350) {\r\n    const throughBall = checkForThroughBall(player, teammates, opponents, goalX);\r\n    if (throughBall && decision < 0.35) {\r\n      initiateThroughBall(player, throughBall);\r\n      return;\r\n    }\r\n  }\r\n\r\n  if (underPressure || decision < (GAME_CONFIG as any).PASSING_CHANCE) {\r\n    const passTarget = findBestPassOption_WithVision(player, teammates, opponents);\r\n    if (passTarget) {\r\n      initiatePass(player, passTarget);\r\n    } else {\r\n      initiateDribble(player, goalX);\r\n    }\r\n  } else {\r\n    initiateDribble(player, goalX);\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// DECISION MAKING: VISION SYSTEM\r\n// ============================================================================\r\n\r\n/**\r\n * Handle player with ball using vision-based decision system\r\n *\r\n * More sophisticated system that evaluates action values\r\n */\r\nexport function handlePlayerWithBall_WithVision(\r\n  player: Player,\r\n  opponents: Player[],\r\n  teammates: Player[]\r\n): void {\r\n  // Using imported gameState from globalExports\r\n\r\n  // Pre-condition: Can player act on ball?\r\n  if (!canPlayerActOnBall(player)) {\r\n    // Find safest protective dribbling direction based on opponent positions\r\n    let bestAngle = getPlayerFacingDirection(player);\r\n    let maxSpace = 0;\r\n\r\n    // Scan 120 degrees ahead to find most open direction\r\n    for (let i = -1; i <= 1; i += 0.5) {\r\n      const angle = getPlayerFacingDirection(player) + (i * Math.PI / 3); // +/- 60 degrees\r\n      const checkPos = { x: player.x + Math.cos(angle) * 50, y: player.y + Math.sin(angle) * 50 };\r\n      const closestOpponentDist = opponents.length > 0\r\n        ? Math.min(...opponents.map(o => getDistance(o, checkPos)))\r\n        : 1000; // No opponents = lots of space\r\n      if (closestOpponentDist > maxSpace) {\r\n        maxSpace = closestOpponentDist;\r\n        bestAngle = angle;\r\n      }\r\n    }\r\n\r\n    // Move slowly and controlled in safest direction\r\n    player.targetX = player.x + Math.cos(bestAngle) * 20;\r\n    player.targetY = player.y + Math.sin(bestAngle) * 20;\r\n    (player as any).speedBoost = 0.8; // Slow, controlled movement\r\n    return; // Wait until settle time passes for new decision\r\n  }\r\n\r\n  // --- DECISION CENTER: ACTION EVALUATION SYSTEM ---\r\n\r\n  // Calculate required basic information\r\n  const goalX = getAttackingGoalX(player.isHome, gameState.currentHalf);\r\n  const allPlayers = [...teammates, ...opponents, player];\r\n\r\n  // 1. CALCULATE SHOT VALUE\r\n  let shotValue = 0;\r\n  const distToGoal = getDistance(player, { x: goalX, y: 300 });\r\n  // Only consider shooting at reasonable distance (~35 meters)\r\n  if (distToGoal < 280) {\r\n    const xG = calculateXG(player, goalX, player.y, opponents);\r\n    shotValue = xG * 100; // Convert xG to 0-100 scale\r\n\r\n    // Reduce shot value if under pressure or bad angle\r\n    if (opponents.some(o => getDistance(o, player) < 30)) shotValue *= 0.6;\r\n    if (Math.abs(player.y - 300) > 150) shotValue *= 0.7; // Bad angle penalty\r\n  }\r\n\r\n  // 2. CALCULATE PASS VALUE\r\n  const passTarget = findBestPassOption_WithVision(player, teammates, opponents);\r\n  let passValue = 0;\r\n  if (passTarget) {\r\n    const distToTarget = getDistance(player, passTarget);\r\n    const spaceAroundTarget = opponents.length > 0\r\n      ? Math.min(...opponents.map(o => getDistance(o, passTarget)))\r\n      : 1000; // No opponents = lots of space\r\n\r\n    // Value: Target's open space + base pass value - distance penalty\r\n    passValue = 40 + (spaceAroundTarget) - (distToTarget * 0.5);\r\n\r\n    // Reward passes towards attack direction\r\n    if (Math.sign(passTarget.x - player.x) === Math.sign(goalX - player.x)) {\r\n      passValue += 25;\r\n    }\r\n  }\r\n\r\n  // 3. CALCULATE DRIBBLE VALUE\r\n  let dribbleValue = 0;\r\n  const forwardAngle = getPlayerFacingDirection(player);\r\n  // Check space 60 units ahead of player\r\n  const dribbleCheckPos = { x: player.x + Math.cos(forwardAngle) * 60, y: player.y + Math.sin(forwardAngle) * 60 };\r\n  const spaceAhead = opponents.length > 0\r\n    ? Math.min(...opponents.map(o => getDistance(o, dribbleCheckPos)))\r\n    : 1000; // No opponents = lots of space\r\n\r\n  // Consider dribbling if sufficient space ahead (40 units)\r\n  if (spaceAhead > 40) {\r\n    // Value: Player's dribbling ability + space ahead\r\n    dribbleValue = (player.dribbling * 0.6) + (spaceAhead * 0.4);\r\n\r\n    // Encourage dribbling for fast players and wingers\r\n    if (player.pace > 82 || ['RW', 'LW', 'RM', 'LM'].includes(player.role)) {\r\n      dribbleValue += 15;\r\n    }\r\n  }\r\n\r\n  // --- ACTION SELECTION AND EXECUTION ---\r\n  // Choose action with highest value that passes threshold\r\n\r\n  if (shotValue > passValue && shotValue > dribbleValue && shotValue > 30) {\r\n    handleShotAttempt(player, goalX, allPlayers);\r\n    return;\r\n  }\r\n\r\n  // Pass if it has highest value AND above reasonable threshold (e.g: 45)\r\n  if (passValue > dribbleValue && passValue > 45) {\r\n    initiatePass(player, passTarget);\r\n    return;\r\n  }\r\n\r\n  // If shot or pass aren't logical options, default to dribbling\r\n  initiateDribble(player, goalX);\r\n}\r\n\r\n", "import type { Player, GameState } from '../types';\nimport { getDistance } from '../utils/ui';\nimport { SetPieceBehaviorSystem } from '../setpieces/SetPieceBehaviorSystem';\n\nexport const BehaviorResult = {\n    success(target: { x: number; y: number }, speedMultiplier = 1.0, description = '', shouldLock = false) {\n        return {\n            available: true,\n            target,\n            speedMultiplier,\n            description,\n            shouldLock,\n            error: null\n        };\n    },\n\n    unavailable(reason = 'Conditions not met') {\n        return {\n            available: false,\n            target: null,\n            speedMultiplier: 1.0,\n            description: '',\n            shouldLock: false,\n            error: reason\n        };\n    },\n\n    isValid(result: any): boolean {\n        return result && typeof result === 'object' && result.available === true;\n    }\n};\n\nexport const PHASES = {\n    DEFENSIVE: 'defensive',\n    ATTACKING: 'attacking',\n    TRANSITION_TO_ATTACK: 'transition_attack',\n    TRANSITION_TO_DEFENSE: 'transition_defense'\n};\n\nconst GoalkeeperBehaviors = {\n    sweeperKeeping(ball: { x: number; y: number }, teammates: Player[], opponents: Player[], ownGoalX: number) {\n        const defenders = teammates.filter(t => ['CB', 'RB', 'LB'].includes(t.role));\n        if (defenders.length === 0) return null;\n\n        const defensiveLine = Math.max(...defenders.map(t => Math.abs(t.x - ownGoalX)));\n\n        if (defensiveLine < 200) return null;\n\n        const threatBehindLine = opponents.find(opp => {\n            const oppDistToGoal = Math.abs(opp.x - ownGoalX);\n            return oppDistToGoal < defensiveLine - 50 && getDistance(opp, ball) < 100;\n        });\n\n        if (threatBehindLine) {\n            const interceptPoint = {\n                x: ownGoalX + Math.sign(ball.x - ownGoalX) * Math.min(defensiveLine * 0.6, 180),\n                y: ball.y\n            };\n\n            return {\n                target: interceptPoint,\n                speedMultiplier: 1.8,\n                description: 'sweeper-keeper intercept',\n                shouldLock: true\n            };\n        }\n\n        return null;\n    },\n\n    buildUpSupport(holder: Player | null, ownGoalX: number) {\n        if (!holder || holder.role === 'GK') return null;\n\n        const holderDistToGoal = Math.abs(holder.x - ownGoalX);\n\n        if (holderDistToGoal > 400) return null;\n\n        const safeZone = {\n            x: ownGoalX + Math.sign(holder.x - ownGoalX) * 80,\n            y: 300\n        };\n\n        return {\n            target: safeZone,\n            speedMultiplier: 1.0,\n            description: 'GK build-up support',\n            shouldLock: false\n        };\n    },\n\n    angleNarrowing(ball: { x: number; y: number }, ownGoalX: number) {\n        const goalCenter = { x: ownGoalX, y: 300 };\n        const ballToGoalDist = getDistance(ball, goalCenter);\n\n        const optimalDist = Math.min(ballToGoalDist * 0.35, 60);\n        const angle = Math.atan2(ball.y - goalCenter.y, ball.x - goalCenter.x);\n\n        return {\n            target: {\n                x: goalCenter.x + Math.cos(angle) * optimalDist,\n                y: goalCenter.y + Math.sin(angle) * optimalDist\n            },\n            speedMultiplier: 1.4,\n            description: 'angle narrowing',\n            shouldLock: true\n        };\n    }\n};\n\nconst DefensiveBehaviors = {\n    defensiveLineShift(player: Player, ball: { x: number; y: number }, teammates: Player[], ownGoalX: number) {\n        if (!['CB', 'RB', 'LB'].includes(player.role)) return null;\n\n        const defensiveLine = teammates.filter(t =>\n            ['CB', 'RB', 'LB'].includes(t.role)\n        );\n\n        if (defensiveLine.length < 2) return null;\n\n        const avgLineX = defensiveLine.reduce((sum, p) => sum + p.x, 0) / defensiveLine.length;\n        const targetLineX = avgLineX + (ball.y - 300) * 0.15;\n\n        const ballPressure = Math.min(...teammates.map(t => getDistance(t, ball)));\n        const verticalAdjust = ballPressure < 50 ? 25 : -15;\n\n        return {\n            target: {\n                x: player.x + Math.sign(targetLineX - avgLineX) * 20 + verticalAdjust * Math.sign(ownGoalX - player.x),\n                y: player.y + (ball.y - player.y) * 0.2\n            },\n            speedMultiplier: 1.0,\n            description: 'defensive line shift',\n            shouldLock: false\n        };\n    },\n\n    fullBackCovering(fb: Player, opponents: Player[]) {\n        if (!['RB', 'LB'].includes(fb.role)) return null;\n\n        const isRightBack = fb.role === 'RB';\n        const wideThreats = opponents.filter(opp =>\n            (isRightBack && opp.y < 200) || (!isRightBack && opp.y > 400)\n        );\n\n        if (wideThreats.length === 0) return null;\n\n        const nearestThreat = wideThreats.sort((a, b) =>\n            getDistance(a, fb) - getDistance(b, fb)\n        )[0];\n\n        if (!nearestThreat) return null;\n\n        const distToThreat = getDistance(nearestThreat, fb);\n\n        if (distToThreat < 150) {\n            const interceptAngle = Math.atan2(nearestThreat.y - fb.y, nearestThreat.x - fb.x);\n\n            return {\n                target: {\n                    x: fb.x + Math.cos(interceptAngle) * 50,\n                    y: fb.y + Math.sin(interceptAngle) * 50\n                },\n                speedMultiplier: 1.5,\n                description: 'full-back pressing winger',\n                shouldLock: true\n            };\n        }\n\n        return null;\n    },\n\n    centerBackMarking(cb: Player, opponents: Player[], ownGoalX: number) {\n        if (!['CB'].includes(cb.role)) return null;\n\n        const strikers = opponents.filter(opp => ['ST', 'CF'].includes(opp.role));\n        if (strikers.length === 0) return null;\n\n        const nearestStriker = strikers.sort((a, b) =>\n            getDistance(a, cb) - getDistance(b, cb)\n        )[0];\n\n        if (!nearestStriker) return null;\n\n        const inDangerZone = Math.abs(nearestStriker.x - ownGoalX) < 200;\n\n        if (inDangerZone) {\n            const markingDist = 15;\n            const angle = Math.atan2(nearestStriker.y - ownGoalX, nearestStriker.x - ownGoalX);\n\n            return {\n                target: {\n                    x: nearestStriker.x - Math.cos(angle) * markingDist,\n                    y: nearestStriker.y - Math.sin(angle) * markingDist\n                },\n                speedMultiplier: 1.3,\n                description: 'CB tight marking',\n                shouldLock: true\n            };\n        }\n\n        return null;\n    },\n\n    invertedFullBack(fb: Player, holder: Player | null, teammates: Player[], ownGoalX: number) {\n        if (!['RB', 'LB'].includes(fb.role)) return null;\n        if (!holder || holder.isHome !== fb.isHome) return null;\n\n        const ballInOwnHalf = Math.abs(holder.x - ownGoalX) < 400;\n        if (!ballInOwnHalf) return null;\n\n        const midfielders = teammates.filter(t =>\n            ['CM', 'CDM', 'CAM'].includes(t.role)\n        );\n\n        const midFieldCongestion = midfielders.reduce((sum, m) =>\n            sum + (Math.abs(m.y - 300) < 100 ? 1 : 0), 0\n        );\n\n        if (midFieldCongestion > 2) return null;\n\n        return {\n            target: {\n                x: ownGoalX + Math.sign(holder.x - ownGoalX) * 250,\n                y: 300\n            },\n            speedMultiplier: 1.1,\n            description: 'inverted full-back',\n            shouldLock: false\n        };\n    }\n};\n\nconst MidfieldBehaviors = {\n    cdmScreening(ball: { x: number; y: number }, teammates: Player[]) {\n        const defensiveLine = teammates.filter(t =>\n            ['CB', 'RB', 'LB'].includes(t.role)\n        );\n\n        if (defensiveLine.length === 0) return null;\n\n        const avgDefLineX = defensiveLine.reduce((sum, p) => sum + p.x, 0) / defensiveLine.length;\n\n        const screeningX = avgDefLineX + Math.sign(ball.x - avgDefLineX) * 80;\n        const screeningY = 300 + (ball.y - 300) * 0.4;\n\n        return {\n            target: { x: screeningX, y: screeningY },\n            speedMultiplier: 1.0,\n            description: 'CDM screening defense',\n            shouldLock: false\n        };\n    },\n\n    boxToBoxLateRun(cm: Player, ball: { x: number; y: number }, holder: Player | null, teammates: Player[], opponentGoalX: number) {\n        if (!['CM'].includes(cm.role)) return null;\n        if (!holder || holder.isHome !== cm.isHome) return null;\n\n        const ballInFinalThird = Math.abs(ball.x - opponentGoalX) < 250;\n        const alreadyForward = Math.abs(cm.x - opponentGoalX) < 180;\n        const playersInBox = teammates.filter(t =>\n            Math.abs(t.x - opponentGoalX) < 150\n        ).length;\n\n        if (!ballInFinalThird || alreadyForward || playersInBox > 2) return null;\n\n        return {\n            target: {\n                x: opponentGoalX - Math.sign(opponentGoalX - 400) * 100,\n                y: 300 + (Math.random() - 0.5) * 120\n            },\n            speedMultiplier: 1.7,\n            description: 'box-to-box late run',\n            shouldLock: true\n        };\n    },\n\n    registaTempoDictation(cm: Player, holder: Player | null, ownGoalX: number) {\n        if (!['CM', 'CDM'].includes(cm.role)) return null;\n        if (!holder || holder.isHome !== cm.isHome) return null;\n\n        const deepPosition = {\n            x: ownGoalX + Math.sign(holder.x - ownGoalX) * 200,\n            y: 300\n        };\n\n        const inDeepZone = Math.abs(cm.x - deepPosition.x) < 60;\n\n        if (inDeepZone) return null;\n\n        return {\n            target: deepPosition,\n            speedMultiplier: 0.9,\n            description: 'regista deep positioning',\n            shouldLock: false\n        };\n    },\n\n    camBetweenLines(cam: Player, opponents: Player[], opponentGoalX: number) {\n        if (!['CAM'].includes(cam.role)) return null;\n\n        const oppDefenders = opponents.filter(o =>\n            ['CB', 'RB', 'LB', 'CDM'].includes(o.role)\n        );\n\n        if (oppDefenders.length < 2) return null;\n\n        const avgDefX = oppDefenders.reduce((sum, p) => sum + p.x, 0) / oppDefenders.length;\n        const pocketX = avgDefX + Math.sign(opponentGoalX - avgDefX) * 60;\n\n        return {\n            target: {\n                x: pocketX,\n                y: 300 + (Math.random() - 0.5) * 80\n            },\n            speedMultiplier: 1.2,\n            description: 'CAM finding pocket',\n            shouldLock: false\n        };\n    },\n\n    cmPressTrigger(cm: Player, holder: Player | null) {\n        if (!['CM'].includes(cm.role)) return null;\n        if (!holder || holder.isHome === cm.isHome) return null;\n\n        const holderInCenter = Math.abs(holder.y - 300) < 150;\n        const distToHolder = getDistance(cm, holder);\n\n        if (holderInCenter && distToHolder < 80) {\n            return {\n                target: {\n                    x: holder.x,\n                    y: holder.y\n                },\n                speedMultiplier: 1.6,\n                description: 'CM press trigger',\n                shouldLock: true\n            };\n        }\n\n        return null;\n    }\n};\n\nconst ForwardBehaviors = {\n    wingerWidthProviding(winger: Player, holder: Player | null) {\n        if (!['RW', 'LW', 'RM', 'LM'].includes(winger.role)) return null;\n        if (!holder || holder.isHome !== winger.isHome) return null;\n\n        const isRight = ['RW', 'RM'].includes(winger.role);\n        const targetY = isRight ? 80 : 520;\n        const currentlyWide = Math.abs(winger.y - targetY) < 40;\n\n        if (currentlyWide) return null;\n\n        return {\n            target: {\n                x: winger.x + Math.sign(holder.x - winger.x) * 30,\n                y: targetY\n            },\n            speedMultiplier: 1.1,\n            description: 'winger providing width',\n            shouldLock: false\n        };\n    },\n\n    invertedWingerCutInside(winger: Player, opponentGoalX: number) {\n        if (!['RW', 'LW'].includes(winger.role)) return null;\n\n        const distToGoal = Math.abs(winger.x - opponentGoalX);\n        const isWide = (winger.role === 'RW' && winger.y < 150) ||\n            (winger.role === 'LW' && winger.y > 450);\n\n        if (distToGoal < 280 && isWide) {\n            return {\n                target: {\n                    x: opponentGoalX - Math.sign(opponentGoalX - winger.x) * 100,\n                    y: 300 + (Math.random() - 0.5) * 100\n                },\n                speedMultiplier: 1.4,\n                description: 'inverted winger cutting inside',\n                shouldLock: true\n            };\n        }\n\n        return null;\n    },\n\n    strikerRunsInBehind(striker: Player, holder: Player | null, opponents: Player[], opponentGoalX: number) {\n        if (!['ST', 'CF'].includes(striker.role)) return null;\n        if (!holder || holder.isHome !== striker.isHome) return null;\n\n        const oppDefenders = opponents.filter(o =>\n            ['CB', 'RB', 'LB'].includes(o.role)\n        );\n\n        if (oppDefenders.length === 0) return null;\n\n        const lastDefender = oppDefenders.sort((a, b) =>\n            Math.abs(b.x - opponentGoalX) - Math.abs(a.x - opponentGoalX)\n        )[0];\n\n        if (!lastDefender) return null;\n\n        const runTargetX = lastDefender.x + Math.sign(opponentGoalX - lastDefender.x) * 30;\n        const distToLastDefender = Math.abs(striker.x - lastDefender.x);\n\n        if (distToLastDefender < 20 || getDistance(holder, striker) > 250) return null;\n\n        return {\n            target: {\n                x: runTargetX,\n                y: 300 + (Math.random() - 0.5) * 120\n            },\n            speedMultiplier: 1.6,\n            description: 'striker run in behind',\n            shouldLock: true\n        };\n    },\n\n    false9DropDeep(striker: Player, holder: Player | null, teammates: Player[], opponentGoalX: number) {\n        if (!['ST', 'CF'].includes(striker.role)) return null;\n        if (!holder || holder.isHome !== striker.isHome) return null;\n\n        const forwardRunners = teammates.filter(t =>\n            ['RW', 'LW', 'CAM'].includes(t.role) &&\n            Math.abs(t.vx) > 50\n        );\n\n        if (forwardRunners.length === 0) return null;\n\n        const dropPosition = {\n            x: striker.x - Math.sign(opponentGoalX - striker.x) * 120,\n            y: 300\n        };\n\n        return {\n            target: dropPosition,\n            speedMultiplier: 1.2,\n            description: 'false 9 dropping deep',\n            shouldLock: true\n        };\n    },\n\n    targetStrikerHoldUp(striker: Player, opponents: Player[], ball: { x: number; y: number }) {\n        if (!['ST', 'CF'].includes(striker.role)) return null;\n\n        const nearbyOpponents = opponents.filter(o =>\n            getDistance(o, striker) < 60\n        );\n\n        if (nearbyOpponents.length > 0 && getDistance(striker, ball) < 25) {\n            return {\n                target: {\n                    x: striker.x,\n                    y: striker.y\n                },\n                speedMultiplier: 0.7,\n                description: 'target striker holding up',\n                shouldLock: true\n            };\n        }\n\n        return null;\n    },\n\n    strikerPressingTrigger(striker: Player, opponents: Player[], ball: { x: number; y: number }, ownGoalX: number) {\n        if (!['ST', 'CF'].includes(striker.role)) return null;\n\n        const oppCBs = opponents.filter(o =>\n            ['CB', 'GK'].includes(o.role)\n        );\n\n        if (oppCBs.length === 0) return null;\n\n        const nearestCB = oppCBs.sort((a, b) =>\n            getDistance(a, ball) - getDistance(b, ball)\n        )[0];\n\n        if (!nearestCB) return null;\n\n        const distToCB = getDistance(striker, nearestCB);\n\n        if (distToCB < 100 && Math.abs(nearestCB.x - ownGoalX) > 400) {\n            return {\n                target: {\n                    x: nearestCB.x,\n                    y: nearestCB.y\n                },\n                speedMultiplier: 1.7,\n                description: 'striker leading press',\n                shouldLock: true\n            };\n        }\n\n        return null;\n    }\n};\n\nconst TransitionBehaviors = {\n    counterAttackRun(player: Player, opponentGoalX: number, justWonPossession: boolean) {\n        if (!justWonPossession) return null;\n        if (!['ST', 'RW', 'LW', 'CAM', 'CM'].includes(player.role)) return null;\n\n        const spaceAhead = Math.abs(player.x - opponentGoalX);\n\n        if (['ST', 'RW', 'LW'].includes(player.role) && spaceAhead > 150) {\n            return {\n                target: {\n                    x: opponentGoalX - Math.sign(opponentGoalX - player.x) * 80,\n                    y: player.role === 'ST' ? 300 : player.y\n                },\n                speedMultiplier: 2.0,\n                description: 'counter-attack sprint',\n                shouldLock: true,\n                duration: 3000\n            };\n        }\n\n        if (['CAM', 'CM'].includes(player.role)) {\n            return {\n                target: {\n                    x: player.x + Math.sign(opponentGoalX - player.x) * 120,\n                    y: 300\n                },\n                speedMultiplier: 1.6,\n                description: 'counter-attack support',\n                shouldLock: true,\n                duration: 2500\n            };\n        }\n\n        return null;\n    },\n\n    counterPress(player: Player, ball: { x: number; y: number }, justLostPossession: boolean) {\n        if (!justLostPossession) return null;\n\n        const distToBall = getDistance(player, ball);\n\n        if (distToBall > 80) return null;\n\n        return {\n            target: {\n                x: ball.x,\n                y: ball.y\n            },\n            speedMultiplier: 1.9,\n            description: 'counter-press',\n            shouldLock: true,\n            duration: 4000\n        };\n    },\n\n    recoveryRun(player: Player, ball: { x: number; y: number }, ownGoalX: number, justLostPossession: boolean) {\n        if (!justLostPossession) return null;\n\n        const distToBall = getDistance(player, ball);\n\n        if (distToBall < 100) return null;\n\n        const homePositionX = (player as any).homePosition?.x || (ownGoalX + Math.sign(player.x - ownGoalX) * 200);\n\n        return {\n            target: {\n                x: homePositionX,\n                y: (player as any).homePosition?.y || 300\n            },\n            speedMultiplier: 1.7,\n            description: 'recovery run',\n            shouldLock: true,\n            duration: 3000\n        };\n    }\n};\n\nconst TacticalSystemModifiers = {\n    possessionSystem(player: Player, holder: Player | null, teammates: Player[]) {\n        if (!holder || holder.isHome !== player.isHome) return null;\n\n        const nearbyTeammates = teammates.filter(t =>\n            getDistance(t, holder) < 150 && t.id !== player.id && t.id !== holder.id\n        );\n\n        if (nearbyTeammates.length < 1) return null;\n\n        const avgX = nearbyTeammates.reduce((sum, t) => sum + t.x, holder.x) / (nearbyTeammates.length + 1);\n        const avgY = nearbyTeammates.reduce((sum, t) => sum + t.y, holder.y) / (nearbyTeammates.length + 1);\n\n        return {\n            target: {\n                x: avgX + (Math.random() - 0.5) * 40,\n                y: avgY + (Math.random() - 0.5) * 40\n            },\n            speedMultiplier: 0.9,\n            description: 'possession triangle formation',\n            shouldLock: false\n        };\n    },\n\n    highPressSystem(player: Player, opponentGoalX: number) {\n        const teamPushUp = Math.abs(player.x - opponentGoalX) > 300;\n\n        if (!teamPushUp) return null;\n\n        const targetX = opponentGoalX - Math.sign(opponentGoalX - player.x) * 250;\n\n        return {\n            target: {\n                x: targetX,\n                y: player.y\n            },\n            speedMultiplier: 1.2,\n            description: 'high-press positioning',\n            shouldLock: false\n        };\n    },\n\n    lowBlockSystem(player: Player, ownGoalX: number) {\n        const defensiveThird = ownGoalX + Math.sign(player.x - ownGoalX) * 200;\n        const tooAdvanced = Math.abs(player.x - defensiveThird) > 150;\n\n        if (!tooAdvanced) return null;\n\n        return {\n            target: {\n                x: defensiveThird,\n                y: 300 + (player.y - 300) * 0.7\n            },\n            speedMultiplier: 1.0,\n            description: 'low-block positioning',\n            shouldLock: false\n        };\n    }\n};\n\nexport function selectPlayerBehavior(player: Player, gameState: GameState, phase: string, tacticalSystem: string) {\n    const allPlayers = [...(gameState.homePlayers || []), ...(gameState.awayPlayers || [])];\n    const teammates = allPlayers.filter(p => p.isHome === player.isHome && p.id !== player.id);\n    const opponents = allPlayers.filter(p => p.isHome !== player.isHome);\n    const ball = gameState.ballPosition;\n    const holder = gameState.ballHolder;\n\n    const ownGoalX = player.isHome ?\n        (gameState.currentHalf === 1 ? 50 : 750) :\n        (gameState.currentHalf === 1 ? 750 : 50);\n    const opponentGoalX = player.isHome ?\n        (gameState.currentHalf === 1 ? 750 : 50) :\n        (gameState.currentHalf === 1 ? 50 : 750);\n\n    const timeSinceChange = Date.now() - (gameState.lastPossessionChange || 0);\n    const justWonPossession = timeSinceChange < 5000 && holder?.isHome === player.isHome;\n    const justLostPossession = timeSinceChange < 5000 && holder?.isHome !== player.isHome;\n\n    if (phase === 'SET_PIECE') {\n        (player as any).currentBehavior = 'set_piece_hold';\n        return null;\n    }\n\n    const behaviors = [];\n\n    if (phase === PHASES.TRANSITION_TO_ATTACK || justWonPossession) {\n        behaviors.push(\n            TransitionBehaviors.counterAttackRun(player, opponentGoalX, justWonPossession)\n        );\n    }\n\n    if (phase === PHASES.TRANSITION_TO_DEFENSE || justLostPossession) {\n        behaviors.push(\n            TransitionBehaviors.counterPress(player, ball, justLostPossession),\n            TransitionBehaviors.recoveryRun(player, ball, ownGoalX, justLostPossession)\n        );\n    }\n\n    if (phase === PHASES.DEFENSIVE || (holder && holder.isHome !== player.isHome)) {\n        if (player.role === 'GK') {\n            behaviors.push(\n                GoalkeeperBehaviors.sweeperKeeping(ball, teammates, opponents, ownGoalX),\n                GoalkeeperBehaviors.angleNarrowing(ball, ownGoalX)\n            );\n        }\n\n        behaviors.push(\n            DefensiveBehaviors.defensiveLineShift(player, ball, teammates, ownGoalX),\n            DefensiveBehaviors.fullBackCovering(player, opponents),\n            DefensiveBehaviors.centerBackMarking(player, opponents, ownGoalX)\n        );\n\n        behaviors.push(\n            MidfieldBehaviors.cdmScreening(ball, teammates),\n            MidfieldBehaviors.cmPressTrigger(player, holder)\n        );\n\n        behaviors.push(\n            ForwardBehaviors.strikerPressingTrigger(player, opponents, ball, ownGoalX)\n        );\n    }\n\n    if (phase === PHASES.ATTACKING || (holder && holder.isHome === player.isHome)) {\n        if (player.role === 'GK') {\n            behaviors.push(\n                GoalkeeperBehaviors.buildUpSupport(holder, ownGoalX)\n            );\n        }\n\n        behaviors.push(\n            DefensiveBehaviors.invertedFullBack(player, holder, teammates, ownGoalX)\n        );\n\n        behaviors.push(\n            MidfieldBehaviors.boxToBoxLateRun(player, ball, holder, teammates, opponentGoalX),\n            MidfieldBehaviors.registaTempoDictation(player, holder, ownGoalX),\n            MidfieldBehaviors.camBetweenLines(player, opponents, opponentGoalX)\n        );\n\n        behaviors.push(\n            ForwardBehaviors.wingerWidthProviding(player, holder),\n            ForwardBehaviors.invertedWingerCutInside(player, opponentGoalX),\n            ForwardBehaviors.strikerRunsInBehind(player, holder, opponents, opponentGoalX),\n            ForwardBehaviors.false9DropDeep(player, holder, teammates, opponentGoalX),\n            ForwardBehaviors.targetStrikerHoldUp(player, opponents, ball)\n        );\n    }\n\n    if (tacticalSystem === 'possession') {\n        behaviors.push(\n            TacticalSystemModifiers.possessionSystem(player, holder, teammates)\n        );\n    } else if (tacticalSystem === 'high_press') {\n        behaviors.push(\n            TacticalSystemModifiers.highPressSystem(player, opponentGoalX)\n        );\n    } else if (tacticalSystem === 'low_block' || tacticalSystem === 'counter_attack') {\n        behaviors.push(\n            TacticalSystemModifiers.lowBlockSystem(player, ownGoalX)\n        );\n    }\n\n    const validBehavior = behaviors.find(b => b !== null);\n\n    if (validBehavior) (player as any).currentBehavior = validBehavior.description;\n    return validBehavior || null;\n}\n\nexport function detectGamePhase(gameState: GameState): string {\n    if (typeof SetPieceBehaviorSystem !== 'undefined' &&\n        SetPieceBehaviorSystem.isSetPieceActive(gameState)) {\n        return 'SET_PIECE';\n    }\n\n    const holder = gameState.ballHolder;\n    const timeSinceChange = Date.now() - (gameState.lastPossessionChange || 0);\n\n    if (timeSinceChange < 5000) {\n        if (holder) {\n            return PHASES.TRANSITION_TO_ATTACK;\n        } else {\n            return PHASES.TRANSITION_TO_DEFENSE;\n        }\n    }\n\n    if (holder) {\n        return PHASES.ATTACKING;\n    }\n\n    return PHASES.DEFENSIVE;\n}\n\nexport function getTacticalSystemType(tacticName: string | null): string {\n    const systemMap: { [key: string]: string } = {\n        'possession': 'possession',\n        'tiki_taka': 'possession',\n        'high_press': 'high_press',\n        'gegenpress': 'high_press',\n        'counter_attack': 'counter_attack',\n        'defensive': 'low_block',\n        'park_bus': 'low_block'\n    };\n\n    return systemMap[tacticName?.toLowerCase() ?? ''] || 'balanced';\n}\n\nexport const BehaviorSystem = {\n    selectPlayerBehavior,\n    detectGamePhase,\n    getTacticalSystemType,\n    BehaviorResult,\n    PHASES\n};\n\n// Functions are now exported via ES6 modules - no window exports needed\n", "import type { Player, GameState } from '../types';\nimport { getDistance } from '../utils/ui';\nimport { BehaviorSystem } from '../behavior/BehaviorSystem';\n\nconst MovementPatterns = {\n    diagonalRun(player: Player, ball: { x: number; y: number }, opponentGoalX: number) {\n        if (!['RW', 'LW', 'RM', 'LM'].includes(player.role)) return null;\n\n        const distToBall = getDistance(player, ball);\n        if (distToBall > 200) return null;\n\n        const isWide = player.y < 150 || player.y > 450;\n        let targetY, description;\n\n        if (!isWide) {\n            targetY = 300;\n            description = 'cutting inside';\n        } else {\n            targetY = player.role.includes('R') ? 80 : 520;\n            description = 'running the wide channel';\n        }\n\n        const direction = Math.sign(opponentGoalX - player.x) || 1;\n        const targetX = player.x + direction * 120;\n\n        return {\n            target: { x: targetX, y: targetY },\n            speedMultiplier: 1.5,\n            description: description,\n            shouldLock: true\n        };\n    },\n\n    overlapRun(player: Player, teammates: Player[], opponentGoalX: number) {\n        if (!['RB', 'LB'].includes(player.role)) return null;\n\n        const isRightSide = player.role === 'RB';\n        const winger = teammates.find(t =>\n            (isRightSide && ['RW', 'RM'].includes(t.role)) ||\n            (!isRightSide && ['LW', 'LM'].includes(t.role))\n        );\n\n        if (!winger) return null;\n\n        const wingerHasCutInside = Math.abs(winger.y - 300) < 150;\n        if (!wingerHasCutInside) return null;\n\n        if ((player.isHome && player.x < 400) || (!player.isHome && player.x > 400)) return null;\n\n        const expectedWideY = isRightSide ? 80 : 520;\n        return {\n            target: {\n                x: winger.x + Math.sign(opponentGoalX - winger.x) * 50,\n                y: expectedWideY\n            },\n            speedMultiplier: 1.6,\n            description: 'overlapping run',\n            shouldLock: true\n        };\n    },\n\n    underlapRun(player: Player, teammates: Player[], opponentGoalX: number) {\n        if (!['RB', 'LB'].includes(player.role)) return null;\n\n        const isRightSide = player.role === 'RB';\n        const winger = teammates.find(t =>\n            (isRightSide && ['RW', 'RM'].includes(t.role)) ||\n            (!isRightSide && ['LW', 'LM'].includes(t.role))\n        );\n\n        if (!winger) return null;\n\n        const wingerStayingWide = isRightSide ? winger.y < 150 : winger.y > 450;\n        if (!wingerStayingWide) return null;\n\n        const distToWinger = getDistance(player, winger);\n        if (distToWinger < 100) return null;\n\n        return {\n            target: {\n                x: winger.x + Math.sign(opponentGoalX - winger.x) * 40,\n                y: 300 + (isRightSide ? -60 : 60)\n            },\n            speedMultiplier: 1.5,\n            description: 'underlap run',\n            shouldLock: true\n        };\n    },\n\n    thirdManRun(player: Player, holder: Player, teammates: Player[]) {\n        if (!['CM', 'CAM', 'RW', 'LW'].includes(player.role)) return null;\n\n        const passerAndReceiver = teammates.filter(t =>\n            getDistance(t, holder) < 80 && t.id !== holder.id\n        );\n\n        if (passerAndReceiver.length === 0) return null;\n\n        const receiver = passerAndReceiver[0];\n        if (!receiver) return null;\n        const avgX = (holder.x + receiver.x) / 2;\n        const avgY = (holder.y + receiver.y) / 2;\n\n        const runAngle = Math.atan2(receiver.y - holder.y, receiver.x - holder.x) + Math.PI / 3;\n\n        return {\n            target: {\n                x: avgX + Math.cos(runAngle) * 100,\n                y: avgY + Math.sin(runAngle) * 100\n            },\n            speedMultiplier: 1.6,\n            description: 'third man run',\n            shouldLock: true\n        };\n    }\n};\n\nconst RoleSpecificBehaviors = {\n    false9Movement(player: Player, teammates: Player[], opponentGoalX: number) {\n        if (player.role !== 'ST') return null;\n\n        const attackersMakingRuns = teammates.filter(t =>\n            ['RW', 'LW', 'CAM'].includes(t.role) &&\n            Math.abs(t.vx) > 50\n        );\n\n        if (attackersMakingRuns.length < 1) return null;\n\n        return {\n            target: {\n                x: player.x - (Math.sign(opponentGoalX - player.x) * 100),\n                y: 300\n            },\n            speedMultiplier: 1.2,\n            description: 'false 9 dropping deep',\n            shouldLock: true\n        };\n    },\n\n    boxToBoxRun(player: Player, ball: { x: number; y: number }, teammates: Player[], opponentGoalX: number) {\n        if (!['CM', 'CDM'].includes(player.role)) return null;\n\n        const ballInFinalThird = Math.abs(ball.x - opponentGoalX) < 250;\n        if (!ballInFinalThird) return null;\n\n        if (Math.abs(player.x - opponentGoalX) < 180) return null;\n\n        const playersInBox = teammates.filter(t => Math.abs(t.x - opponentGoalX) < 160).length;\n        if (playersInBox > 2) return null;\n\n        return {\n            target: {\n                x: opponentGoalX - (Math.sign(opponentGoalX - 400) * 100),\n                y: 300 + (Math.random() - 0.5) * 150\n            },\n            speedMultiplier: 1.7,\n            description: 'box-to-box late run',\n            shouldLock: true\n        };\n    },\n\n    mezzalaWideMovement(player: Player, holder: Player | null, opponentGoalX: number) {\n        if (!['CM'].includes(player.role)) return null;\n        if (!holder || holder.isHome !== player.isHome) return null;\n\n        const holderIsWide = holder.y < 200 || holder.y > 400;\n        if (!holderIsWide) return null;\n\n        const sameSide = (holder.y < 300 && player.y < 300) || (holder.y > 300 && player.y > 300);\n        if (!sameSide) return null;\n\n        return {\n            target: {\n                x: holder.x + Math.sign(opponentGoalX - holder.x) * 60,\n                y: holder.y + (Math.random() - 0.5) * 40\n            },\n            speedMultiplier: 1.4,\n            description: 'mezzala overload',\n            shouldLock: true\n        };\n    },\n\n    strikerWideMovement(player: Player, teammates: Player[], opponentGoalX: number) {\n        if (!['ST'].includes(player.role)) return null;\n\n        const otherForward = teammates.find(t =>\n            ['ST', 'CF', 'RW', 'LW'].includes(t.role) && t.id !== player.id\n        );\n\n        if (!otherForward) return null;\n\n        const distToOtherForward = getDistance(player, otherForward);\n        if (distToOtherForward > 100) return null;\n\n        const targetY = otherForward.y < 300 ? 450 : 150;\n\n        return {\n            target: {\n                x: player.x + Math.sign(opponentGoalX - player.x) * 40,\n                y: targetY\n            },\n            speedMultiplier: 1.3,\n            description: 'striker wide pull',\n            shouldLock: true\n        };\n    },\n\n    segundoVolanteRun(player: Player, ball: { x: number; y: number }, holder: Player | null, opponentGoalX: number) {\n        if (!['CDM'].includes(player.role)) return null;\n        if (!holder || holder.isHome !== player.isHome) return null;\n\n        const ballInMidfield = Math.abs(ball.x - 400) < 200;\n        if (!ballInMidfield) return null;\n\n        const distToBall = getDistance(player, ball);\n        if (distToBall > 150) return null;\n\n        return {\n            target: {\n                x: ball.x + Math.sign(opponentGoalX - ball.x) * 120,\n                y: 300\n            },\n            speedMultiplier: 1.5,\n            description: 'segundo volante burst',\n            shouldLock: true\n        };\n    }\n};\n\nexport function selectBestAttackingMovement(player: Player, holder: Player, teammates: Player[], opponents: Player[], activePosition: { x: number; y: number }, opponentGoalX: number, gameState: GameState) {\n    if (typeof BehaviorSystem !== 'undefined') {\n        const phase = BehaviorSystem.detectGamePhase(gameState);\n        const tacticName = player.isHome ? gameState.homeTactic : gameState.awayTactic;\n        const tacticalSystem = BehaviorSystem.getTacticalSystemType(tacticName);\n\n        const advancedBehavior = BehaviorSystem.selectPlayerBehavior(\n            player,\n            gameState,\n            phase,\n            tacticalSystem\n        );\n\n        if (advancedBehavior) {\n            player.currentBehavior = advancedBehavior.description;\n            return {\n                x: advancedBehavior.target.x,\n                y: advancedBehavior.target.y,\n                speedBoost: advancedBehavior.speedMultiplier,\n                shouldLock: advancedBehavior.shouldLock\n            };\n        }\n    }\n\n    const patterns = [\n        RoleSpecificBehaviors.false9Movement(player, teammates, opponentGoalX),\n        RoleSpecificBehaviors.boxToBoxRun(player, gameState.ballPosition, teammates, opponentGoalX),\n        RoleSpecificBehaviors.mezzalaWideMovement(player, holder, opponentGoalX),\n        RoleSpecificBehaviors.strikerWideMovement(player, teammates, opponentGoalX),\n        RoleSpecificBehaviors.segundoVolanteRun(player, gameState.ballPosition, holder, opponentGoalX),\n\n        MovementPatterns.thirdManRun(player, holder, teammates),\n        MovementPatterns.overlapRun(player, teammates, opponentGoalX),\n        MovementPatterns.underlapRun(player, teammates, opponentGoalX),\n        MovementPatterns.diagonalRun(player, gameState.ballPosition, opponentGoalX)\n    ];\n\n    const bestPattern = patterns.find(p => p !== null);\n\n    if (bestPattern) {\n        (player as any).currentBehavior = bestPattern.description;\n        return {\n            x: bestPattern.target.x,\n            y: bestPattern.target.y,\n            speedBoost: bestPattern.speedMultiplier,\n            shouldLock: bestPattern.shouldLock\n        };\n    }\n\n    const direction = Math.sign(opponentGoalX - player.x) || 1;\n    const holderUnderPressure = opponents.some(o => getDistance(o, holder) < 70);\n\n    if (holderUnderPressure) {\n        (player as any).currentBehavior = 'offering support';\n        return {\n            x: holder.x - direction * 60,\n            y: holder.y + (player.y < 300 ? -70 : 70),\n            speedBoost: 1.1,\n            shouldLock: false\n        };\n    } else {\n        (player as any).currentBehavior = 'advancing position';\n        return {\n            x: activePosition.x + direction * 70,\n            y: activePosition.y,\n            speedBoost: 1.0,\n            shouldLock: false\n        };\n    }\n}\n", "/**\r\n * Canvas Setup System\r\n * Handles canvas initialization, scaling, and high-DPI support\r\n *\r\n * @migrated-from js/rendering/canvasSetup.js\r\n * \u2705 Migrated from JavaScript with zero functional changes\r\n * \u2705 Full type safety with strict TypeScript\r\n */\r\n\r\nimport type { GameState } from '../types';\r\nimport { gameState } from '../globalExports';\r\nimport { GAME_CONFIG } from '../config';\r\n\r\n// ============================================================================\r\n// GLOBAL DECLARATIONS\r\n// ============================================================================\r\n\r\ndeclare global {\r\n  interface Window {\r\n    gameState: GameState;\r\n    GameCanvasScaler?: {\r\n      resize: () => void;\r\n      width: number;\r\n      height: number;\r\n    };\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// CANVAS SCALING (IIFE)\r\n// ============================================================================\r\n\r\n(() => {\r\n  const LOGICAL_WIDTH = 1280;   // Game world width in logical units\r\n  const LOGICAL_HEIGHT = 720;   // Game world height in logical units\r\n  const CANVAS_IDS = ['backgroundCanvas', 'gameCanvas', 'uiCanvas'];\r\n\r\n  const canvases = CANVAS_IDS\r\n    .map(id => document.getElementById(id) as HTMLCanvasElement | null)\r\n    .filter((canvas): canvas is HTMLCanvasElement => canvas !== null);\r\n\r\n  const container = document.getElementById('canvas-container');\r\n\r\n  function resizeCanvases(): void {\r\n    const dpr = window.devicePixelRatio || 1;\r\n\r\n    canvases.forEach(canvas => {\r\n      const ctx = canvas.getContext('2d');\r\n      if (!ctx) return;\r\n\r\n      // Only re-size if something actually changed\r\n      const targetW = Math.floor(LOGICAL_WIDTH * dpr);\r\n      const targetH = Math.floor(LOGICAL_HEIGHT * dpr);\r\n      if (canvas.width !== targetW || canvas.height !== targetH) {\r\n        canvas.width = targetW;\r\n        canvas.height = targetH;\r\n      }\r\n\r\n      canvas.style.width = `${LOGICAL_WIDTH}px`;\r\n      canvas.style.height = `${LOGICAL_HEIGHT}px`;\r\n\r\n      // Reset and apply scale so 1 unit = 1 CSS pixel\r\n      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);\r\n      ctx.imageSmoothingEnabled = false; // prevent blurriness for sprites\r\n    });\r\n\r\n    // Keep container consistent with logical size\r\n    if (container) {\r\n      container.style.width = `${LOGICAL_WIDTH}px`;\r\n      container.style.height = `${LOGICAL_HEIGHT}px`;\r\n      container.style.margin = '0 auto';\r\n    }\r\n  }\r\n\r\n  // Efficient resize handling (debounced)\r\n  let resizeTimeout: number;\r\n  window.addEventListener('resize', () => {\r\n    clearTimeout(resizeTimeout);\r\n    resizeTimeout = setTimeout(resizeCanvases, 100) as unknown as number;\r\n  });\r\n\r\n  // Run once on load\r\n  resizeCanvases();\r\n\r\n  // Expose helper if other modules need to force re-scale\r\n  window.GameCanvasScaler = {\r\n    resize: resizeCanvases,\r\n    width: LOGICAL_WIDTH,\r\n    height: LOGICAL_HEIGHT\r\n  };\r\n})();\r\n\r\n// ============================================================================\r\n// CANVAS LAYER INITIALIZATION\r\n// ============================================================================\r\n\r\n/**\r\n * Initialize all canvas layers with proper scaling\r\n */\r\nexport function initializeCanvasLayers(): boolean {\r\n  const container = document.getElementById('canvas-container');\r\n  if (!container) {\r\n    console.error('Canvas container not found');\r\n    return false;\r\n  }\r\n\r\n  // Y\u00DCKSEK \u00C7\u00D6Z\u00DCN\u00DCRL\u00DCK \u0130\u00C7\u0130N \u00D6L\u00C7EK FAKT\u00D6R\u00DC\r\n  // Bu de\u011Fer, setupGameScreen'de kullan\u0131lan \u00E7arpanla ayn\u0131 olmal\u0131d\u0131r (\u00D6rn: 2)\r\n  const SCALE_FACTOR = GAME_CONFIG.HIGH_DPI_SCALE_FACTOR; // \u00C7\u00F6z\u00FCn\u00FCrl\u00FC\u011F\u00FC iki kat\u0131na \u00E7\u0131kar\u0131yoruz (800x600 -> 1600x1200)\r\n\r\n  container.style.display = 'block';\r\n\r\n  // Initialize canvases and contexts if they don't exist\r\n  if (!gameState.canvases) {\r\n    gameState.canvases = { background: null, game: null, ui: null };\r\n  }\r\n  if (!gameState.contexts) {\r\n    gameState.contexts = { background: null, game: null, ui: null };\r\n  }\r\n\r\n  gameState.canvases.background = document.getElementById('backgroundCanvas') as HTMLCanvasElement | null;\r\n  gameState.canvases.game = document.getElementById('gameCanvas') as HTMLCanvasElement | null;\r\n  gameState.canvases.ui = document.getElementById('uiCanvas') as HTMLCanvasElement | null;\r\n\r\n  gameState.backgroundDrawn = false;\r\n\r\n  // --- Background Canvas ---\r\n  if (gameState.canvases.background) {\r\n    gameState.contexts.background = gameState.canvases.background.getContext('2d', { alpha: false });\r\n    if (gameState.contexts.background) {\r\n      // KR\u0130T\u0130K ADIM: \u00C7izim ba\u011Flam\u0131n\u0131 \u00F6l\u00E7eklendir\r\n      gameState.contexts.background.scale(SCALE_FACTOR, SCALE_FACTOR);\r\n      console.log(`\u2713 Background canvas initialized and scaled by ${SCALE_FACTOR}x`);\r\n    }\r\n  } else {\r\n    console.error('\u2717 Background canvas not found');\r\n    return false;\r\n  }\r\n\r\n  // --- Game Canvas ---\r\n  if (gameState.canvases.game) {\r\n    gameState.contexts.game = gameState.canvases.game.getContext('2d', { alpha: true });\r\n    if (gameState.contexts.game) {\r\n      // KR\u0130T\u0130K ADIM: \u00C7izim ba\u011Flam\u0131n\u0131 \u00F6l\u00E7eklendir\r\n      gameState.contexts.game.scale(SCALE_FACTOR, SCALE_FACTOR);\r\n      console.log(`\u2713 Game canvas initialized and scaled by ${SCALE_FACTOR}x`);\r\n    }\r\n  } else {\r\n    console.error('\u2717 Game canvas not found');\r\n    return false;\r\n  }\r\n\r\n  // --- UI Canvas ---\r\n  if (gameState.canvases.ui) {\r\n    gameState.contexts.ui = gameState.canvases.ui.getContext('2d', { alpha: true });\r\n    if (gameState.contexts.ui) {\r\n      // KR\u0130T\u0130K ADIM: \u00C7izim ba\u011Flam\u0131n\u0131 \u00F6l\u00E7eklendir\r\n      gameState.contexts.ui.scale(SCALE_FACTOR, SCALE_FACTOR);\r\n      console.log(`\u2713 UI canvas initialized and scaled by ${SCALE_FACTOR}x`);\r\n    }\r\n  } else {\r\n    console.error('\u2717 UI canvas not found');\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n// ============================================================================\r\n// BROWSER EXPORTS\r\n// ============================================================================\r\n// Function is now exported via ES6 modules - no window exports needed\r\n", "/**\r\n * Pitch Drawing System\r\n * Handles rendering of the football pitch background, lines, and markings\r\n *\r\n * @migrated-from js/rendering/drawPitch.js\r\n * \u2705 Migrated from JavaScript with zero functional changes\r\n * \u2705 Full type safety with strict TypeScript\r\n */\r\n\r\nimport type { GameState } from '../types';\r\nimport { gameState } from '../globalExports';\r\nimport { GAME_CONFIG } from '../config';\r\n\r\n// ============================================================================\r\n// GLOBAL DECLARATIONS\r\n// ============================================================================\r\n\r\ndeclare global {\r\n  interface Window {\r\n    gameState: GameState;\r\n    drawPitchBackground?: typeof drawPitchBackground;\r\n    drawGrass?: typeof drawGrass;\r\n    drawStripes?: typeof drawStripes;\r\n    drawLines?: typeof drawLines;\r\n    drawCenterCircle?: typeof drawCenterCircle;\r\n    drawGoals?: typeof drawGoals;\r\n    drawPenaltyAreas?: typeof drawPenaltyAreas;\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// MAIN PITCH DRAWING\r\n// ============================================================================\r\n\r\n/**\r\n * Draw the pitch background with caching\r\n */\r\nexport function drawPitchBackground(): void {\r\n  if (!gameState.contexts || !gameState.contexts.background) {\r\n    console.warn('Background context not ready.');\r\n    return;\r\n  }\r\n\r\n  const ctx = gameState.contexts.background;\r\n\r\n  // Get dynamic canvas dimensions\r\n  const canvasWidth = gameState.isVertical ? 600 : 800;\r\n  const canvasHeight = gameState.isVertical ? 800 : 600;\r\n\r\n  // 1. Clear the main canvas\r\n  ctx.clearRect(0, 0, canvasWidth, canvasHeight);\r\n\r\n  // 2. Conditionally apply the 90-degree rotation\r\n  ctx.save();\r\n  if (gameState.isVertical) {\r\n    ctx.translate(600, 0); // Translate to top-right corner\r\n    ctx.rotate(Math.PI / 2); // Rotate 90 degrees\r\n  }\r\n\r\n  // 3. Check for the cached 800x600 pitch\r\n  if (gameState.offscreenPitch) {\r\n    ctx.drawImage(\r\n      gameState.offscreenPitch,\r\n      0, 0, // Source X, Y\r\n      GAME_CONFIG.PITCH_WIDTH, GAME_CONFIG.PITCH_HEIGHT,\r\n      0, 0, // Destination X, Y (Logical 0, 0)\r\n      GAME_CONFIG.PITCH_WIDTH, GAME_CONFIG.PITCH_HEIGHT\r\n    );\r\n    ctx.restore(); // Restore context (Semicolon removed from the end)\r\n    return; // Exit the function now that the pitch is drawn\r\n  }\r\n\r\n  console.log('\uD83D\uDDBC\uFE0F Creating and caching pitch background for the first time...');\r\n\r\n  // Create a new hidden canvas in memory (ALWAYS 800x600)\r\n  const offscreenCanvas = document.createElement('canvas');\r\n  offscreenCanvas.width = GAME_CONFIG.PITCH_WIDTH;  // 800\r\n  offscreenCanvas.height = GAME_CONFIG.PITCH_HEIGHT; // 600\r\n  const offCtx = offscreenCanvas.getContext('2d'); // Draw on the hidden canvas\r\n\r\n  if (!offCtx) {\r\n    console.error('Failed to get offscreen context');\r\n    ctx.restore();\r\n    return;\r\n  }\r\n\r\n  const w = GAME_CONFIG.PITCH_WIDTH;\r\n  const h = GAME_CONFIG.PITCH_HEIGHT;\r\n\r\n  // Perform drawing operations on the hidden 800x600 canvas\r\n  drawGrass(offCtx, w, h);\r\n  drawStripes(offCtx, w, h);\r\n  drawLines(offCtx, w, h);\r\n  drawGoals(offCtx, w, h);\r\n  drawCenterCircle(offCtx, w, h);\r\n  drawPenaltyAreas(offCtx, w, h);\r\n\r\n  offCtx.shadowBlur = 0;\r\n\r\n  gameState.offscreenPitch = offscreenCanvas;\r\n\r\n  ctx.drawImage(\r\n    gameState.offscreenPitch,\r\n    0, 0,\r\n    GAME_CONFIG.PITCH_WIDTH, GAME_CONFIG.PITCH_HEIGHT,\r\n    0, 0,\r\n    GAME_CONFIG.PITCH_WIDTH, GAME_CONFIG.PITCH_HEIGHT\r\n  );\r\n  // -------------------------------------------------------------------\r\n  ctx.restore(); // Restore context\r\n}\r\n\r\n// ============================================================================\r\n// PITCH ELEMENT DRAWING\r\n// ============================================================================\r\n\r\n/**\r\n * Draw grass background\r\n */\r\nexport function drawGrass(ctx: CanvasRenderingContext2D, w: number, h: number): void {\r\n  // Modern, vibrant grass with depth\r\n  //const grassGradient = ctx.createRadialGradient(w/2, h/2, 0, w/2, h/2, w * 0.8);\r\n  // grassGradient.addColorStop(0, '#0d5c2e');\r\n  //grassGradient.addColorStop(0.5, '#0a4d24');\r\n  // grassGradient.addColorStop(1, '#083d1d');\r\n  ctx.fillStyle = '#0d5c2e';\r\n  ctx.fillRect(0, 0, w, h);\r\n}\r\n\r\n/**\r\n * Draw grass stripes (mowing pattern)\r\n */\r\nexport function drawStripes(ctx: CanvasRenderingContext2D, w: number, h: number): void {\r\n  // Realistic mowing pattern stripes\r\n  const stripeWidth = 50; // Her bir \u015Feridin geni\u015Fli\u011Fi\r\n\r\n  // Yar\u0131 saydam a\u00E7\u0131k renk (degradenin yerine)\r\n  ctx.fillStyle = 'rgba(255, 255, 255, 0.07)'; // Hafif bir ayd\u0131nlatma efekti\r\n\r\n  // Her iki \u015Feritte bir (bir bo\u015F, bir dolu) ayd\u0131nl\u0131k \u015Ferit \u00E7iz\r\n  for (let i = 0; i < w; i += stripeWidth * 2) {\r\n    ctx.fillRect(i, 0, stripeWidth, h);\r\n  }\r\n\r\n  // Not: globalAlpha veya save/restore'a art\u0131k gerek yok\r\n  // \u00E7\u00FCnk\u00FC fillStyle'\u0131m\u0131z zaten yar\u0131 saydam.\r\n}\r\n\r\n/**\r\n * Draw pitch lines\r\n */\r\nexport function drawLines(ctx: CanvasRenderingContext2D, w: number, h: number): void {\r\n  // Ultra-crisp white lines with enhanced glow\r\n  ctx.save();\r\n  ctx.shadowColor = 'rgba(255, 255, 255, 0.9)';\r\n  ctx.shadowBlur = 10;\r\n  ctx.strokeStyle = '#ffffff';\r\n  ctx.lineWidth = 3;\r\n  ctx.lineCap = 'round';\r\n  ctx.lineJoin = 'round';\r\n\r\n  // Outer boundary\r\n  ctx.strokeRect(10, 10, w - 20, h - 20);\r\n\r\n  // Center line\r\n  ctx.beginPath();\r\n  ctx.moveTo(w / 2, 10);\r\n  ctx.lineTo(w / 2, h - 10);\r\n  ctx.stroke();\r\n\r\n  ctx.restore();\r\n}\r\n\r\n/**\r\n * Draw center circle\r\n */\r\nexport function drawCenterCircle(ctx: CanvasRenderingContext2D, w: number, h: number): void {\r\n  ctx.save();\r\n  ctx.shadowColor = 'rgba(255, 255, 255, 0.9)';\r\n  ctx.shadowBlur = 10;\r\n  ctx.strokeStyle = '#ffffff';\r\n  ctx.lineWidth = 3;\r\n\r\n  // Center circle\r\n  ctx.beginPath();\r\n  ctx.arc(w / 2, h / 2, 70, 0, Math.PI * 2);\r\n  ctx.stroke();\r\n\r\n  // Center spot with enhanced glow\r\n  ctx.shadowBlur = 20;\r\n  ctx.beginPath();\r\n  ctx.arc(w / 2, h / 2, 5, 0, Math.PI * 2);\r\n  ctx.fillStyle = '#ffffff';\r\n  ctx.fill();\r\n\r\n  ctx.restore();\r\n}\r\n\r\n/**\r\n * Draw goals\r\n */\r\nexport function drawGoals(ctx: CanvasRenderingContext2D, w: number, h: number): void {\r\n  ctx.save();\r\n  ctx.shadowColor = 'rgba(255, 255, 255, 0.8)';\r\n  ctx.shadowBlur = 8;\r\n  ctx.strokeStyle = '#ffffff';\r\n  ctx.lineWidth = 3;\r\n\r\n  // Left goal\r\n  ctx.strokeRect(10, h / 2 - 120, 120, 240);\r\n  // Right goal\r\n  ctx.strokeRect(w - 130, h / 2 - 120, 120, 240);\r\n\r\n  ctx.restore();\r\n}\r\n\r\n/**\r\n * Draw penalty areas and arcs\r\n */\r\nexport function drawPenaltyAreas(ctx: CanvasRenderingContext2D, w: number, h: number): void {\r\n  ctx.save();\r\n  ctx.shadowColor = 'rgba(255, 255, 255, 0.8)';\r\n  ctx.shadowBlur = 8;\r\n  ctx.strokeStyle = '#ffffff';\r\n  ctx.lineWidth = 3;\r\n\r\n  // Left penalty area\r\n  ctx.strokeRect(10, h / 2 - 60, 50, 120);\r\n  // Right penalty area\r\n  ctx.strokeRect(w - 60, h / 2 - 60, 50, 120);\r\n\r\n  const angle = Math.acos(50 / 70);\r\n\r\n  // Left penalty arc\r\n  ctx.beginPath();\r\n  ctx.arc(80, h / 2, 70, -angle, angle);\r\n  ctx.stroke();\r\n\r\n  // Right penalty arc\r\n  ctx.beginPath();\r\n  ctx.arc(w - 80, h / 2, 70, Math.PI - angle, Math.PI + angle);\r\n  ctx.stroke();\r\n\r\n  // Penalty spots with enhanced glow\r\n  ctx.shadowBlur = 20;\r\n  ctx.fillStyle = '#ffffff';\r\n  ctx.beginPath();\r\n  ctx.arc(80, h / 2, 5, 0, Math.PI * 2);\r\n  ctx.fill();\r\n  ctx.beginPath();\r\n  ctx.arc(w - 80, h / 2, 5, 0, Math.PI * 2);\r\n  ctx.fill();\r\n\r\n  ctx.restore();\r\n}\r\n\r\n// ============================================================================\r\n// BROWSER EXPORTS\r\n// ============================================================================\r\n\r\nif (typeof window !== 'undefined') {\r\n  window.drawPitchBackground = drawPitchBackground;\r\n  window.drawGrass = drawGrass;\r\n  window.drawStripes = drawStripes;\r\n  window.drawLines = drawLines;\r\n  window.drawCenterCircle = drawCenterCircle;\r\n  window.drawGoals = drawGoals;\r\n  window.drawPenaltyAreas = drawPenaltyAreas;\r\n}\r\n", "/**\r\n * Entity Drawing System\r\n * Handles rendering of players, ball, and related visual effects\r\n *\r\n * @migrated-from js/rendering/drawEntities.js\r\n * \u2705 Migrated from JavaScript with zero functional changes\r\n * \u2705 Full type safety with strict TypeScript\r\n */\r\n\r\nimport type { GameState, Player } from '../types';\r\nimport { createBallTrail } from './particles';\r\nimport { gameState } from '../globalExports';\r\n\r\n// ============================================================================\r\n// GLOBAL DECLARATIONS\r\n// ============================================================================\r\n\r\ndeclare global {\r\n  interface Window {\r\n    gameState: GameState;\r\n    lightenColor?: typeof lightenColor;\r\n    darkenColor?: typeof darkenColor;\r\n    drawPlayer?: typeof drawPlayer;\r\n    drawPlayerShadow?: typeof drawPlayerShadow;\r\n    drawPlayerBody?: typeof drawPlayerBody;\r\n    drawPlayerHighlight?: typeof drawPlayerHighlight;\r\n    drawPlayerLabel?: typeof drawPlayerLabel;\r\n    drawBall?: typeof drawBall;\r\n    drawShotEffect?: typeof drawShotEffect;\r\n    drawBallBody?: typeof drawBallBody;\r\n    drawBallPattern?: typeof drawBallPattern;\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// COLOR UTILITIES\r\n// ============================================================================\r\n\r\n/**\r\n * Lighten a hex color by a percentage\r\n */\r\nexport function lightenColor(color: string, percent: number): string {\r\n  const num = parseInt(color.replace(\"#\", \"\"), 16);\r\n  const amt = Math.round(2.55 * percent);\r\n  const R = (num >> 16) + amt;\r\n  const G = (num >> 8 & 0x00FF) + amt;\r\n  const B = (num & 0x0000FF) + amt;\r\n  return \"#\" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +\r\n    (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 + (B < 255 ? B < 1 ? 0 : B : 255))\r\n    .toString(16).slice(1);\r\n}\r\n\r\n/**\r\n * Darken a hex color by a percentage\r\n */\r\nexport function darkenColor(color: string, percent: number): string {\r\n  const num = parseInt(color.replace(\"#\", \"\"), 16);\r\n  const amt = Math.round(2.55 * percent);\r\n  const R = (num >> 16) - amt;\r\n  const G = (num >> 8 & 0x00FF) - amt;\r\n  const B = (num & 0x0000FF) - amt;\r\n  return \"#\" + (0x1000000 + (R > 0 ? R : 0) * 0x10000 +\r\n    (G > 0 ? G : 0) * 0x100 + (B > 0 ? B : 0))\r\n    .toString(16).slice(1);\r\n}\r\n\r\n// ============================================================================\r\n// PLAYER DRAWING\r\n// ============================================================================\r\n\r\n/**\r\n * Draw a player on the canvas\r\n */\r\nexport function drawPlayer(ctx: CanvasRenderingContext2D, player: Player, hasBall: boolean): void {\r\n  if (!player || typeof player.x !== 'number' || typeof player.y !== 'number' ||\r\n    !isFinite(player.x) || !isFinite(player.y)) {\r\n    console.warn('Invalid player position:', player?.name, player?.x, player?.y);\r\n    return;\r\n  }\r\n\r\n  const size = 16;\r\n\r\n  // Enhanced shadow with better depth\r\n  ctx.save();\r\n  ctx.shadowColor = 'rgba(0, 0, 0, 0.7)';\r\n  ctx.shadowBlur = 15;\r\n  ctx.shadowOffsetX = 2;\r\n  ctx.shadowOffsetY = 2;\r\n  ctx.restore();\r\n\r\n  // Draw player body with improved gradient\r\n  const offset = size * 0.5;\r\n  const gradient = ctx.createRadialGradient(\r\n    player.x - offset, player.y - offset, 0,\r\n    player.x, player.y, size\r\n  );\r\n  const color = player.isHome ? gameState.homeJerseyColor : gameState.awayJerseyColor;\r\n\r\n  gradient.addColorStop(0, lightenColor(color, 50));\r\n  gradient.addColorStop(0.5, color);\r\n  gradient.addColorStop(1, darkenColor(color, 30));\r\n\r\n  ctx.beginPath();\r\n  ctx.arc(player.x, player.y, size, 0, Math.PI * 2);\r\n  ctx.fillStyle = gradient;\r\n  ctx.fill();\r\n\r\n  // Enhanced highlight with better visibility\r\n  const isShooter = gameState.shooter && gameState.shooter.name === player.name && gameState.shotInProgress;\r\n\r\n  if (hasBall || isShooter) {\r\n    ctx.save();\r\n    ctx.shadowColor = isShooter ? '#ff4444' : '#ffd700';\r\n    ctx.shadowBlur = 15;\r\n    ctx.strokeStyle = isShooter ? '#ff4444' : '#ffd700';\r\n    ctx.lineWidth = 2.5;\r\n    ctx.beginPath();\r\n    ctx.arc(player.x, player.y, size + 2, 0, Math.PI * 2);\r\n    ctx.stroke();\r\n\r\n    // Add pulsing outer ring\r\n    ctx.globalAlpha = 0.4;\r\n    ctx.lineWidth = 1.5;\r\n    ctx.beginPath();\r\n    ctx.arc(player.x, player.y, size + 5, 0, Math.PI * 2);\r\n    ctx.stroke();\r\n    ctx.restore();\r\n  } else {\r\n    ctx.strokeStyle = 'rgba(255, 255, 255, 0.95)';\r\n    ctx.lineWidth = 1.5;\r\n    ctx.beginPath();\r\n    ctx.arc(player.x, player.y, size + 1.5, 0, Math.PI * 2);\r\n    ctx.stroke();\r\n  }\r\n\r\n  drawPlayerLabel(ctx, player);\r\n}\r\n\r\n/**\r\n * Draw player shadow (unused but kept for compatibility)\r\n */\r\nexport function drawPlayerShadow(_ctx: CanvasRenderingContext2D, _player: Player, _size: number): void {\r\n  // This function is kept for compatibility but not actively used\r\n  // The shadow is now drawn directly in drawPlayer\r\n}\r\n\r\n/**\r\n * Draw player body (unused but kept for compatibility)\r\n */\r\nexport function drawPlayerBody(ctx: CanvasRenderingContext2D, player: Player, size: number): void {\r\n  const offset = size * 0.5; // e.g., 5 * 0.5 = 2.5\r\n  const gradient = ctx.createRadialGradient(player.x - offset, player.y - offset, 0, player.x, player.y, size);\r\n  const color = player.isHome ? gameState.homeJerseyColor : gameState.awayJerseyColor;\r\n\r\n  gradient.addColorStop(0, lightenColor(color, 40));\r\n  gradient.addColorStop(0.6, color);\r\n  gradient.addColorStop(1, darkenColor(color, 40));\r\n\r\n  ctx.beginPath();\r\n  ctx.arc(player.x, player.y, size, 0, Math.PI * 2);\r\n  ctx.fillStyle = gradient;\r\n  ctx.fill();\r\n}\r\n\r\n/**\r\n * Draw player highlight (unused but kept for compatibility)\r\n */\r\nexport function drawPlayerHighlight(ctx: CanvasRenderingContext2D, player: Player, size: number, hasBall: boolean): void {\r\n  const isShooter = gameState.shooter && gameState.shooter.name === player.name && gameState.shotInProgress;\r\n\r\n  // Define smaller line widths\r\n  const highlightLineWidth = isShooter ? 2 : 1.5;\r\n  // Define smaller size offset\r\n  const highlightRadius = size + 1.5;\r\n\r\n  if (hasBall || isShooter) {\r\n    ctx.save();\r\n    ctx.shadowColor = isShooter ? '#ff4444' : '#fbbf24';\r\n    ctx.shadowBlur = 10; // Reduced blur\r\n    ctx.strokeStyle = isShooter ? '#ff4444' : '#fbbf24';\r\n    ctx.lineWidth = highlightLineWidth;\r\n    ctx.beginPath();\r\n    // Use the new, smaller radius\r\n    ctx.arc(player.x, player.y, highlightRadius, 0, Math.PI * 2);\r\n    ctx.stroke();\r\n    ctx.restore();\r\n  } else {\r\n    ctx.strokeStyle = 'rgba(255, 255, 255, 0.9)';\r\n    ctx.lineWidth = 1;\r\n    ctx.beginPath();\r\n    // Use the new, smaller radius\r\n    ctx.arc(player.x, player.y, highlightRadius, 0, Math.PI * 2);\r\n    ctx.stroke();\r\n  }\r\n}\r\n\r\n/**\r\n * Draw player name label\r\n */\r\nexport function drawPlayerLabel(ctx: CanvasRenderingContext2D, player: Player): void {\r\n  ctx.save(); // Save the (potentially) rotated context state\r\n\r\n  // 1. Move to the player's position\r\n  ctx.translate(player.x, player.y);\r\n\r\n  // 2. Conditionally un-rotate the context\r\n  if (gameState.isVertical) {\r\n    ctx.rotate(-Math.PI / 2);\r\n  }\r\n\r\n  // 3. Draw the text at the new (0,0) origin\r\n  ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';\r\n  ctx.shadowBlur = 3;\r\n  ctx.fillStyle = 'white';\r\n  ctx.font = 'bold 13px Arial';\r\n  ctx.textAlign = 'center';\r\n  ctx.textBaseline = 'middle';\r\n  ctx.fillText(player.name.substring(0, 2).toUpperCase(), 0, 0);\r\n\r\n  ctx.restore(); // Restore the context\r\n}\r\n\r\n// ============================================================================\r\n// BALL DRAWING\r\n// ============================================================================\r\n\r\n/**\r\n * Draw ground shadow for the ball\r\n * @migrated-from js/config.js (drawGroundShadow function)\r\n */\r\nexport function drawGroundShadow(ctx: CanvasRenderingContext2D, x: number, y: number, size: number, ballHeight: number): void {\r\n  const shadowY = y + size / 2; // Shadow is on the ground plane, slightly below the ball's center\r\n  const shadowRadiusX = size * 1.2 * (1 - ballHeight * 0.4);\r\n  const shadowRadiusY = shadowRadiusX * 0.3; // Elliptical shadow\r\n  const shadowOpacity = 0.4 * (1 - ballHeight * 0.5);\r\n\r\n  if (shadowOpacity > 0) {\r\n    ctx.save();\r\n    ctx.fillStyle = `rgba(0, 0, 0, ${shadowOpacity})`;\r\n    ctx.beginPath();\r\n    ctx.ellipse(x, shadowY, shadowRadiusX, shadowRadiusY, 0, 0, Math.PI * 2);\r\n    ctx.fill();\r\n    ctx.restore();\r\n  }\r\n}\r\n\r\n/**\r\n * Draw the ball\r\n */\r\nexport function drawBall(ctx: CanvasRenderingContext2D, x: number, y: number): void {\r\n  if (!isFinite(x) || !isFinite(y)) {\r\n    console.warn('Invalid ball position:', x, y);\r\n    x = 400;\r\n    y = 300;\r\n  }\r\n\r\n  const baseSize = 9;\r\n  const size = baseSize + gameState.ballHeight * 6;\r\n\r\n  // Create ball trail effect when ball is moving\r\n  if (gameState.ballTrajectory || (gameState.ballVelocity && (Math.abs(gameState.ballVelocity.x) > 50 || Math.abs(gameState.ballVelocity.y) > 50))) {\r\n    createBallTrail(x, y);\r\n  }\r\n\r\n  drawShotEffect(ctx, x, y, size);\r\n\r\n  // Draw a dedicated shadow on the ground before drawing the ball\r\n  drawGroundShadow(ctx, x, y, baseSize, gameState.ballHeight);\r\n\r\n  // Draw the ball itself on top of the shadow\r\n  drawBallBody(ctx, x, y, size);\r\n  drawBallPattern(ctx, x, y, size);\r\n}\r\n\r\n/**\r\n * Draw shot effect around the ball\r\n */\r\nexport function drawShotEffect(ctx: CanvasRenderingContext2D, x: number, y: number, size: number): void {\r\n  if (gameState.shotInProgress && gameState.ballTrajectory) {\r\n    ctx.save();\r\n    ctx.globalAlpha = 0.4;\r\n    ctx.strokeStyle = '#ff4444';\r\n    ctx.lineWidth = 3;\r\n    ctx.beginPath();\r\n    ctx.arc(x, y, size + 8, 0, Math.PI * 2);\r\n    ctx.stroke();\r\n    ctx.globalAlpha = 0.2;\r\n    ctx.beginPath();\r\n    ctx.arc(x, y, size + 16, 0, Math.PI * 2);\r\n    ctx.stroke();\r\n    ctx.restore();\r\n  }\r\n}\r\n\r\n/**\r\n * Draw ball body with 3D shading\r\n */\r\nexport function drawBallBody(ctx: CanvasRenderingContext2D, x: number, y: number, size: number): void {\r\n  // Enhanced 3D ball with realistic shading\r\n\r\n  // Main ball gradient for depth\r\n  const mainGradient = ctx.createRadialGradient(\r\n    x - size * 0.35, y - size * 0.35, size * 0.1,\r\n    x, y, size\r\n  );\r\n  mainGradient.addColorStop(0, '#ffffff');\r\n  mainGradient.addColorStop(0.3, '#f5f5f5');\r\n  mainGradient.addColorStop(0.7, '#d0d0d0');\r\n  mainGradient.addColorStop(1, '#a0a0a0');\r\n\r\n  ctx.beginPath();\r\n  ctx.arc(x, y, size, 0, Math.PI * 2);\r\n  ctx.fillStyle = mainGradient;\r\n  ctx.fill();\r\n\r\n  // Bright specular highlight for 3D effect\r\n  const highlightGradient = ctx.createRadialGradient(\r\n    x - size * 0.4, y - size * 0.4, 0,\r\n    x - size * 0.4, y - size * 0.4, size * 0.6\r\n  );\r\n  highlightGradient.addColorStop(0, 'rgba(255, 255, 255, 0.9)');\r\n  highlightGradient.addColorStop(0.3, 'rgba(255, 255, 255, 0.4)');\r\n  highlightGradient.addColorStop(1, 'rgba(255, 255, 255, 0)');\r\n  ctx.fillStyle = highlightGradient;\r\n  ctx.fill();\r\n\r\n  // Shadow side for extra depth\r\n  const shadowGradient = ctx.createRadialGradient(\r\n    x + size * 0.3, y + size * 0.3, 0,\r\n    x + size * 0.3, y + size * 0.3, size * 0.7\r\n  );\r\n  shadowGradient.addColorStop(0, 'rgba(0, 0, 0, 0)');\r\n  shadowGradient.addColorStop(0.5, 'rgba(0, 0, 0, 0.15)');\r\n  shadowGradient.addColorStop(1, 'rgba(0, 0, 0, 0.3)');\r\n  ctx.fillStyle = shadowGradient;\r\n  ctx.fill();\r\n\r\n  // Crisp outline\r\n  ctx.strokeStyle = '#888';\r\n  ctx.lineWidth = 1.8;\r\n  ctx.stroke();\r\n}\r\n\r\n/**\r\n * Draw ball pattern (pentagon)\r\n */\r\nexport function drawBallPattern(ctx: CanvasRenderingContext2D, x: number, y: number, size: number): void {\r\n  // Subtle pentagon pattern for realistic football look\r\n  ctx.save();\r\n  ctx.strokeStyle = 'rgba(80, 80, 80, 0.4)';\r\n  ctx.lineWidth = 0.8;\r\n\r\n  // Draw subtle panel lines\r\n  for (let i = 0; i < 5; i++) {\r\n    const angle = (i * Math.PI * 2) / 5 - Math.PI / 2;\r\n    const startX = x + Math.cos(angle) * (size * 0.3);\r\n    const startY = y + Math.sin(angle) * (size * 0.3);\r\n    const endX = x + Math.cos(angle) * (size * 0.75);\r\n    const endY = y + Math.sin(angle) * (size * 0.75);\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(startX, startY);\r\n    ctx.lineTo(endX, endY);\r\n    ctx.stroke();\r\n  }\r\n\r\n  // Central pentagon\r\n  ctx.beginPath();\r\n  for (let i = 0; i <= 5; i++) {\r\n    const angle = (i * Math.PI * 2) / 5 - Math.PI / 2;\r\n    const px = x + Math.cos(angle) * (size * 0.3);\r\n    const py = y + Math.sin(angle) * (size * 0.3);\r\n    if (i === 0) ctx.moveTo(px, py);\r\n    else ctx.lineTo(px, py);\r\n  }\r\n  ctx.stroke();\r\n\r\n  ctx.restore();\r\n}\r\n\r\n// ============================================================================\r\n// BROWSER EXPORTS\r\n// ============================================================================\r\n\r\nif (typeof window !== 'undefined') {\r\n  window.lightenColor = lightenColor;\r\n  window.darkenColor = darkenColor;\r\n  window.drawPlayer = drawPlayer;\r\n  window.drawPlayerShadow = drawPlayerShadow;\r\n  window.drawPlayerBody = drawPlayerBody;\r\n  window.drawPlayerHighlight = drawPlayerHighlight;\r\n  window.drawPlayerLabel = drawPlayerLabel;\r\n  window.drawBall = drawBall;\r\n  window.drawShotEffect = drawShotEffect;\r\n  window.drawBallBody = drawBallBody;\r\n  window.drawBallPattern = drawBallPattern;\r\n  // Note: drawGroundShadow is already exported by config module\r\n}\r\n", "/**\r\n * Game Renderer\r\n * Main rendering loop that draws all game entities\r\n *\r\n * @migrated-from js/rendering/gameRenderer.js\r\n * \u2705 Migrated from JavaScript with zero functional changes\r\n * \u2705 Full type safety with strict TypeScript\r\n */\r\n\r\nimport type { GameState } from '../types';\r\nimport { drawPlayer } from './drawEntities';\r\nimport { drawBall } from './drawEntities';\r\nimport { gameState } from '../globalExports';\r\nimport { GAME_CONFIG } from '../config';\r\n\r\n// ============================================================================\r\n// GLOBAL DECLARATIONS\r\n// ============================================================================\r\n\r\ndeclare global {\r\n  interface Window {\r\n    gameState: GameState;\r\n    renderGame?: typeof renderGame;\r\n    drawOffsideLines?: (ctx: CanvasRenderingContext2D) => void;\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// MAIN RENDER FUNCTION\r\n// ============================================================================\r\n\r\n/**\r\n * Main game rendering function\r\n * Renders all entities on the game canvas\r\n */\r\nexport function renderGame(): void {\r\n  if (!gameState.contexts || !gameState.contexts.game) {\r\n    console.warn('Game context not initialized yet');\r\n    return;\r\n  }\r\n\r\n  const ctx = gameState.contexts.game;\r\n\r\n  // Y\u00DCKSEK \u00C7\u00D6Z\u00DCN\u00DCRL\u00DCK AYARLARI\r\n  const SCALE_FACTOR = GAME_CONFIG.HIGH_DPI_SCALE_FACTOR;\r\n  const LOGICAL_WIDTH = gameState.isVertical ? 600 : 800;\r\n  const LOGICAL_HEIGHT = gameState.isVertical ? 800 : 600;\r\n\r\n  // 1. Clear the main canvas\r\n  // KR\u0130T\u0130K D\u00DCZELTME: Transform matrisini s\u0131f\u0131rla VE hemen ard\u0131ndan \u00F6l\u00E7eklendirmeyi uygula.\r\n  // Bu, \u00E7izimlerin 800x600 koordinat uzay\u0131nda kalmas\u0131n\u0131 sa\u011Flar.\r\n  ctx.setTransform(SCALE_FACTOR, 0, 0, SCALE_FACTOR, 0, 0);\r\n\r\n  // Canvas'\u0131 mant\u0131ksal boyutta temizle (\u00D6rn: 800x600 alan\u0131n\u0131 temizler)\r\n  ctx.clearRect(0, 0, LOGICAL_WIDTH, LOGICAL_HEIGHT);\r\n\r\n  // 2. Conditionally apply the 90-degree rotation\r\n  // save() \u00E7a\u011Fr\u0131s\u0131, setTransform ile ayarlanan SCALE_FACTOR'\u00FC saklar.\r\n  ctx.save();\r\n  if (gameState.isVertical) {\r\n    // \u00C7evirme koordinatlar\u0131 hala mant\u0131ksal olmal\u0131d\u0131r (600x800)\r\n    ctx.translate(600, 0);\r\n    ctx.rotate(Math.PI / 2);\r\n  }\r\n\r\n  // 3. Apply camera shake *after* the potential rotation\r\n  if (gameState.cameraShake > 0) {\r\n    const shakeX = (Math.random() - 0.5) * gameState.cameraShake;\r\n    const shakeY = (Math.random() - 0.5) * gameState.cameraShake;\r\n    ctx.translate(shakeX, shakeY);\r\n  }\r\n\r\n  // \u00C7izim kodunun geri kalan\u0131 (drawPlayer, drawBall) mant\u0131ksal koordinatlarda \u00E7al\u0131\u015F\u0131r\r\n  if (gameState.particles && gameState.particles.length > 0) {\r\n    gameState.particles.forEach(p => p.draw(ctx));\r\n  }\r\n\r\n  // Draw players\r\n  const allPlayers = [...gameState.homePlayers, ...gameState.awayPlayers];\r\n  if (allPlayers.length > 0) {\r\n    allPlayers.forEach(player => {\r\n      const hasBall = !!(gameState.ballHolder && gameState.ballHolder.name === player.name && !gameState.ballTrajectory);\r\n      drawPlayer(ctx, player, hasBall); // This calls drawPlayerLabel\r\n\r\n      // This 'intro' block also needs the conditional rotation fix\r\n      // Note: 'intro' is not in GameStatus type, but may be set dynamically\r\n      if ((gameState.status as string) === 'intro') {\r\n        ctx.save();\r\n        ctx.translate(player.x, player.y + 30);\r\n\r\n        // Conditionally un-rotate\r\n        if (gameState.isVertical) {\r\n          ctx.rotate(-Math.PI / 2);\r\n        }\r\n\r\n        ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';\r\n        ctx.shadowBlur = 4;\r\n        ctx.fillStyle = 'white';\r\n        ctx.font = 'bold 14px Arial';\r\n        ctx.textAlign = 'center';\r\n        ctx.fillText(player.name, 0, 0);\r\n\r\n        ctx.restore();\r\n      }\r\n    });\r\n  }\r\n\r\n  if (gameState.ballPosition) {\r\n    drawBall(ctx, gameState.ballPosition.x, gameState.ballPosition.y);\r\n  }\r\n\r\n  if (window.SHOW_OFFSIDE_LINES && window.drawOffsideLines) {\r\n    window.drawOffsideLines(ctx);\r\n  }\r\n\r\n  // 4. Restore the context (removes rotation/shake)\r\n  ctx.restore();\r\n}\r\n\r\n// ============================================================================\r\n// BROWSER EXPORTS\r\n// ============================================================================\r\n\r\nif (typeof window !== 'undefined') {\r\n  window.renderGame = renderGame;\r\n}\r\n", "/**\r\n * Rendering System\r\n * Central export point for all rendering-related functions\r\n *\r\n * @module rendering\r\n * @version 1.0.0-typescript\r\n */\r\n\r\n// ============================================================================\r\n// CANVAS SETUP\r\n// ============================================================================\r\nexport { initializeCanvasLayers } from './canvasSetup';\r\n\r\n// ============================================================================\r\n// PARTICLES\r\n// ============================================================================\r\nexport {\r\n  createGoalExplosion,\r\n  createBallTrail,\r\n  createPassEffect,\r\n  createSaveEffect\r\n} from './particles';\r\n\r\n// Note: Particle class is exported from ./particles for browser compatibility\r\n// but not re-exported here to avoid conflicts with the Particle interface in types\r\n\r\n// ============================================================================\r\n// PITCH DRAWING\r\n// ============================================================================\r\nexport {\r\n  drawPitchBackground,\r\n  drawGrass,\r\n  drawStripes,\r\n  drawLines,\r\n  drawCenterCircle,\r\n  drawGoals,\r\n  drawPenaltyAreas\r\n} from './drawPitch';\r\n\r\n// ============================================================================\r\n// ENTITY DRAWING\r\n// ============================================================================\r\nexport {\r\n  lightenColor,\r\n  darkenColor,\r\n  drawPlayer,\r\n  drawPlayerShadow,\r\n  drawPlayerBody,\r\n  drawPlayerHighlight,\r\n  drawPlayerLabel,\r\n  drawBall,\r\n  drawShotEffect,\r\n  drawBallBody,\r\n  drawBallPattern\r\n} from './drawEntities';\r\n\r\n// ============================================================================\r\n// GAME RENDERER\r\n// ============================================================================\r\nexport { renderGame } from './gameRenderer';\r\n\r\nconsole.log('\u2705 Rendering System loaded (TypeScript v1.0.0)');\r\n", "/**\r\n * ============================================================================\r\n * SET PIECE ENFORCEMENT SYSTEM v1.0\r\n * ============================================================================\r\n * [setpiece-fix] [defenders-fix] [gk-protection]\r\n *\r\n * Enforces professional set-piece rules:\r\n * 1. Taker-first action: Only taker can initiate play\r\n * 2. Opponent distance: Opponents must stay 100px away until first action\r\n * 3. Goalkeeper protection: GK cannot be tackled\r\n * 4. Set-piece state machine: Clear phases for execution\r\n * ============================================================================\r\n *\r\n * @module setpieces/enforcement\r\n * @migrated-from js/setpieces/setPieceEnforcement.js\r\n */\r\n\r\nimport type { GameState, Player } from '../types';\r\nimport { distance as getDistance } from '../utils/math';\r\nimport { getAttackingGoalX } from '../utils/ui';\r\nimport { GAME_CONFIG } from '../config';\r\n\r\n// ============================================================================\r\n// CONFIGURATION\r\n// ============================================================================\r\nconst SET_PIECE_ENFORCEMENT = {\r\n    OPPONENT_MIN_DISTANCE: 100,     // 100 pixels minimum distance\r\n    GK_PROTECTION_ENABLED: true,    // Goalkeeper protection always on\r\n    TAKER_PROTECTION_TIME: 2000,    // Taker protected for 2 seconds\r\n    WALL_MIN_DISTANCE: 92           // Wall distance for free kicks (10 yards)\r\n};\r\n\r\n// ============================================================================\r\n// SET PIECE STATE MACHINE\r\n// ============================================================================\r\nconst SET_PIECE_STATES = {\r\n    POSITIONING: 'POSITIONING',                 // Players moving to positions\r\n    WAIT_FOR_TAKER_ACTION: 'WAIT_FOR_TAKER_ACTION', // Waiting for taker to act\r\n    EXECUTING: 'EXECUTING',                     // Ball in motion\r\n    COMPLETED: 'COMPLETED'                      // Set piece finished\r\n};\r\n\r\n/**\r\n * Get current set-piece state\r\n */\r\nfunction getSetPieceState(gameState: GameState): string | null {\r\n    if (!gameState || !gameState.setPiece) return null;\r\n\r\n    const setPiece = gameState.setPiece as any;\r\n\r\n    // Check if already executed\r\n    if (setPiece.executed || gameState.ballTrajectory) {\r\n        return SET_PIECE_STATES.COMPLETED;\r\n    }\r\n\r\n    // Check if execution time reached\r\n    const now = Date.now();\r\n    const executionTime = setPiece.executionTime || now + 3000;\r\n\r\n    if (now >= executionTime && !setPiece.executed) {\r\n        return SET_PIECE_STATES.WAIT_FOR_TAKER_ACTION;\r\n    }\r\n\r\n    return SET_PIECE_STATES.POSITIONING;\r\n}\r\n\r\n// ============================================================================\r\n// [setpiece-fix] TAKER-FIRST ACTION ENFORCEMENT\r\n// ============================================================================\r\n\r\n/**\r\n * Check if player is the designated taker\r\n */\r\nfunction isSetPieceTaker(player: Player, gameState: GameState): boolean {\r\n    if (!gameState || !gameState.setPiece) return false;\r\n\r\n    const kicker = (gameState.setPiece as any).kicker;\r\n    if (!kicker) return false;\r\n\r\n    return String(player.id) === String(kicker.id);\r\n}\r\n\r\n/**\r\n * [setpiece-fix] Freeze opponents until taker acts\r\n * Enforces 100px minimum distance rule\r\n * [kick-off-fix] Also freezes non-taker teammates for kick-offs\r\n * [kick-off-half-fix] Enforces players stay in own half before kick-off\r\n */\r\nfunction freezeOpponentsUntilKick(player: Player, gameState: GameState, _allPlayers: Player[]): boolean {\r\n    if (!gameState || !gameState.setPiece || !gameState.ballPosition) return false;\r\n\r\n    const state = getSetPieceState(gameState);\r\n\r\n    // Only enforce during WAIT_FOR_TAKER_ACTION phase\r\n    if (state !== SET_PIECE_STATES.WAIT_FOR_TAKER_ACTION) return false;\r\n\r\n    const takingTeam = (gameState.setPiece as any).team;\r\n    const takingTeamIsHome = (typeof takingTeam === 'boolean') ? takingTeam : (takingTeam === 'home');\r\n\r\n    // Is this player an opponent?\r\n    const isOpponent = player.isHome !== takingTeamIsHome;\r\n    const isTaker = isSetPieceTaker(player, gameState);\r\n\r\n    // [kick-off-fix] For kick-offs, freeze ALL non-takers (including same team)\r\n    // This prevents the second taker from running before the first taker passes\r\n    if (gameState.status === 'KICK_OFF' && !isTaker) {\r\n        // Freeze position - no movement allowed until taker acts\r\n        player.targetX = player.x;\r\n        player.targetY = player.y;\r\n        player.vx = 0;\r\n        player.vy = 0;\r\n        return true; // Blocked\r\n    }\r\n\r\n    if (!isOpponent) return false;\r\n\r\n    // Calculate distance to ball\r\n    const distToBall = getDistance(player, gameState.ballPosition);\r\n\r\n    // [setpiece-fix] ENFORCE 100px MINIMUM DISTANCE\r\n    if (distToBall < SET_PIECE_ENFORCEMENT.OPPONENT_MIN_DISTANCE) {\r\n        // Push opponent back to minimum distance\r\n        const dx = player.x - gameState.ballPosition.x;\r\n        const dy = player.y - gameState.ballPosition.y;\r\n        const dist = Math.sqrt(dx * dx + dy * dy) || 1;\r\n        const ratio = SET_PIECE_ENFORCEMENT.OPPONENT_MIN_DISTANCE / dist;\r\n\r\n        player.x = gameState.ballPosition.x + dx * ratio;\r\n        player.y = gameState.ballPosition.y + dy * ratio;\r\n        player.targetX = player.x;\r\n        player.targetY = player.y;\r\n        player.vx = 0;\r\n        player.vy = 0;\r\n\r\n        return true; // Blocked\r\n    }\r\n\r\n    return false; // Not blocked\r\n}\r\n\r\n/**\r\n * [kick-off-half-fix] CRITICAL: Enforce players stay in own half before kick-off\r\n * This runs during POSITIONING and WAIT phases to prevent players crossing center line\r\n */\r\nfunction enforceKickOffHalfRule(player: Player, gameState: GameState): boolean {\r\n    if (!gameState || gameState.status !== 'KICK_OFF' || !gameState.setPiece) {\r\n        return false; // Not a kick-off\r\n    }\r\n\r\n    const state = getSetPieceState(gameState);\r\n\r\n    // Only enforce before execution (during POSITIONING and WAIT phases)\r\n    if (state === SET_PIECE_STATES.EXECUTING || state === SET_PIECE_STATES.COMPLETED) {\r\n        return false; // Kick-off already taken, players can cross\r\n    }\r\n\r\n    const centerX = GAME_CONFIG.PITCH_WIDTH / 2;\r\n\r\n    // Determine own goal position\r\n    const ownGoalX = getAttackingGoalX(!player.isHome, gameState.currentHalf);\r\n\r\n    const ownHalfIsLeft = ownGoalX < centerX;\r\n\r\n    // Check if player is in wrong half (with 5px tolerance for floating-point errors)\r\n    let inWrongHalf = false;\r\n    if (ownHalfIsLeft && player.x > centerX + 5) {\r\n        inWrongHalf = true; // Should be left, but is right\r\n    } else if (!ownHalfIsLeft && player.x < centerX - 5) {\r\n        inWrongHalf = true; // Should be right, but is left\r\n    }\r\n\r\n    if (inWrongHalf) {\r\n        // CRITICAL: Push player back to own half\r\n        const margin = 30; // Safe margin from center line\r\n        if (ownHalfIsLeft) {\r\n            player.x = Math.min(player.x, centerX - margin);\r\n            player.targetX = Math.min(player.targetX || player.x, centerX - margin);\r\n        } else {\r\n            player.x = Math.max(player.x, centerX + margin);\r\n            player.targetX = Math.max(player.targetX || player.x, centerX + margin);\r\n        }\r\n\r\n        // Stop movement towards wrong half\r\n        player.vx = 0;\r\n        player.vy = 0;\r\n\r\n        return true; // Position corrected\r\n    }\r\n\r\n    return false; // Player in correct half\r\n}\r\n\r\n/**\r\n * [setpiece-fix] Resume play after taker action\r\n */\r\nfunction resumeAfterTakerAction(gameState: GameState): void {\r\n    if (!gameState || !gameState.setPiece) return;\r\n\r\n    // Mark as executed\r\n    (gameState.setPiece as any).executed = true;\r\n    (gameState.setPiece as any).executionTime = Date.now();\r\n\r\n    console.log('\u2705 Set piece: Taker action detected, opponents released');\r\n}\r\n\r\n// ============================================================================\r\n// [gk-protection] GOALKEEPER PROTECTION\r\n// ============================================================================\r\n\r\n/**\r\n * [gk-protection] Check if player is a goalkeeper\r\n */\r\nfunction isGoalkeeper(player: Player): boolean {\r\n    if (!player) return false;\r\n    return player.role === 'GK' || (player as any).role === 'goalkeeper';\r\n}\r\n\r\n/**\r\n * [gk-protection] Prevent tackling the goalkeeper\r\n * Returns true if tackle should be blocked\r\n */\r\nfunction protectGoalkeeper(tackler: Player, target: Player, gameState: GameState): boolean {\r\n    if (!SET_PIECE_ENFORCEMENT.GK_PROTECTION_ENABLED) return false;\r\n\r\n    // Check if target is goalkeeper\r\n    if (!isGoalkeeper(target)) return false;\r\n\r\n    // [gk-protection] BLOCK TACKLE ATTEMPT\r\n    console.log(`\uD83D\uDEAB [gk-protection] Tackle blocked: ${tackler.name} cannot tackle goalkeeper ${target.name}`);\r\n\r\n    // Instead of tackling, assign marking behavior\r\n    assignDefensiveMarking(tackler, target, gameState);\r\n\r\n    return true; // Block tackle\r\n}\r\n\r\n/**\r\n * [gk-protection] Assign defensive marking instead of tackling GK\r\n */\r\nfunction assignDefensiveMarking(marker: Player, target: Player, gameState: GameState): void {\r\n    if (!marker || !target) return;\r\n\r\n    // Find nearest passing option to mark\r\n    const allPlayers = [...(gameState?.homePlayers || []), ...(gameState?.awayPlayers || [])];\r\n    const teammates = allPlayers.filter(p => p.isHome === target.isHome && p.id !== target.id);\r\n\r\n    // Find closest teammate to mark\r\n    const nearestTeammate = teammates\r\n        .filter(p => !isGoalkeeper(p))\r\n        .sort((a, b) => getDistance(marker, a) - getDistance(marker, b))[0];\r\n\r\n    if (nearestTeammate) {\r\n        // Mark the nearest passing option\r\n        marker.targetX = nearestTeammate.x;\r\n        marker.targetY = nearestTeammate.y;\r\n        (marker as any).intent = 'MARK_PASSING_OPTION';\r\n        console.log(`  \u2192 ${marker.name} marking ${nearestTeammate.name} instead`);\r\n    } else {\r\n        // Cover space near goal\r\n        const ownGoalX = getAttackingGoalX(!marker.isHome, gameState?.currentHalf || 1);\r\n        const direction = Math.sign(ownGoalX - 400);\r\n        marker.targetX = ownGoalX + direction * 60;\r\n        marker.targetY = 300;\r\n        (marker as any).intent = 'COVER_SPACE';\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// [setpiece-fix] SET PIECE STATE MANAGEMENT\r\n// ============================================================================\r\n\r\n/**\r\n * Initialize set piece with proper state\r\n */\r\nfunction initializeSetPieceState(gameState: GameState): void {\r\n    if (!gameState || !gameState.setPiece) return;\r\n\r\n    const setPiece = gameState.setPiece as any;\r\n\r\n    // Set initial state\r\n    setPiece.state = SET_PIECE_STATES.POSITIONING;\r\n    setPiece.executed = false;\r\n    setPiece.configuredTime = Date.now();\r\n\r\n    // Set execution time if not set\r\n    if (!setPiece.executionTime) {\r\n        setPiece.executionTime = Date.now() + 2500; // 2.5 seconds for positioning\r\n    }\r\n\r\n    console.log(`\u2705 Set piece initialized: ${setPiece.type} (execution in ${(setPiece.executionTime - Date.now()) / 1000}s)`);\r\n}\r\n\r\n/**\r\n * Update set piece state machine\r\n */\r\nfunction updateSetPieceState(gameState: GameState): void {\r\n    if (!gameState || !gameState.setPiece) return;\r\n\r\n    const setPiece = gameState.setPiece as any;\r\n    const currentState = getSetPieceState(gameState);\r\n\r\n    // Update state if changed\r\n    if (setPiece.state !== currentState) {\r\n        const oldState = setPiece.state;\r\n        setPiece.state = currentState;\r\n\r\n        console.log(`\u26A1 Set piece state: ${oldState} \u2192 ${currentState}`);\r\n\r\n        // Handle state transitions\r\n        if (currentState === SET_PIECE_STATES.WAIT_FOR_TAKER_ACTION) {\r\n            console.log('\u23F3 Waiting for taker action...');\r\n        } else if (currentState === SET_PIECE_STATES.EXECUTING) {\r\n            console.log('\uD83D\uDE80 Set piece executing...');\r\n        } else if (currentState === SET_PIECE_STATES.COMPLETED) {\r\n            console.log('\u2705 Set piece completed');\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Check if set piece action is allowed\r\n */\r\nfunction canPlayerActOnSetPiece(player: Player, gameState: GameState): boolean {\r\n    if (!gameState || !gameState.setPiece) return true;\r\n\r\n    const state = getSetPieceState(gameState);\r\n\r\n    // During WAIT_FOR_TAKER_ACTION, only taker can act\r\n    if (state === SET_PIECE_STATES.WAIT_FOR_TAKER_ACTION) {\r\n        return isSetPieceTaker(player, gameState);\r\n    }\r\n\r\n    // During positioning, no one can act\r\n    if (state === SET_PIECE_STATES.POSITIONING) {\r\n        return false;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n// ============================================================================\r\n// MAIN UPDATE FUNCTION\r\n// ============================================================================\r\n\r\n/**\r\n * Main enforcement update - call this every frame\r\n */\r\nfunction updateSetPieceEnforcement(gameState: GameState, allPlayers: Player[]): void {\r\n    if (!gameState || !gameState.setPiece) return;\r\n\r\n    // Update state machine\r\n    updateSetPieceState(gameState);\r\n\r\n    const state = getSetPieceState(gameState);\r\n\r\n    // [kick-off-half-fix] CRITICAL: Enforce players stay in own half before kick-off\r\n    // This runs during POSITIONING and WAIT phases\r\n    if (gameState.status === 'KICK_OFF' &&\r\n        (state === SET_PIECE_STATES.POSITIONING || state === SET_PIECE_STATES.WAIT_FOR_TAKER_ACTION)) {\r\n        allPlayers.forEach(player => {\r\n            enforceKickOffHalfRule(player, gameState);\r\n        });\r\n    }\r\n\r\n    // During WAIT_FOR_TAKER_ACTION phase, enforce rules\r\n    if (state === SET_PIECE_STATES.WAIT_FOR_TAKER_ACTION) {\r\n        // Freeze all opponents\r\n        allPlayers.forEach(player => {\r\n            freezeOpponentsUntilKick(player, gameState, allPlayers);\r\n        });\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// EXPORTS\r\n// ============================================================================\r\nexport const SetPieceEnforcement = {\r\n    // Configuration\r\n    SET_PIECE_ENFORCEMENT,\r\n    SET_PIECE_STATES,\r\n\r\n    // State management\r\n    getSetPieceState,\r\n    initializeSetPieceState,\r\n    updateSetPieceState,\r\n    canPlayerActOnSetPiece,\r\n\r\n    // Taker-first action\r\n    isSetPieceTaker,\r\n    freezeOpponentsUntilKick,\r\n    enforceKickOffHalfRule,\r\n    resumeAfterTakerAction,\r\n\r\n    // Goalkeeper protection\r\n    isGoalkeeper,\r\n    protectGoalkeeper,\r\n    assignDefensiveMarking,\r\n\r\n    // Main update\r\n    updateSetPieceEnforcement\r\n};\r\n\r\n// Browser exports - now using ES6 modules\r\nconsole.log('\u2705 SET PIECE ENFORCEMENT SYSTEM v1.0 LOADED');\r\nconsole.log('   \u2713 [setpiece-fix] Taker-first action logic');\r\nconsole.log('   \u2713 [setpiece-fix] 100px opponent distance enforcement');\r\nconsole.log('   \u2713 [kick-off-half-fix] Players stay in own half before kick-off');\r\nconsole.log('   \u2713 [gk-protection] Goalkeeper protection enabled');\r\nconsole.log('   \u2713 [setpiece-fix] State machine (WAIT_FOR_TAKER_ACTION)');\r\n", "/**\n * @file core.ts\n * @migrated-from js/core.js\n *\n * Core Game Logic and Update Functions\n *\n * THIS MODULE IS RESPONSIBLE FOR:\n * 1. Ball physics simulation and trajectory updates\n * 2. Possession changes based on ballHolder\n * 3. Game loop orchestration and timing\n * 4. Calling updatePlayerAI_V2 for each player\n * 5. Goal detection and score updates\n * 6. Match state management (time, status)\n * 7. Rendering and visual updates\n *\n * CONSTRAINT: This module coordinates all systems but doesn't handle individual\n * player decisions (that's in ai module)\n */\n\nimport type { Player, GameState, Foul } from './types';\nimport { distance, pointToLineDistance } from './utils/math';\nimport { getPlayerActivePosition, applyMarkingAndPressing } from './ai';\nimport { updateGoalkeeperAI_Advanced } from './ai';\nimport { initiatePass, initiateDribble, passBall } from './ai';\nimport { action_attemptTackle } from './rules/ballControl';\nimport { assignBallChasers, validateBallHolder, updatePhysics } from './physics';\nimport { renderGame } from './rendering';\nimport { GAME_CONFIG, TACTICS, GAME_LOOP } from './config';\nimport { gameState } from './globalExports';\nimport { EVENT_TYPES } from './types';\nimport { eventBus } from './eventBus';\nimport { getAttackingGoalX, calculateXG, isSetPieceStatus } from './utils/ui';\nimport { resetAfterGoal, handleShotAttempt, removePlayerFromMatch, handleFreeKick, processPendingEvents } from './main';\nimport * as SetPieceIntegration from './setpieces/integration';\nimport { SetPieceEnforcement } from './setpieces/enforcement';\n\nimport { getVisibleTeammates } from './ai/playerVision';\nimport { selectBestAttackingMovement } from './ai/MovementPatterns';\nimport { canPlayerActOnBall } from './ai/playerFirstTouch';\n\n// Debug flag (replaces window.DEBUG_AI)\nconst DEBUG_AI = false;\n\n// ============================================================================\n// SPATIAL AWARENESS SYSTEM\n// ============================================================================\n\nclass SpatialAwarenessSystem {\n    private grid: Player[][][] | null = null;\n    private cellSize: number = 50;\n\n    buildGrid(allPlayers: Player[], width: number, height: number): void {\n        const cols = Math.ceil(width / this.cellSize);\n        const rows = Math.ceil(height / this.cellSize);\n\n        this.grid = Array(rows).fill(null).map(() => Array(cols).fill(null).map(() => []));\n\n        allPlayers.forEach(player => {\n            const col = Math.floor(player.x / this.cellSize);\n            const row = Math.floor(player.y / this.cellSize);\n\n            if (this.grid && row >= 0 && row < rows && col >= 0 && col < cols && this.grid[row] && this.grid[row][col]) {\n                this.grid[row][col].push(player);\n            }\n        });\n    }\n\n    getNearbyPlayers(player: Player, radius: number): Player[] {\n        if (!this.grid || this.grid.length === 0) return [];\n\n        const col = Math.floor(player.x / this.cellSize);\n        const row = Math.floor(player.y / this.cellSize);\n        const cellRadius = Math.ceil(radius / this.cellSize);\n\n        const nearby: Player[] = [];\n\n        for (let r = row - cellRadius; r <= row + cellRadius; r++) {\n            for (let c = col - cellRadius; c <= col + cellRadius; c++) {\n                if (this.grid && r >= 0 && r < this.grid.length && this.grid[0] && c >= 0 && c < this.grid[0].length) {\n                    const row = this.grid[r];\n                    if (row) {\n                        const cell = row[c];\n                        if (cell) {\n                            nearby.push(...cell);\n                        }\n                    }\n                }\n            }\n        }\n\n        return nearby.filter(p => {\n            if (p.id === player.id) return false;\n            const dx = p.x - player.x;\n            const dy = p.y - player.y;\n            return Math.sqrt(dx * dx + dy * dy) < radius;\n        });\n    }\n\n    calculateSpacingForce(player: Player, teammates: Player[]): { x: number; y: number } {\n        const personalSpace = ['CB', 'RB', 'LB'].includes(player.role) ? 35 : 25;\n        const nearby = this.getNearbyPlayers(player, personalSpace * 2).filter(p => teammates.some(t => t.id === p.id));\n\n        let forceX = 0;\n        let forceY = 0;\n\n        nearby.forEach(teammate => {\n            const dx = player.x - teammate.x;\n            const dy = player.y - teammate.y;\n            const dist = Math.sqrt(dx * dx + dy * dy);\n\n            if (dist < personalSpace && dist > 0) {\n                const strength = (personalSpace - dist) / personalSpace;\n                const force = strength * 2.5;\n                forceX += (dx / dist) * force;\n                forceY += (dy / dist) * force;\n            }\n        });\n\n        return { x: forceX, y: forceY };\n    }\n}\n\nexport const spatialSystem = new SpatialAwarenessSystem();\n\n// ============================================================================\n// ACTION DECISION SYSTEM\n// ============================================================================\n\ninterface ActionDecision {\n    action: 'SHOOT' | 'PASS' | 'DRIBBLE' | 'HOLD';\n    target: Player | { x: number; y: number } | null;\n}\n\nclass ActionDecisionSystem {\n    decideBestAction(player: Player, teammates: Player[], opponents: Player[], gameState: GameState): ActionDecision {\n        const goalX = getAttackingGoalX(player.isHome, gameState.currentHalf);\n\n        // PRIORITY 1: SHOOT\n        if (this.shouldShootNow(player, opponents, gameState)) {\n            if (DEBUG_AI) {\n                console.log(`[AI] ${player.name}: SHOOT decision (goalX=${goalX})`);\n            }\n            return { action: 'SHOOT', target: { x: goalX, y: 300 } };\n        }\n\n        // PRIORITY 2: PASS\n        const bestPass = this.findBestPassTarget(player, teammates, opponents, goalX);\n        if (bestPass && bestPass.score > 60) {\n            if (DEBUG_AI) {\n                console.log(`[AI] ${player.name}: PASS decision (score=${bestPass.score}, target=${bestPass.teammate.name})`);\n            }\n            return { action: 'PASS', target: bestPass.teammate };\n        }\n\n        // PRIORITY 3: DRIBBLE\n        if (this.hasSpaceToDribble(player, opponents, goalX)) {\n            if (DEBUG_AI) {\n                console.log(`[AI] ${player.name}: DRIBBLE decision (to goalX=${goalX})`);\n            }\n            return { action: 'DRIBBLE', target: { x: goalX, y: player.y } };\n        }\n\n        // DEFAULT:\n        if (bestPass) {\n            if (DEBUG_AI) {\n                console.log(`[AI] ${player.name}: PASS decision (fallback, score=${bestPass.score})`);\n            }\n            return { action: 'PASS', target: bestPass.teammate };\n        }\n\n        if (DEBUG_AI) {\n            console.log(`[AI] ${player.name}: HOLD decision (no viable options)`);\n        }\n        return { action: 'HOLD', target: null };\n    }\n\n    shouldShootNow(player: Player, opponents: Player[], gameState: GameState): boolean {\n        try {\n            // Prevent shooting immediately after kick-off\n            if (gameState.postKickOffCalmPeriod && gameState.kickOffCompletedTime) {\n                const timeSinceKickOff = Date.now() - gameState.kickOffCompletedTime;\n                if (timeSinceKickOff < 4000) { // 4 seconds calm period\n                    return false;\n                }\n                // Clear flag after calm period expires\n                if (timeSinceKickOff >= 4000) {\n                    gameState.postKickOffCalmPeriod = false;\n                }\n            }\n\n            const goalX = getAttackingGoalX(player.isHome, gameState.currentHalf);\n\n            // Validate goalX calculation\n            if (typeof goalX !== 'number' || !isFinite(goalX)) {\n                console.warn(`Invalid goalX in shouldShootNow: ${goalX}`);\n                return false;\n            }\n\n            const distToGoal = Math.abs(player.x - goalX);\n            if (distToGoal > 250) return false;\n\n            const xG = calculateXG(player, goalX, player.y, opponents);\n\n            // Validate xG result\n            if (typeof xG !== 'number' || !isFinite(xG)) {\n                console.warn(`Invalid xG calculation: ${xG}, defaulting to no shot`);\n                return false;\n            }\n\n            return xG > 0.1;\n        } catch (err) {\n            console.error('shouldShootNow error:', err);\n            return false;\n        }\n    }\n\n    findBestPassTarget(player: Player, teammates: Player[], opponents: Player[], goalX: number): { teammate: Player; score: number } | null {\n        const visibleTeammates = getVisibleTeammates(player, [...teammates, player]);\n\n        let bestOption: { teammate: Player; score: number } | null = null;\n        let bestScore = -1;\n\n        visibleTeammates.forEach((teammate: Player) => {\n            const distToTeammate = distance(player, teammate);\n            if (distToTeammate < 30 || distToTeammate > 250) return;\n\n            let score = 0;\n\n            if (Math.sign(teammate.x - player.x) === Math.sign(goalX - player.x)) {\n                score += 40;\n            }\n\n            const space = opponents.length > 0\n                ? Math.min(...opponents.map(o => distance(teammate, o)))\n                : 1000;\n            score += Math.max(0, space - 20);\n\n            const isBlocked = opponents.some(opp => pointToLineDistance(opp, player, teammate) < 20 && distance(player, opp) < distToTeammate);\n            if (isBlocked) score = 0;\n\n            if (score > bestScore) {\n                bestScore = score;\n                bestOption = { teammate, score };\n            }\n        });\n\n        return bestOption;\n    }\n\n    hasSpaceToDribble(player: Player, opponents: Player[], goalX: number): boolean {\n        const dribbleCheckPos = {\n            x: player.x + Math.sign(goalX - player.x) * 50,\n            y: player.y\n        };\n        const spaceAhead = opponents.length > 0\n            ? Math.min(...opponents.map(o => distance(dribbleCheckPos, o)))\n            : 1000;\n        return spaceAhead > 40;\n    }\n}\n\nexport const actionDecision = new ActionDecisionSystem();\n\n// ============================================================================\n// SMART TACKLE SYSTEM\n// ============================================================================\n\nclass SmartTackleSystem {\n    shouldAttemptTackle(defender: Player, ballCarrier: Player, gameState: GameState): boolean {\n        const dist = Math.sqrt(\n            Math.pow(defender.x - ballCarrier.x, 2) +\n            Math.pow(defender.y - ballCarrier.y, 2)\n        );\n\n        if (dist > 18) return false;\n\n        const inPenaltyBox = this.isInPenaltyBox(defender, gameState);\n\n        if (inPenaltyBox) {\n            const defenderSkill = (defender.defending / 100);\n            return Math.random() < (defenderSkill * 0.2);\n        }\n\n        const defenderSkill = (defender.defending / 100);\n        return Math.random() < (defenderSkill * 0.6);\n    }\n\n    isInPenaltyBox(player: Player, gameState: GameState): boolean {\n        const pitchWidth = GAME_CONFIG.PITCH_WIDTH;\n        const boxWidth = 160;\n        const boxHeight = 400;\n        const centerY = 300;\n\n        const attackingGoalX = getAttackingGoalX(!player.isHome, gameState.currentHalf);\n\n        if (attackingGoalX < pitchWidth / 2) {\n            return player.x < boxWidth &&\n                player.y > (centerY - boxHeight / 2) &&\n                player.y < (centerY + boxHeight / 2);\n        } else {\n            return player.x > (pitchWidth - boxWidth) &&\n                player.y > (centerY - boxHeight / 2) &&\n                player.y < (centerY + boxHeight / 2);\n        }\n    }\n\n    checkForPenalty(foul: Foul, gameState: GameState): { awarded: boolean; attackingTeam?: string; defendingTeam?: string } {\n        const fouledInBox = this.isInPenaltyBox(foul.fouled, gameState);\n\n        if (!fouledInBox || foul.severity <= 0.5) {\n            return { awarded: false };\n        }\n\n        const PITCH_WIDTH = GAME_CONFIG.PITCH_WIDTH;\n        const boxWidth = 160;\n\n        const inLeftBox = foul.fouled.x < boxWidth;\n        const inRightBox = foul.fouled.x > (PITCH_WIDTH - boxWidth);\n\n        const homeAttackingGoalX = getAttackingGoalX(true, gameState.currentHalf);\n\n        let foulInHomeDefensiveBox: boolean, foulInAwayDefensiveBox: boolean;\n\n        if (homeAttackingGoalX < PITCH_WIDTH / 2) {\n            foulInHomeDefensiveBox = inRightBox;\n            foulInAwayDefensiveBox = inLeftBox;\n        } else {\n            foulInHomeDefensiveBox = inLeftBox;\n            foulInAwayDefensiveBox = inRightBox;\n        }\n\n        const fouledPlayerIsHome = foul.fouled.isHome;\n        const foulerPlayerIsHome = foul.fouler.isHome;\n\n        let penaltyAwarded = false;\n\n        if (fouledPlayerIsHome && foulInAwayDefensiveBox) {\n            penaltyAwarded = true;\n        } else if (!fouledPlayerIsHome && foulInHomeDefensiveBox) {\n            penaltyAwarded = true;\n        }\n\n        if (penaltyAwarded) {\n            return {\n                awarded: true,\n                attackingTeam: fouledPlayerIsHome ? 'home' : 'away',\n                defendingTeam: foulerPlayerIsHome ? 'home' : 'away'\n            };\n        }\n\n        return { awarded: false };\n    }\n}\n\nexport const tackleSystem = new SmartTackleSystem();\n\n// ============================================================================\n// PENALTY KICK SYSTEM\n// ============================================================================\n\ninterface PenaltyState {\n    shooter: Player;\n    goalkeeper: Player;\n    goalX: number;\n    penaltySpotX: number;\n    spotY: number;\n    phase: 'SETUP' | 'READY' | 'SHOOTING';\n    startTime: number;\n}\n\nclass PenaltySystem {\n    state: PenaltyState | null = null;\n\n    initiate(attackingTeam: Player[], defendingTeam: Player[], gameState: GameState): PenaltyState | null {\n        const shooter = attackingTeam\n            .filter(p => p.role !== 'GK')\n            .sort((a, b) => b.shooting - a.shooting)[0];\n\n        if (!shooter) return null;\n\n        const goalkeeper = defendingTeam.find(p => p.role === 'GK');\n        if (!goalkeeper) return null;\n\n        const goalX = getAttackingGoalX(shooter.isHome, gameState.currentHalf);\n        const penaltySpotX = goalX < 400 ? 110 : 690;\n\n        this.state = {\n            shooter,\n            goalkeeper,\n            goalX,\n            penaltySpotX,\n            spotY: 300,\n            phase: 'SETUP',\n            startTime: Date.now()\n        };\n\n        gameState.status = 'PENALTY';\n        gameState.ballHolder = null;\n        gameState.ballTrajectory = null;\n\n        console.log(`\uD83C\uDFAF PENALTY AWARDED! ${shooter.name} to take`);\n\n        return this.state;\n    }\n\n    update(gameState: GameState): { outcome: string; message: string } | null {\n        if (!this.state) return null;\n\n        const elapsed = Date.now() - this.state.startTime;\n\n        switch (this.state.phase) {\n            case 'SETUP':\n                this.positionPlayers(gameState);\n                if (elapsed > 2000) {\n                    this.state.phase = 'READY';\n                }\n                break;\n\n            case 'READY':\n                if (elapsed > 3000) {\n                    this.state.phase = 'SHOOTING';\n                    return this.executeShot(gameState);\n                }\n                break;\n        }\n\n        return null;\n    }\n\n    positionPlayers(gameState: GameState): void {\n        if (!this.state) return;\n        const allPlayers = [...gameState.homePlayers, ...gameState.awayPlayers];\n\n        // Position shooter\n        this.state.shooter.x = this.state.penaltySpotX;\n        this.state.shooter.y = this.state.spotY;\n\n        // Position goalkeeper\n        this.state.goalkeeper.x = this.state.goalX;\n        this.state.goalkeeper.y = this.state.spotY;\n\n        // Position ball\n        gameState.ballPosition.x = this.state.penaltySpotX;\n        gameState.ballPosition.y = this.state.spotY;\n\n        // Clear everyone else from box\n        allPlayers.forEach(p => {\n            if (this.state && p.id !== this.state.shooter.id && p.id !== this.state.goalkeeper.id) {\n                if (tackleSystem.isInPenaltyBox(p, gameState)) {\n                    p.x = 400;\n                    p.targetX = 400;\n                }\n            }\n        });\n    }\n\n    executeShot(gameState: GameState): { outcome: string; message: string } | null {\n        if (!this.state) return null;\n        const state = this.state; // Local reference for type safety\n        const shooterSkill = state.shooter.shooting / 100;\n        const gkSkill = state.goalkeeper.goalkeeping / 100;\n\n        const teamStats = state.shooter.isHome ? gameState.stats.home : gameState.stats.away;\n        const oppositionStats = state.shooter.isHome ? gameState.stats.away : gameState.stats.home;\n        const PENALTY_XG = 0.76;\n\n        teamStats.xGTotal += PENALTY_XG;\n\n        const corners = [\n            { y_offset: -40, name: 'top' },\n            { y_offset: 40, name: 'bottom' },\n            { y_offset: -20, name: 'mid-top' },\n            { y_offset: 20, name: 'mid-bottom' }\n        ];\n\n        const targetCorner = corners[Math.floor(Math.random() * corners.length)] || corners[0];\n        const targetY = state.spotY + (targetCorner?.y_offset || 0);\n\n        const gkDiveY = state.spotY + (Math.random() < 0.5 ? -40 : 40);\n\n        const accuracy = shooterSkill + (Math.random() * 0.3 - 0.15);\n        const onTarget = accuracy > 0.4;\n        const correctDive = Math.abs(targetY - gkDiveY) < 50;\n        const saved = onTarget && correctDive && (gkSkill + Math.random() * 0.3) > 0.7;\n\n        passBall(\n            state.shooter,\n            state.penaltySpotX,\n            state.spotY,\n            state.goalX,\n            targetY,\n            1.0,\n            900,\n            true\n        );\n\n        state.goalkeeper.targetY = gkDiveY;\n\n        let result: { outcome: string; message: string };\n        if (!onTarget) {\n            result = {\n                outcome: 'MISS',\n                message: `\u274C ${state.shooter.name} misses the target!`\n            };\n            teamStats.shotsOffTarget++;\n\n        } else if (saved) {\n            result = {\n                outcome: 'SAVE',\n                message: `\uD83E\uDDE4 ${state.goalkeeper.name} saves the penalty!`\n            };\n            teamStats.shotsOnTarget++;\n            if (oppositionStats.saves !== undefined) {\n                oppositionStats.saves++;\n            }\n\n        } else {\n            result = {\n                outcome: 'GOAL',\n                message: `\u26BD GOAL! ${state.shooter.name} scores from the spot!`\n            };\n\n            teamStats.shotsOnTarget++;\n\n            if (state.shooter.isHome) {\n                gameState.homeScore++;\n            } else {\n                gameState.awayScore++;\n            }\n\n            gameState.lastGoalScorer = state.shooter.isHome ? 'home' : 'away';\n\n            gameState.goalEvents.push({\n                time: Math.floor(gameState.timeElapsed),\n                scorer: state.shooter.name,\n                isHome: state.shooter.isHome,\n                xG: PENALTY_XG\n            });\n        }\n\n        gameState.commentary.push({\n            text: `${Math.floor(gameState.timeElapsed)}' ${result.message}`,\n            type: result.outcome === 'GOAL' ? 'goal' : 'save'\n        });\n\n        setTimeout(() => {\n            this.reset();\n            gameState.status = 'playing';\n\n            if (result.outcome === 'GOAL') {\n                if (typeof resetAfterGoal === 'function') {\n                    resetAfterGoal();\n                }\n            } else {\n                gameState.ballHolder = state.goalkeeper;\n                state.goalkeeper.hasBallControl = true;\n                state.goalkeeper.ballReceivedTime = Date.now();\n            }\n        }, 3000);\n\n        return result;\n    }\n\n    reset(): void {\n        this.state = null;\n    }\n}\n\nexport const penaltySystem = new PenaltySystem();\n\n// ============================================================================\n// V2 PLAYER UPDATE - Integrates All Systems\n// ============================================================================\n\nexport function updatePlayerAI_V2(player: Player, ball: { x: number; y: number }, allPlayers: Player[], gameState: GameState): void {\n    const now = Date.now();\n\n    // Set piece lock guard\n    if (player.lockUntil && now < player.lockUntil) {\n        if (player.setPieceTarget && player.isKicker) {\n            player.x = player.setPieceTarget.x;\n            player.y = player.setPieceTarget.y;\n            player.targetX = player.setPieceTarget.x;\n            player.targetY = player.setPieceTarget.y;\n            player.vx = 0;\n            player.vy = 0;\n            player.intent = \"SET_PIECE_HOLD\";\n            return;\n        }\n        player.lockUntil = 0;\n    }\n\n    if (player.lockUntil && now >= player.lockUntil) {\n        player.lockUntil = 0;\n        player.setPieceTarget = null;\n        player.isInWall = false;\n        player.isDefCBLine = false;\n        player.isMarker = false;\n        player.isKicker = false;\n    }\n\n    // Let set-piece enhancement run first\n    if (SetPieceIntegration?.updatePlayerAI_V2_SetPieceEnhancement) {\n        if (SetPieceIntegration.updatePlayerAI_V2_SetPieceEnhancement(player, allPlayers, gameState)) {\n            return;\n        }\n    }\n\n    // Decision throttle\n    const updateInterval = player.isChasingBall ? 50 : 200;\n    if (now - (player.lastDecisionTime || 0) < updateInterval) return;\n    player.lastDecisionTime = now;\n\n    // Special-state handling\n    const specialStateActive = ['PENALTY', 'KICK_OFF', 'FREE_KICK', 'CORNER_KICK', 'THROW_IN', 'GOAL_KICK']\n        .includes(gameState.status);\n\n    if (specialStateActive) {\n        if (gameState.status === 'PENALTY' && penaltySystem.state) {\n            penaltySystem.update(gameState);\n            return;\n        }\n    }\n\n    // Normal AI below\n    const teammates = allPlayers.filter(p => p.isHome === player.isHome);\n    const opponents = allPlayers.filter(p => p.isHome !== player.isHome);\n    const spacingForce = spatialSystem.calculateSpacingForce(player, teammates);\n\n    // ON-THE-BALL LOGIC\n    if (gameState.ballHolder?.id === player.id && player.hasBallControl) {\n        if (!canPlayerActOnBall(player)) {\n            player.targetX = player.x;\n            player.targetY = player.y;\n            return;\n        }\n        const decision = actionDecision.decideBestAction(player, teammates, opponents, gameState);\n\n        if (decision.action === 'SHOOT') {\n            const target = decision.target as { x: number; y: number };\n            handleShotAttempt(player, target.x, allPlayers);\n        } else if (decision.action === 'PASS') {\n            initiatePass(player, decision.target as Player);\n        } else if (decision.action === 'DRIBBLE') {\n            const target = decision.target as { x: number; y: number };\n            initiateDribble(player, target.x);\n        } else {\n            player.targetX = player.x;\n            player.targetY = player.y;\n        }\n        return;\n    }\n\n    // OFF-THE-BALL LOGIC\n    if (player.role === 'GK') {\n        updateGoalkeeperAI_Advanced(player, ball, opponents);\n        return;\n    }\n\n    if (!gameState.ballHolder && !gameState.ballTrajectory && player.isChasingBall) {\n        player.targetX = ball.x;\n        player.targetY = ball.y;\n        player.speedBoost = 1.5;\n        return;\n    }\n\n    const ballCarrier = gameState.ballHolder;\n\n    // DEFENDING\n    if (distance(player, ballCarrier) < 50 && (!player.stunnedUntil || now > player.stunnedUntil)) {\n        if (distance(player, ballCarrier) < 35 && (!player.stunnedUntil || now > player.stunnedUntil)) {\n            action_attemptTackle(player, allPlayers);\n        } else {\n            const markingResult = applyMarkingAndPressing(\n                player,\n                ball,\n                opponents,\n                getPlayerActivePosition(player, gameState.currentHalf),\n                getAttackingGoalX(!player.isHome, gameState.currentHalf),\n                TACTICS[player.isHome ? gameState.homeTactic : gameState.awayTactic],\n                player.isHome ? gameState.homeTeamState : gameState.awayTeamState\n            );\n            player.targetX = markingResult.x + spacingForce.x;\n            player.targetY = markingResult.y + spacingForce.y;\n            player.speedBoost = markingResult.shouldPress ? 1.3 : 1.1;\n        }\n        return;\n    }\n\n    // ATTACKING\n    if (ballCarrier && ballCarrier.isHome === player.isHome) {\n        const activePosition = getPlayerActivePosition(player, gameState.currentHalf);\n        const opponentGoalX = getAttackingGoalX(player.isHome, gameState.currentHalf);\n        const supportMove = selectBestAttackingMovement(\n            player, ballCarrier, teammates, opponents, activePosition, opponentGoalX, gameState\n        );\n\n        if (supportMove.shouldLock) {\n            const distToCurrentTarget = Math.sqrt(\n                Math.pow(player.targetX - player.x, 2) +\n                Math.pow(player.targetY - player.y, 2)\n            );\n\n            if (player.targetLocked && now - player.targetLockTime < 2000 && distToCurrentTarget > 15) {\n                return;\n            }\n\n            player.targetX = supportMove.x + spacingForce.x;\n            player.targetY = supportMove.y + spacingForce.y;\n            player.speedBoost = supportMove.speedBoost;\n            player.targetLocked = true;\n            player.targetLockTime = now;\n        } else {\n            player.targetX = supportMove.x + spacingForce.x;\n            player.targetY = supportMove.y + spacingForce.y;\n            player.speedBoost = supportMove.speedBoost;\n        }\n        return;\n    }\n\n    // NEUTRAL\n    const activePos = getPlayerActivePosition(player, gameState.currentHalf);\n    player.targetX = activePos.x + spacingForce.x;\n    player.targetY = activePos.y + spacingForce.y;\n    player.speedBoost = 1.0;\n}\n\nexport function handleFoul_V2(fouler: Player, fouled: Player): void {\n    gameState.fouls++;\n    gameState.ballHolder = null;\n    gameState.ballTrajectory = null;\n\n    console.log(`\u26A0\uFE0F FAUL: ${fouler.name} -> ${fouled.name}`);\n\n    eventBus.publish(EVENT_TYPES.FOUL_COMMITTED, { fouler: fouler, fouled: fouled });\n\n    const severity = Math.random();\n    const alreadyBooked = gameState.yellowCards.some((card: any) => card.player === fouler.name);\n\n    // Second yellow -> red\n    if (alreadyBooked && severity > 0.80) {\n        console.log(`\uD83D\uDFE5 \u0130K\u0130NC\u0130 SARI KART! ${fouler.name} oyundan at\u0131ld\u0131.`);\n        removePlayerFromMatch(fouler);\n        gameState.cardEvents.push({ player: fouler.name, time: Math.floor(gameState.timeElapsed), type: 'second_yellow' });\n\n    } else if (severity > 0.85) {\n        // Direct red\n        if (severity > 0.97) {\n            console.log(`\uD83D\uDFE5 D\u0130REKT KIRMIZI KART! ${fouler.name} oyundan at\u0131ld\u0131.`);\n            removePlayerFromMatch(fouler);\n            gameState.cardEvents.push({ player: fouler.name, time: Math.floor(gameState.timeElapsed), type: 'direct_red' });\n\n        } else if (!alreadyBooked) {\n            console.log(`\uD83D\uDFE8 SARI KART! ${fouler.name}`);\n            gameState.cardEvents.push({ player: fouler.name, time: Math.floor(gameState.timeElapsed), type: 'yellow' });\n        }\n    }\n\n    // Penalty check\n    const penaltyCheck = tackleSystem.checkForPenalty(\n        { fouler, fouled, severity: severity },\n        gameState\n    );\n\n    if (penaltyCheck.awarded) {\n        console.log(`\uD83C\uDFAF PENALTI! Faul: ${fouler.name}`);\n        const attackingTeam = fouled.isHome ? gameState.homePlayers : gameState.awayPlayers;\n        const defendingTeam = fouler.isHome ? gameState.homePlayers : gameState.awayPlayers;\n\n        penaltySystem.initiate(attackingTeam, defendingTeam, gameState);\n        return;\n    }\n\n    // Free kick\n    handleFreeKick({ x: fouled.x, y: fouled.y }, fouler.isHome);\n}\n\n// ============================================================================\n// SHOT STATE CLEANUP\n// ============================================================================\n\nexport function cleanupShotState(gameState: GameState): void {\n    if (!gameState.ballTrajectory || gameState.ballHolder) {\n        if (gameState.shotInProgress) {\n            console.log(`Shot ended: ${gameState.shooter?.name || 'unknown'}`);\n        }\n        gameState.shotInProgress = false;\n        gameState.shooter = null;\n        gameState.currentShotXG = null;\n    }\n}\n\n// ============================================================================\n// DYNAMIC DEFENSIVE LINE\n// ============================================================================\n\nexport function updateDefensiveLines(gameState: GameState): void {\n    const calculateDefensiveLine = (team: 'home' | 'away') => {\n        const players = team === 'home' ? gameState.homePlayers : gameState.awayPlayers;\n        const defenders = players.filter(p => ['CB', 'RB', 'LB', 'CDM'].includes(p.role));\n\n        if (defenders.length === 0) return team === 'home' ? 200 : 600;\n\n        const mostBack = team === 'home' ?\n            Math.max(...defenders.map(d => d.x)) :\n            Math.min(...defenders.map(d => d.x));\n\n        return mostBack;\n    };\n\n    gameState.homeDefensiveLine = calculateDefensiveLine('home');\n    gameState.awayDefensiveLine = calculateDefensiveLine('away');\n}\n\n// ============================================================================\n// PHYSICS TIMESTEP SCALING\n// ============================================================================\n\nexport function getScaledTimestep(): number {\n    const GAME_SPEED = GAME_CONFIG.GAME_SPEED || 1.0;\n    const baseTimestep = 3/60;\n    return baseTimestep / GAME_SPEED;\n}\n\n// ============================================================================\n// PARTICLE CLEANUP\n// ============================================================================\n\nexport function updateParticlesWithCleanup(gameState: GameState): void {\n    if (!gameState.particles || gameState.particles.length === 0) return;\n\n    const now = Date.now();\n    const PARTICLE_TIMEOUT = 5000;\n    const VIEWPORT_MARGIN = 100;\n    const MAX_PARTICLES = 150;\n\n    gameState.particles = gameState.particles.filter(particle => {\n        if (now - particle.createdAt > PARTICLE_TIMEOUT) return false;\n        if (particle.x < -VIEWPORT_MARGIN || particle.x > 900) return false;\n        if (particle.y < -VIEWPORT_MARGIN || particle.y > 700) return false;\n        return true;\n    });\n\n    if (gameState.particles.length > MAX_PARTICLES) {\n        gameState.particles = gameState.particles.slice(-MAX_PARTICLES);\n        console.log(`\u26A0\uFE0F Particle count capped at ${MAX_PARTICLES} (performance protection)`);\n    }\n}\n\n// ============================================================================\n// MAIN GAME LOOP V2\n// ============================================================================\n\nlet lastFrameTime = 0;\nlet physicsAccumulator = 0;\nlet gameTime = 0;\n\nexport function gameLoop_V2(timestamp: number): void {\n    if (!lastFrameTime) lastFrameTime = timestamp;\n    if (!gameState.contexts || !gameState.contexts.game) {\n        if (gameState.status !== 'finished') {\n            requestAnimationFrame(gameLoop_V2);\n        }\n        return;\n    }\n\n    let dt = (timestamp - lastFrameTime) / 1000;\n    lastFrameTime = timestamp;\n    dt = Math.max(0, Math.min(dt, GAME_LOOP.MAX_FRAME_TIME));\n\n    const allPlayers = [...gameState.homePlayers, ...gameState.awayPlayers];\n    spatialSystem.buildGrid(allPlayers, 800, 600);\n\n    if (gameState.status === 'playing' && !gameState.ballHolder?.hasBallControl && !gameState.ballTrajectory) {\n        assignBallChasers(allPlayers);\n    }\n\n    const isGameActive = gameState.status === 'playing';\n    const isSetPiece = isSetPieceStatus(gameState.status);\n    const runPhysics = isGameActive || isSetPiece;\n\n    if (runPhysics) {\n        allPlayers.forEach(player => {\n            updatePlayerAI_V2(player, gameState.ballPosition, allPlayers, gameState);\n        });\n    }\n\n    if (isSetPiece) {\n        if (SetPieceEnforcement?.updateSetPieceEnforcement) {\n            SetPieceEnforcement.updateSetPieceEnforcement(gameState, allPlayers);\n        }\n\n        if (gameState.setPiece && gameState.setPiece.executionTime) {\n            const timeUntilExecution = gameState.setPiece.executionTime - Date.now();\n\n            if (timeUntilExecution <= 100 && !gameState.setPiece.executed) {\n                if (SetPieceIntegration?.executeSetPiece_Router) {\n                    SetPieceIntegration.executeSetPiece_Router(gameState);\n                }\n            }\n        }\n    }\n\n    if (gameState.status === 'PENALTY' && penaltySystem.state) {\n        penaltySystem.update(gameState);\n    }\n\n    if (runPhysics) {\n        if (gameState.status === 'playing') {\n            gameTime += dt;\n            processPendingEvents(gameTime);\n        }\n\n        const scaledTimestep = getScaledTimestep();\n\n        physicsAccumulator += dt;\n        let steps = 0;\n        const maxSteps = 5;\n        while (physicsAccumulator >= scaledTimestep && steps < maxSteps) {\n            updatePhysics(scaledTimestep);\n            physicsAccumulator -= scaledTimestep;\n            steps++;\n        }\n        if (steps >= maxSteps) {\n            physicsAccumulator = 0;\n        }\n\n        cleanupShotState(gameState);\n        updateDefensiveLines(gameState);\n        updateParticlesWithCleanup(gameState);\n    }\n\n    // Possession tracking\n    const holder = validateBallHolder(gameState.ballHolder);\n    if (holder) {\n        if (holder.isHome) {\n            gameState.stats.home.possessionTime += dt;\n        } else {\n            gameState.stats.away.possessionTime += dt;\n        }\n    }\n    const totalPossession = gameState.stats.home.possessionTime + gameState.stats.away.possessionTime;\n    if (totalPossession > 0) {\n        gameState.stats.home.possession = Math.round((gameState.stats.home.possessionTime / totalPossession) * 100);\n        gameState.stats.away.possession = 100 - gameState.stats.home.possession;\n    }\n\n    renderGame();\n\n    if (gameState.status !== 'finished') {\n        requestAnimationFrame(gameLoop_V2);\n    }\n}\n\n", "/**\r\n * Set Piece Configuration System - TypeScript Migration\r\n *\r\n * Handles tactical routine selection and configuration for set pieces:\r\n * - Corner kick routines (standard, inswinger, outswinger, short)\r\n * - Defensive systems (zonal, man marking)\r\n * - Goal kick strategies (short/long)\r\n * - Execution timing based on danger level\r\n *\r\n * @module setpieces/config\r\n * @migrated-from js/setpieces/setPieceConfig.js\r\n */\r\n\r\nimport type { GameState } from '../types';\r\nimport { getAttackingGoalX } from '../utils/ui';\r\nimport { SetPieceEnforcement } from './enforcement';\r\nimport { TACTICS, GAME_CONFIG } from '../config';\r\nimport { gameState as globalGameState } from '../globalExports';\r\n\r\n// ============================================================================\r\n// TYPE DEFINITIONS\r\n// ============================================================================\r\n\r\ntype CornerRoutine = 'standard' | 'inswinger' | 'outswinger' | 'short';\r\n\r\ninterface RoutineWeights {\r\n  standard: number;\r\n  inswinger: number;\r\n  outswinger: number;\r\n  short: number;\r\n}\r\n\r\n// ============================================================================\r\n// ROUTINE SELECTION\r\n// ============================================================================\r\n\r\n/**\r\n * Select routine based on weighted probabilities\r\n */\r\nfunction selectWeightedRoutine(weights: RoutineWeights): CornerRoutine {\r\n  const total = Object.values(weights).reduce((sum, w) => sum + w, 0);\r\n  if (total <= 0) return 'standard';\r\n\r\n  let random = Math.random() * total;\r\n\r\n  for (const [routine, weight] of Object.entries(weights)) {\r\n    random -= weight;\r\n    if (random <= 0) return routine as CornerRoutine;\r\n  }\r\n\r\n  return 'standard';\r\n}\r\n\r\n// ============================================================================\r\n// SET PIECE CONFIGURATION\r\n// ============================================================================\r\n\r\n/**\r\n * Intelligent routine selection based on team tactics\r\n */\r\nexport function configureSetPieceRoutines(gameState: GameState): void {\r\n  if (!gameState) {\r\n    console.error(\"Config SetPiece: gameState is missing!\");\r\n    return;\r\n  }\r\n\r\n  if (!gameState.setPiece) {\r\n    (gameState as any).setPiece = {};\r\n  }\r\n\r\n  // Get team and tactic information safely\r\n  const takingTeam = (gameState.setPiece as any).team; // true for home, false for away\r\n  const homeTacticKey = gameState.homeTactic || 'balanced';\r\n  const awayTacticKey = gameState.awayTactic || 'balanced';\r\n\r\n  const tactic = takingTeam === true ?\r\n    ((TACTICS as any)[homeTacticKey] || (TACTICS as any)['balanced']) :\r\n    ((TACTICS as any)[awayTacticKey] || (TACTICS as any)['balanced']);\r\n  const opposingTactic = takingTeam === true ?\r\n    ((TACTICS as any)[awayTacticKey] || (TACTICS as any)['balanced']) :\r\n    ((TACTICS as any)[homeTacticKey] || (TACTICS as any)['balanced']);\r\n\r\n  // Corner kick routine selection\r\n  if (gameState.status === 'CORNER_KICK') {\r\n    // Default weights\r\n    const routineWeights: RoutineWeights = {\r\n      standard: 40,\r\n      inswinger: 25,\r\n      outswinger: 25,\r\n      short: 10\r\n    };\r\n\r\n    if (tactic) {\r\n      // High possession tactics prefer short corners\r\n      if (tactic.possessionPriority > 0.7) {\r\n        routineWeights.short = 25;\r\n        routineWeights.standard = 30;\r\n      }\r\n    }\r\n\r\n    (gameState.setPiece as any).routine = selectWeightedRoutine(routineWeights);\r\n\r\n    // Defensive system\r\n    if (opposingTactic) {\r\n      // High defensive organization prefers zonal\r\n      (gameState.setPiece as any).defensiveSystem =\r\n        (opposingTactic.compactness > 0.65 || opposingTactic.defensiveLineDepth < 0.4)\r\n        ? 'zonal' : 'man_marking';\r\n    } else {\r\n      (gameState.setPiece as any).defensiveSystem = 'zonal';\r\n    }\r\n  }\r\n\r\n  // Goal kick strategy\r\n  if (gameState.status === 'GOAL_KICK') {\r\n    (gameState.setPiece as any).playShort = tactic && tactic.possessionPriority > 0.6;\r\n  }\r\n\r\n  // Set execution time based on set piece type and danger level\r\n  if (!(gameState.setPiece as any).executionTime || (gameState.setPiece as any).executionTime < Date.now()) {\r\n    let delay = 1000 + Math.random() * 800; // Default: 1.0-1.8 seconds\r\n\r\n    // Dangerous free kicks need longer positioning time (professional realism)\r\n    if (gameState.status === 'FREE_KICK' && gameState.setPiece && gameState.setPiece.position) {\r\n      const fkPos = gameState.setPiece.position;\r\n      const takingTeamIsHome = (typeof (gameState.setPiece as any).team === 'boolean')\r\n        ? (gameState.setPiece as any).team\r\n        : ((gameState.setPiece as any).team === 'home');\r\n\r\n      // Calculate goal position and distance\r\n      const opponentGoalX = getAttackingGoalX(takingTeamIsHome, gameState.currentHalf);\r\n\r\n      const distToGoal = Math.hypot(fkPos.x - opponentGoalX, fkPos.y - 300);\r\n      const angleToGoal = Math.abs(fkPos.y - 300);\r\n\r\n      // Dangerous free kick: close to goal (<280px) and good angle (<130px)\r\n      const isDangerous = distToGoal < 280 && angleToGoal < 130;\r\n\r\n      if (isDangerous) {\r\n        // Dangerous: 2.5-3.5 seconds for wall/positioning setup\r\n        delay = 2500 + Math.random() * 1000;\r\n      } else {\r\n        // Non-dangerous: 0.5-1.0 seconds (quick play)\r\n        delay = 500 + Math.random() * 500;\r\n      }\r\n    }\r\n\r\n    (gameState.setPiece as any).executionTime = Date.now() + delay;\r\n  }\r\n\r\n  (gameState.setPiece as any).configured = true;\r\n}\r\n\r\n// ============================================================================\r\n// PRE-CONFIGURATION\r\n// ============================================================================\r\n\r\n/**\r\n * Pre-configuration hook (Called before positioning players)\r\n * This simply ensures ball placement and execution time - positioning is handled by SetPieceBehaviorSystem\r\n */\r\nexport function executeSetPiece_PreConfiguration(): void {\r\n  try {\r\n    const gameState = globalGameState as GameState;\r\n    const sp = gameState?.setPiece;\r\n    if (!sp || !(sp as any).type || !sp.position) return;\r\n\r\n    // Ensure ball is placed correctly (inline logic to avoid circular dependency)\r\n    const W = GAME_CONFIG.PITCH_WIDTH;\r\n    const H = GAME_CONFIG.PITCH_HEIGHT;\r\n    const M = 6;\r\n    sp.position.x = Math.min(W - M, Math.max(M, Number(sp.position.x) || W / 2));\r\n    sp.position.y = Math.min(H - M, Math.max(M, Number(sp.position.y) || H / 2));\r\n    gameState.ballPosition = { x: sp.position.x, y: sp.position.y };\r\n    gameState.ballVelocity = { x: 0, y: 0 };\r\n\r\n    // Configure tactical routines if needed (for corner kicks, free kicks)\r\n    if ((sp as any).type === 'CORNER_KICK' || (sp as any).type === 'FREE_KICK' || (sp as any).type === 'GOAL_KICK') {\r\n      configureSetPieceRoutines(gameState);\r\n    }\r\n\r\n    // Ensure execution time is set\r\n    if (!(sp as any).executionTime || (sp as any).executionTime < Date.now()) {\r\n      (sp as any).executionTime = Date.now() + 1000 + Math.random() * 800;\r\n    }\r\n\r\n    // Initialize enforcement system state machine\r\n    if (SetPieceEnforcement.initializeSetPieceState) {\r\n      SetPieceEnforcement.initializeSetPieceState(gameState);\r\n    }\r\n\r\n    // Mark as configured - positioning will be handled by SetPieceBehaviorSystem\r\n    (sp as any).configured = true;\r\n\r\n    console.log(`\u2713 Set piece pre-configured: ${(sp as any).type} at (${Math.round(sp.position.x)}, ${Math.round(sp.position.y)})`);\r\n\r\n  } catch (e) {\r\n    console.error('executeSetPiece_PreConfiguration failed:', e);\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// BROWSER EXPORTS\r\n// ============================================================================\r\n// Functions are now exported via ES6 modules - no window exports needed\r\n", "/**\r\n * UI Utility Functions\r\n * Helper functions for UI operations and calculations\r\n *\r\n * @migrated-from js/ui/utils.js\r\n * \u2705 Migrated from JavaScript with zero functional changes\r\n * \u2705 Full type safety with strict TypeScript\r\n */\r\n\r\nimport type { GameState, Player } from '../types';\r\nimport { GAME_CONFIG } from '../config';\r\nimport { gameState } from '../globalExports';\r\n\r\n// ============================================================================\r\n// CONFIG HELPERS\r\n// ============================================================================\r\n\r\nexport function CFG(): any {\r\n    return GAME_CONFIG;\r\n}\r\n\r\nexport function ensureStatsShape(gs: GameState): void {\r\n  gs.stats = gs.stats || {} as any;\r\n  const s = gs.stats;\r\n  s.home = s.home || {} as any;\r\n  s.away = s.away || {} as any;\r\n  if (typeof s.home.possession !== 'number') s.home.possession = 0;\r\n  if (typeof s.away.possession !== 'number') s.away.possession = 0;\r\n\r\n  s.possessionTimer = s.possessionTimer || { home: 0, away: 0 };\r\n  if (typeof s.lastPossessionUpdate !== 'number') s.lastPossessionUpdate = Date.now();\r\n\r\n  // keep legacy mirror in sync\r\n  (s as any).possession = (s as any).possession || { home: 0, away: 0 };\r\n  (s as any).possession.home = s.home.possession;\r\n  (s as any).possession.away = s.away.possession;\r\n}\r\n\r\nexport function setPossession(gs: GameState, homePct: number, awayPct: number): void {\r\n  const s = gs.stats;\r\n  s.home.possession = Math.max(0, Math.min(100, homePct));\r\n  s.away.possession = Math.max(0, Math.min(100, awayPct));\r\n  // update legacy mirror\r\n  (s as any).possession.home = s.home.possession;\r\n  (s as any).possession.away = s.away.possession;\r\n}\r\n\r\n// ============================================================================\r\n// SET PIECE HELPERS\r\n// ============================================================================\r\n\r\nexport const SET_PIECE_STATUSES = Object.freeze([\r\n    'GOAL_KICK',\r\n    'CORNER_KICK',\r\n    'THROW_IN',\r\n    'FREE_KICK',\r\n    'PENALTY',\r\n    'KICK_OFF'\r\n]);\r\n\r\nexport function isSetPieceStatus(status: string | undefined | null): boolean {\r\n    if (!status) return false;\r\n    return SET_PIECE_STATUSES.includes(status);\r\n}\r\n\r\n// ============================================================================\r\n// GEOMETRY AND CALCULATION HELPERS\r\n// ============================================================================\r\n\r\nexport function getDistance(a: any, b: any): number {\r\n  const ax = Number(a?.x) || 0, ay = Number(a?.y) || 0;\r\n  const bx = Number(b?.x) || 0, by = Number(b?.y) || 0;\r\n  return Math.hypot(ax - bx, ay - by);\r\n}\r\n\r\nexport function getAttackingGoalX(isHome: boolean, currentHalf: number): number {\r\n    // 1. Varsay\u0131lan (fallback) de\u011Ferleri tan\u0131mla\r\n    const GOAL_X_LEFT_DEFAULT = 50;\r\n    const GOAL_X_RIGHT_DEFAULT = 750;\r\n\r\n    // 2. Global GAME_CONFIG'i g\u00FCvenle kontrol et\r\n    const activeConfig = GAME_CONFIG;\r\n\r\n    // 3. De\u011Ferleri belirle (Global config varsa onu kullan, yoksa varsay\u0131lan\u0131 kullan)\r\n    const goalLeft = (activeConfig && activeConfig.GOAL_X_LEFT) ? activeConfig.GOAL_X_LEFT : GOAL_X_LEFT_DEFAULT;\r\n    const goalRight = (activeConfig && activeConfig.GOAL_X_RIGHT) ? activeConfig.GOAL_X_RIGHT : GOAL_X_RIGHT_DEFAULT;\r\n\r\n    // 4. D\u00FCzeltilmi\u015F de\u011Ferleri kullanarak mant\u0131\u011F\u0131 \u00E7al\u0131\u015Ft\u0131r\r\n    if (currentHalf === 1) {\r\n        return isHome ? goalRight : goalLeft; // \u00F6rn: 750 : 50\r\n    } else {\r\n        return isHome ? goalLeft : goalRight; // \u00F6rn: 50 : 750\r\n    }\r\n}\r\n\r\nexport function getNearestAttacker(x: number, y: number, allPlayers: Player[], attackingTeamIsHome: boolean): Player | null {\r\n    const attackers = allPlayers.filter(p =>\r\n        p.isHome === attackingTeamIsHome &&\r\n        p.role !== 'GK'\r\n    );\r\n\r\n    let nearest: Player | null = null;\r\n    let minDist = Infinity;\r\n\r\n    attackers.forEach(player => {\r\n        const dist = Math.sqrt((player.x - x) ** 2 + (player.y - y) ** 2);\r\n        if (dist < minDist) {\r\n            minDist = dist;\r\n            nearest = player;\r\n        }\r\n    });\r\n\r\n    return nearest;\r\n}\r\n\r\nexport function calculateXG(shooter: Player, goalX: number, goalY: number, opponents: Player[]): number {\r\n    const distToGoal = Math.sqrt(Math.pow(shooter.x - goalX, 2) + Math.pow(shooter.y - goalY, 2));\r\n    const angleToGoalCenter = Math.abs(shooter.y - 300);\r\n\r\n    const maxAngle = 150;\r\n    const angleQuality = Math.max(0, 1 - (angleToGoalCenter / maxAngle));\r\n\r\n    const normalizedDistance = Math.min(distToGoal / 400, 1);\r\n    const distanceQuality = Math.pow(1 - normalizedDistance, 1.5);\r\n\r\n    const nearbyDefenders = opponents.filter(opp => getDistance(shooter, opp) < 30);\r\n    const pressureMultiplier = Math.max(0.4, 1 - (nearbyDefenders.length * 0.18));\r\n\r\n    const shooterAbility = 0.2 + (shooter.shooting / 100) * 0.8;\r\n\r\n    const speed = Math.sqrt(shooter.vx * shooter.vx + shooter.vy * shooter.vy);\r\n    const movementPenalty = speed > 100 ? 0.9 : 1.0;\r\n\r\n    const fatiguePenalty = (shooter as any).stamina < 40 ? 0.95 : 1.0;\r\n\r\n    let xG = (distanceQuality * 0.35 + angleQuality * 0.30 + shooterAbility * 0.35) * pressureMultiplier * movementPenalty * fatiguePenalty;\r\n\r\n    xG = Math.max(0.03, Math.min(0.92, xG));\r\n\r\n    return xG;\r\n}\r\n\r\nexport function pointToLineDistance(point: { x: number; y: number }, lineStart: { x: number; y: number }, lineEnd: { x: number; y: number }): number {\r\n    const A = point.x - lineStart.x;\r\n    const B = point.y - lineStart.y;\r\n    const C = lineEnd.x - lineStart.x;\r\n    const D = lineEnd.y - lineStart.y;\r\n\r\n    const dot = A * C + B * D;\r\n    const lenSq = C * C + D * D;\r\n    let param = -1;\r\n\r\n    if (lenSq !== 0) param = dot / lenSq;\r\n\r\n    let xx, yy;\r\n\r\n    if (param < 0) {\r\n        xx = lineStart.x;\r\n        yy = lineStart.y;\r\n    } else if (param > 1) {\r\n        xx = lineEnd.x;\r\n        yy = lineEnd.y;\r\n    } else {\r\n        xx = lineStart.x + param * C;\r\n        yy = lineStart.y + param * D;\r\n    }\r\n\r\n    const dx = point.x - xx;\r\n    const dy = point.y - yy;\r\n    return Math.sqrt(dx * dx + dy * dy);\r\n}\r\n\r\nexport function getValidStat(statValue: any, defaultValue: number = 0): number {\r\n    const num = parseFloat(statValue);\r\n    return isNaN(num) ? defaultValue : num;\r\n}\r\n\r\n// ============================================================================\r\n// TEAM SIDE HELPERS\r\n// ============================================================================\r\n\r\nexport function resolveSide(value: any): 'home' | 'away' | null {\r\n  try {\r\n    if (value === true || value === 'home') return 'home';\r\n    if (value === false || value === 'away') return 'away';\r\n\r\n    if (typeof value === 'string') {\r\n      if (value === (gameState?.homeTeam || '').trim()) return 'home';\r\n      if (value === (gameState?.awayTeam || '').trim()) return 'away';\r\n    }\r\n\r\n    if (value && typeof value === 'object') {\r\n      if ('isHome' in value) return value.isHome ? 'home' : 'away';\r\n      // Prevent infinite recursion by checking if value.team/side is different from value\r\n      if ('team' in value && value.team !== value) return resolveSide(value.team);\r\n      if ('side' in value && value.side !== value) return resolveSide(value.side);\r\n    }\r\n  } catch (error) {\r\n    console.error('[resolveSide] Error resolving side:', error, 'Input value:', value);\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nexport function invertSide(side: 'home' | 'away' | string): 'home' | 'away' | null {\r\n  if (side === 'home') return 'away';\r\n  if (side === 'away') return 'home';\r\n  return null;\r\n}\r\n\r\n// ============================================================================\r\n// BROWSER EXPORTS\r\n// ============================================================================\r\n\r\n// Functions are now exported via ES6 modules - no window exports needed\r\n", "/**\r\n * UI Screens\r\n * Screen rendering functions for upload and setup screens\r\n *\r\n * @migrated-from js/ui/uiScreens.js\r\n * \u2705 Migrated from JavaScript with zero functional changes\r\n * \u2705 Full type safety with strict TypeScript\r\n */\r\n\r\nimport { gameState } from '../globalExports';\r\nimport { TACTICS } from '../config';\r\nimport { selectBestFormation, selectBestTactic } from '../gameSetup';\r\n\r\n// ============================================================================\r\n// GLOBAL DECLARATIONS\r\n// ============================================================================\r\n// Note: Window interface declarations moved to globalExports.ts for centralization\r\n\r\n// ============================================================================\r\n// UPLOAD SCREEN\r\n// ============================================================================\r\n\r\nexport function renderUploadScreen(app: HTMLElement): void {\r\n    app.innerHTML = `\r\n        <div style=\"\r\n            min-height: 100vh;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            padding: 40px 20px;\r\n        \">\r\n            <div style=\"\r\n                background: linear-gradient(135deg, rgba(15, 15, 30, 0.95) 0%, rgba(25, 25, 45, 0.95) 100%);\r\n                backdrop-filter: blur(30px);\r\n                border-radius: 32px;\r\n                padding: 60px 50px;\r\n                max-width: 500px;\r\n                width: 100%;\r\n                box-shadow:\r\n                    0 30px 90px rgba(0, 0, 0, 0.6),\r\n                    0 0 0 1px rgba(255, 255, 255, 0.15),\r\n                    inset 0 1px 0 rgba(255, 255, 255, 0.2);\r\n                border: 1px solid rgba(255, 255, 255, 0.15);\r\n                text-align: center;\r\n            \">\r\n                <div style=\"\r\n                    font-size: 80px;\r\n                    margin-bottom: 24px;\r\n                    animation: bounce 2s infinite;\r\n                    filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.3));\r\n                \">\u26BD</div>\r\n\r\n                <h1 style=\"\r\n                    font-size: 42px;\r\n                    margin: 0 0 12px;\r\n                    color: #fff;\r\n                    font-weight: 900;\r\n                    letter-spacing: -0.5px;\r\n                    text-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);\r\n                \">Football Match Simulator</h1>\r\n\r\n                <p style=\"\r\n                    color: rgba(255, 255, 255, 0.7);\r\n                    font-size: 17px;\r\n                    margin-bottom: 40px;\r\n                    font-weight: 500;\r\n                    letter-spacing: 0.3px;\r\n                \">Enhanced AI \u2022 Tactical Positioning \u2022 Smart Strategy</p>\r\n\r\n                <input type=\"file\" accept=\".xlsx,.xls\" id=\"fileInput\" onchange=\"handleFileUpload(event)\" style=\"display: none;\">\r\n\r\n                <label for=\"fileInput\" style=\"\r\n                    display: inline-block;\r\n                    padding: 18px 40px;\r\n                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n                    color: white;\r\n                    font-size: 17px;\r\n                    font-weight: 800;\r\n                    letter-spacing: 0.5px;\r\n                    border-radius: 14px;\r\n                    cursor: pointer;\r\n                    transition: all 0.3s ease;\r\n                    box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);\r\n                    border: none;\r\n                    text-transform: uppercase;\r\n                \">\r\n                    \uD83D\uDCC1 Upload Excel File\r\n                </label>\r\n\r\n                <div style=\"\r\n                    margin-top: 40px;\r\n                    text-align: left;\r\n                    color: rgba(255, 255, 255, 0.7);\r\n                    font-size: 15px;\r\n                \">\r\n                    <p style=\"\r\n                        font-weight: 700;\r\n                        margin-bottom: 16px;\r\n                        font-size: 16px;\r\n                        color: rgba(255, 255, 255, 0.9);\r\n                    \">\u26BD Enhanced Features:</p>\r\n                    <ul style=\"list-style: none; padding: 0; margin: 0;\">\r\n                        <li style=\"padding: 8px 0; display: flex; align-items: center; gap: 10px;\">\r\n                            <span style=\"color: #00ff88;\">\u2705</span>\r\n                            <span>6 Dynamic formations</span>\r\n                        </li>\r\n                        <li style=\"padding: 8px 0; display: flex; align-items: center; gap: 10px;\">\r\n                            <span style=\"color: #00ff88;\">\u2705</span>\r\n                            <span>Delta time physics</span>\r\n                        </li>\r\n                        <li style=\"padding: 8px 0; display: flex; align-items: center; gap: 10px;\">\r\n                            <span style=\"color: #00ff88;\">\u2705</span>\r\n                            <span>Layered canvas rendering</span>\r\n                        </li>\r\n                        <li style=\"padding: 8px 0; display: flex; align-items: center; gap: 10px;\">\r\n                            <span style=\"color: #00ff88;\">\u2705</span>\r\n                            <span>Event-driven architecture</span>\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n\r\n            <div id=\"toggle-container\" style=\"position: absolute; bottom: 20px; right: 20px; z-index: 100;\"></div>\r\n        </div>\r\n\r\n        <style>\r\n            @keyframes bounce {\r\n                0%, 100% { transform: translateY(0); }\r\n                50% { transform: translateY(-10px); }\r\n            }\r\n\r\n            label[for=\"fileInput\"]:hover {\r\n                transform: translateY(-2px);\r\n                box-shadow: 0 12px 32px rgba(102, 126, 234, 0.5);\r\n            }\r\n        </style>\r\n    `;\r\n}\r\n\r\n// ============================================================================\r\n// SETUP SCREEN\r\n// ============================================================================\r\n\r\nexport function renderSetupScreen(app: HTMLElement): void {\r\n    if (!gameState) {\r\n        console.error('\u274C gameState not initialized yet');\r\n        app.innerHTML = '<div style=\"padding: 40px; text-align: center;\">Loading...</div>';\r\n        return;\r\n    }\r\n\r\n    // Using imported gameState from globalExports\r\n\r\n    // Auto-select formations and tactics if not set\r\n    if (!(gameState as any).homeFormation && selectBestFormation) {\r\n        const homeTeamPlayers = gameState.players.filter(p => p.team === gameState.homeTeam);\r\n        (gameState as any).homeFormation = selectBestFormation(homeTeamPlayers);\r\n    }\r\n    if (!(gameState as any).awayFormation && selectBestFormation) {\r\n        const awayTeamPlayers = gameState.players.filter(p => p.team === gameState.awayTeam);\r\n        (gameState as any).awayFormation = selectBestFormation(awayTeamPlayers);\r\n    }\r\n\r\n    if (!(gameState as any).homeTactic && selectBestTactic) {\r\n        const homeTeamPlayers = gameState.players.filter(p => p.team === gameState.homeTeam);\r\n        (gameState as any).homeTactic = selectBestTactic(homeTeamPlayers);\r\n    }\r\n    if (!(gameState as any).awayTactic && selectBestTactic) {\r\n        const awayTeamPlayers = gameState.players.filter(p => p.team === gameState.awayTeam);\r\n        (gameState as any).awayTactic = selectBestTactic(awayTeamPlayers);\r\n    }\r\n\r\n    // Using imported TACTICS from config\r\n    const tacticsOptions = Object.keys(TACTICS).map(key =>\r\n        `<option value=\"${key}\" ${key === (gameState as any).homeTactic ? 'selected' : ''}>${TACTICS[key as keyof typeof TACTICS]?.name || key}</option>`\r\n    ).join('');\r\n\r\n    const awayTacticsOptions = Object.keys(TACTICS).map(key =>\r\n        `<option value=\"${key}\" ${key === (gameState as any).awayTactic ? 'selected' : ''}>${TACTICS[key as keyof typeof TACTICS]?.name || key}</option>`\r\n    ).join('');\r\n\r\n    const teamsOptions = (gameState as any).teams ? (gameState as any).teams.map((t: string) =>\r\n        `<option value=\"${t}\" ${t === gameState.homeTeam ? 'selected' : ''}>${t}</option>`\r\n    ).join('') : '';\r\n\r\n    const awayTeamsOptions = (gameState as any).teams ? (gameState as any).teams.map((t: string) =>\r\n        `<option value=\"${t}\" ${t === gameState.awayTeam ? 'selected' : ''}>${t}</option>`\r\n    ).join('') : '';\r\n\r\n    const batchHomeTeamsOptions = (gameState as any).teams ? (gameState as any).teams.map((t: string) =>\r\n        `<option value=\"${t}\">${t}</option>`\r\n    ).join('') : '';\r\n\r\n    const batchAwayTeamsOptions = (gameState as any).teams ? (gameState as any).teams.map((t: string) =>\r\n        `<option value=\"${t}\">${t}</option>`\r\n    ).join('') : '';\r\n\r\n    app.innerHTML = `\r\n        <div class=\"container\">\r\n            <h1 style=\"text-align: center; font-size: 42px; margin-bottom: 30px; text-shadow: 0 0 30px rgba(255,255,255,0.5);\">\u26BD Enhanced Match Setup</h1>\r\n\r\n            <div style=\"display: flex; gap: 20px; justify-content: center; margin-bottom: 40px;\">\r\n                <button class=\"mode-btn active\" id=\"singleModeBtn\" onclick=\"switchSimulationMode('single')\" style=\"padding: 15px 40px; border-radius: 15px; font-size: 1.1em; font-weight: 700; cursor: pointer; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; transition: all 0.3s;\">\r\n                    \uD83C\uDFAE Single Match\r\n                </button>\r\n                <button class=\"mode-btn\" id=\"batchModeBtn\" onclick=\"switchSimulationMode('batch')\" style=\"padding: 15px 40px; border-radius: 15px; font-size: 1.1em; font-weight: 700; cursor: pointer; background: rgba(255,255,255,0.1); color: white; border: 2px solid transparent; transition: all 0.3s;\">\r\n                    \uD83D\uDCCA Batch Simulation\r\n                </button>\r\n            </div>\r\n\r\n            <div id=\"toggle-container\" style=\"max-width: 1200px; margin: 20px auto 0; text-align: right; padding-right: 20px;\"></div>\r\n\r\n            <div id=\"singleMatchMode\" style=\"display: block;\">\r\n                <div style=\"max-width: 900px; margin: 0 auto; background: rgba(0,0,0,0.5); backdrop-filter: blur(20px); border-radius: 24px; padding: 40px; border: 1px solid rgba(255,255,255,0.1);\">\r\n                    <div style=\"margin-bottom: 30px; padding: 20px; background: rgba(16,185,129,0.1); border-radius: 16px; border: 1px solid rgba(16,185,129,0.3);\">\r\n                        <div style=\"font-size: 18px; font-weight: 600;\">\u2728 AI Auto-Selection Active</div>\r\n                        <div style=\"font-size: 14px; margin-top: 8px; opacity: 0.9;\">${(gameState as any).teams?.length || 0} teams \u2022 ${gameState.players.length} professional players</div>\r\n                    </div>\r\n\r\n                    <div class=\"grid grid-2\">\r\n                        <div>\r\n                            <label class=\"label\">\uD83C\uDFE0 Home Team</label>\r\n                            <select id=\"homeSelect\" class=\"select\">\r\n                                ${teamsOptions}\r\n                            </select>\r\n\r\n                            <label class=\"label\" style=\"margin-top: 20px;\">Tactic</label>\r\n                            <select id=\"homeTacticSelect\" class=\"select\">\r\n                                ${tacticsOptions}\r\n                            </select>\r\n                        </div>\r\n                        <div>\r\n                            <label class=\"label\">\u2708\uFE0F Away Team</label>\r\n                            <select id=\"awaySelect\" class=\"select\">\r\n                                ${awayTeamsOptions}\r\n                            </select>\r\n\r\n                            <label class=\"label\" style=\"margin-top: 20px;\">Tactic</label>\r\n                            <select id=\"awayTacticSelect\" class=\"select\">\r\n                                ${awayTacticsOptions}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <button onclick=\"startMatch()\" ${gameState.homeTeam === gameState.awayTeam ? 'disabled' : ''}\r\n                        class=\"btn\" style=\"width: 100%; margin-top: 30px; padding: 20px; font-size: 20px;\">\r\n                        ${gameState.homeTeam === gameState.awayTeam ? '\u26A0\uFE0F Select different teams' : '\u25B6\uFE0F START MATCH'}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <div id=\"batchMatchMode\" style=\"display: none;\">\r\n                <div style=\"max-width: 1200px; margin: 0 auto;\">\r\n                    <div style=\"background: rgba(0,0,0,0.5); backdrop-filter: blur(20px); border-radius: 24px; padding: 30px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 30px;\">\r\n                        <h3 style=\"margin-bottom: 20px; font-size: 20px;\">\u2795 Add Matches</h3>\r\n\r\n                        <div style=\"display: grid; grid-template-columns: 1fr 1fr auto; gap: 15px; align-items: end;\">\r\n                            <div>\r\n                                <label class=\"label\">Home Team</label>\r\n                                <select id=\"batchHomeSelect\" class=\"select\">\r\n                                    ${batchHomeTeamsOptions}\r\n                                </select>\r\n                            </div>\r\n                            <div>\r\n                                <label class=\"label\">Away Team</label>\r\n                                <select id=\"batchAwaySelect\" class=\"select\">\r\n                                    ${batchAwayTeamsOptions}\r\n                                </select>\r\n                            </div>\r\n                            <button onclick=\"addMatchToBatch()\" class=\"btn\" style=\"padding: 12px 30px; white-space: nowrap;\">\r\n                                \u2795 Add Match\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div style=\"background: rgba(0,0,0,0.5); backdrop-filter: blur(20px); border-radius: 24px; padding: 30px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 30px;\">\r\n                        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;\">\r\n                            <h3 style=\"font-size: 20px;\">\uD83D\uDCCB Match List</h3>\r\n                            <button onclick=\"CustomFixtureSimulator.clearAll()\" style=\"padding: 8px 20px; background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; border-radius: 8px; color: #ef4444; cursor: pointer; font-size: 14px; font-weight: 600;\">\r\n                                \uD83D\uDDD1\uFE0F Clear All\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div id=\"custom-match-list\">\r\n                            <div style=\"text-align: center; padding: 40px; opacity: 0.5;\">\r\n                                <div style=\"font-size: 48px; margin-bottom: 10px;\">\u26BD</div>\r\n                                <div>No matches added yet</div>\r\n                                <div style=\"font-size: 14px; margin-top: 5px;\">Add matches above to start</div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <button id=\"simulate-all-btn\" onclick=\"CustomFixtureSimulator.simulateAll()\" disabled class=\"btn\" style=\"width: 100%; padding: 20px; font-size: 20px; opacity: 0.5; background: linear-gradient(135deg, #f093fb, #f5576c);\">\r\n                        \uD83D\uDE80 SIMULATE ALL MATCHES\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n    `; // <-- The closing `};` should be here\r\n\r\n    setTimeout(() => {\r\n        // attachSetupEventListeners would be called here if needed\r\n    }, 0);\r\n}\r\n\r\n// ============================================================================\r\n// SIMULATION MODE SWITCHER\r\n// ============================================================================\r\n\r\nexport function switchSimulationMode(mode: 'single' | 'batch'): void {\r\n    const singleBtn = document.getElementById('singleModeBtn') as HTMLButtonElement | null;\r\n    const batchBtn = document.getElementById('batchModeBtn') as HTMLButtonElement | null;\r\n    const singleMode = document.getElementById('singleMatchMode') as HTMLDivElement | null;\r\n    const batchMode = document.getElementById('batchMatchMode') as HTMLDivElement | null;\r\n\r\n    if (!singleBtn || !batchBtn || !singleMode || !batchMode) return;\r\n\r\n    if (mode === 'single') {\r\n        singleBtn.classList.add('active');\r\n        batchBtn.classList.remove('active');\r\n        singleBtn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';\r\n        singleBtn.style.border = 'none';\r\n        batchBtn.style.background = 'rgba(255,255,255,0.1)';\r\n        batchBtn.style.border = '2px solid transparent';\r\n\r\n        singleMode.style.display = 'block';\r\n        batchMode.style.display = 'none';\r\n    } else {\r\n        batchBtn.classList.add('active');\r\n        singleBtn.classList.remove('active');\r\n        batchBtn.style.background = 'linear-gradient(135deg, #f093fb, #f5576c)';\r\n        batchBtn.style.border = 'none';\r\n        singleBtn.style.background = 'rgba(255,255,255,0.1)';\r\n        singleBtn.style.border = '2px solid transparent';\r\n\r\n        singleMode.style.display = 'none';\r\n        batchMode.style.display = 'block';\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// BATCH MATCH HELPER\r\n// ============================================================================\r\n\r\nexport function addMatchToBatch(): void {\r\n    const homeSelect = document.getElementById('batchHomeSelect') as HTMLSelectElement | null;\r\n    const awaySelect = document.getElementById('batchAwaySelect') as HTMLSelectElement | null;\r\n\r\n    if (!homeSelect || !awaySelect) return;\r\n\r\n    // Team values would be used by CustomFixtureSimulator if available\r\n    // const homeTeam = homeSelect.value;\r\n    // const awayTeam = awaySelect.value;\r\n\r\n    // CustomFixtureSimulator not used in ES6 module context\r\n}\r\n\r\n// ============================================================================\r\n// BROWSER EXPORTS\r\n// ============================================================================\r\n\r\n// Functions are now exported via ES6 modules - no window exports needed\r\n", "/**\r\n * UI Components\r\n * Component library for rendering scoreboard, commentary, stats, and match summary\r\n *\r\n * @migrated-from js/ui/uiComponents.js\r\n * \u2705 Migrated from JavaScript with zero functional changes\r\n * \u2705 Full type safety with strict TypeScript\r\n */\r\n\r\nimport { gameState } from '../globalExports';\r\n\r\n// ============================================================================\r\n// GLOBAL DECLARATIONS\r\n// ============================================================================\r\n// Note: resetMatch moved to globalExports.ts for centralization\r\n\r\ndeclare global {\r\n  interface Window {\r\n    renderStatisticsSummary?: typeof renderStatisticsSummary;\r\n    lightenColor?: (color: string, amount: number) => string;\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// HELPER FUNCTIONS\r\n// ============================================================================\r\n\r\nfunction lightenColor(color: string, amount: number): string {\r\n    // Simple color lightening - parse hex and add to RGB values\r\n    if (color.startsWith('#')) {\r\n        const num = parseInt(color.slice(1), 16);\r\n        const r = Math.min(255, ((num >> 16) & 0xff) + amount);\r\n        const g = Math.min(255, ((num >> 8) & 0xff) + amount);\r\n        const b = Math.min(255, (num & 0xff) + amount);\r\n        return `#${((r << 16) | (g << 8) | b).toString(16).padStart(6, '0')}`;\r\n    }\r\n    return color;\r\n}\r\n\r\n// ============================================================================\r\n// SCOREBOARD\r\n// ============================================================================\r\n\r\nexport function renderScoreboard(): string {\r\n    // Using imported gameState from globalExports\r\n    const homeCoach = (gameState as any).teamCoaches?.[gameState.homeTeam] || 'Unknown Coach';\r\n    const awayCoach = (gameState as any).teamCoaches?.[gameState.awayTeam] || 'Unknown Coach';\r\n    const homeLogo = (gameState as any).teamLogos?.[gameState.homeTeam] || '';\r\n    const awayLogo = (gameState as any).teamLogos?.[gameState.awayTeam] || '';\r\n\r\n    return `\r\n        <div style=\"\r\n            background: linear-gradient(135deg, rgba(15, 15, 30, 0.98) 0%, rgba(25, 25, 45, 0.98) 100%);\r\n            backdrop-filter: blur(30px) saturate(200%);\r\n            border-radius: 16px;\r\n            padding: 12px 24px; /* RECHAZADO: Reduced padding */\r\n            box-shadow:\r\n                0 15px 40px rgba(0, 0, 0, 0.5),\r\n                0 0 0 1px rgba(255, 255, 255, 0.1),\r\n                inset 0 1px 0 rgba(255, 255, 255, 0.15);\r\n            border: 1px solid rgba(255, 255, 255, 0.1);\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: space-between;\r\n            gap: 20px; /* RECHAZADO: Reduced gap */\r\n            position: relative;\r\n            overflow: hidden;\r\n            width: 100%;\r\n            box-sizing: border-box;\r\n            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\r\n        \">\r\n\r\n            <div style=\"position: absolute; top: 0; left: 0; right: 0; height: 60%; background: linear-gradient(180deg, rgba(255,255,255,0.05) 0%, transparent 100%); pointer-events: none;\"></div>\r\n            <div style=\"position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%); animation: rotate 20s linear infinite; pointer-events: none;\"></div>\r\n\r\n            <div style=\"display: flex; align-items: center; gap: 16px; flex: 1; min-width: 0; position: relative; z-index: 1;\">\r\n                ${homeLogo ? `\r\n                    <div style=\"width: 48px; height: 48px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; display: flex; align-items: center; justify-content: center; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); flex-shrink: 0;\">\r\n                        <img src=\"${homeLogo}\" style=\"width: 36px; height: 36px; object-fit: contain; filter: drop-shadow(0 2px 8px rgba(0,0,0,0.5));\">\r\n                    </div>\r\n                ` : ''}\r\n                <div style=\"display: flex; flex-direction: column; min-width: 0;\">\r\n                    <div style=\"font-size: 18px; font-weight: 900; color: #ffffff; text-transform: uppercase; letter-spacing: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);\">${gameState.homeTeam}</div>\r\n                    <div style=\"font-size: 10px; opacity: 0.6; font-weight: 600; letter-spacing: 0.5px; margin-top: 2px;\">${homeCoach}</div>\r\n                </div>\r\n            </div>\r\n\r\n            <div style=\"\r\n                display: flex;\r\n                align-items: center;\r\n                gap: 16px; /* RECHAZADO: Reduced gap */\r\n                position: relative;\r\n                z-index: 1;\r\n                padding: 8px 16px; /* RECHAZADO: Reduced padding */\r\n                background: rgba(0, 0, 0, 0.3);\r\n                border-radius: 12px; /* RECHAZADO: Reduced radius */\r\n                border: 1px solid rgba(255, 255, 255, 0.08);\r\n                box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);\r\n            \">\r\n                <div style=\"\r\n                    font-size: 44px; /* RECHAZADO: Reduced font size */\r\n                    font-weight: 900;\r\n                    line-height: 1;\r\n                    color: ${(gameState as any).homeJerseyColor};\r\n                    text-shadow: 0 0 20px ${(gameState as any).homeJerseyColor}60, 0 0 10px ${(gameState as any).homeJerseyColor}80, 0 4px 12px rgba(0,0,0,0.7);\r\n                    font-family: 'Inter', -apple-system, system-ui, sans-serif;\r\n                    filter: brightness(1.2);\r\n                    transition: all 0.3s ease;\r\n                \" id=\"home-score-color\">0</div>\r\n\r\n                <div style=\"display: flex; flex-direction: column; align-items: center; gap: 6px; padding: 0 12px;\">\r\n                    <div style=\"font-size: 24px; font-weight: 900; font-family: 'Courier New', monospace; line-height: 1; color: #ffffff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.5), 0 2px 6px rgba(0,0,0,0.4); letter-spacing: 1px;\" id=\"time-display\">0'</div>\r\n                    <div style=\"display: flex; align-items: center; gap: 8px;\">\r\n                        <div id=\"status-indicator\"></div>\r\n                        <div style=\"font-size: 10px; opacity: 0.7; font-weight: 800; letter-spacing: 1px; color: #ffffff;\" id=\"half-display\">HALF 1</div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div style=\"\r\n                    font-size: 44px; /* RECHAZADO: Reduced font size */\r\n                    font-weight: 900;\r\n                    line-height: 1;\r\n                    color: ${(gameState as any).awayJerseyColor};\r\n                    text-shadow: 0 0 20px ${(gameState as any).awayJerseyColor}60, 0 0 10px ${(gameState as any).awayJerseyColor}80, 0 4px 12px rgba(0,0,0,0.7);\r\n                    font-family: 'Inter', -apple-system, system-ui, sans-serif;\r\n                    filter: brightness(1.2);\r\n                    transition: all 0.3s ease;\r\n                \" id=\"away-score-color\">0</div>\r\n            </div>\r\n\r\n            <div style=\"display: flex; align-items: center; gap: 16px; flex: 1; min-width: 0; justify-content: flex-end; position: relative; z-index: 1;\">\r\n                <div style=\"display: flex; flex-direction: column; align-items: flex-end; min-width: 0;\">\r\n                    <div style=\"font-size: 18px; font-weight: 900; color: #ffffff; text-transform: uppercase; letter-spacing: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);\">${gameState.awayTeam}</div>\r\n                    <div style=\"font-size: 10px; opacity: 0.6; font-weight: 600; letter-spacing: 0.5px; margin-top: 2px;\">${awayCoach}</div>\r\n                </div>\r\n                ${awayLogo ? `\r\n                    <div style=\"width: 48px; height: 48px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; display: flex; align-items: center; justify-content: center; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); flex-shrink: 0;\">\r\n                        <img src=\"${awayLogo}\" style=\"width: 36px; height: 36px; object-fit: contain; filter: drop-shadow(0 2px 8px rgba(0,0,0,0.5));\">\r\n                    </div>\r\n                ` : ''}\r\n            </div>\r\n        </div>\r\n\r\n        <style>\r\n            @keyframes rotate {\r\n                from { transform: rotate(0deg); }\r\n                to { transform: rotate(360deg); }\r\n            }\r\n        </style>\r\n    `;\r\n}\r\n\r\n// ============================================================================\r\n// STATUS INDICATOR\r\n// ============================================================================\r\n\r\nexport function getStatusIndicator(): string {\r\n    // Using imported gameState from globalExports\r\n\r\n    if (gameState.status === 'playing') {\r\n        return '<div style=\"width: 6px; height: 6px; border-radius: 50%; background: #10b981; box-shadow: 0 0 8px #10b981, 0 0 3px #10b981; animation: pulse 2s infinite;\"></div>';\r\n    } else if ((gameState as any).status === 'intro') {\r\n        return '<div style=\"width: 6px; height: 6px; border-radius: 50%; background: #fbbf24; box-shadow: 0 0 8px #fbbf24;\"></div>';\r\n    } else if (gameState.status === 'halftime') {\r\n        return '<div style=\"width: 6px; height: 6px; border-radius: 50%; background: #f59e0b; box-shadow: 0 0 8px #f59e0b;\"></div>';\r\n    } else if (gameState.status === 'finished') {\r\n        return '<div style=\"width: 6px; height: 6px; border-radius: 50%; background: #ef4444; box-shadow: 0 0 8px #ef4444;\"></div>';\r\n    }\r\n    return '';\r\n}\r\n\r\n// ============================================================================\r\n// COMMENTARY\r\n// ============================================================================\r\n\r\nexport function renderCommentary(): string {\r\n    // Using imported gameState from globalExports\r\n    const recentComments = gameState.commentary.slice(-2).reverse();\r\n    const commentaryHTML = recentComments.map(c => {\r\n        let accentColor = '#6366f1';\r\n        let emoji = '\u26BD';\r\n\r\n        if (c.type === 'goal') {\r\n            accentColor = '#00ff88';\r\n            emoji = '\u26BD';\r\n        } else if (c.type === 'save') {\r\n            accentColor = '#00d4ff';\r\n            emoji = '\uD83E\uDDE4';\r\n        } else if (c.type === 'attack') {\r\n            accentColor = '#ffd700';\r\n            emoji = '\u26A1';\r\n        }\r\n\r\n        return `\r\n            <div style=\"\r\n                padding: 12px 16px;\r\n                margin-bottom: 8px;\r\n                background: linear-gradient(135deg, rgba(0, 0, 0, 0.6) 0%, rgba(0, 0, 0, 0.4) 100%);\r\n                backdrop-filter: blur(20px);\r\n                border-radius: 12px;\r\n                border-left: 4px solid ${accentColor};\r\n                box-shadow:\r\n                    0 8px 24px rgba(0, 0, 0, 0.6),\r\n                    0 0 0 1px rgba(255, 255, 255, 0.1),\r\n                    inset 0 1px 0 rgba(255, 255, 255, 0.1);\r\n                font-size: 14px;\r\n                line-height: 1.5;\r\n                color: rgba(255, 255, 255, 0.95);\r\n                font-weight: 600;\r\n                overflow: hidden;\r\n                text-overflow: ellipsis;\r\n                white-space: nowrap;\r\n                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\r\n                position: relative;\r\n            \">\r\n                <span style=\"\r\n                    font-size: 16px;\r\n                    margin-right: 8px;\r\n                    filter: drop-shadow(0 0 4px ${accentColor});\r\n                \">${emoji}</span>\r\n                ${c.text}\r\n\r\n                <!-- Subtle glow effect -->\r\n                <div style=\"\r\n                    position: absolute;\r\n                    top: 0;\r\n                    left: 0;\r\n                    right: 0;\r\n                    height: 50%;\r\n                    background: linear-gradient(180deg, ${accentColor}15 0%, transparent 100%);\r\n                    pointer-events: none;\r\n                \"></div>\r\n            </div>\r\n        `;\r\n    }).join('');\r\n\r\n    return `\r\n        <div style=\"width: 100%;\">\r\n            <div id=\"commentary-content\" style=\"\r\n                display: flex;\r\n                flex-direction: column;\r\n                gap: 6px;\r\n            \">\r\n                ${commentaryHTML || ''}\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n// ============================================================================\r\n// STATS\r\n// ============================================================================\r\n\r\nexport function renderStats(): string {\r\n    if (!gameState) {\r\n        return '<div class=\"stats-card\"><p>Loading stats...</p></div>';\r\n    }\r\n\r\n    // Using imported gameState from globalExports\r\n\r\n    // Get stats or provide defaults\r\n    const homeStats = gameState.stats.home || { possession: 50, shotsOnTarget: 0, shotsOffTarget: 0, xGTotal: 0 } as any;\r\n    const awayStats = gameState.stats.away || { possession: 50, shotsOnTarget: 0, shotsOffTarget: 0, xGTotal: 0 } as any;\r\n\r\n    const homeShots = (homeStats.shotsOnTarget || 0) + (homeStats.shotsOffTarget || 0);\r\n    const awayShots = (awayStats.shotsOnTarget || 0) + (awayStats.shotsOffTarget || 0);\r\n\r\n    // Helper to create a single stat bar\r\n    const createStatBar = (label: string, homeVal: string | number, awayVal: string | number, homeWidth: number, awayWidth: number, homeColor: string, awayColor: string): string => `\r\n        <div style=\"\r\n            display: grid;\r\n            grid-template-columns: 1fr auto 1fr;\r\n            align-items: center;\r\n            gap: 10px;\r\n            width: 100%;\r\n            font-size: 13px;\r\n            font-weight: 700;\r\n        \">\r\n            <span style=\"color: white; text-align: left; font-weight: 800;\">${homeVal}</span>\r\n            <span style=\"opacity: 0.7; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;\">${label}</span>\r\n            <span style=\"color: white; text-align: right; font-weight: 800;\">${awayVal}</span>\r\n\r\n            <div style=\"grid-column: 1 / -1; display: flex; width: 100%; height: 8px; background: rgba(0,0,0,0.4); border-radius: 4px; overflow: hidden; box-shadow: inset 0 1px 3px rgba(0,0,0,0.5);\">\r\n                <div style=\"width: ${homeWidth}%; background: ${homeColor}; transition: width 0.3s ease;\"></div>\r\n                <div style=\"width: ${awayWidth}%; background: ${awayColor}; transition: width 0.3s ease;\"></div>\r\n            </div>\r\n        </div>\r\n    `;\r\n\r\n    // Calculate percentages for bars\r\n    const totalPossession = (homeStats.possession || 50) + (awayStats.possession || 50);\r\n    const homePossessionPercent = totalPossession > 0 ? (homeStats.possession / totalPossession) * 100 : 50;\r\n    const awayPossessionPercent = totalPossession > 0 ? (awayStats.possession / totalPossession) * 100 : 50;\r\n\r\n    const totalShots = homeShots + awayShots;\r\n    const homeShotsPercent = totalShots > 0 ? (homeShots / totalShots) * 100 : 50;\r\n    const awayShotsPercent = totalShots > 0 ? (awayShots / totalShots) * 100 : 50;\r\n\r\n    const totalXG = (homeStats.xGTotal || 0) + (awayStats.xGTotal || 0);\r\n    const homeXGPercent = totalXG > 0 ? ((homeStats.xGTotal || 0) / totalXG) * 100 : 50;\r\n    const awayXGPercent = totalXG > 0 ? ((awayStats.xGTotal || 0) / totalXG) * 100 : 50;\r\n\r\n    // Main horizontal stat bar\r\n    return `\r\n        <div style=\"\r\n            margin-top: 12px;\r\n            background: linear-gradient(135deg, rgba(15, 15, 30, 0.9) 0%, rgba(25, 25, 45, 0.9) 100%);\r\n            backdrop-filter: blur(20px);\r\n            border-radius: 16px;\r\n            padding: 16px 24px;\r\n            box-shadow:\r\n                0 15px 40px rgba(0, 0, 0, 0.5),\r\n                0 0 0 1px rgba(255, 255, 255, 0.1),\r\n                inset 0 1px 0 rgba(255, 255, 255, 0.1);\r\n            border: 1px solid rgba(255, 255, 255, 0.1);\r\n            position: relative;\r\n            overflow: hidden;\r\n            display: grid;\r\n            grid-template-columns: repeat(3, 1fr);\r\n            gap: 20px;\r\n            align-items: center;\r\n        \">\r\n            ${createStatBar(\r\n                'Possession',\r\n                `${homeStats.possession || 50}%`,\r\n                `${awayStats.possession || 50}%`,\r\n                homePossessionPercent,\r\n                awayPossessionPercent,\r\n                (gameState as any).homeJerseyColor,\r\n                (gameState as any).awayJerseyColor\r\n            )}\r\n\r\n            ${createStatBar(\r\n                'Shots',\r\n                homeShots,\r\n                awayShots,\r\n                homeShotsPercent,\r\n                awayShotsPercent,\r\n                (gameState as any).homeJerseyColor,\r\n                (gameState as any).awayJerseyColor\r\n            )}\r\n\r\n            ${createStatBar(\r\n                'xG',\r\n                (homeStats.xGTotal || 0).toFixed(2),\r\n                (awayStats.xGTotal || 0).toFixed(2),\r\n                homeXGPercent,\r\n                awayXGPercent,\r\n                (gameState as any).homeJerseyColor,\r\n                (gameState as any).awayJerseyColor\r\n            )}\r\n        </div>\r\n    `;\r\n}\r\n\r\n// ============================================================================\r\n// ENHANCED MATCH SUMMARY - SIDE BY SIDE LAYOUT WITH PREMIUM DESIGN\r\n// ============================================================================\r\n\r\nexport function renderMatchSummary(): string {\r\n    // Using imported gameState from globalExports\r\n    const homeLogo = (gameState as any).teamLogos?.[gameState.homeTeam] || '';\r\n    const awayLogo = (gameState as any).teamLogos?.[gameState.awayTeam] || '';\r\n\r\n    const winner = gameState.homeScore > gameState.awayScore ? gameState.homeTeam :\r\n                   gameState.awayScore > gameState.homeScore ? gameState.awayTeam : 'Draw';\r\n\r\n    const allEvents = [\r\n        ...gameState.goalEvents.map(e => ({ ...e, type: 'goal', team: (e as any).isHome ? 'home' : 'away' })),\r\n        ...gameState.cardEvents.map(e => ({ ...e, type: 'card', team: (e as any).isHome ? 'home' : 'away' }))\r\n    ];\r\n\r\n    allEvents.sort((a, b) => a.time - b.time);\r\n\r\n    // Group events by player\r\n    const groupEvents = (events: any[]) => {\r\n        const grouped: Record<string, any> = {};\r\n        events.forEach(e => {\r\n            const key = e.type === 'goal' ? e.scorer : e.player;\r\n            if (!grouped[key]) {\r\n                grouped[key] = { name: key, goals: [], cards: [] };\r\n            }\r\n            if (e.type === 'goal') {\r\n                grouped[key].goals.push(e.time);\r\n            } else {\r\n                grouped[key].cards.push({ time: e.time, card: e.card });\r\n            }\r\n        });\r\n        return Object.values(grouped);\r\n    };\r\n\r\n    const homeGroupedEvents = groupEvents(allEvents.filter(e => e.team === 'home'));\r\n    const awayGroupedEvents = groupEvents(allEvents.filter(e => e.team === 'away'));\r\n\r\n    // Generate events HTML with compact design\r\n    const generateEventsHTML = (groupedEvents: any[], isHome: boolean): string => {\r\n        if (groupedEvents.length === 0) {\r\n            return `\r\n                <div style=\"\r\n                    text-align: center;\r\n                    padding: 60px 20px;\r\n                    opacity: 0.4;\r\n                \">\r\n                    <div style=\"font-size: 48px; margin-bottom: 12px;\">\u26BD</div>\r\n                    <div style=\"font-size: 14px;\">No events</div>\r\n                </div>\r\n            `;\r\n        }\r\n\r\n        return groupedEvents.map(group => {\r\n            let content: string[] = [];\r\n\r\n            // Goals\r\n            if (group.goals.length > 0) {\r\n                content.push(`\r\n                    <div style=\"\r\n                        display: flex;\r\n                        align-items: center;\r\n                        justify-content: space-between;\r\n                        padding: 12px 16px;\r\n                        margin-bottom: 10px;\r\n                        background: linear-gradient(${isHome ? '90deg' : '270deg'}, rgba(0, 255, 136, 0.15) 0%, rgba(0, 255, 136, 0.03) 100%);\r\n                        border-${isHome ? 'left' : 'right'}: 3px solid #00ff88;\r\n                        border-radius: 10px;\r\n                        transition: all 0.3s ease;\r\n                    \">\r\n                        <div style=\"display: flex; align-items: center; gap: 12px; flex: 1;\">\r\n                            <span style=\"font-size: 20px; filter: drop-shadow(0 0 6px #00ff88);\">\u26BD</span>\r\n                            <span style=\"font-weight: 700; font-size: 14px;\">${group.name}</span>\r\n                        </div>\r\n                        <div style=\"\r\n                            display: flex;\r\n                            gap: 6px;\r\n                            font-size: 13px;\r\n                            font-weight: 600;\r\n                            color: #00ff88;\r\n                        \">\r\n                            ${group.goals.map((t: number) => `<span style=\"\r\n                                padding: 4px 8px;\r\n                                background: rgba(0, 255, 136, 0.2);\r\n                                border-radius: 6px;\r\n                                border: 1px solid rgba(0, 255, 136, 0.3);\r\n                            \">${t}'</span>`).join('')}\r\n                        </div>\r\n                    </div>\r\n                `);\r\n            }\r\n\r\n            // Cards\r\n            group.cards.forEach((cardEvent: any) => {\r\n                const cardSymbol = cardEvent.card === 'yellow' ? '\uD83D\uDFE8' : '\uD83D\uDFE5';\r\n                const cardColor = cardEvent.card === 'yellow' ? '#fde047' : '#ef4444';\r\n                content.push(`\r\n                    <div style=\"\r\n                        display: flex;\r\n                        align-items: center;\r\n                        justify-content: space-between;\r\n                        padding: 12px 16px;\r\n                        margin-bottom: 10px;\r\n                        background: linear-gradient(${isHome ? '90deg' : '270deg'}, ${cardColor}15 0%, ${cardColor}03 100%);\r\n                        border-${isHome ? 'left' : 'right'}: 3px solid ${cardColor};\r\n                        border-radius: 10px;\r\n                        transition: all 0.3s ease;\r\n                    \">\r\n                        <div style=\"display: flex; align-items: center; gap: 12px; flex: 1;\">\r\n                            <span style=\"font-size: 18px; filter: drop-shadow(0 0 6px ${cardColor});\">${cardSymbol}</span>\r\n                            <span style=\"font-weight: 700; font-size: 14px;\">${group.name}</span>\r\n                        </div>\r\n                        <span style=\"\r\n                            padding: 4px 8px;\r\n                            background: ${cardColor}20;\r\n                            border-radius: 6px;\r\n                            border: 1px solid ${cardColor}30;\r\n                            font-size: 13px;\r\n                            font-weight: 600;\r\n                            color: ${cardColor};\r\n                        \">${cardEvent.time}'</span>\r\n                    </div>\r\n                `);\r\n            });\r\n\r\n            return content.join('');\r\n        }).join('');\r\n    };\r\n\r\n    const homeEventsHTML = generateEventsHTML(homeGroupedEvents, true);\r\n    const awayEventsHTML = generateEventsHTML(awayGroupedEvents, false);\r\n\r\n    return `\r\n        <div style=\"\r\n            position: fixed;\r\n            top: 0;\r\n            left: 0;\r\n            width: 100%;\r\n            height: 100%;\r\n            background: rgba(0, 0, 0, 0.85);\r\n            backdrop-filter: blur(12px);\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            z-index: 1000;\r\n            animation: fadeIn 0.3s ease;\r\n            padding: 20px;\r\n            box-sizing: border-box;\r\n        \">\r\n            <div style=\"\r\n                background: linear-gradient(135deg, rgba(15, 15, 30, 0.98) 0%, rgba(25, 25, 45, 0.98) 100%);\r\n                border-radius: 24px;\r\n                padding: 40px;\r\n                box-shadow:\r\n                    0 40px 100px rgba(0,0,0,0.8),\r\n                    0 0 0 1px rgba(255,255,255,0.15),\r\n                    inset 0 1px 0 rgba(255,255,255,0.2);\r\n                max-width: 1100px;\r\n                width: 100%;\r\n                max-height: 90vh;\r\n                overflow-y: auto;\r\n                color: white;\r\n                position: relative;\r\n            \">\r\n\r\n                <!-- Header -->\r\n                <div style=\"text-align: center; margin-bottom: 32px;\">\r\n                    <div style=\"\r\n                        display: inline-block;\r\n                        padding: 8px 24px;\r\n                        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);\r\n                        border-radius: 20px;\r\n                        border: 1px solid rgba(255, 255, 255, 0.2);\r\n                        font-size: 14px;\r\n                        font-weight: 700;\r\n                        letter-spacing: 1px;\r\n                        margin-bottom: 16px;\r\n                        text-transform: uppercase;\r\n                    \">\u23F1\uFE0F Full Time</div>\r\n\r\n                    ${winner !== 'Draw' ? `\r\n                        <div style=\"\r\n                            font-size: 20px;\r\n                            font-weight: 700;\r\n                            color: #00ff88;\r\n                            text-shadow: 0 0 20px #00ff8860;\r\n                            margin-bottom: 24px;\r\n                            letter-spacing: 0.5px;\r\n                        \">\uD83C\uDFC6 ${winner} Wins!</div>\r\n                    ` : `\r\n                        <div style=\"\r\n                            font-size: 20px;\r\n                            font-weight: 700;\r\n                            color: #fbbf24;\r\n                            text-shadow: 0 0 20px #fbbf2460;\r\n                            margin-bottom: 24px;\r\n                            letter-spacing: 0.5px;\r\n                        \">\uD83E\uDD1D Match Drawn</div>\r\n                    `}\r\n                </div>\r\n\r\n                <!-- Score Display -->\r\n                <div style=\"\r\n                    display: flex;\r\n                    align-items: center;\r\n                    justify-content: center;\r\n                    gap: 40px;\r\n                    padding: 28px;\r\n                    background: rgba(0, 0, 0, 0.3);\r\n                    border-radius: 20px;\r\n                    margin-bottom: 32px;\r\n                    border: 1px solid rgba(255, 255, 255, 0.1);\r\n                    box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);\r\n                \">\r\n                    <!-- Home Team -->\r\n                    <div style=\"\r\n                        display: flex;\r\n                        align-items: center;\r\n                        gap: 16px;\r\n                        flex: 1;\r\n                        justify-content: flex-end;\r\n                    \">\r\n                        <div style=\"text-align: right;\">\r\n                            <div style=\"\r\n                                font-size: 22px;\r\n                                font-weight: 900;\r\n                                color: #ffffff;\r\n                                text-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);\r\n                                margin-bottom: 4px;\r\n                            \">${gameState.homeTeam}</div>\r\n                            <div style=\"\r\n                                font-size: 12px;\r\n                                opacity: 0.6;\r\n                                font-weight: 600;\r\n                            \">${(gameState as any).teamCoaches?.[gameState.homeTeam] || ''}</div>\r\n                        </div>\r\n                        ${homeLogo ? `\r\n                            <div style=\"\r\n                                width: 64px;\r\n                                height: 64px;\r\n                                background: rgba(255, 255, 255, 0.05);\r\n                                border-radius: 16px;\r\n                                display: flex;\r\n                                align-items: center;\r\n                                justify-content: center;\r\n                                border: 1px solid rgba(255, 255, 255, 0.1);\r\n                                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);\r\n                            \">\r\n                                <img src=\"${homeLogo}\" style=\"\r\n                                    width: 52px;\r\n                                    height: 52px;\r\n                                    object-fit: contain;\r\n                                    filter: drop-shadow(0 2px 8px rgba(0,0,0,0.5));\r\n                                \">\r\n                            </div>\r\n                        ` : ''}\r\n                    </div>\r\n\r\n                    <!-- Score -->\r\n                    <div style=\"\r\n                        display: flex;\r\n                        align-items: center;\r\n                        gap: 20px;\r\n                        padding: 0 24px;\r\n                    \">\r\n                        <div style=\"\r\n                            font-size: 56px;\r\n                            font-weight: 900;\r\n                            color: ${(gameState as any).homeJerseyColor};\r\n                            text-shadow: 0 0 30px ${(gameState as any).homeJerseyColor}60;\r\n                            filter: brightness(1.3);\r\n                        \">${gameState.homeScore}</div>\r\n                        <div style=\"\r\n                            font-size: 40px;\r\n                            font-weight: 300;\r\n                            opacity: 0.4;\r\n                        \">-</div>\r\n                        <div style=\"\r\n                            font-size: 56px;\r\n                            font-weight: 900;\r\n                            color: ${(gameState as any).awayJerseyColor};\r\n                            text-shadow: 0 0 30px ${(gameState as any).awayJerseyColor}60;\r\n                            filter: brightness(1.3);\r\n                        \">${gameState.awayScore}</div>\r\n                    </div>\r\n\r\n                    <!-- Away Team -->\r\n                    <div style=\"\r\n                        display: flex;\r\n                        align-items: center;\r\n                        gap: 16px;\r\n                        flex: 1;\r\n                    \">\r\n                        ${awayLogo ? `\r\n                            <div style=\"\r\n                                width: 64px;\r\n                                height: 64px;\r\n                                background: rgba(255, 255, 255, 0.05);\r\n                                border-radius: 16px;\r\n                                display: flex;\r\n                                align-items: center;\r\n                                justify-content: center;\r\n                                border: 1px solid rgba(255, 255, 255, 0.1);\r\n                                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);\r\n                            \">\r\n                                <img src=\"${awayLogo}\" style=\"\r\n                                    width: 52px;\r\n                                    height: 52px;\r\n                                    object-fit: contain;\r\n                                    filter: drop-shadow(0 2px 8px rgba(0,0,0,0.5));\r\n                                \">\r\n                            </div>\r\n                        ` : ''}\r\n                        <div>\r\n                            <div style=\"\r\n                                font-size: 22px;\r\n                                font-weight: 900;\r\n                                color: #ffffff;\r\n                                text-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);\r\n                                margin-bottom: 4px;\r\n                            \">${gameState.awayTeam}</div>\r\n                            <div style=\"\r\n                                font-size: 12px;\r\n                                opacity: 0.6;\r\n                                font-weight: 600;\r\n                            \">${(gameState as any).teamCoaches?.[gameState.awayTeam] || ''}</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <!-- Tabs -->\r\n                <div style=\"\r\n                    display: flex;\r\n                    gap: 12px;\r\n                    justify-content: center;\r\n                    margin-bottom: 28px;\r\n                    border-bottom: 1px solid rgba(255,255,255,0.1);\r\n                    padding-bottom: 0;\r\n                \">\r\n                    <button onclick=\"switchSummaryTab('events')\" id=\"events-tab\" style=\"\r\n                        padding: 12px 28px;\r\n                        border-radius: 12px 12px 0 0;\r\n                        font-weight: 700;\r\n                        font-size: 14px;\r\n                        cursor: pointer;\r\n                        background: linear-gradient(135deg, #667eea, #764ba2);\r\n                        color: white;\r\n                        border: none;\r\n                        transition: all 0.3s;\r\n                        letter-spacing: 0.5px;\r\n                        text-transform: uppercase;\r\n                        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);\r\n                    \">\r\n                        \uD83D\uDCCB Match Events\r\n                    </button>\r\n                    <button onclick=\"switchSummaryTab('stats')\" id=\"stats-tab\" style=\"\r\n                        padding: 12px 28px;\r\n                        border-radius: 12px 12px 0 0;\r\n                        font-weight: 700;\r\n                        font-size: 14px;\r\n                        cursor: pointer;\r\n                        background: rgba(255,255,255,0.05);\r\n                        color: rgba(255,255,255,0.7);\r\n                        border: 1px solid rgba(255,255,255,0.1);\r\n                        transition: all 0.3s;\r\n                        letter-spacing: 0.5px;\r\n                        text-transform: uppercase;\r\n                    \">\r\n                        \uD83D\uDCCA Statistics\r\n                    </button>\r\n                </div>\r\n\r\n                <!-- Events Content (Side by Side) -->\r\n                <div id=\"summary-events-content\" style=\"display: block;\">\r\n                    <div style=\"\r\n                        display: grid;\r\n                        grid-template-columns: 1fr 1fr;\r\n                        gap: 24px;\r\n                        margin-bottom: 28px;\r\n                    \">\r\n                        <!-- Home Events -->\r\n                        <div>\r\n                            <h3 style=\"\r\n                                margin: 0 0 20px 0;\r\n                                font-size: 16px;\r\n                                font-weight: 800;\r\n                                color: ${(gameState as any).homeJerseyColor};\r\n                                filter: brightness(1.3);\r\n                                text-transform: uppercase;\r\n                                letter-spacing: 1px;\r\n                                display: flex;\r\n                                align-items: center;\r\n                                gap: 8px;\r\n                            \">\r\n                                <span>\uD83D\uDCCB</span> ${gameState.homeTeam}\r\n                            </h3>\r\n                            <div style=\"\r\n                                max-height: 400px;\r\n                                overflow-y: auto;\r\n                                padding-right: 8px;\r\n                            \">\r\n                                ${homeEventsHTML}\r\n                            </div>\r\n                        </div>\r\n\r\n                        <!-- Away Events -->\r\n                        <div>\r\n                            <h3 style=\"\r\n                                margin: 0 0 20px 0;\r\n                                font-size: 16px;\r\n                                font-weight: 800;\r\n                                color: ${(gameState as any).awayJerseyColor};\r\n                                filter: brightness(1.3);\r\n                                text-transform: uppercase;\r\n                                letter-spacing: 1px;\r\n                                display: flex;\r\n                                align-items: center;\r\n                                gap: 8px;\r\n                            \">\r\n                                <span>\uD83D\uDCCB</span> ${gameState.awayTeam}\r\n                            </h3>\r\n                            <div style=\"\r\n                                max-height: 400px;\r\n                                overflow-y: auto;\r\n                                padding-right: 8px;\r\n                            \">\r\n                                ${awayEventsHTML}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <!-- Stats Content -->\r\n                <div id=\"summary-stats-content\" style=\"display: none;\">\r\n                    ${renderStatisticsSummary()}\r\n                </div>\r\n\r\n                <!-- Action Button -->\r\n                <button onclick=\"resetMatch()\" style=\"\r\n                    width: 100%;\r\n                    margin-top: 20px;\r\n                    padding: 18px;\r\n                    font-size: 18px;\r\n                    font-weight: 800;\r\n                    letter-spacing: 1px;\r\n                    text-transform: uppercase;\r\n                    background: linear-gradient(135deg, #f093fb, #f5576c);\r\n                    color: white;\r\n                    border: none;\r\n                    border-radius: 14px;\r\n                    cursor: pointer;\r\n                    transition: all 0.3s ease;\r\n                    box-shadow: 0 8px 24px rgba(240, 147, 251, 0.4);\r\n                \">\r\n                    \uD83D\uDD04 New Match\r\n                </button>\r\n            </div>\r\n        </div>\r\n\r\n        <style>\r\n            @keyframes fadeIn {\r\n                from {\r\n                    opacity: 0;\r\n                    transform: scale(0.95);\r\n                }\r\n                to {\r\n                    opacity: 1;\r\n                    transform: scale(1);\r\n                }\r\n            }\r\n\r\n            button:hover {\r\n                transform: translateY(-2px);\r\n                box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);\r\n            }\r\n\r\n            /* Custom Scrollbar */\r\n            #summary-events-content > div > div::-webkit-scrollbar,\r\n            #summary-stats-content::-webkit-scrollbar {\r\n                width: 6px;\r\n            }\r\n\r\n            #summary-events-content > div > div::-webkit-scrollbar-track,\r\n            #summary-stats-content::-webkit-scrollbar-track {\r\n                background: rgba(255, 255, 255, 0.05);\r\n                border-radius: 3px;\r\n            }\r\n\r\n            #summary-events-content > div > div::-webkit-scrollbar-thumb,\r\n            #summary-stats-content::-webkit-scrollbar-thumb {\r\n                background: rgba(255, 255, 255, 0.2);\r\n                border-radius: 3px;\r\n            }\r\n\r\n            #summary-events-content > div > div::-webkit-scrollbar-thumb:hover,\r\n            #summary-stats-content::-webkit-scrollbar-thumb:hover {\r\n                background: rgba(255, 255, 255, 0.3);\r\n            }\r\n        </style>\r\n    `;\r\n}\r\n\r\n// ============================================================================\r\n// ENHANCED STATISTICS SUMMARY - MODERN DUAL-COLUMN COMPARISON\r\n// ============================================================================\r\n\r\nexport function renderStatisticsSummary(): string {\r\n    // Using imported gameState from globalExports\r\n    const homeStats = gameState.stats.home || {} as any;\r\n    const awayStats = gameState.stats.away || {} as any;\r\n\r\n    const homePassAcc = homeStats.passesAttempted > 0\r\n        ? Math.round((homeStats.passesCompleted / homeStats.passesAttempted) * 100)\r\n        : 0;\r\n    const awayPassAcc = awayStats.passesAttempted > 0\r\n        ? Math.round((awayStats.passesCompleted / awayStats.passesAttempted) * 100)\r\n        : 0;\r\n\r\n    // Helper function for stat comparison bars\r\n    const renderStatBar = (label: string, homeVal: string | number, awayVal: string | number, icon: string): string => {\r\n        // Calculate percentages for the bar\r\n        const homeNum = parseFloat(String(homeVal)) || 0;\r\n        const awayNum = parseFloat(String(awayVal)) || 0;\r\n        const total = homeNum + awayNum;\r\n        const homePercent = total > 0 ? (homeNum / total) * 100 : 50;\r\n        const awayPercent = total > 0 ? (awayNum / total) * 100 : 50;\r\n\r\n        return `\r\n            <div style=\"\r\n                padding: 16px;\r\n                background: rgba(255, 255, 255, 0.02);\r\n                border-radius: 12px;\r\n                border: 1px solid rgba(255, 255, 255, 0.06);\r\n            \">\r\n                <!-- Label and Icon -->\r\n                <div style=\"\r\n                    display: flex;\r\n                    align-items: center;\r\n                    justify-content: center;\r\n                    gap: 8px;\r\n                    margin-bottom: 12px;\r\n                    font-size: 13px;\r\n                    font-weight: 700;\r\n                    opacity: 0.8;\r\n                    text-transform: uppercase;\r\n                    letter-spacing: 0.5px;\r\n                \">\r\n                    <span style=\"font-size: 16px;\">${icon}</span>\r\n                    <span>${label}</span>\r\n                </div>\r\n\r\n                <!-- Values -->\r\n                <div style=\"\r\n                    display: flex;\r\n                    justify-content: space-between;\r\n                    align-items: center;\r\n                    margin-bottom: 10px;\r\n                    font-size: 20px;\r\n                    font-weight: 900;\r\n                \">\r\n                    <span style=\"\r\n                        color: ${(gameState as any).homeJerseyColor};\r\n                        filter: brightness(1.3);\r\n                        text-shadow: 0 0 10px ${(gameState as any).homeJerseyColor}40;\r\n                    \">${homeVal}</span>\r\n                    <span style=\"\r\n                        color: ${(gameState as any).awayJerseyColor};\r\n                        filter: brightness(1.3);\r\n                        text-shadow: 0 0 10px ${(gameState as any).awayJerseyColor}40;\r\n                    \">${awayVal}</span>\r\n                </div>\r\n\r\n                <!-- Bar -->\r\n                <div style=\"\r\n                    display: flex;\r\n                    width: 100%;\r\n                    height: 8px;\r\n                    background: rgba(0, 0, 0, 0.4);\r\n                    border-radius: 4px;\r\n                    overflow: hidden;\r\n                    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);\r\n                \">\r\n                    <div style=\"\r\n                        width: ${homePercent}%;\r\n                        background: linear-gradient(90deg, ${(gameState as any).homeJerseyColor}, ${lightenColor((gameState as any).homeJerseyColor, 20)});\r\n                        transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);\r\n                        box-shadow: 0 0 8px ${(gameState as any).homeJerseyColor}60;\r\n                    \"></div>\r\n                    <div style=\"\r\n                        width: ${awayPercent}%;\r\n                        background: linear-gradient(270deg, ${(gameState as any).awayJerseyColor}, ${lightenColor((gameState as any).awayJerseyColor, 20)});\r\n                        transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);\r\n                        box-shadow: 0 0 8px ${(gameState as any).awayJerseyColor}60;\r\n                    \"></div>\r\n                </div>\r\n            </div>\r\n        `;\r\n    };\r\n\r\n    return `\r\n        <div style=\"padding: 20px 0;\">\r\n            <h3 style=\"\r\n                text-align: center;\r\n                font-size: 20px;\r\n                font-weight: 900;\r\n                margin-bottom: 32px;\r\n                text-transform: uppercase;\r\n                letter-spacing: 1px;\r\n                opacity: 0.9;\r\n            \">\r\n                \uD83D\uDCCA Detailed Match Statistics\r\n            </h3>\r\n\r\n            <div style=\"\r\n                display: grid;\r\n                grid-template-columns: repeat(2, 1fr);\r\n                gap: 16px;\r\n                margin-bottom: 20px;\r\n            \">\r\n                ${renderStatBar('Possession', `${homeStats.possession || 50}%`, `${awayStats.possession || 50}%`, '\u26A1')}\r\n                ${renderStatBar('Goals', gameState.homeScore, gameState.awayScore, '\u26BD')}\r\n                ${renderStatBar('Shots', (homeStats.shotsOnTarget || 0) + (homeStats.shotsOffTarget || 0), (awayStats.shotsOnTarget || 0) + (awayStats.shotsOffTarget || 0), '\uD83C\uDFAF')}\r\n                ${renderStatBar('On Target', homeStats.shotsOnTarget || 0, awayStats.shotsOnTarget || 0, '\uD83C\uDFAF')}\r\n                ${renderStatBar('xG', (homeStats.xGTotal || 0).toFixed(2), (awayStats.xGTotal || 0).toFixed(2), '\u26A1')}\r\n                ${renderStatBar('Pass Acc.', `${homePassAcc}%`, `${awayPassAcc}%`, '\u2705')}\r\n                ${renderStatBar('Interceptions', homeStats.interceptions || 0, awayStats.interceptions || 0, '\u270B')}\r\n                ${renderStatBar('Offsides', (homeStats as any).offsides || 0, (awayStats as any).offsides || 0, '\uD83D\uDEA9')}\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n// ============================================================================\r\n// TAB SWITCHING FUNCTION\r\n// ============================================================================\r\n\r\nexport function switchSummaryTab(tab: 'events' | 'stats'): void {\r\n    const eventsContent = document.getElementById('summary-events-content');\r\n    const statsContent = document.getElementById('summary-stats-content');\r\n    const eventsTab = document.getElementById('events-tab') as HTMLButtonElement | null;\r\n    const statsTab = document.getElementById('stats-tab') as HTMLButtonElement | null;\r\n\r\n    if (!eventsContent || !statsContent || !eventsTab || !statsTab) {\r\n        console.warn('Could not find summary tab elements');\r\n        return;\r\n    }\r\n\r\n    // Toggle content\r\n    eventsContent.style.display = tab === 'events' ? 'block' : 'none';\r\n    statsContent.style.display = tab === 'stats' ? 'block' : 'none';\r\n\r\n    // Active tab styles\r\n    if (tab === 'events') {\r\n        eventsTab.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';\r\n        eventsTab.style.color = 'white';\r\n        eventsTab.style.border = 'none';\r\n        eventsTab.style.boxShadow = '0 4px 12px rgba(102, 126, 234, 0.3)';\r\n\r\n        statsTab.style.background = 'rgba(255,255,255,0.05)';\r\n        statsTab.style.color = 'rgba(255,255,255,0.7)';\r\n        statsTab.style.border = '1px solid rgba(255,255,255,0.1)';\r\n        statsTab.style.boxShadow = 'none';\r\n    } else {\r\n        statsTab.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';\r\n        statsTab.style.color = 'white';\r\n        statsTab.style.border = 'none';\r\n        statsTab.style.boxShadow = '0 4px 12px rgba(102, 126, 234, 0.3)';\r\n\r\n        eventsTab.style.background = 'rgba(255,255,255,0.05)';\r\n        eventsTab.style.color = 'rgba(255,255,255,0.7)';\r\n        eventsTab.style.border = '1px solid rgba(255,255,255,0.1)';\r\n        eventsTab.style.boxShadow = 'none';\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// BROWSER EXPORTS\r\n// ============================================================================\r\n\r\n// Functions are now exported via ES6 modules - no window exports needed\r\n", "/**\r\n * UI Manager\r\n * Manages UI state and rendering lifecycle\r\n *\r\n * @migrated-from js/ui/uiManager.js\r\n * \u2705 Migrated from JavaScript with zero functional changes\r\n * \u2705 Full type safety with strict TypeScript\r\n */\r\n\r\nimport { CFG } from './utils';\r\nimport { gameState } from '../globalExports';\r\nimport { renderUploadScreen, renderSetupScreen } from './uiScreens';\r\nimport {\r\n  renderScoreboard,\r\n  renderCommentary,\r\n  renderStats,\r\n  renderMatchSummary,\r\n  getStatusIndicator\r\n} from './uiComponents';\r\nimport { initializeCanvasLayers } from '../rendering/canvasSetup';\r\nimport { drawPitchBackground } from '../rendering/drawPitch';\r\nimport { renderGame } from '../rendering/gameRenderer';\r\nimport { toggleOrientation } from '../config';\r\n\r\n// ============================================================================\r\n// GLOBAL DECLARATIONS\r\n// ============================================================================\r\n\r\ndeclare global {\r\n  interface Window {\r\n    updateGameUI?: typeof updateGameUI;\r\n    setupGameScreen?: typeof setupGameScreen;\r\n    initializeCanvasLayers?: () => boolean;\r\n    drawPitchBackground?: () => void;\r\n    renderGame?: () => void;\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// UI STATE\r\n// ============================================================================\r\n\r\nexport const uiElements: {\r\n    homeScore?: HTMLElement | null;\r\n    awayScore?: HTMLElement | null;\r\n    timeDisplay?: HTMLElement | null;\r\n    halfDisplay?: HTMLElement | null;\r\n    statusIndicator?: HTMLElement | null;\r\n    commentaryContent?: HTMLElement | null;\r\n    statsWrapper?: HTMLElement | null;\r\n    summaryWrapper?: HTMLElement | null;\r\n} = {};\r\n\r\n// ============================================================================\r\n// MAIN RENDER FUNCTION\r\n// ============================================================================\r\n\r\nexport function render(): void {\r\n    const app = document.getElementById('app');\r\n    if (!app) return;\r\n\r\n    if (!gameState) {\r\n        console.error('\u274C Cannot render: gameState not initialized');\r\n        app.innerHTML = '<div style=\"padding: 40px; text-align: center; color: white;\">Loading game state...</div>';\r\n        return;\r\n    }\r\n\r\n    // Using imported gameState from globalExports\r\n\r\n    // --- 1. RENDER THE CURRENT SCREEN ---\r\n    if (gameState.status === 'upload' || gameState.status === 'setup') {\r\n        (gameState as any).gameUIDisplayed = false; // Reset the flag\r\n        if (gameState.status === 'upload' && renderUploadScreen) {\r\n            renderUploadScreen(app);\r\n        }\r\n        if (gameState.status === 'setup' && renderSetupScreen) {\r\n            renderSetupScreen(app);\r\n        }\r\n    }\r\n    // If the game is active\r\n    else {\r\n        // If the game UI hasn't been drawn yet, draw it ONCE.\r\n        if (!(gameState as any).gameUIDisplayed) {\r\n            setupGameScreen(app);\r\n            (gameState as any).gameUIDisplayed = true; // Set the flag\r\n        }\r\n        // On every subsequent call, just update the text content.\r\n        updateGameUI();\r\n    }\r\n\r\n    // --- 2. ALWAYS INJECT THE TOGGLE BUTTON ---\r\n    // Find the placeholder div that was rendered by the functions above\r\n    const toggleContainer = document.getElementById('toggle-container');\r\n\r\n    if (toggleContainer) {\r\n        // Create the button programmatically\r\n        const toggleBtn = document.createElement('button');\r\n        toggleBtn.id = 'orientationToggleBtn';\r\n\r\n        // Apply styling\r\n        toggleBtn.style.background = 'rgba(255,255,255,0.1)';\r\n        toggleBtn.style.border = '1px solid rgba(255,255,255,0.2)';\r\n        toggleBtn.style.color = 'white';\r\n        toggleBtn.style.padding = '5px 10px';\r\n        toggleBtn.style.borderRadius = '5px';\r\n        toggleBtn.style.cursor = 'pointer';\r\n        toggleBtn.style.fontSize = '10px';\r\n        toggleBtn.style.opacity = '0.5';\r\n        toggleBtn.style.transition = 'opacity 0.3s';\r\n\r\n        // Set text based on current state\r\n        toggleBtn.innerText = (gameState as any).isVertical ? 'View: Horizontal' : 'View: Vertical';\r\n\r\n        // Add hover effects\r\n        toggleBtn.onmouseover = () => toggleBtn.style.opacity = '1';\r\n        toggleBtn.onmouseout = () => toggleBtn.style.opacity = '0.5';\r\n\r\n        // Add click event listener\r\n        toggleBtn.addEventListener('click', toggleOrientation);\r\n\r\n        // Clear container and add the new button\r\n        toggleContainer.innerHTML = '';\r\n        toggleContainer.appendChild(toggleBtn);\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// UPDATE GAME UI\r\n// ============================================================================\r\n\r\nexport function updateGameUI(): void {\r\n    // Using imported gameState from globalExports\r\n\r\n    // Update Scoreboard text content\r\n    if (uiElements.homeScore) uiElements.homeScore.textContent = String(gameState.homeScore);\r\n    if (uiElements.awayScore) uiElements.awayScore.textContent = String(gameState.awayScore);\r\n    if (uiElements.timeDisplay) uiElements.timeDisplay.textContent = `${String(Math.floor(gameState.timeElapsed)).padStart(2, '0')}'`;\r\n    if (uiElements.halfDisplay) uiElements.halfDisplay.textContent = `HALF ${gameState.currentHalf}`;\r\n    if (uiElements.statusIndicator && getStatusIndicator) {\r\n        uiElements.statusIndicator.innerHTML = getStatusIndicator();\r\n    }\r\n\r\n    // Update Commentary with fade-out effect\r\n    const commentaryWrapper = document.getElementById('commentary-wrapper');\r\n    if (commentaryWrapper && renderCommentary) {\r\n        clearTimeout((gameState as any).commentaryFadeTimeout);\r\n        commentaryWrapper.innerHTML = renderCommentary();\r\n        commentaryWrapper.style.opacity = '0.5'; // Set initial opacity\r\n\r\n        (gameState as any).commentaryFadeTimeout = setTimeout(() => {\r\n            commentaryWrapper.style.opacity = '0.1'; // Fade out\r\n        }, 1000); // Time before fade\r\n    }\r\n\r\n    // Update Stats\r\n    if (uiElements.statsWrapper && renderStats) {\r\n        uiElements.statsWrapper.innerHTML = renderStats();\r\n    }\r\n\r\n\r\n    // Update Match Summary Overlay (This logic is correct)\r\n    if (uiElements.summaryWrapper) {\r\n        if (gameState.status === 'finished' && !(gameState as any).summaryDrawn && renderMatchSummary) {\r\n            uiElements.summaryWrapper.innerHTML = renderMatchSummary();\r\n            (gameState as any).summaryDrawn = true;\r\n\r\n            setTimeout(() => {\r\n                const eventsTab = document.getElementById('events-tab');\r\n                if(eventsTab) {\r\n                    (eventsTab as HTMLElement).click();\r\n                }\r\n            }, 10);\r\n\r\n        } else if (gameState.status !== 'finished' && (gameState as any).summaryDrawn) {\r\n            uiElements.summaryWrapper.innerHTML = '';\r\n            (gameState as any).summaryDrawn = false;\r\n        }\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// SETUP GAME SCREEN\r\n// ============================================================================\r\n\r\nexport function setupGameScreen(app: HTMLElement): void {\r\n    // Using imported gameState from globalExports\r\n\r\n    // 1. MANTIK/OYUN Koordinat Boyutlar\u0131 (CSS G\u00F6r\u00FCnt\u00FCleme Boyutu)\r\n    const LOGICAL_WIDTH = (gameState as any).isVertical ? 600 : 800;\r\n    const LOGICAL_HEIGHT = (gameState as any).isVertical ? 800 : 600;\r\n\r\n    // 2. \u00D6L\u00C7EK FAKT\u00D6R\u00DC (initializeCanvasLayers'da kullan\u0131lanla ayn\u0131)\r\n    const SCALE_FACTOR = (CFG() as any).HIGH_DPI_SCALE_FACTOR;\r\n\r\n    // 3. F\u0130Z\u0130KSEL P\u0130KSEL BOYUTLARI (Canvas width/height attribute)\r\n    const physicalCanvasWidth = LOGICAL_WIDTH * SCALE_FACTOR; // \u00D6rn: 1600\r\n    const physicalCanvasHeight = LOGICAL_HEIGHT * SCALE_FACTOR; // \u00D6rn: 1200\r\n\r\n    // 4. CSS G\u00D6R\u00DCNT\u00DCLEME BOYUTU (Container style)\r\n    // KONTEYNER BOYUTUNU MANTIK BOYUTUNDA TUTARIZ (\u00D6rn: 800px)\r\n    const containerWidth = LOGICAL_WIDTH;\r\n    const containerHeight = LOGICAL_HEIGHT;\r\n\r\n    const scoreboardHTML = renderScoreboard ? renderScoreboard() : '';\r\n    const commentaryHTML = renderCommentary ? renderCommentary() : '';\r\n    const statsHTML = renderStats ? renderStats() : '';\r\n\r\n    app.innerHTML = `\r\n        <div class=\"container\">\r\n            <div style=\"width: ${containerWidth}px; margin: 0 auto 12px auto;\">\r\n                <div id=\"scoreboard-wrapper\">\r\n                    ${scoreboardHTML}\r\n                </div>\r\n            </div>\r\n\r\n            <div class=\"canvas-container\" style=\"position: relative; margin-bottom: 20px;\">\r\n                <div id=\"canvas-container\" style=\"position: relative; width: ${containerWidth}px; height: ${containerHeight}px; margin: 0 auto; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.1);\">\r\n                    <canvas id=\"backgroundCanvas\" width=\"${physicalCanvasWidth}\" height=\"${physicalCanvasHeight}\" style=\"position: absolute; z-index: 1;\"></canvas>\r\n                    <canvas id=\"gameCanvas\" width=\"${physicalCanvasWidth}\" height=\"${physicalCanvasHeight}\" style=\"position: absolute; z-index: 2;\"></canvas>\r\n                    <canvas id=\"uiCanvas\" width=\"${physicalCanvasWidth}\" height=\"${physicalCanvasHeight}\" style=\"position: absolute; z-index: 3;\"></canvas>\r\n\r\n                    <div id=\"commentary-wrapper\" style=\"position: absolute; bottom: 16px; left: 16px; z-index: 4; max-width: 350px;\">\r\n                        ${commentaryHTML}\r\n                    </div>\r\n                </div>\r\n                <div id=\"summary-wrapper\"></div>\r\n            </div>\r\n\r\n            <div style=\"max-width: ${containerWidth}px; margin: 0 auto;\">\r\n                <div id=\"stats-wrapper\">${statsHTML}</div>\r\n            </div>\r\n\r\n            <div id=\"toggle-container\" style=\"max-width: ${containerWidth}px; margin: 10px auto 0; text-align: right;\"></div>\r\n        </div>\r\n\r\n        `;\r\n\r\n    // 3. Cache DOM elements (geri kalan\u0131 de\u011Fi\u015Fmez)\r\n    uiElements.homeScore = document.getElementById('home-score-color');\r\n    uiElements.awayScore = document.getElementById('away-score-color');\r\n    uiElements.timeDisplay = document.getElementById('time-display');\r\n    uiElements.halfDisplay = document.getElementById('half-display');\r\n    uiElements.statusIndicator = document.getElementById('status-indicator');\r\n    uiElements.commentaryContent = document.getElementById('commentary-content');\r\n    uiElements.statsWrapper = document.getElementById('stats-wrapper');\r\n    uiElements.summaryWrapper = document.getElementById('summary-wrapper');\r\n\r\n    // ... (di\u011Fer ui elementleri)\r\n\r\n    // 5. Initialize canvas (geri kalan\u0131 de\u011Fi\u015Fmez)\r\n    setTimeout(() => {\r\n        console.log('\uD83C\uDFA8 Setting up canvas & drawing background...');\r\n        const success = initializeCanvasLayers ? initializeCanvasLayers() : false;\r\n        if (success) {\r\n            // NEW: Check if orientation changed to invalidate cache\r\n            if ((gameState as any).orientationChanged) {\r\n                 (gameState as any).offscreenPitch = null; // Invalidate cache\r\n                 (gameState as any).orientationChanged = false; // Reset flag\r\n            }\r\n            if (drawPitchBackground) {\r\n                drawPitchBackground();\r\n            }\r\n            if (renderGame) {\r\n                renderGame();\r\n            }\r\n        } else {\r\n            console.error('\u274C Failed to initialize canvases');\r\n        }\r\n    }, 0);\r\n}\r\n\r\n// ============================================================================\r\n// BROWSER EXPORTS\r\n// ============================================================================\r\n\r\n// Functions are now exported via ES6 modules - no window exports needed\r\n", "/**\n * @file main.ts\n * @migrated-from js/main.js\n *\n * Main Initialization and Game Loop\n *\n * This module handles:\n * 1. File upload and Excel data processing\n * 2. UI event listeners\n * 3. Match initialization and setup\n * 4. Game state management (halftime, fulltime)\n * 5. Set piece handling (free kicks, throw-ins, etc.)\n * 6. Match statistics and momentum system\n * 7. Real-time clock and UI updates\n */\n\nimport type { Player, TeamState } from './types';\nimport { distance } from './utils/math';\nimport { getPlayerActivePosition } from './ai';\nimport { passBall } from './ai';\nimport { gameState } from './globalExports';\nimport { GAME_CONFIG, TACTICS, GAME_LOOP, getRoleFromPosition } from './config';\nimport { EVENT_TYPES } from './types';\nimport { eventBus } from './eventBus';\nimport { gameLoop_V2 } from './core';\nimport { ensureStatsShape, getAttackingGoalX, calculateXG } from './utils/ui';\nimport { initFirstTouchStats } from './ai/playerFirstTouch';\nimport { initOffsideStats } from './rules/offside';\nimport * as SetPieceIntegration from './setpieces/integration';\nimport { configureSetPieceRoutines } from './setpieces/config';\nimport { calculatePassSuccess } from './ai/decisions';\nimport { resolveShot_WithAdvancedGK } from './ai/goalkeeper';\nimport { selectBestFormation, selectBestTactic, selectBestTeam, initializePlayers } from './gameSetup';\nimport { render, updateGameUI } from './ui/uiManager';\nimport { renderGame } from './rendering/gameRenderer';\nimport { initializeCanvasLayers } from './rendering/canvasSetup';\nimport { drawPitchBackground } from './rendering/drawPitch';\n\ndeclare const XLSX: any;\n\n// ============================================================================\n// FILE UPLOAD AND DATA PROCESSING\n// ============================================================================\n\nexport function handleFileUpload(event: Event): void {\n    const input = event.target as HTMLInputElement;\n    const file = input.files?.[0];\n    if (!file) return;\n\n    const reader = new FileReader();\n    reader.onload = function(e: ProgressEvent<FileReader>) {\n        const data = new Uint8Array(e.target!.result as ArrayBuffer);\n        const workbook = XLSX.read(data, { type: 'array' });\n\n        const sayfa1 = workbook.Sheets['Sayfa1'];\n        const sayfa1Data = XLSX.utils.sheet_to_json(sayfa1, { header: 1 });\n        gameState.teams = [];\n        gameState.teamJerseys = {};\n        gameState.teamCoaches = {};\n        gameState.teamLogos = gameState.teamLogos || {};\n\n        sayfa1Data.slice(1).forEach((row: any[]) => {\n            if (row[0] && row[0].toString().trim()) {\n                const teamName = row[0].toString().trim();\n                gameState.teams.push(teamName);\n                gameState.teamJerseys[teamName] = {\n                    jersey1: row[3] ? row[3].toString().trim() : '#ef4444',\n                    jersey2: row[4] ? row[4].toString().trim() : '#3b82f6'\n                };\n                gameState.teamLogos[teamName] = row[7] ? row[7].toString().trim() : '';\n            }\n        });\n\n        const oyuncular = workbook.Sheets['oyuncular'];\n        const oyuncularData = XLSX.utils.sheet_to_json(oyuncular, { header: 1 });\n\n        gameState.players = oyuncularData.slice(1)\n            .filter((row: any[]) => {\n                const hasName = row[0] && row[0].toString().trim();\n                const hasTeam = row[2] && row[2].toString().trim();\n                const position = row[3] ? row[3].toString().trim() : '';\n                const fotmobId = row[11];\n                const rating = row[12];\n\n                if (position.toLowerCase() === 'coach') {\n                    const teamName = row[2].toString().trim();\n                    const coachName = row[0].toString().trim();\n                    gameState.teamCoaches[teamName] = coachName;\n                    return false;\n                }\n\n                const hasValidId = fotmobId && fotmobId.toString().trim() && fotmobId.toString().trim().toLowerCase() !== 'n/a';\n\n                return hasName && hasTeam && hasValidId &&\n                       rating && !isNaN(parseFloat(rating));\n            })\n            .map((row: any[], index: number) => {\n                const positionString = row[3]?.toString().trim() || '';\n                const isGK = positionString.toLowerCase().includes('keeper') ||\n                             positionString.toLowerCase().includes('gk');\n\n                const playerId = row[11] ? String(row[11]).trim() : `temp_${index}`;\n                const playerRole = typeof getRoleFromPosition === 'function' ? getRoleFromPosition(positionString) : 'CM';\n\n                return {\n                    id: playerId,\n                    name: row[0].toString().trim(),\n                    team: row[2].toString().trim(),\n                    position: positionString.split(',')[0].trim(),\n                    role: playerRole,\n                    pace: parseInt(row[4]) || 60,\n                    shooting: parseInt(row[5]) || 60,\n                    passing: parseInt(row[6]) || 60,\n                    dribbling: parseInt(row[7]) || 60,\n                    defending: parseInt(row[8]) || 60,\n                    physicality: parseInt(row[9]) || 60,\n                    goalkeeping: parseInt(row[10]) || 60,\n                    rating: parseFloat(row[12]) || 6.5,\n                    realStats: {\n                        chancesCreated: parseFloat(row[13]) || 0,\n                        crossesAccuracy: parseFloat(row[14]) || 0,\n                        dribblesSucceeded: parseFloat(row[15]) || 0,\n                        dispossessed: parseFloat(row[16]) || 0,\n                        penaltyWon: parseFloat(row[17]) || 0,\n                        foulsWon: parseFloat(row[18]) || 0,\n                        aerialsWonPercent: parseFloat(row[19]) || 50,\n                        duelWonPercent: parseFloat(row[20]) || 50,\n                        interceptions: parseFloat(row[21]) || 0,\n                        fouls: parseFloat(row[22]) || 0,\n                        recoveries: parseFloat(row[23]) || 0,\n                        goals: parseFloat(row[24]) || 0,\n                        assists: parseFloat(row[25]) || 0,\n                        xG: parseFloat(row[26]) || 0,\n                        xGOT: parseFloat(row[27]) || 0,\n                        shots: parseFloat(row[28]) || 0,\n                        shotsOnTarget: parseFloat(row[29]) || 0,\n                        xA: parseFloat(row[30]) || 0,\n                        passAccuracy: parseFloat(row[31]) || 70,\n                        longBallAccuracy: parseFloat(row[32]) || 50,\n                        wonContest: parseFloat(row[33]) || 0,\n                        touchesOppBox: parseFloat(row[34]) || 0,\n                        gkSaves: isGK ? parseFloat(row[35]) || 0 : 0,\n                        gkSavePercent: isGK ? parseFloat(row[36]) || 50 : 0,\n                        gkGoalsConceded: isGK ? parseFloat(row[37]) || 0 : 0,\n                        gkGoalsPrevented: isGK ? parseFloat(row[38]) || 0 : 0,\n                        gkKeeperSweeper: isGK ? parseFloat(row[39]) || 0 : 0,\n                        gkErrorLedToGoal: isGK ? parseFloat(row[40]) || 0 : 0,\n                        yellowCards: parseFloat(row[41]) || 0,\n                        redCards: parseFloat(row[42]) || 0\n                    }\n                };\n            });\n\n        gameState.homeTeam = gameState.teams[0] || '';\n        gameState.awayTeam = gameState.teams[1] || '';\n        gameState.status = 'setup';\n        render();\n    };\n    reader.readAsArrayBuffer(file);\n}\n\nexport function attachSetupEventListeners(): void {\n    const homeSelect = document.getElementById('homeSelect') as HTMLSelectElement;\n    const awaySelect = document.getElementById('awaySelect') as HTMLSelectElement;\n    const homeTacticSelect = document.getElementById('homeTacticSelect') as HTMLSelectElement;\n    const awayTacticSelect = document.getElementById('awayTacticSelect') as HTMLSelectElement;\n\n    if (homeSelect) {\n        homeSelect.addEventListener('change', (e) => {\n            gameState.homeTeam = (e.target as HTMLSelectElement).value;\n            const homeTeamPlayers = gameState.players.filter(p => p.team === gameState.homeTeam);\n            gameState.homeFormation = selectBestFormation(homeTeamPlayers);\n            gameState.homeTactic = selectBestTactic(homeTeamPlayers);\n            gameState.homeTacticManuallySet = false;\n            render();\n        });\n    }\n\n    if (awaySelect) {\n        awaySelect.addEventListener('change', (e) => {\n            gameState.awayTeam = (e.target as HTMLSelectElement).value;\n            const awayTeamPlayers = gameState.players.filter(p => p.team === gameState.awayTeam);\n            gameState.awayFormation = selectBestFormation(awayTeamPlayers);\n            gameState.awayTactic = selectBestTactic(awayTeamPlayers);\n            gameState.awayTacticManuallySet = false;\n            render();\n        });\n    }\n\n    if (homeTacticSelect) {\n        homeTacticSelect.addEventListener('change', (e) => {\n            gameState.homeTactic = (e.target as HTMLSelectElement).value as any;\n            gameState.homeTacticManuallySet = true;\n        });\n    }\n\n    if (awayTacticSelect) {\n        awayTacticSelect.addEventListener('change', (e) => {\n            gameState.awayTactic = (e.target as HTMLSelectElement).value as any;\n            gameState.awayTacticManuallySet = true;\n        });\n    }\n}\n\n// ============================================================================\n// GAME LOOP VARIABLES\n// ============================================================================\n\nexport let isBatchMode = false;\nexport let lastFrameTime = 0;\nexport let gameTime = 0;\nexport let physicsAccumulator = 0;\nexport let animationFrameId: number | null = null;\nexport let gameIntervalId: number | null = null;\n\nexport let pendingGameEvents: any[] = [];\n\n// ============================================================================\n// SET PIECE HANDLERS\n// ============================================================================\n\nconst CFG = () => GAME_CONFIG;\nconst resolveSide = (foulTeam: boolean | string): string => {\n    if (typeof foulTeam === 'boolean') return foulTeam ? 'home' : 'away';\n    return foulTeam;\n};\nconst invertSide = (side: string): string => side === 'home' ? 'away' : 'home';\n\nexport function handleFreeKick(foulLocation: { x: number; y: number } | null, foulTeam: boolean | string): void {\n    const foulSide = resolveSide(foulTeam);\n    const awardSide = invertSide(foulSide);\n    const freeKickTeam = (awardSide === \"home\");\n\n    const pos = {\n        x: Number(foulLocation?.x) || CFG().PITCH_WIDTH / 2,\n        y: Number(foulLocation?.y) || CFG().PITCH_HEIGHT / 2\n    };\n\n    const opponentGoalX = getAttackingGoalX(freeKickTeam, gameState.currentHalf);\n    const distToGoal = distance(pos, { x: opponentGoalX, y: 300 });\n    const isCentral = Math.abs(pos.y - 300) < 130;\n    const isDangerous = distToGoal < 280 && isCentral;\n\n    const executionDelay = isDangerous ? 3000 : 1200;\n\n    gameState.status = 'FREE_KICK';\n    gameState.setPiece = {\n        type: 'FREE_KICK',\n        team: freeKickTeam,\n        side: awardSide,\n        position: pos,\n        executionTime: Date.now() + executionDelay,\n        configured: false,\n        executed: false,\n        isDangerous: isDangerous\n    };\n\n    gameState.ballPosition = { x: pos.x, y: pos.y };\n    gameState.ballVelocity = { x: 0, y: 0 };\n    gameState.ballTrajectory = null;\n    gameState.ballHolder = null;\n\n    SetPieceIntegration.ensureCorrectSetPiecePlacement(gameState);\n\n    if (configureSetPieceRoutines) {\n        configureSetPieceRoutines(gameState);\n    }\n\n    const teamName = (awardSide === \"home\") ? gameState.homeTeam : gameState.awayTeam;\n    gameState.commentary.push({\n        text: `${Math.floor(gameState.timeElapsed)}' Free kick for ${teamName}`,\n        type: \"attack\"\n    });\n}\n\nexport function handleThrowIn(): void {\n    const lastPlayer = gameState.lastTouchedBy;\n\n    if (!lastPlayer) {\n        console.error(`\u274C THROW-IN ERROR: No lastTouchedBy player!`);\n        setupKickOff('home');\n        return;\n    }\n\n    const throwInTeam = !lastPlayer.isHome;\n    const throwInY = gameState.ballPosition.y < 300 ? 10 : 590;\n    const throwInX = Math.max(50, Math.min(750, gameState.ballPosition.x));\n\n    console.log(`\u26BE THROW-IN: Last touch by ${lastPlayer.name} (${lastPlayer.isHome ? 'home' : 'away'}), awarding to ${throwInTeam ? 'home' : 'away'}`);\n\n    gameState.status = 'THROW_IN';\n    gameState.setPiece = {\n        type: 'THROW_IN',\n        team: throwInTeam,\n        position: { x: throwInX, y: throwInY },\n        executionTime: Date.now() + 1000,\n        executed: false\n    };\n\n    gameState.ballPosition.x = throwInX;\n    gameState.ballPosition.y = throwInY;\n    gameState.ballVelocity = { x: 0, y: 0 };\n    gameState.ballTrajectory = null;\n    gameState.ballHolder = null;\n\n    const teamName = throwInTeam ? gameState.homeTeam : gameState.awayTeam;\n    gameState.commentary.push({\n        text: `${Math.floor(gameState.timeElapsed)}' Throw-in for ${teamName}`,\n        type: 'attack'\n    });\n}\n\nexport function handleBallOutOfBounds(): void {\n    const ballX = gameState.ballPosition.x;\n    const lastPlayer = gameState.lastTouchedBy;\n\n    if (!lastPlayer) {\n        setupKickOff('home');\n        return;\n    }\n\n    gameState.ballTrajectory = null;\n    gameState.ballHolder = null;\n    gameState.ballVelocity = { x: 0, y: 0 };\n    gameState.ballHeight = 0;\n\n    const crossedLeftSide = ballX < 50;\n    const crossedRightSide = ballX > 750;\n\n    if (!crossedLeftSide && !crossedRightSide) {\n        return;\n    }\n\n    const homeDefendsLeft = gameState.currentHalf === 1;\n    let defendingTeamIsHome: boolean;\n    if (crossedLeftSide) {\n        defendingTeamIsHome = homeDefendsLeft;\n    } else {\n        defendingTeamIsHome = !homeDefendsLeft;\n    }\n\n    const defendingTeamTouchedLast = (lastPlayer.isHome === defendingTeamIsHome);\n\n    if (defendingTeamTouchedLast) {\n        // Corner kick\n        const isLeftCorner = crossedLeftSide;\n        const isTopCorner = gameState.ballPosition.y < 300;\n\n        gameState.status = 'CORNER_KICK';\n        gameState.setPiece = {\n            type: 'CORNER_KICK',\n            team: !defendingTeamIsHome,\n            position: SetPieceIntegration.getCornerKickPosition(isLeftCorner, isTopCorner),\n            executionTime: Date.now() + 1200,\n            executed: false\n        };\n\n        gameState.ballPosition.x = gameState.setPiece.position.x;\n        gameState.ballPosition.y = gameState.setPiece.position.y;\n\n        if (configureSetPieceRoutines) {\n            configureSetPieceRoutines(gameState);\n        }\n\n        const teamName = !defendingTeamIsHome ? gameState.homeTeam : gameState.awayTeam;\n        gameState.commentary.push({\n            text: `${Math.floor(gameState.timeElapsed)}' Corner kick for ${teamName}`,\n            type: 'attack'\n        });\n\n    } else {\n        // Goal kick\n        const gkX = crossedLeftSide ? 50 : 750;\n\n        gameState.status = 'GOAL_KICK';\n        gameState.setPiece = {\n            type: 'GOAL_KICK',\n            team: defendingTeamIsHome,\n            position: SetPieceIntegration.getGoalKickPosition(gkX, 'center'),\n            executionTime: Date.now() + 1200,\n            executed: false\n        };\n\n        gameState.ballPosition.x = gameState.setPiece.position.x;\n        gameState.ballPosition.y = gameState.setPiece.position.y;\n\n        if (configureSetPieceRoutines) {\n            configureSetPieceRoutines(gameState);\n        }\n\n        const teamName = defendingTeamIsHome ? gameState.homeTeam : gameState.awayTeam;\n        gameState.commentary.push({\n            text: `${Math.floor(gameState.timeElapsed)}' Goal kick for ${teamName}`,\n            type: 'attack'\n        });\n    }\n}\n\nexport function processPendingEvents(currentGameTime: number): void {\n    const eventsToProcess = pendingGameEvents.filter(event => currentGameTime >= event.resolveTime);\n    pendingGameEvents = pendingGameEvents.filter(event => currentGameTime < event.resolveTime);\n\n    for (const event of eventsToProcess) {\n        if (event.type === 'shot_outcome') {\n            resolveShot_WithAdvancedGK(event.data);\n        }\n    }\n}\n\nexport function restoreFormationAfterSetPiece(): void {\n    const allPlayers = [...gameState.homePlayers, ...gameState.awayPlayers];\n\n    allPlayers.forEach(player => {\n        if (player.role === 'GK') {\n            const ownGoalX = getAttackingGoalX(!player.isHome, gameState.currentHalf);\n            player.targetX = ownGoalX;\n            player.targetY = 300;\n        } else {\n            const activePos = getPlayerActivePosition(player, gameState.currentHalf);\n            player.targetX = activePos.x;\n            player.targetY = activePos.y;\n        }\n\n        player.speedBoost = 1.0;\n    });\n}\n\n// ============================================================================\n// JERSEY AND TEAM SELECTION\n// ============================================================================\n\nexport function selectJerseys(): void {\n    const homeJerseys = gameState.teamJerseys[gameState.homeTeam];\n    const awayJerseys = gameState.teamJerseys[gameState.awayTeam];\n\n    function isValidColor(color: string | undefined | null): boolean {\n        if (!color || typeof color !== 'string') return false;\n        return /^#[0-9A-F]{6}$/i.test(color.trim());\n    }\n\n    const defaultHomeColor = '#ef4444';\n    const defaultAwayColor = '#3b82f6';\n\n    if (!homeJerseys || !awayJerseys) {\n        gameState.homeJerseyColor = defaultHomeColor;\n        gameState.awayJerseyColor = defaultAwayColor;\n        return;\n    }\n\n    gameState.homeJerseyColor = isValidColor(homeJerseys.jersey1)\n        ? homeJerseys.jersey1.trim()\n        : defaultHomeColor;\n\n    let awayColor = isValidColor(awayJerseys.jersey1)\n        ? awayJerseys.jersey1.trim()\n        : defaultAwayColor;\n\n    if (gameState.homeJerseyColor.toLowerCase() === awayColor.toLowerCase()) {\n        awayColor = isValidColor(awayJerseys.jersey2)\n            ? awayJerseys.jersey2.trim()\n            : '#10b981';\n    }\n\n    gameState.awayJerseyColor = awayColor;\n}\n\nexport function setupKickOff(teamWithBall: 'home' | 'away'): void {\n    console.log(`\u26BD Setting up kick-off for ${teamWithBall} team`);\n\n    if (teamWithBall !== 'home' && teamWithBall !== 'away') {\n        console.error(`\u274C setupKickOff: INVALID TEAM \"${teamWithBall}\"!`);\n    }\n\n    const kickoffTeamIsHome = teamWithBall === 'home';\n\n    const setPieceState = {\n        type: 'KICK_OFF' as const,\n        team: kickoffTeamIsHome,\n        position: { x: 400, y: 300 },\n        executionTime: Date.now() + 1200,\n        configured: false,\n        executed: false\n    };\n\n    gameState.setPiece = setPieceState;\n\n    gameState.ballTrajectory = null;\n    gameState.ballHolder = null;\n\n    gameState.ballPosition = { x: 400, y: 300 };\n    gameState.ballVelocity = { x: 0, y: 0 };\n\n    const allPlayers = [...gameState.homePlayers, ...gameState.awayPlayers];\n\n    const centerX = 400;\n    const centerY = 300;\n\n    allPlayers.forEach(p => {\n        p.isChasingBall = false;\n        p.chaseStartTime = null;\n    });\n\n    allPlayers.forEach(player => {\n        player.hasBallControl = false;\n        player.vx = 0;\n        player.vy = 0;\n        player.speedBoost = 1.0;\n        player.targetLocked = false;\n\n        const activePos = getPlayerActivePosition(player, gameState.currentHalf);\n        const ownGoalX = getAttackingGoalX(!player.isHome, gameState.currentHalf);\n        const isKickoffTeam = player.isHome === kickoffTeamIsHome;\n\n        const ownHalfIsLeft = ownGoalX < centerX;\n\n        if (player.role === 'GK') {\n            player.x = ownGoalX;\n            player.y = centerY;\n            return;\n        }\n\n        const baseDistanceFromCenter = 60;\n        const roleAdjustment = player.role.includes('ST') || player.role.includes('FW') || player.role.includes('CF')\n            ? 20\n            : player.role.includes('MID') || player.role.includes('CM') || player.role.includes('CAM')\n            ? 40\n            : 80;\n\n        let targetX: number, targetY: number;\n\n        if (ownHalfIsLeft) {\n            targetX = centerX - baseDistanceFromCenter - roleAdjustment;\n            targetX = Math.max(targetX, ownGoalX + 80);\n        } else {\n            targetX = centerX + baseDistanceFromCenter + roleAdjustment;\n            targetX = Math.min(targetX, ownGoalX - 80);\n        }\n\n        targetY = Math.max(80, Math.min(520, activePos.y));\n\n        if (!isKickoffTeam) {\n            const distToCenter = distance({ x: targetX, y: targetY }, { x: centerX, y: centerY });\n            if (distToCenter < 70) {\n                const angle = Math.atan2(targetY - centerY, targetX - centerX);\n                const pushDistance = 75;\n\n                targetX = centerX + Math.cos(angle) * pushDistance;\n                targetY = centerY + Math.sin(angle) * pushDistance;\n\n                if (ownHalfIsLeft) {\n                    targetX = Math.min(targetX, centerX - 30);\n                } else {\n                    targetX = Math.max(targetX, centerX + 30);\n                }\n\n                targetY = Math.max(80, Math.min(520, targetY));\n            }\n        }\n\n        player.x = targetX;\n        player.y = targetY;\n        player.targetX = player.x;\n        player.targetY = player.y;\n    });\n\n    gameState.status = 'KICK_OFF';\n\n    if (configureSetPieceRoutines) {\n        configureSetPieceRoutines(gameState);\n    }\n\n    const kickOffTeamPlayers = kickoffTeamIsHome ? gameState.homePlayers : gameState.awayPlayers;\n\n    const striker = kickOffTeamPlayers\n        .filter(p => p.role === 'ST')\n        .sort((a, b) => b.rating - a.rating)[0];\n\n    const midfielder = kickOffTeamPlayers\n        .filter(p => ['CAM', 'CM', 'CDM'].includes(p.role))\n        .sort((a, b) => b.passing - a.passing)[0];\n\n    if (!striker && !midfielder) {\n        console.error('\u274C No suitable players for kick-off');\n        return;\n    }\n\n    const primaryTaker = striker || midfielder;\n    const nonGKPlayers = kickOffTeamPlayers.filter(p => p.role !== 'GK');\n    const secondaryTaker = striker && midfielder ? midfielder : (nonGKPlayers.length > 1 ? nonGKPlayers[1] : null);\n\n    if (primaryTaker) {\n        primaryTaker.x = centerX;\n        primaryTaker.y = centerY;\n    }\n\n    if (secondaryTaker) {\n        const opponentGoalX = getAttackingGoalX(kickoffTeamIsHome, gameState.currentHalf);\n        const direction = opponentGoalX > centerX ? -1 : 1;\n        secondaryTaker.x = centerX + (direction * 25);\n        secondaryTaker.y = centerY;\n    }\n}\n\nexport function removePlayerFromMatch(playerToRemove: Player): void {\n    if (playerToRemove.isHome) {\n        gameState.homePlayers = gameState.homePlayers.filter(p => p.id !== playerToRemove.id);\n    } else {\n        gameState.awayPlayers = gameState.awayPlayers.filter(p => p.id !== playerToRemove.id);\n    }\n}\n\nexport function handleShotAttempt(holder: Player, goalX: number, allPlayers: Player[]): void {\n    const goalkeeper = allPlayers.find(p => p.role === 'GK' && p.isHome !== holder.isHome);\n    const opponents = allPlayers.filter(p => p.isHome !== holder.isHome);\n\n    const xG = calculateXG(holder, goalX, holder.y, opponents);\n    const teamStats = holder.isHome ? gameState.stats.home : gameState.stats.away;\n\n    teamStats.xGTotal += xG;\n    gameState.lastTouchedBy = holder;\n\n    const shootingSkill = holder.shooting / 110;\n    const pressureLevel = opponents.filter(opp => distance(holder, opp) < 40).length;\n    const pressurePenalty = pressureLevel * 0.12;\n    const distToGoal = Math.abs(holder.x - goalX);\n    const distancePenalty = Math.min(distToGoal / 350, 0.25);\n    const angleFromCenter = Math.abs(holder.y - 300);\n    const anglePenalty = Math.min(angleFromCenter / 180, 0.20);\n    const fatiguePenalty = Math.max(0, (100 - holder.stamina) / 100 * 0.15);\n\n    const baseAccuracy = shootingSkill * 0.9;\n    const effectiveAccuracy = Math.max(0.1, baseAccuracy - pressurePenalty - distancePenalty - anglePenalty - fatiguePenalty);\n\n    const goalCenterY = 300;\n    const GOAL_Y_TOP = GAME_CONFIG.GOAL_Y_TOP;\n    const GOAL_Y_BOTTOM = GAME_CONFIG.GOAL_Y_BOTTOM;\n    const goalHeight = GOAL_Y_BOTTOM - GOAL_Y_TOP;\n\n    const maxDeviation = goalHeight * 1.5;\n    const deviationRange = maxDeviation * (1 - effectiveAccuracy);\n    const aimOffset = (Math.random() - 0.5) * deviationRange;\n    const shotTargetY = goalCenterY + aimOffset;\n\n    const shotPower = 800 + holder.shooting * 4;\n    passBall(holder, holder.x, holder.y, goalX, shotTargetY, 1.0, shotPower, true);\n\n    if (gameState.ballTrajectory) {\n        gameState.ballTrajectory.shotTargetY = shotTargetY;\n        gameState.ballTrajectory.effectiveAccuracy = effectiveAccuracy;\n    }\n\n    gameState.shotInProgress = true;\n    gameState.shooter = holder;\n    gameState.currentShotXG = xG;\n\n    const resolveDuration = gameState.ballTrajectory?.duration ? (gameState.ballTrajectory.duration / 1000) : 0.5;\n    pendingGameEvents.push({\n        type: 'shot_outcome',\n        resolveTime: gameTime + resolveDuration,\n        data: { holder, xG, goalkeeper, goalX, shotTargetY }\n    });\n}\n\n// ============================================================================\n// MATCH STATISTICS AND MOMENTUM\n// ============================================================================\n\nexport function updateMatchStats(): void {\n    const now = Date.now();\n    const elapsed = (now - gameState.stats.lastPossessionUpdate) / 1000;\n\n    if (gameState.ballHolder) {\n        if (gameState.ballHolder.isHome) {\n            gameState.stats.possessionTimer.home += elapsed;\n        } else {\n            gameState.stats.possessionTimer.away += elapsed;\n        }\n    }\n\n    const totalTime = gameState.stats.possessionTimer.home + gameState.stats.possessionTimer.away;\n    if (totalTime > 0) {\n        gameState.stats.home.possession = Math.round((gameState.stats.possessionTimer.home / totalTime) * 100);\n        gameState.stats.away.possession = Math.round((gameState.stats.possessionTimer.away / totalTime) * 100);\n    }\n\n    gameState.stats.lastPossessionUpdate = now;\n\n    updateTeamStates();\n}\n\nexport const MomentumSystem = {\n    homeMomentum: 0,\n    awayMomentum: 0,\n    lastUpdate: Date.now(),\n\n    getMomentumBonus(isHome: boolean): number {\n        const momentum = isHome ? this.homeMomentum : this.awayMomentum;\n        return 1.0 + (momentum / 1000);\n    },\n\n    onGoalScored(scoringTeam: 'home' | 'away'): void {\n        if (scoringTeam === 'home') {\n            this.homeMomentum = Math.min(100, this.homeMomentum + 25);\n            this.awayMomentum = Math.max(-100, this.awayMomentum - 15);\n        } else {\n            this.awayMomentum = Math.min(100, this.awayMomentum + 25);\n            this.homeMomentum = Math.max(-100, this.homeMomentum - 15);\n        }\n        console.log(`\uD83D\uDCC8 Momentum: Home=${this.homeMomentum}, Away=${this.awayMomentum}`);\n    },\n\n    onShotOnTarget(shootingTeam: 'home' | 'away'): void {\n        if (shootingTeam === 'home') {\n            this.homeMomentum = Math.min(100, this.homeMomentum + 5);\n            this.awayMomentum = Math.max(-100, this.awayMomentum - 2);\n        } else {\n            this.awayMomentum = Math.min(100, this.awayMomentum + 5);\n            this.homeMomentum = Math.max(-100, this.homeMomentum - 2);\n        }\n    },\n\n    onTackleWon(tacklingTeam: 'home' | 'away'): void {\n        if (tacklingTeam === 'home') {\n            this.homeMomentum = Math.min(100, this.homeMomentum + 2);\n        } else {\n            this.awayMomentum = Math.min(100, this.awayMomentum + 2);\n        }\n    },\n\n    onPassCompleted(passingTeam: 'home' | 'away'): void {\n        if (passingTeam === 'home') {\n            this.homeMomentum = Math.min(100, this.homeMomentum + 0.5);\n        } else {\n            this.awayMomentum = Math.min(100, this.awayMomentum + 0.5);\n        }\n    },\n\n    update(): void {\n        const now = Date.now();\n        const elapsed = (now - this.lastUpdate) / 1000;\n\n        if (elapsed > 5) {\n            const decayRate = 2;\n\n            if (this.homeMomentum > 0) {\n                this.homeMomentum = Math.max(0, this.homeMomentum - decayRate);\n            } else if (this.homeMomentum < 0) {\n                this.homeMomentum = Math.min(0, this.homeMomentum + decayRate);\n            }\n\n            if (this.awayMomentum > 0) {\n                this.awayMomentum = Math.max(0, this.awayMomentum - decayRate);\n            } else if (this.awayMomentum < 0) {\n                this.awayMomentum = Math.min(0, this.awayMomentum + decayRate);\n            }\n\n            this.lastUpdate = now;\n        }\n    },\n\n    reset(): void {\n        this.homeMomentum = 0;\n        this.awayMomentum = 0;\n        this.lastUpdate = Date.now();\n    }\n};\n\nexport function applyMomentumToPlayer(player: Player): void {\n    const momentumBonus = MomentumSystem.getMomentumBonus(player.isHome);\n\n    player.effectivePace = player.pace * momentumBonus;\n    player.effectiveShooting = player.shooting * momentumBonus;\n    player.effectivePassing = player.passing * momentumBonus;\n}\n\nexport function updateMomentum(): void {\n    MomentumSystem.update();\n\n    const allPlayers = [...gameState.homePlayers, ...gameState.awayPlayers];\n    allPlayers.forEach(applyMomentumToPlayer);\n}\n\nexport function renderMomentumBar(ctx: CanvasRenderingContext2D): void {\n    if (!ctx) return;\n\n    const barWidth = 300;\n    const barHeight = 20;\n    const barX = (GAME_CONFIG.PITCH_WIDTH - barWidth) / 2;\n    const barY = 10;\n\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';\n    ctx.fillRect(barX, barY, barWidth, barHeight);\n\n    const homeMomentum = Math.max(0, MomentumSystem.homeMomentum);\n    const homeMomentumWidth = (homeMomentum / 100) * (barWidth / 2);\n    ctx.fillStyle = gameState.homeJerseyColor;\n    ctx.fillRect(barX + (barWidth / 2) - homeMomentumWidth, barY, homeMomentumWidth, barHeight);\n\n    const awayMomentum = Math.max(0, MomentumSystem.awayMomentum);\n    const awayMomentumWidth = (awayMomentum / 100) * (barWidth / 2);\n    ctx.fillStyle = gameState.awayJerseyColor;\n    ctx.fillRect(barX + (barWidth / 2), barY, awayMomentumWidth, barHeight);\n\n    ctx.strokeStyle = 'white';\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo(barX + barWidth / 2, barY);\n    ctx.lineTo(barX + barWidth / 2, barY + barHeight);\n    ctx.stroke();\n\n    ctx.fillStyle = 'white';\n    ctx.font = 'bold 10px Arial';\n    ctx.textAlign = 'center';\n    ctx.fillText('MOMENTUM', barX + barWidth / 2, barY - 3);\n}\n\nexport function updateTeamStates(): void {\n    const timeSinceStateUpdate = Date.now() - (gameState.lastTeamStateUpdate || 0);\n    if (timeSinceStateUpdate < 2000) return;\n\n    gameState.lastTeamStateUpdate = Date.now();\n\n    gameState.homeTeamState = determineTeamState(true);\n    gameState.awayTeamState = determineTeamState(false);\n}\n\nexport function determineTeamState(isHome: boolean): TeamState {\n    const tactic = TACTICS[isHome ? gameState.homeTactic : gameState.awayTactic];\n\n    if (!tactic) {\n        return 'BALANCED';\n    }\n\n    const teamHasBall = gameState.ballHolder && gameState.ballHolder.isHome === isHome;\n    const timeSinceChange = Date.now() - gameState.lastPossessionChange;\n    const opponentGoalX = getAttackingGoalX(isHome, gameState.currentHalf);\n    const ballDistToOpponentGoal = gameState.ballPosition ? Math.abs(gameState.ballPosition.x - opponentGoalX) : 400;\n\n    const score = isHome ? gameState.homeScore : gameState.awayScore;\n    const opponentScore = isHome ? gameState.awayScore : gameState.homeScore;\n    const scoreDiff = score - opponentScore;\n    const timeRemaining = (gameState.currentHalf === 1 ? 45 : 90) - gameState.timeElapsed;\n\n    const teamPlayers = isHome ? gameState.homePlayers : gameState.awayPlayers;\n    const avgStamina = teamPlayers.reduce((sum, p) => sum + p.stamina, 0) / teamPlayers.length;\n\n    if (scoreDiff < 0 && timeRemaining < 10) {\n        return 'ATTACKING';\n    }\n\n    if (scoreDiff > 0 && timeRemaining < 15) {\n        return avgStamina < 40 ? 'DEFENDING' : 'BALANCED';\n    }\n\n    if (teamHasBall && timeSinceChange < 5000 && ballDistToOpponentGoal > 200 && tactic.counterAttackSpeed > 1.2) {\n        return avgStamina > 50 ? 'COUNTER_ATTACK' : 'BALANCED';\n    }\n\n    if (!teamHasBall && tactic.pressIntensity > 0.7 && ballDistToOpponentGoal < 400 && avgStamina > 60) {\n        return 'HIGH_PRESS';\n    }\n\n    if (teamHasBall && ballDistToOpponentGoal < 300) {\n        return 'ATTACKING';\n    }\n\n    if (!teamHasBall && ballDistToOpponentGoal > 500) {\n        return 'DEFENDING';\n    }\n\n    return 'BALANCED';\n}\n\nexport function handlePassAttempt(holder: Player, allPlayers: Player[]): void {\n    const teammates = allPlayers.filter(p => p.isHome === holder.isHome && p.name !== holder.name && p.role !== 'GK');\n\n    if (teammates.length === 0) {\n        return;\n    }\n\n    const passTarget = teammates[Math.floor(Math.random() * teammates.length)];\n    if (passTarget) {\n        const passDist = distance(holder, passTarget);\n        const nearbyOpponents = allPlayers.filter(p =>\n            p.isHome !== holder.isHome && distance(holder, p) < 50\n        );\n        const isUnderPressure = nearbyOpponents.length > 1;\n\n        const passSuccess = calculatePassSuccess(holder, passTarget, passDist, isUnderPressure);\n        let passSpeed = 400 + holder.passing * 3;\n\n        if (gameState.postKickOffCalmPeriod && gameState.kickOffCompletedTime) {\n            const timeSinceKickOff = Date.now() - gameState.kickOffCompletedTime;\n            if (timeSinceKickOff < 4000) {\n                passSpeed = Math.min(passSpeed, 450);\n            }\n        }\n\n        passBall(holder, holder.x, holder.y, passTarget.x, passTarget.y, passSuccess, passSpeed, false);\n        gameState.currentPassReceiver = passTarget;\n\n        const teamStats = holder.isHome ? gameState.stats.home : gameState.stats.away;\n        teamStats.passesAttempted++;\n\n        eventBus.publish(EVENT_TYPES.BALL_PASSED, {\n            passer: holder,\n            receiver: passTarget,\n            distance: distance\n        });\n    }\n}\n\nexport function resetAfterGoal(): void {\n    console.log('\uD83C\uDFAF Resetting after goal...');\n\n    gameState.shotInProgress = false;\n    gameState.shooter = null;\n    gameState.currentShotXG = null;\n    gameState.ballTrajectory = null;\n    gameState.ballChasers.clear();\n    gameState.currentPassReceiver = null;\n\n    const allPlayers = [...gameState.homePlayers, ...gameState.awayPlayers];\n    allPlayers.forEach(p => {\n        p.isChasingBall = false;\n        p.chaseStartTime = null;\n        p.speedBoost = 1.0;\n        p.targetLocked = false;\n    });\n\n    const kickOffTeam = gameState.lastGoalScorer === 'home' ? 'away' : 'home';\n\n    const goalResetDelay = GAME_LOOP.GAME_SPEED > 100 ? 0 : 3000;\n\n    setTimeout(() => {\n        if (gameState.status !== 'finished') {\n            setupKickOff(kickOffTeam);\n        }\n    }, goalResetDelay);\n}\n\nexport function switchSides(): void {\n    const allPlayers = [...gameState.homePlayers, ...gameState.awayPlayers];\n\n    allPlayers.forEach(player => {\n        const activePos = getPlayerActivePosition(player, 2);\n\n        player.x = activePos.x;\n        player.y = activePos.y;\n        player.targetX = activePos.x;\n        player.targetY = activePos.y;\n\n        player.vx = 0;\n        player.vy = 0;\n        player.hasBallControl = false;\n        player.ballReceivedTime = null;\n    });\n\n    gameState.ballPosition = { x: 400, y: 300 };\n    gameState.ballVelocity = { x: 0, y: 0 };\n    gameState.ballHeight = 0;\n    gameState.ballTrajectory = null;\n    gameState.ballHolder = null;\n    gameState.ballChasers.clear();\n\n    const tempLine = gameState.homeDefensiveLine;\n    gameState.homeDefensiveLine = 800 - gameState.awayDefensiveLine;\n    gameState.awayDefensiveLine = 800 - tempLine;\n}\n\n// ============================================================================\n// MATCH LIFECYCLE\n// ============================================================================\n\nexport function startMatch(): void {\n    console.log('START MATCH CALLED!');\n\n    try {\n        ensureStatsShape(gameState);\n        const homeTeam = selectBestTeam(gameState.homeTeam);\n        const awayTeam = selectBestTeam(gameState.awayTeam);\n\n        if (!homeTeam || !awayTeam || homeTeam.players.length < 11 || awayTeam.players.length < 11) {\n            alert('Not enough players!');\n            return;\n        }\n\n        gameState.homeFormation = homeTeam.formation;\n        gameState.awayFormation = awayTeam.formation;\n\n        if (!gameState.homeTacticManuallySet) {\n            gameState.homeTactic = selectBestTactic(homeTeam.players);\n        }\n        if (!gameState.awayTacticManuallySet) {\n            gameState.awayTactic = selectBestTactic(awayTeam.players);\n        }\n\n        selectJerseys();\n        initFirstTouchStats();\n        initOffsideStats();\n\n        const initialized = initializePlayers(\n            homeTeam.players,\n            awayTeam.players,\n            homeTeam.formation,\n            awayTeam.formation\n        );\n\n        gameState.homePlayers = initialized.home;\n        gameState.awayPlayers = initialized.away;\n\n        // Reset match state\n        gameState.status = 'intro';\n        gameState.commentary = [];\n        gameState.timeElapsed = 0;\n        gameState.currentHalf = 1;\n        gameState.homeScore = 0;\n        gameState.awayScore = 0;\n        gameState.ballPosition = { x: 400, y: 300 };\n        gameState.ballVelocity = { x: 0, y: 0 };\n        gameState.ballHeight = 0;\n        gameState.ballTrajectory = null;\n        gameState.ballHolder = null;\n        gameState.lastEventTime = Date.now();\n        gameState.particles = [];\n        gameState.ballChasers = new Set();\n        gameState.totalPasses = 0;\n        gameState.totalShots = 0;\n        gameState.shotInProgress = false;\n        gameState.shooter = null;\n        gameState.homeDefensiveLine = 200;\n        gameState.awayDefensiveLine = 600;\n        gameState.lastPossessionChange = 0;\n        gameState.currentShotXG = null;\n        gameState.currentPassReceiver = null;\n        gameState.fouls = 0;\n        gameState.yellowCards = [];\n        gameState.redCards = [];\n        gameState.lastGoalScorer = null;\n        gameState.lastTouchedBy = null;\n\n        gameState.setPieceExecuting = false;\n        gameState.lastControlAttempt = 0;\n\n        gameState.homeTeamState = 'BALANCED';\n        gameState.awayTeamState = 'BALANCED';\n        gameState.lastTeamStateUpdate = Date.now();\n        gameState.possessionChanges = 0;\n\n        lastFrameTime = 0;\n        physicsAccumulator = 0;\n        gameTime = 0;\n\n        render();\n\n        setTimeout(() => {\n            console.log('\uD83C\uDFA8 Initializing canvas layers...');\n            const success = initializeCanvasLayers();\n\n            if (success) {\n                console.log('\u2713 Canvas layers ready');\n                drawPitchBackground();\n\n                if (gameState.contexts && gameState.contexts.game) {\n                    console.log('\u2713 Rendering initial game state');\n                    renderGame();\n                }\n\n                console.log('\u2713 Starting intro rendering');\n                animationFrameId = requestAnimationFrame(introRenderLoop);\n            } else {\n                console.error('\u2717 Failed to initialize canvas layers');\n                alert('Error: Canvas initialization failed. Please refresh the page.');\n            }\n        }, 150);\n\n        setTimeout(() => {\n            setupKickOff('home');\n\n            gameState.commentary = [{\n                text: `\u26BD ${gameState.homeTeam} (${homeTeam.formation}, ${TACTICS[gameState.homeTactic]?.name || 'Unknown'}) vs ${gameState.awayTeam} (${awayTeam.formation}, ${TACTICS[gameState.awayTactic]?.name || 'Unknown'}) - KICK OFF!`,\n                type: 'goal'\n            }];\n\n            updateGameUI();\n\n            if (animationFrameId) cancelAnimationFrame(animationFrameId);\n\n            lastFrameTime = 0;\n            physicsAccumulator = 0;\n            gameTime = 0;\n\n            console.log('\uD83C\uDFAE Starting V2 game loop...');\n\n            animationFrameId = requestAnimationFrame(gameLoop_V2);\n\n            eventBus.publish(EVENT_TYPES.MATCH_START, {\n                homeTeam: gameState.homeTeam,\n                awayTeam: gameState.awayTeam\n            });\n\n        }, 3000);\n\n        const realTimeInterval = 100;\n        const timeIncrementPerInterval = GAME_LOOP.GAME_SPEED * (realTimeInterval / 1000);\n\n        gameIntervalId = window.setInterval(() => {\n\n            if (gameState.status === 'playing') {\n                gameState.timeElapsed += timeIncrementPerInterval;\n            }\n\n            updateMatchStats();\n\n            if (gameState.timeElapsed >= 45 && gameState.currentHalf === 1) {\n                handleHalfTime();\n                return;\n            }\n\n            if (gameState.timeElapsed >= 90 && gameState.status !== 'finished') {\n                handleFullTime();\n                return;\n            }\n\n            if (GAME_LOOP.GAME_SPEED <= 100) {\n                if (typeof updateGameUI === 'function') updateGameUI();\n            }\n\n        }, realTimeInterval);\n\n    } catch (error) {\n        console.error('ERROR IN START MATCH:', error);\n    }\n}\n\nexport function debugBallState(): void {\n    if (gameState.status === 'playing') {\n        const ballSpeed = Math.sqrt(\n            gameState.ballVelocity.x ** 2 + gameState.ballVelocity.y ** 2\n        );\n\n        if (ballSpeed < 1 && !gameState.ballHolder && !gameState.ballTrajectory) {\n            console.log('\u26A0\uFE0F BALL APPEARS STUCK:', {\n                position: gameState.ballPosition,\n                velocity: gameState.ballVelocity,\n                chasers: gameState.ballChasers.size,\n                holder: null\n            });\n        }\n    }\n}\n\nsetInterval(debugBallState, 1000);\n\nexport function introRenderLoop(_timestamp: number): void {\n    if (gameState.status !== 'intro') {\n        return;\n    }\n\n    if (!gameState.contexts || !gameState.contexts.game) {\n        animationFrameId = requestAnimationFrame(introRenderLoop);\n        return;\n    }\n\n    renderGame();\n    animationFrameId = requestAnimationFrame(introRenderLoop);\n}\n\nexport function handleHalfTime(): void {\n    if (gameState.status === 'halftime') {\n        return;\n    }\n\n    gameState.status = 'halftime';\n    gameState.commentary.push({ text: '\u23F8\uFE0F HALF TIME!', type: 'goal' });\n    updateGameUI();\n\n    if (animationFrameId) {\n        cancelAnimationFrame(animationFrameId);\n        animationFrameId = null;\n    }\n\n    eventBus.publish(EVENT_TYPES.HALF_TIME, {\n        homeScore: gameState.homeScore,\n        awayScore: gameState.awayScore\n    });\n\n    const halftimeDelay = GAME_LOOP.GAME_SPEED > 100 ? 0 : 5000;\n\n    setTimeout(() => {\n        switchSides();\n        gameState.currentHalf = 2;\n        gameState.timeElapsed = 45;\n\n        setupKickOff('away');\n\n        if (gameState.setPiece && gameState.setPiece.type === 'KICK_OFF') {\n            gameState.setPiece.executionTime = Date.now() + 2000;\n        }\n\n        gameState.commentary.push({ text: '\u25B6\uFE0F Second half begins!', type: 'goal' });\n\n        if (GAME_LOOP.GAME_SPEED <= 100) {\n            if (typeof updateGameUI === 'function') updateGameUI();\n        }\n\n        lastFrameTime = 0;\n        physicsAccumulator = 0;\n\n        animationFrameId = requestAnimationFrame(gameLoop_V2);\n    }, halftimeDelay);\n}\n\nexport function handleFullTime(): void {\n    gameState.status = 'finished';\n    if (gameIntervalId) clearInterval(gameIntervalId);\n\n    const winner = gameState.homeScore > gameState.awayScore ? gameState.homeTeam :\n                 gameState.awayScore > gameState.homeScore ? gameState.awayTeam : 'Draw';\n    gameState.commentary.push(\n        { text: `\uD83C\uDFC1 FULL TIME! ${gameState.homeScore} - ${gameState.awayScore}`, type: 'goal' },\n        { text: winner === 'Draw' ? '\uD83E\uDD1D Match ends in a draw!' : `\uD83C\uDFC6 ${winner} WINS!`, type: 'goal' }\n    );\n\n    eventBus.publish(EVENT_TYPES.MATCH_END, {\n        homeScore: gameState.homeScore,\n        awayScore: gameState.awayScore,\n        winner: winner\n    });\n\n    render();\n}\n\nexport function resetMatch(): void {\n    if (gameIntervalId) clearInterval(gameIntervalId);\n    if (animationFrameId) cancelAnimationFrame(animationFrameId);\n\n    eventBus.clear();\n\n    gameState.status = 'setup';\n    gameState.timeElapsed = 0;\n    gameState.currentHalf = 1;\n    gameState.homeScore = 0;\n    gameState.awayScore = 0;\n    gameState.commentary = [];\n    gameState.ballPosition = { x: 400, y: 300 };\n    gameState.ballVelocity = { x: 0, y: 0 };\n    gameState.ballHeight = 0;\n    gameState.ballTrajectory = null;\n    gameState.ballHolder = null;\n    gameState.particles = [];\n    gameState.ballChasers = new Set();\n    gameState.totalPasses = 0;\n    gameState.totalShots = 0;\n    gameState.shotInProgress = false;\n    gameState.shooter = null;\n    gameState.homeDefensiveLine = 200;\n    gameState.awayDefensiveLine = 600;\n    gameState.lastPossessionChange = 0;\n    gameState.homeTactic = 'balanced';\n    gameState.awayTactic = 'balanced';\n    gameState.currentShotXG = null;\n    gameState.currentPassReceiver = null;\n    gameState.fouls = 0;\n    gameState.yellowCards = [];\n    gameState.redCards = [];\n    gameState.lastGoalScorer = null;\n    gameState.goalEvents = [];\n    gameState.cardEvents = [];\n    gameState.backgroundDrawn = false;\n    gameState.gameUIDisplayed = false;\n    gameState.summaryDrawn = false;\n\n    gameState.homeTeamState = 'BALANCED';\n    gameState.awayTeamState = 'BALANCED';\n    gameState.lastTeamStateUpdate = Date.now();\n    gameState.possessionChanges = 0;\n\n    lastFrameTime = 0;\n    physicsAccumulator = 0;\n    gameTime = 0;\n\n    gameState.stats = {\n        home: {\n            possession: 0,\n            possessionTime: 0,\n            passesCompleted: 0,\n            passesAttempted: 0,\n            shotsOnTarget: 0,\n            shotsOffTarget: 0,\n            tackles: 0,\n            interceptions: 0,\n            saves: 0,\n            xGTotal: 0\n        },\n        away: {\n            possession: 0,\n            possessionTime: 0,\n            passesCompleted: 0,\n            passesAttempted: 0,\n            shotsOnTarget: 0,\n            shotsOffTarget: 0,\n            tackles: 0,\n            interceptions: 0,\n            saves: 0,\n            xGTotal: 0\n        },\n        possession: { home: 50, away: 50 },\n        possessionTimer: { home: 0, away: 0 },\n        lastPossessionUpdate: Date.now()\n    };\n    pendingGameEvents = [];\n\n    render();\n}\n\n// ============================================================================\n// DOM READY INITIALIZATION\n// ============================================================================\n\nif (typeof document !== 'undefined') {\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', function() {\n            render();\n        });\n    } else {\n        render();\n    }\n}\n", "/**\r\n * Goalkeeper AI System - TypeScript Migration\r\n *\r\n * Handles all goalkeeper-specific behavior:\r\n * - Positioning and stance management\r\n * - Threat assessment and reaction\r\n * - Sweeping and crossing\r\n * - Save mechanics and animations\r\n * - Advanced save probability calculation\r\n *\r\n * @module ai/goalkeeper\r\n * @migrated-from js/ai/aigoalkeeper.js\r\n */\r\n\r\nimport type { Player, Vector2D } from '../types';\r\nimport { distance } from '../utils/math';\r\nimport { getAttackingGoalX } from '../utils/ui';\r\nimport { eventBus } from '../eventBus';\r\nimport { EVENT_TYPES } from '../types/events';\r\nimport { Particle, createGoalExplosion } from '../rendering/particles';\r\nimport { showGoalAnimation } from '../ui/goalAnimation';\r\nimport { resetAfterGoal } from '../main';\r\nimport { gameState } from '../globalExports';\r\nimport { GAME_CONFIG } from '../config';\r\n\r\n// ============================================================================\r\n// TYPE DEFINITIONS\r\n// ============================================================================\r\n\r\ninterface GoalkeeperConfig {\r\n  BASE_POSITION_RATIO: number;\r\n  THREAT_ADVANCE_MAX: number;\r\n  ANGLE_CUT_RATIO: number;\r\n  STANCES: {\r\n    [key: string]: GoalkeeperStance;\r\n  };\r\n  DANGER_ZONE_DISTANCE: number;\r\n  IMMEDIATE_THREAT_DISTANCE: number;\r\n  ONE_ON_ONE_DISTANCE: number;\r\n  SWEEPER_DISTANCE: number;\r\n  THROUGH_BALL_INTERCEPT_RANGE: number;\r\n  GOAL_CENTER_Y: number;\r\n  GOAL_WIDTH: number;\r\n  REACTION_TIME: number;\r\n  CROSS_CLAIM_RANGE: number;\r\n  CROSS_PUNCH_RANGE: number;\r\n}\r\n\r\ninterface GoalkeeperStance {\r\n  name: string;\r\n  saveBonus: number;\r\n  mobilityPenalty: number;\r\n  description: string;\r\n}\r\n\r\ninterface ThreatInfo {\r\n  player: Player;\r\n  score: number;\r\n  distToGoal: number;\r\n  distToGK: number;\r\n  hasBall: boolean;\r\n  angleToGoal: number;\r\n}\r\n\r\ninterface CrossAction {\r\n  action: 'claim' | 'punch';\r\n  targetX: number;\r\n  targetY: number;\r\n  successChance: number;\r\n}\r\n\r\ninterface ShotResolution {\r\n  holder: Player;\r\n  xG: number;\r\n  goalkeeper: Player;\r\n  goalX: number;\r\n  shotTargetY: number;\r\n}\r\n\r\n// ============================================================================\r\n// CONFIGURATION\r\n// ============================================================================\r\n\r\nexport const GOALKEEPER_CONFIG: GoalkeeperConfig = {\r\n  // Positioning parameters\r\n  BASE_POSITION_RATIO: 0.05,        // How far from goal line (5%)\r\n  THREAT_ADVANCE_MAX: 50,            // Max distance to advance (pixels)\r\n  ANGLE_CUT_RATIO: 0.3,              // How much to advance toward ball\r\n\r\n  // Stance types and their effects\r\n  STANCES: {\r\n    COMFORTABLE: {\r\n      name: 'comfortable',\r\n      saveBonus: 0,\r\n      mobilityPenalty: 0,\r\n      description: 'No immediate threat'\r\n    },\r\n    READY: {\r\n      name: 'ready',\r\n      saveBonus: 0.05,\r\n      mobilityPenalty: 0.1,\r\n      description: 'Threat nearby, ready to react'\r\n    },\r\n    SET: {\r\n      name: 'set',\r\n      saveBonus: 0.15,\r\n      mobilityPenalty: 0.3,\r\n      description: 'Shot imminent, set position'\r\n    },\r\n    ADVANCING: {\r\n      name: 'advancing',\r\n      saveBonus: 0.10,\r\n      mobilityPenalty: 0,\r\n      description: 'Coming out to narrow angle'\r\n    },\r\n    ONE_ON_ONE: {\r\n      name: 'oneOnOne',\r\n      saveBonus: 0.20,\r\n      mobilityPenalty: 0.5,\r\n      description: 'Making self big for 1v1'\r\n    }\r\n  },\r\n\r\n  // Threat assessment\r\n  DANGER_ZONE_DISTANCE: 280,         // Distance considered dangerous\r\n  IMMEDIATE_THREAT_DISTANCE: 150,    // Distance for \"set\" stance\r\n  ONE_ON_ONE_DISTANCE: 80,           // Distance for 1v1 stance\r\n\r\n  // Sweeping behavior\r\n  SWEEPER_DISTANCE: 120,             // Max distance to sweep\r\n  THROUGH_BALL_INTERCEPT_RANGE: 200, // Range to intercept through balls\r\n\r\n  // Save positioning\r\n  GOAL_CENTER_Y: 300,\r\n  GOAL_WIDTH: 120,                   // GOAL_Y_BOTTOM - GOAL_Y_TOP\r\n  REACTION_TIME: 200,                // ms to react to shot\r\n\r\n  // Cross handling\r\n  CROSS_CLAIM_RANGE: 80,             // Range to claim crosses\r\n  CROSS_PUNCH_RANGE: 120             // Range to punch if can't claim\r\n};\r\n\r\n// ============================================================================\r\n// HELPER FUNCTIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Safe distance calculation wrapper\r\n */\r\nfunction getDistance(p1: Vector2D | Player, p2: Vector2D | Player): number {\r\n  return distance(p1, p2);\r\n}\r\n\r\n// getAttackingGoalX is now imported from '../utils/ui'\r\n\r\n// ============================================================================\r\n// THREAT ASSESSMENT\r\n// ============================================================================\r\n\r\n/**\r\n * Assess threats to goalkeeper\r\n *\r\n * Evaluates opponents based on:\r\n * - Distance to goal\r\n * - Angle quality\r\n * - Ball possession\r\n * - Player role (attackers prioritized)\r\n */\r\nexport function assessGoalkeeperThreats(\r\n  goalkeeper: Player,\r\n  _ball: Vector2D,\r\n  opponents: Player[]\r\n): ThreatInfo[] {\r\n  // Using imported gameState from globalExports\r\n  const goalX = getAttackingGoalX(!goalkeeper.isHome, gameState.currentHalf);\r\n\r\n  const threats = opponents\r\n    .filter(opp => opp.role !== 'GK')\r\n    .map(opp => {\r\n      const distToGoal = Math.abs(opp.x - goalX);\r\n      const distToGK = getDistance(goalkeeper, opp);\r\n      const angleToGoal = Math.abs(opp.y - GOALKEEPER_CONFIG.GOAL_CENTER_Y);\r\n      const hasBall = gameState.ballHolder?.id === opp.id;\r\n\r\n      let threatScore = 0;\r\n\r\n      if (distToGoal < GOALKEEPER_CONFIG.DANGER_ZONE_DISTANCE) {\r\n        threatScore += (1 - distToGoal / GOALKEEPER_CONFIG.DANGER_ZONE_DISTANCE) * 50;\r\n      }\r\n\r\n      const angleQuality = 1 - (angleToGoal / (GOALKEEPER_CONFIG.GOAL_WIDTH / 2));\r\n      threatScore += angleQuality * 30;\r\n\r\n      if (hasBall) {\r\n        threatScore += 40;\r\n      }\r\n\r\n      if (opp.role === 'ST' || opp.role === 'RW' || opp.role === 'LW') {\r\n        threatScore += 10;\r\n      }\r\n\r\n      return {\r\n        player: opp,\r\n        score: threatScore,\r\n        distToGoal: distToGoal,\r\n        distToGK: distToGK,\r\n        hasBall: hasBall,\r\n        angleToGoal: angleToGoal\r\n      };\r\n    })\r\n    .filter(threat => threat.score > 20)\r\n    .sort((a, b) => b.score - a.score);\r\n\r\n  return threats;\r\n}\r\n\r\n// ============================================================================\r\n// GOALKEEPER STANCE\r\n// ============================================================================\r\n\r\n/**\r\n * Determine goalkeeper's stance based on threat level\r\n */\r\nexport function determineGoalkeeperStance(\r\n  _goalkeeper: Player,\r\n  mainThreat: ThreatInfo | null,\r\n  threats: ThreatInfo[],\r\n  _ball: Vector2D\r\n): GoalkeeperStance {\r\n  // Using imported gameState from globalExports\r\n\r\n  if (!mainThreat) {\r\n    return GOALKEEPER_CONFIG.STANCES['COMFORTABLE']!;\r\n  }\r\n\r\n  // 1v1 situation?\r\n  if (mainThreat.hasBall &&\r\n    mainThreat.distToGoal < GOALKEEPER_CONFIG.ONE_ON_ONE_DISTANCE &&\r\n    threats.length === 1) {\r\n    return GOALKEEPER_CONFIG.STANCES['ONE_ON_ONE']!;\r\n  }\r\n\r\n  // Imminent shot?\r\n  if (mainThreat.hasBall &&\r\n    mainThreat.distToGoal < GOALKEEPER_CONFIG.IMMEDIATE_THREAT_DISTANCE) {\r\n    return GOALKEEPER_CONFIG.STANCES['SET']!;\r\n  }\r\n\r\n  // Ball in air (cross/high ball)?\r\n  if (gameState.ballHeight > 0.5) {\r\n    return GOALKEEPER_CONFIG.STANCES['ADVANCING']!;\r\n  }\r\n\r\n  // General danger?\r\n  if (mainThreat.distToGoal < GOALKEEPER_CONFIG.DANGER_ZONE_DISTANCE) {\r\n    return GOALKEEPER_CONFIG.STANCES['READY']!;\r\n  }\r\n\r\n  return GOALKEEPER_CONFIG.STANCES['COMFORTABLE']!;\r\n}\r\n\r\n// ============================================================================\r\n// POSITIONING\r\n// ============================================================================\r\n\r\n/**\r\n * Calculate optimal goalkeeper position\r\n */\r\nexport function calculateOptimalGoalkeeperPosition(\r\n  goalkeeper: Player,\r\n  mainThreat: ThreatInfo | null,\r\n  stance: GoalkeeperStance,\r\n  ball: Vector2D\r\n): Vector2D {\r\n  // Using imported gameState from globalExports\r\n  // Using imported GAME_CONFIG from config\r\n  const goalX = getAttackingGoalX(!goalkeeper.isHome, gameState.currentHalf);\r\n  const goalCenterY = GOALKEEPER_CONFIG.GOAL_CENTER_Y;\r\n\r\n  // IMPROVED CORNER POSITIONING\r\n  if (gameState.status === 'CORNER_KICK' && gameState.setPiece) {\r\n    const cornerY = (gameState.setPiece as any).position.y;\r\n\r\n    const realStats = (goalkeeper as any).realStats || {};\r\n    const sweeperRating = realStats.gkKeeperSweeper || 5;\r\n    const aggressionFactor = sweeperRating / 10; // 0.5 to 1.0\r\n\r\n    const allPlayers = [...gameState.homePlayers, ...gameState.awayPlayers];\r\n    const attackersInBox = allPlayers\r\n      .filter(p => p.isHome !== goalkeeper.isHome && Math.abs(p.x - goalX) < 120)\r\n      .length;\r\n\r\n    // More attackers = stay closer to goal line\r\n    const crowdingPenalty = Math.min(attackersInBox * 0.1, 0.3);\r\n\r\n    // FIXED: Better positioning calculation\r\n    const baseShift = (cornerY - goalCenterY) * (0.25 + aggressionFactor * 0.15 - crowdingPenalty);\r\n\r\n    // FIXED: Consider corner side more carefully\r\n    const isNearPost = (cornerY < goalCenterY && cornerY < 250) || (cornerY > goalCenterY && cornerY > 350);\r\n    const postAdjustment = isNearPost ? 0 : 10;\r\n\r\n    let targetY = goalCenterY + baseShift + (cornerY > goalCenterY ? postAdjustment : -postAdjustment);\r\n\r\n    // FIXED: Ensure keeper stays within reasonable bounds\r\n    const minY = (GAME_CONFIG as any).GOAL_Y_TOP + 25;\r\n    const maxY = (GAME_CONFIG as any).GOAL_Y_BOTTOM - 25;\r\n    targetY = Math.max(minY, Math.min(maxY, targetY));\r\n\r\n    // FIXED: Slight forward positioning for corners\r\n    const forwardOffset = Math.sign(400 - goalX) * (2 + aggressionFactor * 3);\r\n\r\n    console.log(`\u26BD ${goalkeeper.name} corner positioning: Y=${targetY.toFixed(0)} (aggression: ${aggressionFactor.toFixed(2)}, attackers: ${attackersInBox})`);\r\n\r\n    return {\r\n      x: goalX + forwardOffset,\r\n      y: targetY\r\n    };\r\n  }\r\n\r\n  // Original positioning logic for non-corner situations\r\n  if (!mainThreat) {\r\n    return {\r\n      x: goalX + (ball.x - goalX) * GOALKEEPER_CONFIG.BASE_POSITION_RATIO,\r\n      y: goalCenterY + (ball.y - goalCenterY) * 0.15\r\n    };\r\n  }\r\n\r\n  const threat = mainThreat.player;\r\n\r\n  // Angle cutting logic\r\n  const vectorX = threat.x - goalX;\r\n  const vectorY = threat.y - goalCenterY;\r\n  const vectorLength = Math.sqrt(vectorX * vectorX + vectorY * vectorY);\r\n\r\n  if (vectorLength === 0) {\r\n    return { x: goalX, y: goalCenterY };\r\n  }\r\n\r\n  const normX = vectorX / vectorLength;\r\n  const normY = vectorY / vectorLength;\r\n\r\n  const realStats = (goalkeeper as any).realStats || {};\r\n  const sweeperAbility = realStats.gkKeeperSweeper || 0;\r\n  const sweeperModifier = sweeperAbility * 0.3;\r\n\r\n  let advanceDistance = GOALKEEPER_CONFIG.THREAT_ADVANCE_MAX;\r\n\r\n  switch (stance.name) {\r\n    case 'oneOnOne':\r\n      advanceDistance = Math.min(mainThreat.distToGK * 0.5, 80);\r\n      break;\r\n    case 'set':\r\n      advanceDistance = 25;\r\n      break;\r\n    case 'advancing':\r\n      advanceDistance = 60 + sweeperModifier * 20;\r\n      break;\r\n    case 'ready':\r\n      advanceDistance = 35 + sweeperModifier * 15;\r\n      break;\r\n    case 'comfortable':\r\n      advanceDistance = 15;\r\n      break;\r\n  }\r\n\r\n  const targetX = goalX + normX * advanceDistance;\r\n  const targetY = goalCenterY + normY * (advanceDistance * 0.6);\r\n\r\n  const goalTop = (GAME_CONFIG as any).GOAL_Y_TOP;\r\n  const goalBottom = (GAME_CONFIG as any).GOAL_Y_BOTTOM;\r\n\r\n  // FIXED: Better X constraint\r\n  const isLeftGoal = goalX < 400;\r\n  const constrainedX = isLeftGoal ?\r\n    Math.max(goalX - 5, Math.min(goalX + advanceDistance + 10, targetX)) :\r\n    Math.max(goalX - advanceDistance - 10, Math.min(goalX + 5, targetX));\r\n\r\n  const constrainedY = Math.max(goalTop + 10, Math.min(goalBottom - 10, targetY));\r\n\r\n  return {\r\n    x: constrainedX,\r\n    y: constrainedY\r\n  };\r\n}\r\n\r\n// ============================================================================\r\n// SWEEPING LOGIC\r\n// ============================================================================\r\n\r\n/**\r\n * Determine if goalkeeper should sweep (come out for through ball)\r\n */\r\nexport function shouldGoalkeeperSweep(\r\n  goalkeeper: Player,\r\n  _ball: Vector2D,\r\n  opponents: Player[]\r\n): boolean {\r\n  // Using imported gameState from globalExports\r\n\r\n  // Is ball trajectory heading toward goal?\r\n  if (!gameState.ballTrajectory || gameState.ballTrajectory.isShot) {\r\n    return false;\r\n  }\r\n\r\n  const goalX = getAttackingGoalX(!goalkeeper.isHome, gameState.currentHalf);\r\n  const traj = gameState.ballTrajectory;\r\n\r\n  // Ball heading toward goal area?\r\n  const ballHeadingToGoal = Math.abs(traj.endX - goalX) < GOALKEEPER_CONFIG.SWEEPER_DISTANCE;\r\n\r\n  if (!ballHeadingToGoal) {\r\n    return false;\r\n  }\r\n\r\n  // Is an attacker chasing it?\r\n  const attackersChasingBall = opponents.filter(opp => {\r\n    const distToBallTarget = Math.sqrt(\r\n      Math.pow(opp.x - traj.endX, 2) +\r\n      Math.pow(opp.y - traj.endY, 2)\r\n    );\r\n    return distToBallTarget < 100 && opp.role !== 'GK';\r\n  });\r\n\r\n  if (attackersChasingBall.length === 0) {\r\n    return false;\r\n  }\r\n\r\n  // Can keeper get there first?\r\n  const keeperDistToBall = getDistance(goalkeeper, { x: traj.endX, y: traj.endY });\r\n  const attackerDistToBall = Math.min(...attackersChasingBall.map(att =>\r\n    getDistance(att, { x: traj.endX, y: traj.endY })\r\n  ));\r\n\r\n  // Sweeper ability affects decision\r\n  const realStats = (goalkeeper as any).realStats || {};\r\n  const sweeperConfidence = (realStats.gkKeeperSweeper || 0) / 10;\r\n\r\n  // Keeper should sweep if they can get there first (with safety margin)\r\n  return keeperDistToBall < (attackerDistToBall * (1.1 - sweeperConfidence * 0.1));\r\n}\r\n\r\n/**\r\n * Handle cross situations\r\n */\r\nexport function handleCrossSituation(\r\n  goalkeeper: Player,\r\n  _ball: Vector2D,\r\n  _opponents: Player[]\r\n): CrossAction | null {\r\n  // Using imported gameState from globalExports\r\n\r\n  // Is it a cross? (high ball in wide position)\r\n  if (!gameState.ballHeight || gameState.ballHeight < 0.5) {\r\n    return null;\r\n  }\r\n\r\n  if (!gameState.ballTrajectory) {\r\n    return null;\r\n  }\r\n\r\n  const traj = gameState.ballTrajectory;\r\n  const goalCenterY = GOALKEEPER_CONFIG.GOAL_CENTER_Y;\r\n\r\n  // Is ball crossing toward goal area?\r\n  const isCrossing = Math.abs(traj.endY - goalCenterY) < 150 &&\r\n    Math.abs(traj.startY - traj.endY) > 100;\r\n\r\n  if (!isCrossing) {\r\n    return null;\r\n  }\r\n\r\n  // Can keeper claim it?\r\n  const distToBall = getDistance(goalkeeper, { x: traj.endX, y: traj.endY });\r\n\r\n  const realStats = (goalkeeper as any).realStats || {};\r\n  const aerialAbility = realStats.aerialsWonPercent || 50;\r\n\r\n  if (distToBall < GOALKEEPER_CONFIG.CROSS_CLAIM_RANGE) {\r\n    // Attempt to claim\r\n    return {\r\n      action: 'claim',\r\n      targetX: traj.endX,\r\n      targetY: traj.endY,\r\n      successChance: (aerialAbility / 100) * 0.85\r\n    };\r\n  } else if (distToBall < GOALKEEPER_CONFIG.CROSS_PUNCH_RANGE) {\r\n    // Punch clear\r\n    return {\r\n      action: 'punch',\r\n      targetX: traj.endX,\r\n      targetY: traj.endY,\r\n      successChance: (aerialAbility / 100) * 0.95\r\n    };\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n// ============================================================================\r\n// MAIN GOALKEEPER AI\r\n// ============================================================================\r\n\r\n/**\r\n * Update goalkeeper AI (advanced system)\r\n *\r\n * Main entry point for goalkeeper behavior\r\n */\r\nexport function updateGoalkeeperAI_Advanced(\r\n  goalkeeper: Player,\r\n  ball: Vector2D,\r\n  opponents: Player[]\r\n): void {\r\n  // Using imported gameState from globalExports\r\n\r\n  const threats = assessGoalkeeperThreats(goalkeeper, ball, opponents);\r\n  const mainThreat = threats[0] || null;\r\n\r\n  const stance = determineGoalkeeperStance(goalkeeper, mainThreat, threats, ball);\r\n  (goalkeeper as any).stance = stance.name;\r\n  (goalkeeper as any).stanceSaveBonus = stance.saveBonus;\r\n  (goalkeeper as any).stanceMobilityPenalty = stance.mobilityPenalty;\r\n\r\n  if (shouldGoalkeeperSweep(goalkeeper, ball, opponents)) {\r\n    const traj = gameState.ballTrajectory;\r\n    if (traj) {\r\n      goalkeeper.targetX = traj.endX;\r\n      goalkeeper.targetY = traj.endY;\r\n      (goalkeeper as any).speedBoost = 1.3;\r\n      (goalkeeper as any).isSweeping = true;\r\n      console.log(`\uD83C\uDFC3 ${goalkeeper.name} sweeping!`);\r\n      return;\r\n    }\r\n  }\r\n\r\n  const crossAction = handleCrossSituation(goalkeeper, ball, opponents);\r\n  if (crossAction) {\r\n    goalkeeper.targetX = crossAction.targetX;\r\n    goalkeeper.targetY = crossAction.targetY;\r\n    (goalkeeper as any).speedBoost = 1.2;\r\n    (goalkeeper as any).isClaimingCross = true;\r\n    (goalkeeper as any).crossClaimStartTime = Date.now();\r\n    console.log(`\uD83D\uDE4C ${goalkeeper.name} going for cross!`);\r\n\r\n    const claimStartTime = Date.now();\r\n    const expectedDuration = gameState.ballTrajectory ? gameState.ballTrajectory.duration * 0.8 : 500;\r\n\r\n    setTimeout(() => {\r\n      // Validate game state hasn't changed\r\n      if (gameState.status === 'finished' || gameState.status === 'goal_scored') {\r\n        return;\r\n      }\r\n\r\n      // Check if goalkeeper is still claiming and close enough\r\n      if ((goalkeeper as any).isClaimingCross &&\r\n          (goalkeeper as any).crossClaimStartTime === claimStartTime &&\r\n          getDistance(goalkeeper, gameState.ballPosition) < 40) {\r\n        if (Math.random() < crossAction.successChance) {\r\n          gameState.ballHolder = goalkeeper;\r\n          goalkeeper.hasBallControl = true;\r\n          gameState.ballTrajectory = null;\r\n          (goalkeeper as any).ballReceivedTime = Date.now();\r\n          console.log(`\u2705 ${goalkeeper.name} claims the cross!`);\r\n        } else {\r\n          console.log(`\u274C ${goalkeeper.name} missed the cross!`);\r\n        }\r\n      }\r\n      (goalkeeper as any).isClaimingCross = false;\r\n    }, expectedDuration);\r\n\r\n    return;\r\n  }\r\n\r\n  const optimalPosition = calculateOptimalGoalkeeperPosition(\r\n    goalkeeper,\r\n    mainThreat,\r\n    stance,\r\n    ball\r\n  );\r\n\r\n  goalkeeper.targetX = optimalPosition.x;\r\n  goalkeeper.targetY = optimalPosition.y;\r\n\r\n  (goalkeeper as any).speedBoost = 1.0 - stance.mobilityPenalty;\r\n\r\n  (goalkeeper as any).currentMainThreat = mainThreat;\r\n  (goalkeeper as any).threatCount = threats.length;\r\n\r\n  (goalkeeper as any).isSweeping = false;\r\n  (goalkeeper as any).isClaimingCross = false;\r\n}\r\n\r\n// ============================================================================\r\n// SAVE PROBABILITY\r\n// ============================================================================\r\n\r\n/**\r\n * Calculate advanced save probability\r\n *\r\n * Factors in:\r\n * - Goalkeeper ability (skill, rating, real stats)\r\n * - Shooter quality\r\n * - Positioning and stance\r\n * - Shot difficulty (placement)\r\n * - xG value\r\n */\r\nexport function calculateSaveProbability_Advanced(\r\n  xG: number,\r\n  goalkeeper: Player | null,\r\n  shotTargetY: number,\r\n  shooter?: Player\r\n): number {\r\n  if (!goalkeeper) return 0.3;\r\n\r\n  // ============= GOALKEEPER BASE ABILITY =============\r\n\r\n  const gkSkill = goalkeeper.goalkeeping / 100; // 0.6\u20131.0 typically\r\n  const gkRatingNorm = (goalkeeper.rating - 6.0) / 4.0; // Normalize 6\u201310 \u2192 0\u20131\r\n  const baseAbility = (gkSkill * 0.7) + (gkRatingNorm * 0.3);\r\n\r\n  const realStats = (goalkeeper as any).realStats || {};\r\n  const savePercentBonus = realStats.gkSavePercent ? (realStats.gkSavePercent / 100) * 0.30 : 0;\r\n  const reflexBonus = (goalkeeper.pace / 100) * 0.20;\r\n  const consistencyBonus = (realStats.gkGoalsPrevented || 0) * 0.01; // each prevented goal = +1%\r\n  const experienceBonus = (goalkeeper.rating > 7.0 ? 0.05 : 0);\r\n\r\n  // ============= SHOOTER QUALITY EFFECT =============\r\n\r\n  let attackerEffect = 1.0; // Neutral by default\r\n  if (shooter) {\r\n    const rs = (shooter as any).realStats || {};\r\n\r\n    // Key offensive metrics\r\n    const finisherSkill = (shooter.shooting || 60) / 100; // base\r\n    const dribbleQuality = (shooter.dribbling || 60) / 100;\r\n    const xGOTFactor = Math.min(1, (rs.xGOT || 0.3)); // expected goals on target\r\n    const shotAccuracy = rs.shotsOnTarget && rs.shots ? (rs.shotsOnTarget / rs.shots) : 0.4;\r\n\r\n    // Combine offensive efficiency\r\n    const finishingPower = (\r\n      finisherSkill * 0.5 +\r\n      dribbleQuality * 0.2 +\r\n      shotAccuracy * 0.2 +\r\n      xGOTFactor * 0.1\r\n    );\r\n\r\n    // Balance vs GK\r\n    const relativeGap = finishingPower - baseAbility;\r\n\r\n    // Adjust save chance (strong attacker = less save chance)\r\n    attackerEffect = 1 - (relativeGap * 0.5);\r\n    attackerEffect = Math.max(0.6, Math.min(1.4, attackerEffect));\r\n  }\r\n\r\n  // ============= POSITIONING & STANCE =============\r\n\r\n  const goalCenterY = 300;\r\n  const distanceToShot = Math.abs(goalkeeper.y - shotTargetY);\r\n  const maxReach = 120;\r\n  const reachRatio = Math.max(0, 1 - (distanceToShot / maxReach));\r\n\r\n  const stanceBonus = (goalkeeper as any).stanceSaveBonus || 0;\r\n  const anticipationBonus = ((goalkeeper as any).stance === 'set' || (goalkeeper as any).stance === 'ready') ? 0.10 : 0;\r\n\r\n  // ============= SHOT DIFFICULTY =============\r\n\r\n  const goalHeight = 120;\r\n  const placementDifficulty = Math.abs(shotTargetY - goalCenterY) / (goalHeight / 2);\r\n\r\n  // ============= BASE SAVE CHANCE =============\r\n\r\n  let saveProbability = 1 - xG;\r\n  const abilityMultiplier = (baseAbility + savePercentBonus + reflexBonus + consistencyBonus + experienceBonus) * 1.8;\r\n  saveProbability *= abilityMultiplier;\r\n\r\n  const positioningMultiplier = 0.3 + (reachRatio * 0.7);\r\n  saveProbability *= positioningMultiplier;\r\n  saveProbability += stanceBonus + anticipationBonus;\r\n\r\n  // Placement bonus (central shots easier)\r\n  if (placementDifficulty < 0.3) saveProbability += 0.25;\r\n  else if (placementDifficulty < 0.6) saveProbability += 0.15;\r\n\r\n  // Apply attacker vs GK effect\r\n  saveProbability *= attackerEffect;\r\n\r\n  // ============= REALISTIC BOUNDS =============\r\n\r\n  saveProbability = Math.max(0.10, Math.min(0.93, saveProbability));\r\n\r\n  // Low xG shots are usually saved\r\n  if (xG < 0.15) saveProbability = Math.max(saveProbability, 0.75);\r\n\r\n  console.log(\r\n    `SAVE%: ${(saveProbability * 100).toFixed(0)} | xG:${(xG * 100).toFixed(0)} | GK:${(baseAbility * 100).toFixed(0)} | ShooterAdj:${(attackerEffect * 100).toFixed(0)}%`\r\n  );\r\n\r\n  return saveProbability;\r\n}\r\n\r\n// ============================================================================\r\n// SAVE ANIMATION\r\n// ============================================================================\r\n\r\n/**\r\n * Trigger goalkeeper save animation\r\n */\r\nexport function triggerGoalkeeperSave(\r\n  goalkeeper: Player,\r\n  shotX: number,\r\n  shotY: number,\r\n  saveProbability: number = 0.5\r\n): void {\r\n  if (!goalkeeper) return;\r\n\r\n  // Using imported gameState from globalExports\r\n\r\n  // --- BASIC DIVE SETUP ---\r\n  const diveX = shotX - goalkeeper.x;\r\n  const diveY = shotY - goalkeeper.y;\r\n\r\n  (goalkeeper as any).isDiving = true;\r\n  (goalkeeper as any).diveStartTime = Date.now();\r\n  (goalkeeper as any).diveDirection = { x: diveX, y: diveY };\r\n\r\n  // --- IMPROVED: DYNAMIC TIMING & REACH ---\r\n  const gkSkill = (goalkeeper.goalkeeping || 60) / 100;\r\n  const distanceDive = Math.sqrt(diveX ** 2 + diveY ** 2);\r\n  const maxReach = 180;\r\n  const reachFactor = Math.min(1, distanceDive / maxReach);\r\n\r\n  // Faster dive for tough shots and skilled GKs\r\n  const baseDuration = 600 + (200 * (1 - gkSkill));\r\n  const diveDuration = baseDuration * (1.0 - (saveProbability * 0.3));\r\n  (goalkeeper as any).diveDuration = diveDuration;\r\n\r\n  // Apply limited reach so animation looks realistic\r\n  (goalkeeper as any).diveDirection.x *= reachFactor;\r\n  (goalkeeper as any).diveDirection.y *= reachFactor;\r\n\r\n  // --- AUTO RESET ---\r\n  setTimeout(() => {\r\n    (goalkeeper as any).isDiving = false;\r\n  }, diveDuration);\r\n\r\n  // --- PARTICLES ---\r\n  const numParticles = Math.floor(8 + Math.random() * 4);\r\n  const particleColor = saveProbability > 0.6 ? '#60a5fa' : '#1e40af';\r\n\r\n  if (gameState?.particles) {\r\n    for (let i = 0; i < numParticles; i++) {\r\n      const angle = Math.random() * Math.PI * 2;\r\n      const speed = 80 + Math.random() * 120;\r\n      const velocityX = Math.cos(angle) * speed;\r\n      const velocityY = Math.sin(angle) * speed;\r\n\r\n      const particle = new Particle(\r\n        goalkeeper.x,\r\n        goalkeeper.y,\r\n        particleColor,\r\n        velocityX,\r\n        velocityY\r\n      );\r\n      particle.size = 2 + Math.random() * 2;\r\n      gameState.particles.push(particle);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Draw goalkeeper stance indicator (debug)\r\n */\r\nexport function drawGoalkeeperStanceIndicator(\r\n  ctx: CanvasRenderingContext2D,\r\n  goalkeeper: Player\r\n): void {\r\n  if (!(goalkeeper as any).stance) return;\r\n\r\n  const stanceColors: Record<string, string> = {\r\n    comfortable: '#10b981',\r\n    ready: '#3b82f6',\r\n    set: '#f59e0b',\r\n    advancing: '#8b5cf6',\r\n    oneOnOne: '#ef4444'\r\n  };\r\n\r\n  const color = stanceColors[(goalkeeper as any).stance] || '#6b7280';\r\n\r\n  ctx.save();\r\n  ctx.strokeStyle = color;\r\n  ctx.lineWidth = 4;\r\n  ctx.beginPath();\r\n  ctx.arc(goalkeeper.x, goalkeeper.y, 25, 0, Math.PI * 2);\r\n  ctx.stroke();\r\n\r\n  // Draw stance text\r\n  ctx.fillStyle = color;\r\n  ctx.font = 'bold 10px Arial';\r\n  ctx.textAlign = 'center';\r\n  ctx.fillText((goalkeeper as any).stance.toUpperCase(), goalkeeper.x, goalkeeper.y - 35);\r\n\r\n  ctx.restore();\r\n}\r\n\r\n// ============================================================================\r\n// SHOT RESOLUTION\r\n// ============================================================================\r\n\r\n/**\r\n * Resolve shot with advanced goalkeeper system\r\n */\r\nexport function resolveShot_WithAdvancedGK(params: ShotResolution): void {\r\n  // Using imported gameState from globalExports\r\n  // Using imported GAME_CONFIG from config\r\n  const { holder, xG, goalkeeper, goalX, shotTargetY } = params;\r\n\r\n  if (!gameState.shotInProgress) {\r\n    return;\r\n  }\r\n\r\n  const teamStats = holder.isHome ? gameState.stats.home : gameState.stats.away;\r\n  const goalTop = (GAME_CONFIG as any).GOAL_Y_TOP;\r\n  const goalBottom = (GAME_CONFIG as any).GOAL_Y_BOTTOM;\r\n\r\n  if (shotTargetY < goalTop || shotTargetY > goalBottom) {\r\n    teamStats.shotsOffTarget++;\r\n    gameState.commentary.push({\r\n      text: `${Math.floor(gameState.timeElapsed)}' ${holder.name}'s shot is off target!`,\r\n      type: 'attack'\r\n    });\r\n    gameState.shotInProgress = false;\r\n    gameState.shooter = null;\r\n    gameState.currentShotXG = null;\r\n    return;\r\n  }\r\n\r\n  teamStats.shotsOnTarget++;\r\n  const saveProbability = calculateSaveProbability_Advanced(xG, goalkeeper, shotTargetY, holder);\r\n  const keeperSaves = Math.random() < saveProbability;\r\n\r\n  if (!keeperSaves) {\r\n    // --- GOAL SCORED ---\r\n    gameState.status = 'goal_scored';\r\n    if (holder.isHome) gameState.homeScore++;\r\n    else gameState.awayScore++;\r\n\r\n    const scorerName = holder.name;\r\n    const teamColors = holder.isHome\r\n      ? [(gameState as any).homeJerseyColor, '#ffffff']\r\n      : [(gameState as any).awayJerseyColor, '#ffffff'];\r\n\r\n    showGoalAnimation(scorerName, teamColors);\r\n\r\n    // FIXED: isHome instead of team\r\n    gameState.goalEvents.push({\r\n      scorer: holder.name,\r\n      time: Math.floor(gameState.timeElapsed),\r\n      isHome: holder.isHome\r\n    } as any);\r\n\r\n    createGoalExplosion(goalX, shotTargetY,\r\n      holder.isHome ? (gameState as any).homeJerseyColor : (gameState as any).awayJerseyColor);\r\n\r\n    const xGDisplay = (xG * 100).toFixed(0);\r\n    gameState.commentary.push({\r\n      text: `${Math.floor(gameState.timeElapsed)}' GOAL! ${holder.name} scores! (xG: ${xGDisplay}%)`,\r\n      type: 'goal'\r\n    });\r\n\r\n    if (eventBus && EVENT_TYPES) {\r\n      eventBus.publish(EVENT_TYPES.GOAL_SCORED, {\r\n        scorer: holder,\r\n        xG: xG,\r\n        time: Math.floor(gameState.timeElapsed)\r\n      });\r\n    }\r\n\r\n    gameState.lastGoalScorer = holder.isHome ? 'home' : 'away';\r\n    resetAfterGoal();\r\n  } else {\r\n    // --- SAVED ---\r\n    triggerGoalkeeperSave(goalkeeper, goalX, shotTargetY, saveProbability);\r\n    const saveQuality = saveProbability > 0.7 ? 'incredible' :\r\n      saveProbability > 0.5 ? 'great' : 'good';\r\n\r\n    gameState.commentary.push({\r\n      text: `${Math.floor(gameState.timeElapsed)}' ${saveQuality} save by ${goalkeeper.name}!`,\r\n      type: 'save'\r\n    });\r\n\r\n    if (eventBus && EVENT_TYPES) {\r\n      eventBus.publish(EVENT_TYPES.SHOT_SAVED, {\r\n        goalkeeper: goalkeeper,\r\n        shooter: holder,\r\n        saveQuality: saveQuality\r\n      });\r\n    }\r\n\r\n    gameState.ballHolder = goalkeeper;\r\n    goalkeeper.hasBallControl = true;\r\n    (goalkeeper as any).ballReceivedTime = Date.now();\r\n  }\r\n\r\n  gameState.commentary = gameState.commentary.slice(-6);\r\n  gameState.shotInProgress = false;\r\n  gameState.shooter = null;\r\n  gameState.currentShotXG = null;\r\n}\r\n\r\n", "/**\r\n * AI Movement System - TypeScript Migration\r\n *\r\n * Handles all player tactical positioning and movement:\r\n * - Positional play based on formations\r\n * - Defensive marking and pressing\r\n * - Attacking runs and support play\r\n * - Zone-based positioning\r\n * - Anti-clustering logic\r\n *\r\n * @module ai/movement\r\n * @migrated-from js/ai/aimovement.js\r\n */\r\n\r\nimport type { Player, Vector2D } from '../types';\r\nimport { distance, pointToLineDistance } from '../utils/math';\r\nimport { getAttackingGoalX } from '../utils/ui';\r\nimport { shouldAvoidOffside } from '../rules/offside';\r\nimport { updateGoalkeeperAI_Advanced } from '../ai/goalkeeper';\r\nimport { BehaviorSystem } from '../behavior/BehaviorSystem';\r\nimport { gameState } from '../globalExports';\r\nimport { GAME_CONFIG, TACTICS, POSITION_CONFIGS } from '../config';\r\n\r\n// ============================================================================\r\n// TYPE DEFINITIONS\r\n// ============================================================================\r\n\r\ninterface PositionConfig {\r\n  defensiveness: number;\r\n  attackRange: number;\r\n  ballChasePriority: number;\r\n  idealWidth: number;\r\n  pushUpOnAttack: number;\r\n}\r\n\r\ninterface Zone {\r\n  x1: number;\r\n  y1: number;\r\n  x2: number;\r\n  y2: number;\r\n}\r\n\r\ninterface ThreatAssessment {\r\n  player: Player;\r\n  score: number;\r\n}\r\n\r\ninterface MarkingResult {\r\n  shouldMark: boolean;\r\n  shouldPress: boolean;\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\ninterface MovementResult {\r\n  x: number;\r\n  y: number;\r\n  speedBoost?: number;\r\n  shouldLock?: boolean;\r\n}\r\n\r\ntype TeamState = 'BALANCED' | 'ATTACKING' | 'DEFENDING' | 'COUNTER_ATTACK' | 'HIGH_PRESS';\r\ntype MarkingTightness = 'goal_side' | 'tight';\r\n\r\n// ============================================================================\r\n// HELPER FUNCTIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Safe distance calculation wrapper\r\n */\r\nfunction getDistance(p1: Vector2D | Player, p2: Vector2D | Player): number {\r\n  return distance(p1, p2);\r\n}\r\n\r\n// Wrapper functions removed - now using direct ES6 imports\r\n\r\n// ============================================================================\r\n// POSITION CONFIGURATION\r\n// ============================================================================\r\n\r\n/**\r\n * Get position configuration for a role\r\n */\r\nexport function getPositionConfig(role: string): PositionConfig {\r\n  // Using imported POSITION_CONFIGS from config\r\n  return (POSITION_CONFIGS as any)[role.toUpperCase()] || {\r\n    defensiveness: 0.5,\r\n    attackRange: 0.5,\r\n    ballChasePriority: 0.5,\r\n    idealWidth: 0.2,\r\n    pushUpOnAttack: 60\r\n  };\r\n}\r\n\r\n// ============================================================================\r\n// POSITIONAL CALCULATION\r\n// ============================================================================\r\n\r\n/**\r\n * Get player's active position based on half, ball position, and team state\r\n *\r\n * Accounts for:\r\n * - Half-time orientation flip\r\n * - Ball influence on positioning\r\n * - Tactical shifts based on team state\r\n */\r\nexport function getPlayerActivePosition(player: Player, currentHalf: number): Vector2D {\r\n  // Using imported gameState from globalExports\r\n  // Using imported GAME_CONFIG from config\r\n\r\n  // 1. STEP: Get base \"home\" position\r\n  let homeX = (player as any).homeX ?? 400;\r\n  let homeY = (player as any).homeY ?? 300;\r\n  const pitchWidth = (GAME_CONFIG as any).PITCH_WIDTH;\r\n  const pitchHeight = (GAME_CONFIG as any).PITCH_HEIGHT;\r\n\r\n  // 2. STEP: APPLY HALF-TIME FLIP IMMEDIATELY\r\n  // 'activeX' and 'activeY' are now the player's base position in this half\r\n  let activeX = (currentHalf === 2) ? (pitchWidth - homeX) : homeX;\r\n  let activeY = homeY;\r\n\r\n  // 3. STEP: Calculate ball influence and tactical shifts FROM THIS NEW 'activeX' AND 'activeY'\r\n  const ballShiftFactor = 0.15;\r\n  const shiftX = (gameState.ballPosition.x - (pitchWidth / 2)) * ballShiftFactor;\r\n  const shiftY = (gameState.ballPosition.y - (pitchHeight / 2)) * ballShiftFactor;\r\n\r\n  // Apply ball shift to 'activeX' and 'activeY' (not erroneous 'homeX')\r\n  if (!['GK', 'CB', 'LB', 'RB'].includes(player.role)) {\r\n    activeX += shiftX * Math.min(1, Math.abs(activeX - (pitchWidth / 2)) / (pitchWidth / 4));\r\n    activeY += shiftY;\r\n  }\r\n\r\n  // Calculate tactical shifts from 'activeX'\r\n  const isMidfielder = ['CDM', 'CM', 'CAM', 'RM', 'LM'].includes(player.role);\r\n  if (isMidfielder) {\r\n    const teamState = player.isHome ? gameState.homeTeamState : gameState.awayTeamState;\r\n    const opponentGoalX = getAttackingGoalX(player.isHome, currentHalf);\r\n    const ownGoalX = getAttackingGoalX(!player.isHome, currentHalf);\r\n\r\n    if (teamState === 'ATTACKING' || teamState === 'COUNTER_ATTACK') {\r\n      const pushFactor = (teamState === 'ATTACKING') ? 80 : 100;\r\n      const direction = Math.sign(opponentGoalX - activeX) || 1;\r\n      activeX += direction * pushFactor;\r\n    }\r\n    else if (teamState === 'DEFENDING' || teamState === 'HIGH_PRESS') {\r\n      const pullFactor = (teamState === 'DEFENDING') ? 70 : 50;\r\n      const direction = Math.sign(ownGoalX - activeX) || 1;\r\n      activeX += direction * pullFactor;\r\n    }\r\n  }\r\n\r\n  // 4. STEP: Constrain and return results\r\n  activeX = Math.max(10, Math.min(pitchWidth - 10, activeX));\r\n  activeY = Math.max(10, Math.min(pitchHeight - 10, activeY));\r\n\r\n  return { x: activeX, y: activeY };\r\n}\r\n\r\n/**\r\n * Get zone boundaries for a player based on role and team state\r\n */\r\nexport function getZoneForPlayer(\r\n  player: Player,\r\n  _activePosition: Vector2D,\r\n  teamState: TeamState\r\n): Zone {\r\n  const { role, isHome } = player;\r\n\r\n  // Field dimensions and key points\r\n  const FIELD_WIDTH = 800;\r\n  const FIELD_HEIGHT = 600;\r\n  const HALF_WAY_LINE = FIELD_WIDTH / 2;\r\n\r\n  // Team-oriented coordinates\r\n  const ownGoalLine = isHome ? 0 : FIELD_WIDTH;\r\n  const opponentGoalLine = isHome ? FIELD_WIDTH : 0;\r\n\r\n  // Penalty area boundaries (approximate values)\r\n  const ownPenaltyAreaX = isHome ? 130 : FIELD_WIDTH - 130;\r\n  const oppPenaltyAreaX = isHome ? FIELD_WIDTH - 130 : 130;\r\n\r\n  let zone: Zone = { x1: 0, y1: 0, x2: FIELD_WIDTH, y2: FIELD_HEIGHT }; // Default\r\n\r\n  // Vertical corridors (Wings and Center)\r\n  const leftWingY = { y1: 0, y2: 180 };\r\n  const leftCenterY = { y1: 180, y2: 300 };\r\n  const rightCenterY = { y1: 300, y2: 420 };\r\n  const rightWingY = { y1: 420, y2: 600 };\r\n  const centralCorridorY = { y1: 180, y2: 420 };\r\n\r\n  // Zone assignment by position\r\n  switch (role) {\r\n    // --- DEFENSE ---\r\n    case 'LB':\r\n    case 'RB':\r\n      const wingY = role === 'LB' ? leftWingY : rightWingY;\r\n      if (teamState === 'ATTACKING') {\r\n        zone = { x1: HALF_WAY_LINE - 100, x2: oppPenaltyAreaX, ...wingY };\r\n      } else {\r\n        zone = { x1: ownGoalLine, x2: HALF_WAY_LINE, ...wingY };\r\n      }\r\n      break;\r\n\r\n    case 'LCB':\r\n    case 'RCB':\r\n    case 'CB':\r\n      const centerBackY = role === 'LCB' ? leftCenterY : role === 'RCB' ? rightCenterY : centralCorridorY;\r\n      if (teamState === 'ATTACKING') {\r\n        const forwardLimit = isHome ? HALF_WAY_LINE + 100 : HALF_WAY_LINE - 100;\r\n        zone = { x1: ownPenaltyAreaX, x2: forwardLimit, ...centerBackY };\r\n      } else {\r\n        zone = { x1: ownGoalLine, x2: HALF_WAY_LINE, ...centerBackY };\r\n      }\r\n      break;\r\n\r\n    // --- MIDFIELD ---\r\n    case 'CDM':\r\n    case 'CM':\r\n    case 'LCM':\r\n    case 'RCM':\r\n      const midY = role.includes('L') ? leftCenterY : role.includes('R') ? rightCenterY : centralCorridorY;\r\n      zone = { x1: ownPenaltyAreaX, x2: oppPenaltyAreaX, ...midY };\r\n      break;\r\n\r\n    case 'CAM':\r\n      zone = { x1: HALF_WAY_LINE - 150, x2: oppPenaltyAreaX + 20, ...centralCorridorY };\r\n      break;\r\n\r\n    // --- WINGS ---\r\n    case 'LM':\r\n    case 'RM':\r\n      const wideMidY = role === 'LM' ? leftWingY : rightWingY;\r\n      if (teamState === 'ATTACKING') {\r\n        zone = { x1: ownPenaltyAreaX, x2: oppPenaltyAreaX, ...wideMidY };\r\n      } else {\r\n        zone = { x1: ownGoalLine + 100, x2: HALF_WAY_LINE + 150, ...wideMidY };\r\n      }\r\n      break;\r\n\r\n    case 'LW':\r\n    case 'RW':\r\n      const wingerY = role === 'LW' ? leftWingY : rightWingY;\r\n      zone = { x1: HALF_WAY_LINE - 100, x2: opponentGoalLine, ...wingerY };\r\n      if (teamState === 'DEFENDING') {\r\n        zone.x1 = isHome ? zone.x1 - 150 : zone.x1 + 150;\r\n      }\r\n      break;\r\n\r\n    // --- FORWARDS ---\r\n    case 'ST':\r\n    case 'CF':\r\n      zone = { x1: HALF_WAY_LINE, x2: opponentGoalLine, ...centralCorridorY };\r\n      if (teamState === 'DEFENDING') {\r\n        const retreatX = isHome ? HALF_WAY_LINE - 150 : HALF_WAY_LINE + 150;\r\n        zone = { x1: retreatX, x2: opponentGoalLine, ...centralCorridorY };\r\n      }\r\n      break;\r\n\r\n    // --- GOALKEEPER ---\r\n    case 'GK':\r\n      const gkWidth = 160;\r\n      const gkHeight = 400;\r\n      zone = {\r\n        x1: isHome ? ownGoalLine : ownGoalLine - gkWidth,\r\n        x2: isHome ? ownGoalLine + gkWidth : ownGoalLine,\r\n        y1: (FIELD_HEIGHT - gkHeight) / 2,\r\n        y2: (FIELD_HEIGHT + gkHeight) / 2\r\n      };\r\n      break;\r\n  }\r\n\r\n  return zone;\r\n}\r\n\r\n// ============================================================================\r\n// DEFENSIVE THREAT ASSESSMENT\r\n// ============================================================================\r\n\r\n/**\r\n * Assess defensive threats from opponents\r\n *\r\n * Scores opponents based on:\r\n * - Role (ST/CF/W high priority)\r\n * - Proximity to goal\r\n * - Ball possession\r\n * - Central position\r\n * - Marking coverage\r\n */\r\nexport function assessDefensiveThreats(\r\n  defendingPlayer: Player,\r\n  opponents: Player[],\r\n  ownGoalX: number\r\n): ThreatAssessment[] {\r\n  // Using imported gameState from globalExports\r\n  const ballCarrier = gameState.ballHolder;\r\n\r\n  return opponents.map(opponent => {\r\n    if (opponent.role === 'GK') return { player: opponent, score: 0 };\r\n\r\n    const distToGoal = Math.abs(opponent.x - ownGoalX);\r\n    const distToDefender = getDistance(defendingPlayer, opponent);\r\n    const role = opponent.role;\r\n    let score = 0;\r\n\r\n    // Role-based threat bonus\r\n    if (role === 'ST' || role === 'CF') {\r\n      score += 80; // Highest priority\r\n    } else if (role === 'LW' || role === 'RW') {\r\n      score += 70; // High priority wing threats\r\n    } else if (role === 'CAM') {\r\n      score += 50; // Offensive midfielder\r\n    }\r\n\r\n    // 1. Proximity to goal is biggest factor\r\n    if (distToGoal < 400) {\r\n      score += (400 - distToGoal) * 0.6;\r\n    }\r\n\r\n    // 2. Ball possession makes them primary threat\r\n    if (ballCarrier && ballCarrier.id === opponent.id) {\r\n      score += 200;\r\n    }\r\n\r\n    // 3. Central, dangerous position\r\n    const angleToGoal = Math.abs(opponent.y - 300);\r\n    if (angleToGoal < 150) {\r\n      score += (150 - angleToGoal) * 0.3;\r\n    }\r\n\r\n    // 4. Pass reception potential (open space)\r\n    const teammates = defendingPlayer.isHome ? gameState.homePlayers : gameState.awayPlayers;\r\n    const nearbyDefenders = teammates.filter(d => getDistance(d, opponent) < 60);\r\n    if (nearbyDefenders.length <= 1) {\r\n      score += 50; // Unmarked bonus\r\n    }\r\n\r\n    // 5. Closer to defender makes them more urgent responsibility\r\n    score -= distToDefender * 0.15;\r\n\r\n    return { player: opponent, score: Math.max(0, score) };\r\n  }).sort((a, b) => b.score - a.score);\r\n}\r\n\r\n/**\r\n * Find most dangerous attacker to mark\r\n *\r\n * Prioritizes based on marker's role and threat zones\r\n */\r\nexport function findMostDangerousAttacker(\r\n  player: Player,\r\n  threats: ThreatAssessment[],\r\n  playerZone: Zone\r\n): Player | null {\r\n  const markerRole = player.role;\r\n  let primaryTargetRoles: string[] = [];\r\n  let secondaryTargetRoles: string[] = [];\r\n  let bestThreat: ThreatAssessment | null = null;\r\n\r\n  // 1. Determine priority targets based on defender's role\r\n  switch (markerRole) {\r\n    // --- DEFENSE LINE ---\r\n    case 'LB':\r\n      primaryTargetRoles = ['RW', 'RM', 'RWB'];\r\n      secondaryTargetRoles = ['ST', 'CF', 'CAM'];\r\n      break;\r\n    case 'RB':\r\n      primaryTargetRoles = ['LW', 'LM', 'LWB'];\r\n      secondaryTargetRoles = ['ST', 'CF', 'CAM'];\r\n      break;\r\n    case 'CB':\r\n    case 'LCB':\r\n    case 'RCB':\r\n      primaryTargetRoles = ['ST', 'CF'];\r\n      secondaryTargetRoles = ['CAM', 'CM'];\r\n      break;\r\n\r\n    // --- MIDFIELD AND WING FORWARD LINE ---\r\n    case 'CDM':\r\n      primaryTargetRoles = ['CAM', 'CF'];\r\n      secondaryTargetRoles = ['CM'];\r\n      break;\r\n    case 'LM':\r\n    case 'LW':\r\n      primaryTargetRoles = ['RB', 'RWB', 'RM'];\r\n      secondaryTargetRoles = ['CM'];\r\n      break;\r\n    case 'RM':\r\n    case 'RW':\r\n      primaryTargetRoles = ['LB', 'LWB', 'LM'];\r\n      secondaryTargetRoles = ['CM'];\r\n      break;\r\n    case 'CM':\r\n      primaryTargetRoles = ['CM', 'CAM'];\r\n      secondaryTargetRoles = ['CDM'];\r\n      break;\r\n    case 'CAM':\r\n      primaryTargetRoles = ['CDM'];\r\n      secondaryTargetRoles = ['CB'];\r\n      break;\r\n\r\n    // --- FRONT PRESS ---\r\n    case 'ST':\r\n    case 'CF':\r\n      primaryTargetRoles = ['CB', 'LCB', 'RCB'];\r\n      secondaryTargetRoles = ['GK', 'CDM'];\r\n      break;\r\n    default:\r\n      primaryTargetRoles = [];\r\n      secondaryTargetRoles = [];\r\n      break;\r\n  }\r\n\r\n  // 2. Search primary targets\r\n  if (primaryTargetRoles.length > 0) {\r\n    const primaryThreats = threats.filter(t => primaryTargetRoles.includes(t.player.role));\r\n    if (primaryThreats.length > 0) {\r\n      bestThreat = primaryThreats.sort((a, b) => b.score - a.score)[0] || null;\r\n      if (bestThreat && bestThreat.score > 30) {\r\n        return bestThreat.player;\r\n      }\r\n    }\r\n  }\r\n\r\n  // 3. Search secondary targets\r\n  if (secondaryTargetRoles.length > 0) {\r\n    const secondaryThreats = threats.filter(t => secondaryTargetRoles.includes(t.player.role));\r\n    if (secondaryThreats.length > 0) {\r\n      bestThreat = secondaryThreats.sort((a, b) => b.score - a.score)[0] || null;\r\n      if (bestThreat && bestThreat.score > 50) {\r\n        return bestThreat.player;\r\n      }\r\n    }\r\n  }\r\n\r\n  // 4. Zonal emergency\r\n  const threatsInZone = threats.filter(t =>\r\n    t.player.x > playerZone.x1 && t.player.x < playerZone.x2 &&\r\n    t.player.y > playerZone.y1 && t.player.y < playerZone.y2\r\n  );\r\n  if (threatsInZone.length > 0 && threatsInZone[0]!.score > 100) {\r\n    return threatsInZone[0]!.player;\r\n  }\r\n\r\n  // 5. No target found\r\n  return null;\r\n}\r\n\r\n/**\r\n * Calculate optimal marking position\r\n *\r\n * @param marker - Marking player\r\n * @param target - Player being marked\r\n * @param ownGoalX - Own goal X coordinate\r\n * @param tightness - Marking tightness ('goal_side' or 'tight')\r\n */\r\nexport function calculateOptimalMarkingPosition(\r\n  marker: Player,\r\n  target: Player,\r\n  ownGoalX: number,\r\n  tightness: MarkingTightness = 'goal_side'\r\n): Vector2D {\r\n  const goalCenterY = 300;\r\n\r\n  // TIGHT MARKING LOGIC\r\n  if (tightness === 'tight') {\r\n    // Stand fixed distance (25 units) close to target (goal side)\r\n    const fixedDistance = 25;\r\n\r\n    // Find angle between target and goal center\r\n    const angleToGoal = Math.atan2(goalCenterY - target.y, ownGoalX - target.x);\r\n\r\n    const markingPointX = target.x + Math.cos(angleToGoal) * fixedDistance;\r\n    const markingPointY = target.y + Math.sin(angleToGoal) * fixedDistance;\r\n\r\n    return { x: markingPointX, y: markingPointY };\r\n  }\r\n\r\n  // OLD LOGIC ('goal_side' or default):\r\n  // Stand on line between target and goal (proportional distance)\r\n  const vectorX = ownGoalX - target.x;\r\n  const vectorY = goalCenterY - target.y;\r\n\r\n  // Make CB ratio tighter\r\n  const distanceRatio = (marker.role === 'CB') ? 0.08 : 0.12; // Was 0.10 / 0.15\r\n\r\n  const markingPointX = target.x + vectorX * distanceRatio;\r\n  const markingPointY = target.y + vectorY * distanceRatio;\r\n\r\n  return { x: markingPointX, y: markingPointY };\r\n}\r\n\r\n// ============================================================================\r\n// MAIN TACTICAL POSITIONING\r\n// ============================================================================\r\n\r\n/**\r\n * Update player's tactical position\r\n *\r\n * Main entry point for AI movement system\r\n */\r\nexport function updateTacticalPosition(\r\n  player: Player,\r\n  ball: Vector2D,\r\n  _teammates: Player[],\r\n  opponents: Player[]\r\n): void {\r\n  // Using imported gameState from globalExports\r\n\r\n  // Fix: AI Conflict Prevention\r\n  // If status is not 'playing' (e.g. 'FREE_KICK', 'CORNER_KICK' etc.)\r\n  // and player is not locked by 'SetPieceIntegration',\r\n  // prevent this function (tactical positioning) from running\r\n  if (gameState.status !== 'playing') {\r\n    player.targetX = player.x;\r\n    player.targetY = player.y;\r\n    (player as any).speedBoost = 1.0;\r\n    return; // Don't run tactical AI\r\n  }\r\n\r\n  // Using imported TACTICS from config\r\n  const tactic = (TACTICS as any)[player.isHome ? gameState.homeTactic : gameState.awayTactic] || {};\r\n  const teamState = player.isHome ? gameState.homeTeamState : gameState.awayTeamState;\r\n  const activePosition = getPlayerActivePosition(player, gameState.currentHalf);\r\n  const teamHasBall = gameState.ballHolder && gameState.ballHolder.isHome === player.isHome;\r\n  const opponentHasBall = gameState.ballHolder && gameState.ballHolder.isHome !== player.isHome;\r\n\r\n  const ownGoalX = getAttackingGoalX(!player.isHome, gameState.currentHalf);\r\n\r\n  // Goalkeeper uses advanced AI\r\n  if (player.role === 'GK') {\r\n    updateGoalkeeperAI_Advanced(player, ball, opponents);\r\n    return;\r\n  }\r\n\r\n  // Ball chasers go straight to ball\r\n  if (gameState.ballChasers.has(player.id as any)) {\r\n    player.targetX = ball.x;\r\n    player.targetY = ball.y;\r\n    (player as any).targetLocked = true;\r\n    (player as any).targetLockTime = Date.now();\r\n    return;\r\n  }\r\n\r\n  // Check if target should be maintained\r\n  const now = Date.now();\r\n  const distToTarget = Math.sqrt(\r\n    Math.pow(player.targetX - player.x, 2) +\r\n    Math.pow(player.targetY - player.y, 2)\r\n  );\r\n\r\n  if ((player as any).targetLocked && now - ((player as any).targetLockTime || 0) < 1500) {\r\n    if (distToTarget > 20) {\r\n      return;\r\n    }\r\n  }\r\n\r\n  // Default values\r\n  let targetX = activePosition.x;\r\n  let targetY = activePosition.y;\r\n  let shouldLockTarget = false;\r\n\r\n  // DEFENSIVE LOGIC\r\n  if (opponentHasBall) {\r\n    const markingResult = applyMarkingAndPressing(player, ball, opponents, activePosition, ownGoalX, tactic, teamState);\r\n    if (markingResult.shouldMark) {\r\n      targetX = markingResult.x;\r\n      targetY = markingResult.y;\r\n      (player as any).speedBoost = 1.2;\r\n      shouldLockTarget = true;\r\n    } else if (markingResult.shouldPress) {\r\n      targetX = markingResult.x;\r\n      targetY = markingResult.y;\r\n      (player as any).speedBoost = teamState === 'HIGH_PRESS' ? 1.4 : 1.3;\r\n      shouldLockTarget = true;\r\n    } else {\r\n      ({ x: targetX, y: targetY } = applyDefensivePositioning(player, ball, tactic, activePosition, ownGoalX, teamState));\r\n    }\r\n\r\n    // ATTACKING LOGIC - NEW INTEGRATION\r\n  } else if (teamHasBall && gameState.ballHolder) {\r\n    // Use BehaviorSystem for advanced attacking behaviors\r\n    if (BehaviorSystem) {\r\n      const phase = BehaviorSystem.detectGamePhase?.(gameState) || 'attacking';\r\n      const tacticName = player.isHome ? gameState.homeTactic : gameState.awayTactic;\r\n      const tacticalSystem = BehaviorSystem.getTacticalSystemType?.(tacticName) || 'balanced';\r\n\r\n      const advancedBehavior = BehaviorSystem.selectPlayerBehavior?.(\r\n        player,\r\n        gameState,\r\n        phase,\r\n        tacticalSystem\r\n      );\r\n\r\n      if (advancedBehavior) {\r\n        targetX = advancedBehavior.target.x;\r\n        targetY = advancedBehavior.target.y;\r\n        (player as any).speedBoost = advancedBehavior.speedMultiplier;\r\n        shouldLockTarget = advancedBehavior.shouldLock;\r\n        (player as any).currentBehavior = advancedBehavior.description;\r\n      } else {\r\n        // No behavior from system, return to formation\r\n        targetX = activePosition.x;\r\n        targetY = activePosition.y;\r\n        (player as any).speedBoost = 1.0;\r\n        (player as any).currentBehavior = 'holding_shape';\r\n      }\r\n    } else {\r\n      // Fallback if BehaviorSystem not available\r\n      targetX = activePosition.x;\r\n      targetY = activePosition.y;\r\n      (player as any).speedBoost = 1.0;\r\n    }\r\n\r\n  } else {\r\n    // Ball is loose\r\n    const verticalInfluence = (ball.y - 300) * 0.15;\r\n    targetX = activePosition.x;\r\n    targetY = activePosition.y + verticalInfluence;\r\n    (player as any).speedBoost = 1.0;\r\n  }\r\n\r\n  // Apply soft anti-clustering if not locked\r\n  // Note: applySoftAntiClustering is not implemented - removed dead code\r\n\r\n  // CB OVERFLOW LOGIC (preserve formation discipline)\r\n  if (player.role === 'CB' || player.role === 'LCB' || player.role === 'RCB') {\r\n    const MAX_CB_ADVANCE_DISTANCE = 470;\r\n    const halfwayLine = 400;\r\n\r\n    if (ownGoalX < halfwayLine) {\r\n      const redLine = ownGoalX + MAX_CB_ADVANCE_DISTANCE;\r\n      if (targetX > redLine) {\r\n        targetX = redLine;\r\n      }\r\n    } else {\r\n      const redLine = ownGoalX - MAX_CB_ADVANCE_DISTANCE;\r\n      if (targetX < redLine) {\r\n        targetX = redLine;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Constrain to field bounds\r\n  targetX = Math.max(50, Math.min(750, targetX));\r\n  targetY = Math.max(50, Math.min(550, targetY));\r\n\r\n  player.targetX = targetX;\r\n  player.targetY = targetY;\r\n\r\n  if (shouldLockTarget) {\r\n    (player as any).targetLocked = true;\r\n    (player as any).targetLockTime = now;\r\n  } else {\r\n    if (distToTarget < 15) {\r\n      (player as any).targetLocked = false;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Apply marking and pressing logic\r\n */\r\nexport function applyMarkingAndPressing(\r\n  player: Player,\r\n  _ball: Vector2D,\r\n  opponents: Player[],\r\n  activePosition: Vector2D,\r\n  ownGoalX: number,\r\n  tactic: any,\r\n  teamState: TeamState\r\n): MarkingResult {\r\n  // Using imported gameState from globalExports\r\n  const ballCarrier = gameState.ballHolder;\r\n  if (!ballCarrier) return { shouldMark: false, shouldPress: false, x: activePosition.x, y: activePosition.y };\r\n\r\n  // 1. THREAT ANALYSIS\r\n  const playerZone = getZoneForPlayer(player, activePosition, teamState);\r\n  const allThreats = assessDefensiveThreats(player, opponents, ownGoalX);\r\n  const primaryThreat = findMostDangerousAttacker(player, allThreats, playerZone);\r\n\r\n  const distToBallCarrier = getDistance(player, ballCarrier);\r\n\r\n  // 2. PRESS DECISION\r\n  const pressDistance = (teamState === 'HIGH_PRESS') ? 120 : ((tactic.pressIntensity || 0) > 0.7 ? 100 : 80);\r\n  const teammates = player.isHome ? gameState.homePlayers : gameState.awayPlayers;\r\n  const allDefenders = teammates.filter(p => p.id !== player.id && p.role !== 'GK');\r\n  const isClosestDefender = !allDefenders.some(p => getDistance(p, ballCarrier) < distToBallCarrier);\r\n\r\n  if (distToBallCarrier < pressDistance && isClosestDefender) {\r\n    const targetX = ballCarrier.x + (ballCarrier.vx || 0) * 0.2;\r\n    const targetY = ballCarrier.y + (ballCarrier.vy || 0) * 0.2;\r\n    return { shouldMark: false, shouldPress: true, x: targetX, y: targetY };\r\n  }\r\n\r\n  // 3. MARKING DECISION (IMPROVED)\r\n  if (primaryThreat) {\r\n    const distToGoal = Math.abs(primaryThreat.x - ownGoalX);\r\n\r\n    // Danger zone = closer than 180 pixels (~16 meters) to goal\r\n    const inDangerZone = distToGoal < 180;\r\n\r\n    // If threat in danger zone AND player is a defender, use 'tight' marking\r\n    const tightness: MarkingTightness = (inDangerZone && ['CB', 'RB', 'LB'].includes(player.role))\r\n      ? 'tight'\r\n      : 'goal_side';\r\n\r\n    const { x, y } = calculateOptimalMarkingPosition(player, primaryThreat, ownGoalX, tightness);\r\n\r\n    return { shouldMark: true, shouldPress: false, x, y };\r\n  }\r\n\r\n  // 5. ZONAL DEFENSE (Default):\r\n  const { x, y } = applyDefensivePositioning(player, gameState.ballPosition, tactic, activePosition, ownGoalX, teamState);\r\n  return { shouldMark: false, shouldPress: false, x, y };\r\n}\r\n\r\n/**\r\n * Apply defensive positioning logic\r\n */\r\nexport function applyDefensivePositioning(\r\n  player: Player,\r\n  ball: Vector2D,\r\n  _tactic: any,\r\n  activePosition: Vector2D,\r\n  ownGoalX: number,\r\n  teamState: TeamState\r\n): MovementResult {\r\n  // Using imported gameState from globalExports\r\n  const ballDistToOwnGoal = Math.abs(ball.x - ownGoalX);\r\n  const ballSideY = ball.y;\r\n  const playerSideY = player.y;\r\n  const isBallOnFarSide = Math.abs(ballSideY - playerSideY) > 300;\r\n  const horizontalShift = (ball.y - 300) * 0.25;\r\n  const compression = teamState === 'DEFENDING' ? 0.6 : 0.7;\r\n\r\n  let targetX = activePosition.x;\r\n  let targetY = activePosition.y;\r\n\r\n  // --- 1. Depth Adjustment (All roles) ---\r\n  const retreatModifier = teamState === 'DEFENDING' ? 1.3 : 1.0;\r\n  if (ballDistToOwnGoal < 300) {\r\n    const retreatAmount = ((300 - ballDistToOwnGoal) / 3) * retreatModifier;\r\n    const direction = ownGoalX < 400 ? -1 : 1;\r\n    targetX = activePosition.x + direction * retreatAmount;\r\n  }\r\n\r\n  // --- 2. Horizontal Shift and Compactness (Role-based) ---\r\n  const playerRole = player.role;\r\n\r\n  // NEW: CB GAP DYNAMIC FILLING\r\n  // This block runs BEFORE \"Weak Side\" logic\r\n  if (['RB', 'LB'].includes(playerRole)) {\r\n    const teammates = player.isHome ? gameState.homePlayers : gameState.awayPlayers;\r\n    const centralDefenders = teammates.filter(p => p.role === 'CB' || p.role === 'LCB' || p.role === 'RCB');\r\n\r\n    const myNearestCB = centralDefenders.sort((a, b) => getDistance(a, player) - getDistance(b, player))[0];\r\n\r\n    if (myNearestCB) {\r\n      const cbHomeX = getPlayerActivePosition(myNearestCB, gameState.currentHalf).x;\r\n      const cbCurrentX = myNearestCB.x;\r\n\r\n      const cbDisplacement = Math.abs(cbCurrentX - cbHomeX);\r\n\r\n      if (cbDisplacement > 100) {\r\n        const isRB = playerRole === 'RB';\r\n        targetX = cbHomeX + (isRB ? -30 : 30);\r\n        targetY = 300 + (isRB ? -60 : 60);\r\n\r\n        (player as any).speedBoost = 1.3;\r\n        return { x: targetX, y: targetY };\r\n      }\r\n    }\r\n  }\r\n\r\n  // Weak side fullback logic\r\n  if (['RB', 'LB'].includes(playerRole) && isBallOnFarSide) {\r\n    const teammates = player.isHome ? gameState.homePlayers : gameState.awayPlayers;\r\n    const centerBacks = teammates.filter(p => p.role === 'CB');\r\n    if (centerBacks.length > 0) {\r\n      const nearestCB = centerBacks.sort((a, b) => getDistance(a, player) - getDistance(b, player))[0];\r\n      if (nearestCB) {\r\n        targetX = nearestCB.x + (playerRole === 'RB' ? -30 : 30);\r\n      }\r\n    }\r\n    targetY = 300 + (playerRole === 'RB' ? -50 : 50);\r\n\r\n  } else if (['RM', 'LM', 'RW', 'LW'].includes(playerRole)) {\r\n    const isRightSided = playerRole === 'RM' || playerRole === 'RW';\r\n\r\n    if (isBallOnFarSide) {\r\n      targetX = activePosition.x + (ownGoalX > 400 ? -30 : 30);\r\n      targetY = 300 + (isRightSided ? -80 : 80);\r\n    } else {\r\n      targetY = activePosition.y + horizontalShift * 1.5;\r\n      const direction = ownGoalX < 400 ? 1 : -1;\r\n      targetX = activePosition.x + (direction * 50);\r\n    }\r\n\r\n  } else if (['CB', 'CDM', 'CM'].includes(playerRole)) {\r\n    targetY = activePosition.y + horizontalShift;\r\n    targetY = 300 + (targetY - 300) * compression;\r\n\r\n  } else if (playerRole === 'CAM') {\r\n    const direction = ownGoalX < 400 ? 1 : -1;\r\n    targetX = (activePosition.x + (direction * 100));\r\n    targetY = 300 + (ball.y - 300) * 0.3;\r\n\r\n  } else {\r\n    targetY = activePosition.y + horizontalShift;\r\n  }\r\n\r\n  return { x: targetX, y: targetY };\r\n}\r\n\r\n/**\r\n * Apply attacking movement patterns\r\n */\r\nexport function applyAttackingMovement(\r\n  player: Player,\r\n  holder: Player,\r\n  teammates: Player[],\r\n  activePosition: Vector2D,\r\n  opponentGoalX: number,\r\n  _teamState: TeamState\r\n): MovementResult {\r\n  // Using imported gameState from globalExports\r\n  const opponents = player.isHome ? gameState.awayPlayers : gameState.homePlayers;\r\n  const direction = Math.sign(opponentGoalX - player.x) || 1;\r\n  const ballOnOtherSide = (holder.y > 300 && player.y < 300) || (holder.y < 300 && player.y > 300);\r\n\r\n  // Avoid offside trap\r\n  if (shouldAvoidOffside(player, gameState.ballPosition, opponents)) {\r\n    return {\r\n      x: player.x - direction * 20,\r\n      y: player.y,\r\n      speedBoost: 0.9,\r\n      shouldLock: true\r\n    };\r\n  }\r\n\r\n  // Far side wingers cut inside\r\n  if (['LW', 'RW'].includes(player.role) && ballOnOtherSide && getDistance(holder, player) > 150) {\r\n    return {\r\n      x: opponentGoalX - direction * 60,\r\n      y: 300 + (player.y < 300 ? 50 : -50),\r\n      speedBoost: 1.3,\r\n      shouldLock: true\r\n    };\r\n  }\r\n\r\n  // Fullback overlap\r\n  if (['RB', 'LB'].includes(player.role)) {\r\n    const wingerOnMySide = teammates.find(t =>\r\n      (player.role === 'RB' && t.role === 'RW') || (player.role === 'LB' && t.role === 'LW')\r\n    );\r\n    if (wingerOnMySide && Math.abs(wingerOnMySide.y - 300) < 100) {\r\n      return {\r\n        x: activePosition.x + direction * 100,\r\n        y: activePosition.y,\r\n        speedBoost: 1.25,\r\n        shouldLock: true\r\n      };\r\n    }\r\n  }\r\n\r\n  // Winger cutting inside with ball\r\n  if (holder.id === player.id && ['LW', 'RW', 'LM', 'RM'].includes(player.role)) {\r\n    const goalCenterY = 300;\r\n    const targetX = player.x + direction * 70;\r\n    const targetY = player.y + Math.sign(goalCenterY - player.y) * 40;\r\n    return { x: targetX, y: targetY, speedBoost: 1.1, shouldLock: false };\r\n  }\r\n\r\n  const runOptions: Array<{ type: string; target: Vector2D; score: number }> = [];\r\n  const holderUnderPressure = opponents.some(o => getDistance(o, holder) < 70);\r\n\r\n  // 1. SUPPORT RUN (priority when teammate under pressure)\r\n  if (holderUnderPressure) {\r\n    const supportTarget = {\r\n      x: holder.x - direction * 60,\r\n      y: holder.y + (player.y < 300 ? -70 : 70)\r\n    };\r\n    const supportSpace = Math.min(...opponents.map(o => getDistance(o, supportTarget)));\r\n    runOptions.push({ type: 'SUPPORT', target: supportTarget, score: supportSpace + 40 });\r\n  }\r\n\r\n  // 2. THROUGH BALL RUN (forwards and wingers)\r\n  if (['ST', 'RW', 'LW', 'CAM'].includes(player.role)) {\r\n    const lastDefender = opponents\r\n      .filter(o => o.role !== 'GK')\r\n      .sort((a, b) => direction * (b.x - a.x))[0];\r\n\r\n    if (lastDefender) {\r\n      const runTargetX = lastDefender.x + direction * 25;\r\n      const runTargetY = activePosition.y; // Use active position Y to prevent oscillation\r\n      const runTarget = { x: runTargetX, y: runTargetY };\r\n\r\n      const spaceRating = Math.min(...opponents.map(o => getDistance(o, runTarget)));\r\n      const pathClear = !opponents.some(o => pointToLineDistance(o, holder, runTarget) < 25);\r\n\r\n      if (pathClear) {\r\n        runOptions.push({ type: 'THROUGH', target: runTarget, score: spaceRating * 1.2 + (player.passing / 100 * 20) });\r\n      }\r\n    }\r\n  }\r\n\r\n  // 3. SPACE RUN (default forward movement)\r\n  const spaceRunTarget = { x: activePosition.x + direction * 70, y: activePosition.y };\r\n  const spaceRating = Math.min(...opponents.map(o => getDistance(o, spaceRunTarget)));\r\n  runOptions.push({ type: 'SPACE', target: spaceRunTarget, score: spaceRating });\r\n\r\n  // Choose best run option\r\n  const bestRun = runOptions.sort((a, b) => b.score - a.score)[0];\r\n\r\n  let finalMove: MovementResult = { x: activePosition.x, y: activePosition.y, speedBoost: 1.0, shouldLock: false };\r\n\r\n  if (bestRun && bestRun.score > 50) {\r\n    finalMove = {\r\n      x: bestRun.target.x,\r\n      y: bestRun.target.y,\r\n      speedBoost: (bestRun.type === 'THROUGH') ? 1.4 : 1.15,\r\n      shouldLock: true\r\n    };\r\n  }\r\n\r\n  // CM - ST distance control (prevent clustering)\r\n  if (player.role === 'CM' || player.role === 'CAM') {\r\n    const striker = teammates.find(t => t.role === 'ST');\r\n    if (striker) {\r\n      const distToStriker = getDistance({ x: finalMove.x, y: finalMove.y }, striker);\r\n      if (distToStriker < 80) {\r\n        const angleAwayFromStriker = Math.atan2(finalMove.y - striker.y, finalMove.x - striker.x);\r\n        finalMove.x += Math.cos(angleAwayFromStriker) * 20;\r\n        finalMove.y += Math.sin(angleAwayFromStriker) * 20;\r\n      }\r\n    }\r\n  }\r\n\r\n  return finalMove;\r\n}\r\n\r\n", "/**\r\n * Set Piece Utility Functions - TypeScript Migration\r\n *\r\n * Core utilities for set piece positioning and validation:\r\n * - TacticalContext: Game state analysis and urgency calculation\r\n * - PositionManager: Intelligent player spacing and collision avoidance\r\n * - Utility functions: Position sanitization, player validation, offside checks\r\n *\r\n * @module setpieces/utils\r\n * @migrated-from js/setpieces/setPieceUtils.js\r\n */\r\n\r\nimport type { Player, GameState, Vector2D } from '../types';\r\nimport { distance } from '../utils/math';\r\nimport { GAME_CONFIG } from '../config';\r\nimport { getPlayerActivePosition } from '../ai/movement';\r\nimport { getAttackingGoalX } from '../utils/ui';\r\n\r\n// ============================================================================\r\n// TYPE DEFINITIONS\r\n// ============================================================================\r\n\r\ntype Urgency = 'DESPERATE' | 'HIGH' | 'MODERATE' | 'BALANCED' | 'CONSERVATIVE';\r\n\r\nexport interface PositionWithMovement extends Vector2D {\r\n  movement?: string;\r\n  role?: string;\r\n}\r\n\r\ninterface SortedPlayerLists {\r\n  teammates: {\r\n    bestKickers: Player[];\r\n    bestHeaders: Player[];\r\n    fastest: Player[];\r\n    bestDefenders: Player[];\r\n  };\r\n  opponents: {\r\n    tallest: Player[];\r\n    mostDangerous: Player[];\r\n  };\r\n}\r\n\r\nexport interface OffsideAudit {\r\n  position: Vector2D;\r\n  wasOffside: boolean;\r\n  wasAdjusted: boolean;\r\n  originalX: number;\r\n  defensiveLine: number;\r\n  tolerance: number;\r\n  error: string | null;\r\n}\r\n\r\n// ============================================================================\r\n// TACTICAL CONTEXT ANALYZER\r\n// ============================================================================\r\n\r\nexport class TacticalContext {\r\n  gameState: GameState;\r\n  setPieceType: string;\r\n  scoreDifference: number;\r\n  timeRemaining: number;\r\n  isTrailing: boolean;\r\n  isLeading: boolean;\r\n  isDrawn: boolean;\r\n  isLateGame: boolean;\r\n  isVeryLateGame: boolean;\r\n  urgency?: Urgency;\r\n\r\n  constructor(gameState: GameState, setPieceType: string) {\r\n    this.gameState = gameState;\r\n    this.setPieceType = setPieceType;\r\n    this.scoreDifference = (gameState.homeScore || 0) - (gameState.awayScore || 0);\r\n    this.timeRemaining = 90 - ((gameState as any).matchTime || 0);\r\n    this.isTrailing = false;\r\n    this.isLeading = false;\r\n    this.isDrawn = this.scoreDifference === 0;\r\n    this.isLateGame = this.timeRemaining < 15;\r\n    this.isVeryLateGame = this.timeRemaining < 5;\r\n  }\r\n\r\n  getUrgency(isHome: boolean): Urgency {\r\n    const effectiveDiff = isHome ? this.scoreDifference : -this.scoreDifference;\r\n\r\n    if (effectiveDiff < 0) { // Trailing\r\n      if (this.isVeryLateGame) return 'DESPERATE';\r\n      if (this.isLateGame) return 'HIGH';\r\n      return 'MODERATE';\r\n    }\r\n\r\n    if (effectiveDiff > 0) { // Leading\r\n      if (this.isLateGame) return 'CONSERVATIVE';\r\n      return 'BALANCED';\r\n    }\r\n\r\n    return 'BALANCED';\r\n  }\r\n\r\n  shouldCommitForward(isHome: boolean): boolean {\r\n    const urgency = this.getUrgency(isHome);\r\n    return urgency === 'DESPERATE' || urgency === 'HIGH';\r\n  }\r\n\r\n  shouldStayCompact(isHome: boolean): boolean {\r\n    const urgency = this.getUrgency(isHome);\r\n    return urgency === 'CONSERVATIVE' && this.isLateGame;\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// POSITION MANAGER WITH INTELLIGENT SPACING\r\n// ============================================================================\r\n\r\nexport class PositionManager {\r\n  occupiedPositions: Vector2D[];\r\n  minDistance: number;\r\n  priorityZones: Map<string, { x: number; y: number; radius: number }>;\r\n\r\n  constructor() {\r\n    this.occupiedPositions = [];\r\n    this.minDistance = 30;\r\n    this.priorityZones = new Map();\r\n  }\r\n\r\n  reset(): void {\r\n    this.occupiedPositions = [];\r\n    this.priorityZones.clear();\r\n  }\r\n\r\n  markPriorityZone(x: number, y: number, radius: number = 40): void {\r\n    this.priorityZones.set(`${Math.round(x)},${Math.round(y)}`, { x, y, radius });\r\n  }\r\n\r\n  isPositionOccupied(x: number, y: number, allowOverlap: boolean = false): boolean {\r\n    if (allowOverlap) return false;\r\n\r\n    return this.occupiedPositions.some(pos => {\r\n      const dist = distance(pos, { x, y });\r\n      return dist < this.minDistance;\r\n    });\r\n  }\r\n\r\n  findValidPosition(idealPos: Vector2D, maxAttempts: number = 10, allowPriorityOverlap: boolean = false): Vector2D {\r\n    const PITCH_WIDTH = GAME_CONFIG.PITCH_WIDTH;\r\n    const PITCH_HEIGHT = GAME_CONFIG.PITCH_HEIGHT;\r\n\r\n    const safeIdeal = sanitizePosition(idealPos, { behavior: 'PositionManager' });\r\n\r\n    if (!this.isPositionOccupied(safeIdeal.x, safeIdeal.y, allowPriorityOverlap)) {\r\n      this.occupiedPositions.push({ x: safeIdeal.x, y: safeIdeal.y });\r\n      return { x: safeIdeal.x, y: safeIdeal.y };\r\n    }\r\n\r\n    // Spiral search pattern\r\n    for (let attempt = 0; attempt < maxAttempts; attempt++) {\r\n      const angle = (Math.PI * 2 * attempt) / maxAttempts;\r\n      const radius = this.minDistance * (1 + attempt * 0.3);\r\n      const newX = safeIdeal.x + Math.cos(angle) * radius;\r\n      const newY = safeIdeal.y + Math.sin(angle) * radius;\r\n\r\n      const clampedX = Math.max(10, Math.min(PITCH_WIDTH - 10, newX));\r\n      const clampedY = Math.max(10, Math.min(PITCH_HEIGHT - 10, newY));\r\n\r\n      if (!this.isPositionOccupied(clampedX, clampedY, allowPriorityOverlap)) {\r\n        this.occupiedPositions.push({ x: clampedX, y: clampedY });\r\n        return { x: clampedX, y: clampedY };\r\n      }\r\n    }\r\n\r\n    this.occupiedPositions.push({ x: safeIdeal.x, y: safeIdeal.y });\r\n    return { x: safeIdeal.x, y: safeIdeal.y };\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// UTILITY FUNCTIONS\r\n// ============================================================================\r\n\r\n// const __warnHistory = new Map<string, { count: number; last: number }>();\r\n\r\n// function warnThrottled(key: string, ...args: any[]): void {\r\n//   try {\r\n//     const now = Date.now();\r\n//     const entry = __warnHistory.get(key) || { count: 0, last: 0 };\r\n//     if (now - entry.last > 60000) {\r\n//       entry.count = 0;\r\n//       entry.last = now;\r\n//     }\r\n//     entry.count += 1;\r\n//     __warnHistory.set(key, entry);\r\n//     if (entry.count <= 3) {\r\n//       console.warn(...args);\r\n//       if (entry.count === 3) {\r\n//         console.warn(`[SetPiece] Further messages for '${key}' will be suppressed for 60s.`);\r\n//       }\r\n//     }\r\n//   } catch (e) {\r\n//     console.warn(...args);\r\n//   }\r\n// }\r\n\r\nexport function getSafeStat(stats: any, key: string, defaultValue: number = 0): number {\r\n  if (stats && typeof stats[key] === 'number' && !isNaN(stats[key])) {\r\n    return stats[key];\r\n  }\r\n  if (stats && typeof stats[key] === 'string') {\r\n    const num = parseFloat(stats[key]);\r\n    if (!isNaN(num)) return num;\r\n  }\r\n  return defaultValue;\r\n}\r\n\r\nfunction getRoleBasedFallbackPosition(role: string | undefined, context: any = {}): PositionWithMovement {\r\n  const PITCH_WIDTH = GAME_CONFIG.PITCH_WIDTH;\r\n  const PITCH_HEIGHT = GAME_CONFIG.PITCH_HEIGHT;\r\n\r\n  let fallbackX = PITCH_WIDTH / 2;\r\n  let fallbackY = PITCH_HEIGHT / 2;\r\n\r\n  if (role && context.player && context.gameState) {\r\n    const activePos = getPlayerActivePosition(context.player, context.gameState.currentHalf);\r\n    fallbackX = activePos.x;\r\n    fallbackY = activePos.y;\r\n  }\r\n\r\n  fallbackX = Math.max(10, Math.min(PITCH_WIDTH - 10, fallbackX));\r\n  fallbackY = Math.max(10, Math.min(PITCH_HEIGHT - 10, fallbackY));\r\n\r\n  return { x: fallbackX, y: fallbackY, movement: 'role_fallback', role: role || 'FALLBACK_ROLE' };\r\n}\r\n\r\nexport function sanitizePosition(pos: any, context: any = {}): PositionWithMovement {\r\n  const PITCH_WIDTH = GAME_CONFIG.PITCH_WIDTH;\r\n  const PITCH_HEIGHT = GAME_CONFIG.PITCH_HEIGHT;\r\n\r\n  // Validation of position data\r\n  if (!pos || typeof pos !== 'object') {\r\n    console.error(`\u274C sanitizePosition: INVALID POSITION (not an object) for ${context.player?.name || 'unknown player'}`);\r\n    console.error(`   Received:`, pos);\r\n    console.error(`   Context:`, { behavior: context.behavior, role: context.role, movement: context.movement });\r\n    console.error(`   Stack:`, new Error().stack);\r\n    return getRoleBasedFallbackPosition(context.role, context);\r\n  }\r\n\r\n  let x = Number(pos.x);\r\n  let y = Number(pos.y);\r\n\r\n  if (isNaN(x) || !isFinite(x) || isNaN(y) || !isFinite(y)) {\r\n    console.error(`\u274C sanitizePosition: INVALID COORDINATES for ${context.player?.name || 'unknown player'}`);\r\n    console.error(`   Position: {x: ${pos.x} (${typeof pos.x}), y: ${pos.y} (${typeof pos.y})}`);\r\n    console.error(`   After Number(): {x: ${x}, y: ${y}}`);\r\n    console.error(`   Context:`, { behavior: context.behavior, role: context.role, movement: context.movement });\r\n    return getRoleBasedFallbackPosition(context.role, context);\r\n  }\r\n\r\n  const minX = 10, minY = 10;\r\n  const maxX = PITCH_WIDTH - 10, maxY = PITCH_HEIGHT - 10;\r\n\r\n  // Warn if clamping is needed (position was out of bounds)\r\n  const wasOutOfBounds = x < minX || x > maxX || y < minY || y > maxY;\r\n  if (wasOutOfBounds) {\r\n    console.warn(`\u26A0\uFE0F sanitizePosition: Position OUT OF BOUNDS for ${context.player?.name || 'unknown player'}, clamping`);\r\n    console.warn(`   Original: (${x.toFixed(1)}, ${y.toFixed(1)}), Bounds: X[${minX}-${maxX}], Y[${minY}-${maxY}]`);\r\n    console.warn(`   Behavior: ${context.behavior}, Movement: ${pos.movement}`);\r\n  }\r\n\r\n  x = Math.max(minX, Math.min(maxX, x));\r\n  y = Math.max(minY, Math.min(maxY, y));\r\n\r\n  return {\r\n    ...pos,\r\n    x,\r\n    y,\r\n    movement: pos.movement || context.movement || 'standard_position',\r\n    role: pos.role || context.role || 'UNKNOWN_ROLE'\r\n  };\r\n}\r\n\r\nexport function getValidPlayers(playersArray: Player[] | undefined | null): Player[] {\r\n  if (!Array.isArray(playersArray)) return [];\r\n  return playersArray.filter(p => p && typeof p.x === 'number' && typeof p.y === 'number' && isFinite(p.x) && isFinite(p.y));\r\n}\r\n\r\nexport function getSortedLists(teammates: Player[], opponents: Player[]): SortedPlayerLists {\r\n  const validTeammates = getValidPlayers(teammates);\r\n  const validOpponents = getValidPlayers(opponents);\r\n\r\n  return {\r\n    teammates: {\r\n      bestKickers: validTeammates.filter(p => p.role !== 'GK').sort((a, b) =>\r\n        getSafeStat((b as any).stats, 'shooting', 70) - getSafeStat((a as any).stats, 'shooting', 70)),\r\n      bestHeaders: validTeammates.filter(p => p.role !== 'GK').sort((a, b) =>\r\n        getSafeStat((b as any).stats, 'heading', 70) - getSafeStat((a as any).stats, 'heading', 70)),\r\n      fastest: validTeammates.filter(p => p.role !== 'GK').sort((a, b) =>\r\n        getSafeStat((b as any).stats, 'pace', 70) - getSafeStat((a as any).stats, 'pace', 70)),\r\n      bestDefenders: validTeammates.filter(p => p.role !== 'GK').sort((a, b) =>\r\n        getSafeStat((a as any).stats, 'defending', 70) - getSafeStat((b as any).stats, 'defending', 70))\r\n    },\r\n    opponents: {\r\n      tallest: validOpponents.filter(p => p.role !== 'GK').sort((a, b) =>\r\n        getSafeStat((b as any).stats, 'heading', 70) - getSafeStat((a as any).stats, 'heading', 70)),\r\n      mostDangerous: validOpponents.filter(p => p.role !== 'GK').sort((a, b) =>\r\n        getSafeStat((b as any).stats, 'attacking', 70) - getSafeStat((a as any).stats, 'attacking', 70))\r\n    }\r\n  };\r\n}\r\n\r\nexport function determineSetPieceTeam(gameState: GameState | null | undefined, player?: Player): 'home' | 'away' {\r\n  const fallbackTeam = (player && typeof player.isHome === 'boolean') ? (player.isHome ? 'home' : 'away') : 'home';\r\n  if (!gameState || !gameState.setPiece) return fallbackTeam;\r\n\r\n  const setPiece = gameState.setPiece;\r\n  // Check for undefined/null instead of truthy value\r\n  // This allows setPiece.team = false (away team) to be processed correctly\r\n  if ((setPiece as any).team !== undefined && (setPiece as any).team !== null) {\r\n    return (setPiece as any).team === 'home' || (setPiece as any).team === true ? 'home' : 'away';\r\n  }\r\n\r\n  return fallbackTeam;\r\n}\r\n\r\nexport function isPlayerAttacking(player: Player, gameState: GameState): boolean {\r\n  if (!player || typeof player.isHome !== 'boolean') return false;\r\n  const setPieceTeam = determineSetPieceTeam(gameState, player);\r\n  const playerTeam = player.isHome ? 'home' : 'away';\r\n  return setPieceTeam === playerTeam;\r\n}\r\n\r\n/**\r\n * Formation-aware positioning helper\r\n * Ensures players maintain proper positional discipline based on their role\r\n */\r\nexport function getFormationAwarePosition(\r\n  player: Player,\r\n  basePosition: PositionWithMovement,\r\n  gameState: GameState,\r\n  isAttacking: boolean\r\n): PositionWithMovement {\r\n  if (!player || !basePosition || !gameState) return basePosition;\r\n\r\n  const PITCH_WIDTH = GAME_CONFIG.PITCH_WIDTH;\r\n  const PITCH_HEIGHT = GAME_CONFIG.PITCH_HEIGHT;\r\n\r\n  const setPieceType = ((gameState.setPiece as any)?.type || gameState.status || '').toUpperCase();\r\n  const ownGoalX = getAttackingGoalX(!player.isHome, gameState.currentHalf);\r\n  const opponentGoalX = getAttackingGoalX(player.isHome, gameState.currentHalf);\r\n  const direction = Math.sign(opponentGoalX - 400);\r\n\r\n  // Goal kicks and kickoffs need to respect the bespoke restart layout\r\n  if (setPieceType === 'GOAL_KICK' || setPieceType === 'KICK_OFF') {\r\n    return {\r\n      ...basePosition,\r\n      x: Math.max(10, Math.min(PITCH_WIDTH - 10, basePosition.x)),\r\n      y: Math.max(10, Math.min(PITCH_HEIGHT - 10, basePosition.y))\r\n    };\r\n  }\r\n\r\n  // Formation discipline zones\r\n  const DEFENSIVE_ZONE_X = ownGoalX + direction * 150;\r\n  const MIDFIELD_ZONE_X = PITCH_WIDTH / 2;\r\n  const ATTACKING_ZONE_X = opponentGoalX - direction * 150;\r\n\r\n  let adjustedX = basePosition.x;\r\n  const role = player.role || 'UNKNOWN';\r\n\r\n  // Apply formation discipline based on role and attacking/defending state\r\n  if (role.includes('CB') || role.includes('GK')) {\r\n    // Defenders: Stay back unless it's an attacking set piece in opponent's half\r\n    if (!isAttacking || Math.abs(basePosition.x - ownGoalX) < PITCH_WIDTH / 3) {\r\n      if (direction > 0) {\r\n        adjustedX = Math.min(adjustedX, DEFENSIVE_ZONE_X);\r\n      } else {\r\n        adjustedX = Math.max(adjustedX, DEFENSIVE_ZONE_X);\r\n      }\r\n    }\r\n  } else if (role.includes('FB') || role.includes('WB') || role.includes('CDM')) {\r\n    // Full backs and defensive mids: Moderate discipline\r\n    if (!isAttacking) {\r\n      if (direction > 0) {\r\n        adjustedX = Math.min(adjustedX, DEFENSIVE_ZONE_X + 50);\r\n      } else {\r\n        adjustedX = Math.max(adjustedX, DEFENSIVE_ZONE_X - 50);\r\n      }\r\n    }\r\n  } else if (role.includes('ST') || role.includes('CF')) {\r\n    // Strikers: Stay forward unless defending deep\r\n    if (isAttacking) {\r\n      if (direction > 0) {\r\n        adjustedX = Math.max(adjustedX, ATTACKING_ZONE_X);\r\n      } else {\r\n        adjustedX = Math.min(adjustedX, ATTACKING_ZONE_X);\r\n      }\r\n    }\r\n  } else if (role.includes('CAM') || role.includes('AM')) {\r\n    // Attacking mids: Push forward when attacking\r\n    if (isAttacking) {\r\n      if (direction > 0) {\r\n        adjustedX = Math.max(adjustedX, MIDFIELD_ZONE_X + 30);\r\n      } else {\r\n        adjustedX = Math.min(adjustedX, MIDFIELD_ZONE_X - 30);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Ensure position stays within pitch bounds\r\n  adjustedX = Math.max(10, Math.min(PITCH_WIDTH - 10, adjustedX));\r\n\r\n  return {\r\n    ...basePosition,\r\n    x: adjustedX\r\n  };\r\n}\r\n\r\n/**\r\n * Check and adjust for offside position\r\n * Attacking player cannot be ahead of last defender (excluding goalkeeper)\r\n */\r\nexport function checkAndAdjustOffsidePosition(\r\n  position: any,\r\n  _player: Player,\r\n  opponentGoalX: number,\r\n  opponents: Player[],\r\n  _gameState: GameState\r\n): any {\r\n  if (!position || !opponents || opponents.length === 0) return position;\r\n\r\n  const PITCH_WIDTH = GAME_CONFIG.PITCH_WIDTH;\r\n  const direction = Math.sign(opponentGoalX - 400);\r\n\r\n  // Filter opponent field players (excluding goalkeeper)\r\n  const opponentFieldPlayers = opponents.filter(opp =>\r\n    opp.role !== 'GK'\r\n  );\r\n\r\n  if (opponentFieldPlayers.length === 0) return position;\r\n\r\n  // Find last defender (player closest to goal)\r\n  let lastDefender: Player | null = null;\r\n  let minDistanceToGoal = Infinity;\r\n\r\n  opponentFieldPlayers.forEach(opp => {\r\n    const distToGoal = Math.abs(opp.x - opponentGoalX);\r\n    if (distToGoal < minDistanceToGoal) {\r\n      minDistanceToGoal = distToGoal;\r\n      lastDefender = opp;\r\n    }\r\n  });\r\n\r\n  if (!lastDefender) return position;\r\n\r\n  // Is attacking player ahead of last defender?\r\n  const defender = lastDefender as Player; // Type assertion for TypeScript\r\n  const playerDistToGoal = Math.abs(position.x - opponentGoalX);\r\n  const defenderDistToGoal = Math.abs(defender.x - opponentGoalX);\r\n\r\n  // If player is offside, pull position back behind last defender\r\n  if (playerDistToGoal < defenderDistToGoal) {\r\n    const safeOffsetFromOffside = 15;\r\n    position.x = defender.x - direction * safeOffsetFromOffside;\r\n\r\n    // Clamp position to pitch bounds\r\n    position.x = Math.max(10, Math.min(position.x, PITCH_WIDTH - 10));\r\n  }\r\n\r\n  return position;\r\n}\r\n\r\n/**\r\n * Check and adjust for offside with detailed audit trail for debugging\r\n */\r\nexport const checkAndAdjustOffsidePositionWithAudit = (\r\n  position: any,\r\n  isHome: boolean,\r\n  gameState: GameState | null | undefined\r\n): OffsideAudit => {\r\n  if (!gameState || !position) return {\r\n    position: position || { x: 0, y: 0 },\r\n    wasOffside: false,\r\n    wasAdjusted: false,\r\n    originalX: position?.x || 0,\r\n    defensiveLine: 0,\r\n    tolerance: 5,\r\n    error: 'Invalid parameters'\r\n  };\r\n\r\n  const defensiveLine = isHome ? (gameState as any).awayDefensiveLine : (gameState as any).homeDefensiveLine;\r\n  const goalX = isHome ? 800 : 0;\r\n  const tolerance = 5;\r\n\r\n  const playerDistToGoal = Math.abs(position.x - goalX);\r\n  const isOffside = playerDistToGoal < defensiveLine - tolerance;\r\n\r\n  let adjusted = false;\r\n  let originalX = position.x;\r\n\r\n  if (isOffside) {\r\n    position.x = goalX + Math.sign(goalX - position.x) * (defensiveLine - tolerance);\r\n    adjusted = true;\r\n  }\r\n\r\n  return {\r\n    position: position,\r\n    wasOffside: isOffside,\r\n    wasAdjusted: adjusted,\r\n    originalX: originalX,\r\n    defensiveLine: defensiveLine,\r\n    tolerance: tolerance,\r\n    error: null\r\n  };\r\n};\r\n\r\n", "/**\r\n * Kickoff Behaviors - TypeScript Migration\r\n *\r\n * Professional kickoff positioning system\r\n * This function's ONLY job is to tell players to HOLD the position\r\n * that `setupKickOff` (in main.js) already put them in to prevent stuttering.\r\n *\r\n * @module setpieces/behaviors/kickoff\r\n * @migrated-from js/setpieces/behaviors/kickoff.js\r\n */\r\n\r\nimport type { Player, GameState, Vector2D } from '../../types';\r\nimport { sanitizePosition } from '../utils';\r\nimport { distance } from '../../utils/math';\r\nimport { GAME_CONFIG } from '../../config';\r\nimport { getAttackingGoalX } from '../../utils/ui';\r\n\r\n// ============================================================================\r\n// TYPE DEFINITIONS\r\n// ============================================================================\r\n\r\nexport interface DesignatedKickers {\r\n  primary: Player | null;\r\n  secondary: Player | null;\r\n}\r\n\r\n// ============================================================================\r\n// KICKOFF BEHAVIORS\r\n// ============================================================================\r\n\r\nexport const KickoffBehaviors = {\r\n  /**\r\n   * Get position for kickoff based on player role and team\r\n   */\r\n  getKickoffPosition(player: Player, _kickoffPos: Vector2D, isKickingTeam: boolean, gameState: GameState) {\r\n    if (!player || !gameState) {\r\n      return sanitizePosition({ x: 400, y: 300, movement: 'kickoff_fallback' }, { player });\r\n    }\r\n\r\n    // === GOALKEEPER POSITIONING ===\r\n    // GK is the only one who needs a slight adjustment (to their goal line).\r\n    if (player.role === 'GK') {\r\n      const ownGoalX = getAttackingGoalX(!player.isHome, gameState.currentHalf);\r\n      return sanitizePosition({\r\n        x: ownGoalX,\r\n        y: 300,\r\n        movement: 'kickoff_gk',\r\n        role: 'GK'\r\n      }, { player });\r\n    }\r\n\r\n    // === ALL OTHER PLAYERS ===\r\n    // `setupKickOff` in main.js has ALREADY teleported all players\r\n    // to their correct positions. We just tell them to HOLD.\r\n\r\n    let role = player.role;\r\n    // Re-assign role for kickers just for clarity/logic\r\n    if (isKickingTeam) {\r\n      const distToCenter = distance(player, { x: 400, y: 300 });\r\n      if (distToCenter < 15) {\r\n        role = 'PRIMARY_KICKER' as any;\r\n      } else if (distToCenter < 40) {\r\n        role = 'SECONDARY_KICKER' as any;\r\n      }\r\n    }\r\n\r\n    return sanitizePosition({\r\n      x: player.x, // STAY at your current X\r\n      y: player.y, // STAY at your current Y\r\n      movement: 'kickoff_hold_position', // New, clear movement name\r\n      role: role\r\n    }, { player });\r\n  },\r\n\r\n  /**\r\n   * Check if a player's position is valid for kickoff\r\n   * (This function is still useful for validation by other systems)\r\n   */\r\n  isValidKickoffPosition(player: Player, position: Vector2D, isKickingTeam: boolean, gameState: GameState): boolean {\r\n    if (!position || !gameState) return false;\r\n\r\n    const centerX = GAME_CONFIG.PITCH_WIDTH / 2;\r\n    const centerY = GAME_CONFIG.PITCH_HEIGHT / 2;\r\n    const ownGoalX = getAttackingGoalX(!player.isHome, gameState.currentHalf);\r\n    const ownHalfIsLeft = ownGoalX < centerX;\r\n\r\n    // Check if in own half (with 10px tolerance)\r\n    const inOwnHalf = ownHalfIsLeft\r\n      ? position.x <= centerX + 10\r\n      : position.x >= centerX - 10;\r\n\r\n    if (!inOwnHalf) {\r\n      console.warn(`Player ${player.name} not in own half: x=${position.x}, ownHalfIsLeft=${ownHalfIsLeft}`);\r\n      return false;\r\n    }\r\n\r\n    // If defending team, must be outside center circle\r\n    if (!isKickingTeam) {\r\n      const distToCenter = distance(position, { x: centerX, y: centerY });\r\n      if (distToCenter < 70) { // 70px is ~10 yards\r\n        console.warn(`Defending player ${player.name} too close to center: ${distToCenter}px`);\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  },\r\n\r\n  /**\r\n   * Get the two designated kickers for kickoff\r\n   * (This function is still useful for validation by other systems)\r\n   */\r\n  getDesignatedKickers(gameState: GameState): DesignatedKickers {\r\n    if (!gameState || !gameState.setPiece) return { primary: null, secondary: null };\r\n\r\n    const kickingTeamIsHome = (gameState.setPiece as any).team === true || (gameState.setPiece as any).team === 'home';\r\n    const kickingTeamPlayers = kickingTeamIsHome ? gameState.homePlayers : gameState.awayPlayers;\r\n\r\n    if (!kickingTeamPlayers || kickingTeamPlayers.length === 0) {\r\n      return { primary: null, secondary: null };\r\n    }\r\n\r\n    const centerX = GAME_CONFIG.PITCH_WIDTH / 2;\r\n    const centerY = GAME_CONFIG.PITCH_HEIGHT / 2;\r\n\r\n    // Find players closest to center\r\n    const playersNearCenter = kickingTeamPlayers\r\n      .filter(p => p.role !== 'GK')\r\n      .map(p => ({\r\n        player: p,\r\n        dist: distance(p, { x: centerX, y: centerY })\r\n      }))\r\n      .sort((a, b) => a.dist - b.dist);\r\n\r\n    return {\r\n      primary: playersNearCenter[0]?.player || null,\r\n      secondary: playersNearCenter[1]?.player || null\r\n    };\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// BROWSER EXPORTS\r\n// ============================================================================\r\n// Functions are now exported via ES6 modules - no window exports needed\r\nconsole.log('\u2705 KICKOFF BEHAVIORS LOADED - (Simplified HOLD_POSITION fix)');\r\n", "/**\r\n * Penalty Kick Behaviors - TypeScript Migration\r\n *\r\n * Handles player positioning for penalty kicks:\r\n * - Kicker positioning at penalty spot\r\n * - Penalty arc waiting positions\r\n * - Goalkeeper positioning\r\n *\r\n * @module setpieces/behaviors/penalty\r\n * @migrated-from js/setpieces/behaviors/penalty.js\r\n */\r\n\r\nimport type { Player, GameState, Vector2D } from '../../types';\r\nimport { sanitizePosition } from '../utils';\r\nimport { getAttackingGoalX } from '../../utils/ui';\r\n\r\n// ============================================================================\r\n// PENALTY KICK BEHAVIORS\r\n// ============================================================================\r\n\r\nexport const PenaltyKickBehaviors = {\r\n  /**\r\n   * Get kicker position at penalty spot\r\n   */\r\n  getKickerPosition(penaltyPos: Vector2D) {\r\n    return sanitizePosition(\r\n      { x: penaltyPos.x, y: penaltyPos.y, movement: 'penalty_kicker', role: 'PENALTY_KICKER' },\r\n      {}\r\n    );\r\n  },\r\n\r\n  /**\r\n   * Get penalty arc position for waiting players\r\n   */\r\n  getPenaltyArcPosition(player: Player, penaltyPos: Vector2D, isAttacking: boolean, gameState: GameState) {\r\n    if (!player) {\r\n      return sanitizePosition({ x: 400, y: 300, movement: 'penalty_arc' }, {});\r\n    }\r\n\r\n    if (player.role === 'GK') {\r\n      const goalX = isAttacking ?\r\n        getAttackingGoalX(!player.isHome, gameState.currentHalf) :\r\n        getAttackingGoalX(player.isHome, gameState.currentHalf);\r\n      return sanitizePosition({ x: goalX, y: 300, movement: 'gk_penalty', role: 'GK' }, { player });\r\n    }\r\n\r\n    const arcRadius = 110;\r\n    const angle = Math.random() * Math.PI - Math.PI / 2;\r\n    const x = penaltyPos.x + Math.cos(angle) * arcRadius;\r\n    const y = penaltyPos.y + Math.sin(angle) * arcRadius;\r\n\r\n    return sanitizePosition({ x, y, movement: 'penalty_arc_wait' }, { player });\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// BROWSER EXPORTS\r\n// ============================================================================\r\n\r\n\r\n", "/**\r\n * Throw-In Behaviors - TypeScript Migration\r\n *\r\n * Professional throw-in positioning system with:\r\n * - Attacking throw-in formations with short and long options\r\n * - Defensive throw-in marking and pressing\r\n * - Position-aware spacing based on field location\r\n * - Role-based player assignments\r\n *\r\n * @module setpieces/behaviors/throwIn\r\n * @migrated-from js/setpieces/behaviors/throwIn.js\r\n */\r\n\r\nimport type { Player, GameState, Vector2D } from '../../types';\r\nimport {\r\n  sanitizePosition,\r\n  PositionManager,\r\n  getValidPlayers,\r\n  getSortedLists\r\n} from '../utils';\r\nimport { GAME_CONFIG } from '../../config';\r\nimport { getPlayerActivePosition } from '../../ai/movement';\r\nimport { distance as getDistance } from '../../utils/math';\r\n\r\n// ============================================================================\r\n// TYPE DEFINITIONS\r\n// ============================================================================\r\n\r\ninterface ThrowInZones {\r\n  thrower: Vector2D;\r\n  shortOption: Vector2D;\r\n  downLine: Vector2D;\r\n  infield: Vector2D;\r\n  support: Vector2D;\r\n  deepTarget: Vector2D;\r\n  nearMidfield: Vector2D;\r\n  farMidfield: Vector2D;\r\n  defensiveCover: Vector2D[];\r\n  strikerPosition: Vector2D | null;\r\n}\r\n\r\ninterface PlayerJobAssignment extends Vector2D {\r\n  movement: string;\r\n  role: string;\r\n  priority: number;\r\n  runTiming?: string;\r\n}\r\n\r\n// ============================================================================\r\n// PROFESSIONAL THROW-IN BEHAVIORS\r\n// ============================================================================\r\n\r\nexport const ThrowInBehaviors = {\r\n  getThrowInPosition(\r\n    player: Player,\r\n    throwPos: Vector2D,\r\n    ownGoalX: number,\r\n    opponentGoalX: number,\r\n    gameState: GameState,\r\n    teammates: Player[],\r\n    opponents: Player[]\r\n  ) {\r\n    if (!gameState || !player || !throwPos) {\r\n      return sanitizePosition({ x: player?.x ?? 400, y: player?.y ?? 300, movement: 'error_throw' }, { player });\r\n    }\r\n\r\n    if (player.role === 'GK') {\r\n      return sanitizePosition({ x: ownGoalX, y: 300, movement: 'gk_stay_goal', role: 'GK' }, { player, role: 'GK' });\r\n    }\r\n\r\n    // CRITICAL FIX: Determine if this player's team has the throw-in\r\n    // If not, they should be defending, not attacking\r\n    const throwInTeam = (gameState.setPiece as any)?.team;\r\n    const throwInTeamIsHome = (typeof throwInTeam === 'boolean') ? throwInTeam : (throwInTeam === 'home');\r\n    const hasThrowIn = player.isHome === throwInTeamIsHome;\r\n\r\n    // If this player's team doesn't have the throw-in, use defending positioning\r\n    if (!hasThrowIn) {\r\n      return this.getDefendingThrowInPosition(player, throwPos, ownGoalX, gameState, teammates);\r\n    }\r\n\r\n    const PITCH_WIDTH = GAME_CONFIG.PITCH_WIDTH;\r\n    const PITCH_HEIGHT = GAME_CONFIG.PITCH_HEIGHT;\r\n\r\n    const direction = Math.sign(opponentGoalX - 400);\r\n    const isInAttackingThird = Math.abs(throwPos.x - opponentGoalX) < PITCH_WIDTH / 3;\r\n    const isInDefensiveThird = Math.abs(throwPos.x - ownGoalX) < PITCH_WIDTH / 3;\r\n    const isInMiddleThird = !isInAttackingThird && !isInDefensiveThird;\r\n\r\n    if (!(gameState as any)._throwInPosManager) (gameState as any)._throwInPosManager = new PositionManager();\r\n    const posManager = (gameState as any)._throwInPosManager;\r\n\r\n    const setupKey = `_lastThrowInSetup_H${gameState.currentHalf}`;\r\n    if (!(gameState as any)[setupKey] || (gameState as any)[setupKey] !== gameState.setPiece) {\r\n      (gameState as any)[setupKey] = gameState.setPiece;\r\n      posManager.reset();\r\n\r\n      const playerJobs = new Map<string, PlayerJobAssignment>();\r\n      const validTeammates = getValidPlayers(teammates).filter(p => p.role !== 'GK');\r\n      const sortedLists = getSortedLists(validTeammates, getValidPlayers(opponents));\r\n\r\n      const assigned = new Set<string>();\r\n\r\n      // Professional throw-in zones - ENHANCED with position-aware spacing\r\n      // CORRECTED: Thrower must be positioned EXACTLY at the touchline (sideline)\r\n      const touchlineY = throwPos.y < 300 ? 5 : (PITCH_HEIGHT - 5); // Top or bottom touchline\r\n      const infieldDirection = throwPos.y < 300 ? 1 : -1; // Direction towards center of pitch\r\n\r\n      // Adjust zones based on field position for professional spacing\r\n      const forwardAdvance = isInAttackingThird ? 60 : (isInMiddleThird ? 45 : 30);\r\n\r\n      const ZONES: ThrowInZones = {\r\n        thrower: { x: throwPos.x, y: touchlineY }, // EXACT touchline position\r\n        // Short option - close support for quick return pass\r\n        shortOption: {\r\n          x: throwPos.x + direction * 28,\r\n          y: touchlineY + infieldDirection * 32\r\n        },\r\n        // Down the line - runner making forward run along touchline\r\n        downLine: {\r\n          x: throwPos.x + direction * forwardAdvance,\r\n          y: touchlineY + infieldDirection * 20\r\n        },\r\n        // Infield - central player offering passing lane\r\n        infield: {\r\n          x: throwPos.x + direction * 35,\r\n          y: PITCH_HEIGHT / 2 + (throwPos.y < 300 ? 50 : -50)\r\n        },\r\n        // Support behind - safety option\r\n        support: {\r\n          x: throwPos.x - direction * 25,\r\n          y: touchlineY + infieldDirection * 35\r\n        },\r\n        // Deep target - forward player for long throw\r\n        deepTarget: {\r\n          x: throwPos.x + direction * (forwardAdvance + 50),\r\n          y: PITCH_HEIGHT / 2\r\n        },\r\n        // Near-side midfielder - link-up play\r\n        nearMidfield: {\r\n          x: throwPos.x + direction * 20,\r\n          y: PITCH_HEIGHT / 2 + (throwPos.y < 300 ? 80 : -80)\r\n        },\r\n        // Far-side midfielder - switch play option\r\n        farMidfield: {\r\n          x: throwPos.x + direction * 30,\r\n          y: PITCH_HEIGHT / 2 - (throwPos.y < 300 ? 80 : -80)\r\n        },\r\n        // Defensive cover - counter-attack prevention\r\n        defensiveCover: [\r\n          { x: throwPos.x - direction * (isInAttackingThird ? 120 : 80), y: 220 },\r\n          { x: throwPos.x - direction * (isInAttackingThird ? 120 : 80), y: 380 },\r\n          { x: throwPos.x - direction * (isInAttackingThird ? 100 : 60), y: PITCH_HEIGHT / 2 }\r\n        ],\r\n        // Striker positioning - only in attacking third\r\n        strikerPosition: isInAttackingThird ? {\r\n          x: opponentGoalX - direction * 100,\r\n          y: PITCH_HEIGHT / 2\r\n        } : null\r\n      };\r\n\r\n      // Select thrower - nearest fullback/wingback/winger\r\n      const throwerCandidates = validTeammates\r\n        .filter(p => ['RB', 'LB', 'RWB', 'LWB', 'RW', 'LW', 'RM', 'LM'].some(role => p.role.includes(role)))\r\n        .sort((a, b) => getDistance(a, throwPos) - getDistance(b, throwPos));\r\n\r\n      const thrower = throwerCandidates[0] || (validTeammates.length > 0\r\n        ? validTeammates.sort((a, b) => getDistance(a, throwPos) - getDistance(b, throwPos))[0]\r\n        : null);\r\n\r\n      if (thrower) {\r\n        playerJobs.set(String(thrower.id), {\r\n          ...ZONES.thrower,\r\n          movement: 'throw_in_taker',\r\n          role: 'THROWER',\r\n          priority: 10\r\n        });\r\n        assigned.add(String(thrower.id));\r\n      }\r\n\r\n      if (isInAttackingThird) {\r\n        // Attacking throw-in - create overload with position-specific roles\r\n        // Strikers - stay forward as deep targets\r\n        const strikers = validTeammates.filter(p =>\r\n          !assigned.has(String(p.id)) &&\r\n          ['ST', 'CF'].some(r => p.role.includes(r))\r\n        );\r\n        if (strikers[0] && ZONES.strikerPosition) {\r\n          const finalPos = posManager.findValidPosition(ZONES.strikerPosition);\r\n          playerJobs.set(String(strikers[0].id), {\r\n            ...finalPos,\r\n            movement: 'striker_target',\r\n            role: 'STRIKER_TARGET',\r\n            priority: 9\r\n          });\r\n          assigned.add(String(strikers[0].id));\r\n        }\r\n\r\n        // Wingers/attacking midfielders - short option and down the line\r\n        const attackers = validTeammates.filter(p =>\r\n          !assigned.has(String(p.id)) &&\r\n          ['RW', 'LW', 'CAM', 'RM', 'LM'].some(r => p.role.includes(r))\r\n        ).slice(0, 2);\r\n\r\n        if (attackers[0]) {\r\n          const finalPos = posManager.findValidPosition(ZONES.shortOption);\r\n          playerJobs.set(String(attackers[0].id), {\r\n            ...finalPos,\r\n            movement: 'short_option_attack',\r\n            role: 'SHORT_OPTION',\r\n            priority: 9\r\n          });\r\n          assigned.add(String(attackers[0].id));\r\n        }\r\n\r\n        if (attackers[1]) {\r\n          const finalPos = posManager.findValidPosition(ZONES.downLine);\r\n          playerJobs.set(String(attackers[1].id), {\r\n            ...finalPos,\r\n            movement: 'down_line_run',\r\n            role: 'DOWN_LINE',\r\n            runTiming: 'ON_THROW',\r\n            priority: 8\r\n          });\r\n          assigned.add(String(attackers[1].id));\r\n        }\r\n\r\n        // Central midfielders - infield link-up\r\n        const midfielders = validTeammates.filter(p =>\r\n          !assigned.has(String(p.id)) &&\r\n          ['CM', 'CAM'].some(r => p.role.includes(r))\r\n        ).slice(0, 2);\r\n\r\n        if (midfielders[0]) {\r\n          const finalPos = posManager.findValidPosition(ZONES.nearMidfield);\r\n          playerJobs.set(String(midfielders[0].id), {\r\n            ...finalPos,\r\n            movement: 'infield_link',\r\n            role: 'INFIELD_LINK',\r\n            priority: 8\r\n          });\r\n          assigned.add(String(midfielders[0].id));\r\n        }\r\n\r\n        if (midfielders[1]) {\r\n          const finalPos = posManager.findValidPosition(ZONES.farMidfield);\r\n          playerJobs.set(String(midfielders[1].id), {\r\n            ...finalPos,\r\n            movement: 'far_side_option',\r\n            role: 'FAR_SIDE',\r\n            priority: 7\r\n          });\r\n          assigned.add(String(midfielders[1].id));\r\n        }\r\n      } else if (isInDefensiveThird) {\r\n        // Defensive throw-in - safe options, defenders stay back\r\n        // Defensive midfielder - safe short option\r\n        const defMid = validTeammates.find(p =>\r\n          !assigned.has(String(p.id)) &&\r\n          ['CDM', 'CM'].some(r => p.role.includes(r))\r\n        );\r\n        if (defMid) {\r\n          const finalPos = posManager.findValidPosition(ZONES.shortOption);\r\n          playerJobs.set(String(defMid.id), {\r\n            ...finalPos,\r\n            movement: 'safe_short',\r\n            role: 'SAFE_OPTION',\r\n            priority: 9\r\n          });\r\n          assigned.add(String(defMid.id));\r\n        }\r\n\r\n        // Center backs - support behind for safety\r\n        const centerBacks = validTeammates.filter(p =>\r\n          !assigned.has(String(p.id)) &&\r\n          ['CB'].some(r => p.role.includes(r))\r\n        ).slice(0, 2);\r\n\r\n        if (centerBacks[0]) {\r\n          const finalPos = posManager.findValidPosition(ZONES.support);\r\n          playerJobs.set(String(centerBacks[0].id), {\r\n            ...finalPos,\r\n            movement: 'defensive_support',\r\n            role: 'SUPPORT',\r\n            priority: 8\r\n          });\r\n          assigned.add(String(centerBacks[0].id));\r\n        }\r\n\r\n        // Attacking players - stay forward for counter-attack outlet\r\n        const forwards = validTeammates.filter(p =>\r\n          !assigned.has(String(p.id)) &&\r\n          ['ST', 'RW', 'LW'].some(r => p.role.includes(r))\r\n        ).slice(0, 2);\r\n\r\n        forwards.forEach((fwd, idx) => {\r\n          const finalPos = posManager.findValidPosition(\r\n            idx === 0 ? ZONES.deepTarget : ZONES.infield\r\n          );\r\n          playerJobs.set(String(fwd.id), {\r\n            ...finalPos,\r\n            movement: 'counter_outlet',\r\n            role: `OUTLET_${idx}`,\r\n            priority: 7\r\n          });\r\n          assigned.add(String(fwd.id));\r\n        });\r\n      } else {\r\n        // Midfield throw-in - balanced approach\r\n        // Midfielders - create passing options\r\n        const mids = validTeammates.filter(p =>\r\n          !assigned.has(String(p.id)) &&\r\n          ['CM', 'CDM', 'CAM', 'RM', 'LM'].some(r => p.role.includes(r))\r\n        ).slice(0, 3);\r\n\r\n        const zones = [ZONES.shortOption, ZONES.nearMidfield, ZONES.infield];\r\n        mids.forEach((mid, idx) => {\r\n          if (zones[idx]) {\r\n            const finalPos = posManager.findValidPosition(zones[idx]);\r\n            playerJobs.set(String(mid.id), {\r\n              ...finalPos,\r\n              movement: `midfield_receiver_${idx}`,\r\n              role: `MID_RECEIVER_${idx}`,\r\n              priority: 8 - idx\r\n            });\r\n            assigned.add(String(mid.id));\r\n          }\r\n        });\r\n\r\n        // Forwards - position for progression\r\n        const attackers = validTeammates.filter(p =>\r\n          !assigned.has(String(p.id)) &&\r\n          ['ST', 'RW', 'LW'].some(r => p.role.includes(r))\r\n        ).slice(0, 2);\r\n\r\n        if (attackers[0]) {\r\n          const finalPos = posManager.findValidPosition(ZONES.downLine);\r\n          playerJobs.set(String(attackers[0].id), {\r\n            ...finalPos,\r\n            movement: 'forward_run',\r\n            role: 'FORWARD_RUNNER',\r\n            priority: 7\r\n          });\r\n          assigned.add(String(attackers[0].id));\r\n        }\r\n      }\r\n\r\n      // Defensive cover - keep shape\r\n      const defenders = sortedLists.teammates.bestDefenders.filter(p => !assigned.has(String(p.id))).slice(0, 2);\r\n      defenders.forEach((def, idx) => {\r\n        if (ZONES.defensiveCover[idx]) {\r\n          const finalPos = posManager.findValidPosition(ZONES.defensiveCover[idx]);\r\n          playerJobs.set(String(def.id), {\r\n            ...finalPos,\r\n            movement: 'defensive_cover_throw',\r\n            role: `DEFENSIVE_COVER_${idx}`,\r\n            priority: 6\r\n          });\r\n          assigned.add(String(def.id));\r\n        }\r\n      });\r\n\r\n      // Remaining players - maintain shape\r\n      validTeammates.forEach(p => {\r\n        if (!assigned.has(String(p.id))) {\r\n          const activePos = getPlayerActivePosition(p, gameState.currentHalf);\r\n          const finalPos = posManager.findValidPosition(activePos);\r\n          playerJobs.set(String(p.id), {\r\n            ...finalPos,\r\n            movement: 'maintain_shape',\r\n            role: 'SHAPE',\r\n            priority: 4\r\n          });\r\n        }\r\n      });\r\n\r\n      (gameState as any)._throwInJobAssignments = playerJobs;\r\n    }\r\n\r\n    const playerIdStr = String(player.id);\r\n    const myPositionData = (gameState as any)._throwInJobAssignments?.get(playerIdStr);\r\n\r\n    if (myPositionData) {\r\n      return sanitizePosition(myPositionData, { player, gameState, behavior: 'ProfessionalThrowIn' });\r\n    }\r\n\r\n    const activePos = getPlayerActivePosition(player, gameState.currentHalf);\r\n    return sanitizePosition({ x: activePos.x, y: activePos.y, movement: 'fallback_throw' }, { player });\r\n  },\r\n\r\n  /**\r\n   * Defending throw-in positioning - opponents mark and cover space\r\n   */\r\n  getDefendingThrowInPosition(\r\n    player: Player,\r\n    throwPos: Vector2D,\r\n    ownGoalX: number,\r\n    gameState: GameState,\r\n    teammates: Player[]\r\n  ) {\r\n    if (!gameState || !player || !throwPos) {\r\n      return sanitizePosition({ x: player?.x ?? 400, y: player?.y ?? 300, movement: 'error_throw_def' }, { player });\r\n    }\r\n\r\n    const PITCH_HEIGHT = GAME_CONFIG.PITCH_HEIGHT;\r\n\r\n    const direction = Math.sign(throwPos.x - ownGoalX);\r\n    const touchlineY = throwPos.y < 300 ? 5 : (PITCH_HEIGHT - 5);\r\n\r\n    if (!(gameState as any)._throwInDefPosManager) (gameState as any)._throwInDefPosManager = new PositionManager();\r\n    const posManager = (gameState as any)._throwInDefPosManager;\r\n\r\n    const setupKey = `_lastThrowInDefSetup_H${gameState.currentHalf}`;\r\n    if (!(gameState as any)[setupKey] || (gameState as any)[setupKey] !== gameState.setPiece) {\r\n      (gameState as any)[setupKey] = gameState.setPiece;\r\n      posManager.reset();\r\n\r\n      const playerJobs = new Map<string, PlayerJobAssignment>();\r\n      const validTeammates = getValidPlayers(teammates).filter(p => p.role !== 'GK');\r\n      const sortedLists = getSortedLists(validTeammates, []);\r\n\r\n      const assigned = new Set<string>();\r\n\r\n      // Defending throw-in: Mark thrower and cover passing lanes\r\n      // Position 1-2 players to press thrower\r\n      const pressers = sortedLists.teammates.fastest.slice(0, 2);\r\n      pressers.forEach((presser, idx) => {\r\n        const xOffset = idx === 0 ? 15 : 25;\r\n        const yOffset = throwPos.y < 300 ? 25 : -25;\r\n        const finalPos = posManager.findValidPosition({\r\n          x: throwPos.x + direction * xOffset,\r\n          y: touchlineY + yOffset\r\n        });\r\n        playerJobs.set(String(presser.id), {\r\n          ...finalPos,\r\n          movement: 'press_thrower',\r\n          role: `PRESS_THROWER_${idx}`,\r\n          priority: 9\r\n        });\r\n        assigned.add(String(presser.id));\r\n      });\r\n\r\n      // Position defenders to mark potential receivers\r\n      const markers = validTeammates.filter(p => !assigned.has(String(p.id))).slice(0, 4);\r\n      markers.forEach((marker, idx) => {\r\n        const xSpread = throwPos.x + direction * (30 + idx * 25);\r\n        const ySpread = throwPos.y < 300\r\n          ? 120 + idx * 80\r\n          : 480 - idx * 80;\r\n        const finalPos = posManager.findValidPosition({\r\n          x: xSpread,\r\n          y: ySpread\r\n        });\r\n        playerJobs.set(String(marker.id), {\r\n          ...finalPos,\r\n          movement: 'mark_space',\r\n          role: `MARK_SPACE_${idx}`,\r\n          priority: 8 - idx\r\n        });\r\n        assigned.add(String(marker.id));\r\n      });\r\n\r\n      // Remaining players - maintain defensive shape\r\n      validTeammates.forEach(p => {\r\n        if (!assigned.has(String(p.id))) {\r\n          const activePos = getPlayerActivePosition(p, gameState.currentHalf);\r\n          const finalPos = posManager.findValidPosition(activePos);\r\n          playerJobs.set(String(p.id), {\r\n            ...finalPos,\r\n            movement: 'maintain_def_shape',\r\n            role: 'DEF_SHAPE',\r\n            priority: 5\r\n          });\r\n        }\r\n      });\r\n\r\n      (gameState as any)._throwInDefJobAssignments = playerJobs;\r\n    }\r\n\r\n    const playerIdStr = String(player.id);\r\n    const myPositionData = (gameState as any)._throwInDefJobAssignments?.get(playerIdStr);\r\n\r\n    if (myPositionData) {\r\n      return sanitizePosition(myPositionData, { player, gameState, behavior: 'DefendingThrowIn' });\r\n    }\r\n\r\n    const activePos = getPlayerActivePosition(player, gameState.currentHalf);\r\n    return sanitizePosition({ x: activePos.x, y: activePos.y, movement: 'fallback_throw_def' }, { player });\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// BROWSER EXPORTS\r\n// ============================================================================\r\n\r\n// Functions are now exported via ES6 modules - no window exports needed\r\nconsole.log('\u2705 THROW-IN BEHAVIORS LOADED (TypeScript)');\r\n", "/**\r\n * Corner Kick Behaviors - TypeScript Migration\r\n *\r\n * Professional corner kick positioning system with:\r\n * - Attacking corner formations with near/far post runs and set routines\r\n * - Defensive corner marking (man-to-man and zonal)\r\n * - Position-aware spacing and tactical assignments\r\n * - Role-based player assignments with run timing\r\n * - Offside-aware positioning\r\n *\r\n * @module setpieces/behaviors/cornerKick\r\n * @migrated-from js/setpieces/behaviors/cornerKick.js\r\n */\r\n\r\nimport type { Player, GameState, Vector2D } from '../../types';\r\nimport {\r\n  sanitizePosition,\r\n  TacticalContext,\r\n  PositionManager,\r\n  getValidPlayers,\r\n  getSortedLists,\r\n  checkAndAdjustOffsidePosition\r\n} from '../utils';\r\nimport { GAME_CONFIG } from '../../config';\r\nimport { getAttackingGoalX } from '../../utils/ui';\r\nimport { getPlayerActivePosition } from '../../ai/movement';\r\n\r\n// ============================================================================\r\n// TYPE DEFINITIONS\r\n// ============================================================================\r\n\r\ninterface CornerZonePosition {\r\n  start: Vector2D;\r\n  target: Vector2D;\r\n}\r\n\r\ninterface CornerZones {\r\n  nearPostRun: CornerZonePosition;\r\n  farPost: CornerZonePosition;\r\n  penaltySpot: CornerZonePosition;\r\n  sixYardSpot: CornerZonePosition;\r\n  edgeBox: Vector2D;\r\n  edgeBoxLeft: Vector2D;\r\n  edgeBoxRight: Vector2D;\r\n  blockingRun: CornerZonePosition;\r\n  decoyNearPost: CornerZonePosition;\r\n  shortCorner: Vector2D;\r\n  defensiveCover: Vector2D[];\r\n}\r\n\r\ninterface DefensiveCornerZones {\r\n  goalLine: Vector2D;\r\n  nearPost6Y: Vector2D;\r\n  farPost6Y: Vector2D;\r\n  central: Vector2D;\r\n  penaltySpot: Vector2D;\r\n  nearPostPenalty: Vector2D;\r\n  farPostPenalty: Vector2D;\r\n  edgeBox: Vector2D;\r\n  shortCornerPress: Vector2D;\r\n}\r\n\r\ninterface PlayerJobAssignment {\r\n  x: number;\r\n  y: number;\r\n  movement: string;\r\n  role: string;\r\n  priority: number;\r\n  runTiming?: string;\r\n  targetX?: number;\r\n  targetY?: number;\r\n  targetId?: string;\r\n}\r\n\r\n// ============================================================================\r\n// PROFESSIONAL CORNER KICK BEHAVIORS\r\n// ============================================================================\r\n\r\nexport const ProfessionalCornerBehaviors = {\r\n  getAttackingCornerPosition(\r\n    player: Player,\r\n    cornerPos: Vector2D,\r\n    opponentGoalX: number,\r\n    teammates: Player[],\r\n    sortedLists: any,\r\n    _routine: any,\r\n    gameState: GameState\r\n  ) {\r\n    if (!gameState || !player || !cornerPos) {\r\n      return sanitizePosition({ x: player?.x ?? 400, y: player?.y ?? 300, movement: 'error_corner_att' }, { player });\r\n    }\r\n\r\n    if (player.role === 'GK') {\r\n      const gkX = getAttackingGoalX(!player.isHome, gameState.currentHalf);\r\n      return sanitizePosition({ x: gkX, y: 300, movement: 'gk_stay_goal', role: 'GK' }, { player, role: 'GK' });\r\n    }\r\n\r\n    const SET_PIECE_TYPES = { CORNER_KICK: 'CORNER_KICK' };\r\n    const PITCH_WIDTH = GAME_CONFIG.PITCH_WIDTH;\r\n    const PITCH_HEIGHT = GAME_CONFIG.PITCH_HEIGHT;\r\n    const activeConfig = { GOAL_Y_TOP: 225, GOAL_Y_BOTTOM: 375 };\r\n\r\n    const context = new TacticalContext(gameState, SET_PIECE_TYPES.CORNER_KICK);\r\n    const shouldCommit = context.shouldCommitForward(player.isHome);\r\n\r\n    if (!sortedLists) sortedLists = getSortedLists(teammates, getValidPlayers(gameState ? (player.isHome ? gameState.awayPlayers : gameState.homePlayers) : []));\r\n\r\n    const isRightCorner = cornerPos.y < (PITCH_HEIGHT / 2);\r\n    const direction = Math.sign(opponentGoalX - (PITCH_WIDTH / 2));\r\n\r\n    // Professional positioning zones with realistic spacing\r\n    const ZONES: CornerZones = {\r\n      // Near post - first runner (arrives just before far post) - PROFESSIONAL: Attack from penalty area with run-up\r\n      nearPostRun: {\r\n        start: { x: opponentGoalX - direction * 125, y: isRightCorner ? activeConfig.GOAL_Y_TOP + 55 : activeConfig.GOAL_Y_BOTTOM - 55 },\r\n        target: { x: opponentGoalX - direction * 95, y: isRightCorner ? activeConfig.GOAL_Y_TOP + 35 : activeConfig.GOAL_Y_BOTTOM - 35 }\r\n      },\r\n      // Far post - power header (starting deeper for run-up) - PROFESSIONAL: Attack from deep with momentum\r\n      farPost: {\r\n        start: { x: opponentGoalX - direction * 140, y: isRightCorner ? activeConfig.GOAL_Y_BOTTOM - 45 : activeConfig.GOAL_Y_TOP + 45 },\r\n        target: { x: opponentGoalX - direction * 105, y: isRightCorner ? activeConfig.GOAL_Y_BOTTOM - 35 : activeConfig.GOAL_Y_TOP + 35 }\r\n      },\r\n      // Penalty spot - central aerial threat\r\n      penaltySpot: {\r\n        start: { x: opponentGoalX - direction * 125, y: PITCH_HEIGHT / 2 + (isRightCorner ? -15 : 15) },\r\n        target: { x: opponentGoalX - direction * 108, y: PITCH_HEIGHT / 2 }\r\n      },\r\n      // Six-yard line - close-range finisher\r\n      sixYardSpot: {\r\n        start: { x: opponentGoalX - direction * 65, y: PITCH_HEIGHT / 2 + (isRightCorner ? 20 : -20) },\r\n        target: { x: opponentGoalX - direction * 35, y: PITCH_HEIGHT / 2 }\r\n      },\r\n      // Edge of box - cutback receiver and long-range threat\r\n      edgeBox: { x: opponentGoalX - direction * 185, y: PITCH_HEIGHT / 2 },\r\n      edgeBoxLeft: { x: opponentGoalX - direction * 180, y: PITCH_HEIGHT / 2 - 60 },\r\n      edgeBoxRight: { x: opponentGoalX - direction * 180, y: PITCH_HEIGHT / 2 + 60 },\r\n      // Blocking run - creates space (decoy movement)\r\n      blockingRun: {\r\n        start: { x: opponentGoalX - direction * 98, y: isRightCorner ? activeConfig.GOAL_Y_TOP + 65 : activeConfig.GOAL_Y_BOTTOM - 65 },\r\n        target: { x: opponentGoalX - direction * 85, y: PITCH_HEIGHT / 2 + (isRightCorner ? -10 : 10) }\r\n      },\r\n      // Decoy near post run (pulls defender) - PROFESSIONAL: Attack from penalty area with realistic spacing\r\n      decoyNearPost: {\r\n        start: { x: opponentGoalX - direction * 118, y: isRightCorner ? activeConfig.GOAL_Y_TOP + 40 : activeConfig.GOAL_Y_BOTTOM - 40 },\r\n        target: { x: opponentGoalX - direction * 92, y: isRightCorner ? activeConfig.GOAL_Y_TOP + 30 : activeConfig.GOAL_Y_BOTTOM - 30 }\r\n      },\r\n      // Short corner option\r\n      shortCorner: { x: cornerPos.x - direction * 32, y: cornerPos.y + (isRightCorner ? 28 : -28) },\r\n      // Counter-attack prevention (hold defensive shape)\r\n      defensiveCover: [\r\n        { x: opponentGoalX - direction * 285, y: 210 },\r\n        { x: opponentGoalX - direction * 285, y: 390 },\r\n        { x: opponentGoalX - direction * 250, y: PITCH_HEIGHT / 2 }\r\n      ]\r\n    };\r\n\r\n    if (!(gameState as any)._cornerPosManager) (gameState as any)._cornerPosManager = new PositionManager();\r\n    const posManager = (gameState as any)._cornerPosManager;\r\n\r\n    const setupKey = `_lastCornerAttSetup_H${gameState.currentHalf}`;\r\n    if (!(gameState as any)[setupKey] || (gameState as any)[setupKey] !== gameState.setPiece) {\r\n      (gameState as any)[setupKey] = gameState.setPiece;\r\n      posManager.reset();\r\n\r\n      // Mark priority zones for runs\r\n      posManager.markPriorityZone(ZONES.nearPostRun.target.x, ZONES.nearPostRun.target.y);\r\n      posManager.markPriorityZone(ZONES.farPost.target.x, ZONES.farPost.target.y);\r\n\r\n      const playerJobs = new Map<string, PlayerJobAssignment>();\r\n      const validTeammates = getValidPlayers(teammates).filter(p => p.role !== 'GK');\r\n\r\n      // ENHANCED: Position-specific role assignment\r\n      // Defensive players based on role\r\n      const defensivePlayers = validTeammates.filter(p =>\r\n        p.role === 'CB' || p.role === 'LB' || p.role === 'RB' || p.role === 'CDM'\r\n      );\r\n\r\n      // Select players based on attributes AND position\r\n      const bestKicker = sortedLists.teammates.bestKickers[0];\r\n      const aerialThreats = sortedLists.teammates.bestHeaders.slice(0, 4);\r\n      const fastRunners = sortedLists.teammates.fastest.slice(0, 3);\r\n\r\n      // Defenders: Only commit if desperate, otherwise stay back\r\n      const defendersToCommit = shouldCommit ?\r\n        defensivePlayers.filter(p => p.role !== 'GK').slice(0, 1) :\r\n        [];\r\n      const defendersToStayBack = shouldCommit ?\r\n        defensivePlayers.filter(p => !defendersToCommit.includes(p) && p.role !== 'GK').slice(0, 2) :\r\n        defensivePlayers.filter(p => p.role !== 'GK').slice(0, 3);\r\n\r\n      const assigned = new Set<string>();\r\n\r\n      // Assign kicker - prefer players with good passing/crossing\r\n      if (bestKicker) {\r\n        const kickerId = String(bestKicker.id);\r\n        playerJobs.set(kickerId, {\r\n          x: cornerPos.x - direction * 8,\r\n          y: cornerPos.y + 8,\r\n          movement: 'corner_kicker',\r\n          role: 'CORNER_KICKER',\r\n          priority: 10\r\n        });\r\n        assigned.add(kickerId);\r\n      }\r\n\r\n      // Strikers and attacking players - prioritize for attacking roles\r\n      // Near post runner - fast striker or winger (arrives first)\r\n      if (fastRunners[0] && !assigned.has(String(fastRunners[0].id))) {\r\n        const runnerId = String(fastRunners[0].id);\r\n        playerJobs.set(runnerId, {\r\n          ...ZONES.nearPostRun.start,\r\n          targetX: ZONES.nearPostRun.target.x,\r\n          targetY: ZONES.nearPostRun.target.y,\r\n          movement: 'near_post_run',\r\n          role: 'NEAR_POST_RUNNER',\r\n          runTiming: 'ON_KICK',\r\n          priority: 10\r\n        });\r\n        assigned.add(runnerId);\r\n      }\r\n\r\n      // Far post threat - best header (powerful presence)\r\n      if (aerialThreats[0] && !assigned.has(String(aerialThreats[0].id))) {\r\n        const headerId = String(aerialThreats[0].id);\r\n        playerJobs.set(headerId, {\r\n          ...ZONES.farPost.start,\r\n          targetX: ZONES.farPost.target.x,\r\n          targetY: ZONES.farPost.target.y,\r\n          movement: 'far_post_attack',\r\n          role: 'FAR_POST_THREAT',\r\n          runTiming: 'DELAYED',\r\n          priority: 10\r\n        });\r\n        assigned.add(headerId);\r\n      }\r\n\r\n      // Penalty spot presence - central threat\r\n      if (aerialThreats[1] && !assigned.has(String(aerialThreats[1].id))) {\r\n        const penaltyId = String(aerialThreats[1].id);\r\n        playerJobs.set(penaltyId, {\r\n          ...ZONES.penaltySpot.start,\r\n          targetX: ZONES.penaltySpot.target.x,\r\n          targetY: ZONES.penaltySpot.target.y,\r\n          movement: 'penalty_spot_threat',\r\n          role: 'PENALTY_SPOT',\r\n          runTiming: 'IMMEDIATE',\r\n          priority: 9\r\n        });\r\n        assigned.add(penaltyId);\r\n      }\r\n\r\n      // Six-yard box threat - close-range finisher\r\n      if (aerialThreats[2] && !assigned.has(String(aerialThreats[2].id))) {\r\n        const sixYardId = String(aerialThreats[2].id);\r\n        playerJobs.set(sixYardId, {\r\n          ...ZONES.sixYardSpot.start,\r\n          targetX: ZONES.sixYardSpot.target.x,\r\n          targetY: ZONES.sixYardSpot.target.y,\r\n          movement: 'six_yard_threat',\r\n          role: 'SIX_YARD',\r\n          runTiming: 'ON_KICK',\r\n          priority: 9\r\n        });\r\n        assigned.add(sixYardId);\r\n      }\r\n\r\n      // Blocking run - creates space for others (decoy)\r\n      if (fastRunners[1] && !assigned.has(String(fastRunners[1].id))) {\r\n        const blockerId = String(fastRunners[1].id);\r\n        playerJobs.set(blockerId, {\r\n          ...ZONES.blockingRun.start,\r\n          targetX: ZONES.blockingRun.target.x,\r\n          targetY: ZONES.blockingRun.target.y,\r\n          movement: 'blocking_run',\r\n          role: 'BLOCKER',\r\n          runTiming: 'EARLY',\r\n          priority: 8\r\n        });\r\n        assigned.add(blockerId);\r\n      }\r\n\r\n      // Decoy near post run - pulls defenders\r\n      const decoyRunner = validTeammates.find(p =>\r\n        !assigned.has(String(p.id)) &&\r\n        (p.role.includes('CM') || p.role.includes('CAM') || p.role.includes('ST'))\r\n      );\r\n      if (decoyRunner) {\r\n        playerJobs.set(String(decoyRunner.id), {\r\n          ...ZONES.decoyNearPost.start,\r\n          targetX: ZONES.decoyNearPost.target.x,\r\n          targetY: ZONES.decoyNearPost.target.y,\r\n          movement: 'decoy_near_post',\r\n          role: 'DECOY',\r\n          runTiming: 'EARLY',\r\n          priority: 7\r\n        });\r\n        assigned.add(String(decoyRunner.id));\r\n      }\r\n\r\n      // Edge of box positions - three players for rebounds/cutbacks\r\n      const edgePositions = [ZONES.edgeBox, ZONES.edgeBoxLeft, ZONES.edgeBoxRight];\r\n      const edgePlayers = validTeammates\r\n        .filter(p => !assigned.has(String(p.id)) && (p.role.includes('CM') || p.role.includes('CDM') || p.role.includes('CAM')))\r\n        .slice(0, 3);\r\n\r\n      edgePlayers.forEach((edgePlayer, idx) => {\r\n        if (edgePositions[idx]) {\r\n          const finalPos = posManager.findValidPosition(edgePositions[idx]);\r\n          playerJobs.set(String(edgePlayer.id), {\r\n            ...finalPos,\r\n            movement: `edge_box_${idx}`,\r\n            role: `EDGE_BOX_${idx}`,\r\n            priority: 6\r\n          });\r\n          assigned.add(String(edgePlayer.id));\r\n        }\r\n      });\r\n\r\n      // [defenders-fix] Defensive cover - prevent counter (3 players now)\r\n      // Use defendersToStayBack instead of undefined 'defenders' variable\r\n      let defIdx = 0;\r\n      defendersToStayBack.forEach(def => {\r\n        if (!assigned.has(String(def.id)) && defIdx < ZONES.defensiveCover.length) {\r\n          const finalPos = posManager.findValidPosition(ZONES.defensiveCover[defIdx]);\r\n          playerJobs.set(String(def.id), {\r\n            ...finalPos,\r\n            movement: 'defensive_cover_corner',\r\n            role: `DEFENSIVE_COVER_${defIdx}`,\r\n            priority: 5\r\n          });\r\n          assigned.add(String(def.id));\r\n          defIdx++;\r\n        }\r\n      });\r\n\r\n      // Remaining players - support positions\r\n      let supportIdx = 0;\r\n      validTeammates.forEach(p => {\r\n        if (!assigned.has(String(p.id))) {\r\n          const activePos = getPlayerActivePosition(p, gameState.currentHalf);\r\n          const finalPos = posManager.findValidPosition(activePos);\r\n          playerJobs.set(String(p.id), {\r\n            ...finalPos,\r\n            movement: 'support_corner',\r\n            role: `SUPPORT_${supportIdx}`,\r\n            priority: 3\r\n          });\r\n          supportIdx++;\r\n        }\r\n      });\r\n\r\n      (gameState as any)._cornerJobAssignments = playerJobs;\r\n    }\r\n\r\n    const playerIdStr = String(player.id);\r\n    const myPositionData = (gameState as any)._cornerJobAssignments?.get(playerIdStr);\r\n\r\n    if (myPositionData) {\r\n      // OFSAYT KONTROL\u00DC: H\u00FCcum pozisyonlar\u0131nda ofsayt kontrol\u00FC yap\r\n      const opponents = getValidPlayers(player.isHome ? gameState.awayPlayers : gameState.homePlayers);\r\n      const adjustedPosition = checkAndAdjustOffsidePosition(\r\n        myPositionData,\r\n        player,\r\n        opponentGoalX,\r\n        opponents,\r\n        gameState\r\n      );\r\n      return sanitizePosition(adjustedPosition, { player, gameState, behavior: 'ProfessionalCornerAttacking' });\r\n    }\r\n\r\n    const activePos = getPlayerActivePosition(player, gameState.currentHalf);\r\n    return sanitizePosition({ x: activePos.x, y: activePos.y, movement: 'fallback_corner_att' }, { player });\r\n  },\r\n\r\n  getDefendingCornerPosition(\r\n    player: Player,\r\n    cornerPos: Vector2D,\r\n    ownGoalX: number,\r\n    opponents: Player[],\r\n    sortedLists: any,\r\n    system: string,\r\n    gameState: GameState,\r\n    teammates: Player[]\r\n  ) {\r\n    if (!gameState || !player || !cornerPos) {\r\n      return sanitizePosition({ x: player?.x ?? 400, y: player?.y ?? 300, movement: 'error_corner_def' }, { player });\r\n    }\r\n\r\n    if (player.role === 'GK') {\r\n      // GK positioning based on corner side\r\n      const PITCH_HEIGHT = GAME_CONFIG.PITCH_HEIGHT;\r\n      const activeConfig = { GOAL_Y_TOP: 225, GOAL_Y_BOTTOM: 375 };\r\n      const isRightCorner = cornerPos.y < (PITCH_HEIGHT / 2);\r\n      const gkY = isRightCorner ? activeConfig.GOAL_Y_TOP + 50 : activeConfig.GOAL_Y_BOTTOM - 50;\r\n      return sanitizePosition({ x: ownGoalX, y: gkY, movement: 'gk_corner_positioning', role: 'GK' }, { player, role: 'GK' });\r\n    }\r\n\r\n    const SET_PIECE_TYPES = { CORNER_KICK: 'CORNER_KICK' };\r\n    const PITCH_WIDTH = GAME_CONFIG.PITCH_WIDTH;\r\n    const PITCH_HEIGHT = GAME_CONFIG.PITCH_HEIGHT;\r\n    const activeConfig = { GOAL_Y_TOP: 225, GOAL_Y_BOTTOM: 375 };\r\n\r\n    if (!sortedLists) sortedLists = getSortedLists(teammates, opponents);\r\n\r\n    const direction = Math.sign(ownGoalX - (PITCH_WIDTH / 2));\r\n    const context = new TacticalContext(gameState, SET_PIECE_TYPES.CORNER_KICK);\r\n    const useManMarking = system === 'man_marking' || context.shouldStayCompact(player.isHome);\r\n\r\n    // Professional defensive zones\r\n    const ZONES: DefensiveCornerZones = {\r\n      goalLine: { x: ownGoalX + direction * 8, y: PITCH_HEIGHT / 2 },\r\n      nearPost6Y: { x: ownGoalX + direction * 30, y: activeConfig.GOAL_Y_TOP + 20 },\r\n      farPost6Y: { x: ownGoalX + direction * 30, y: activeConfig.GOAL_Y_BOTTOM - 20 },\r\n      central: { x: ownGoalX + direction * 35, y: PITCH_HEIGHT / 2 },\r\n      penaltySpot: { x: ownGoalX + direction * 110, y: PITCH_HEIGHT / 2 },\r\n      nearPostPenalty: { x: ownGoalX + direction * 95, y: activeConfig.GOAL_Y_TOP + 40 },\r\n      farPostPenalty: { x: ownGoalX + direction * 95, y: activeConfig.GOAL_Y_BOTTOM - 40 },\r\n      edgeBox: { x: ownGoalX + direction * 180, y: PITCH_HEIGHT / 2 },\r\n      shortCornerPress: { x: cornerPos.x + direction * 20, y: cornerPos.y }\r\n    };\r\n\r\n    if (!(gameState as any)._cornerDefPosManager) (gameState as any)._cornerDefPosManager = new PositionManager();\r\n    const posManager = (gameState as any)._cornerDefPosManager;\r\n\r\n    const setupKey = `_lastCornerDefSetup_H${gameState.currentHalf}`;\r\n    if (!(gameState as any)[setupKey] || (gameState as any)[setupKey] !== gameState.setPiece) {\r\n      (gameState as any)[setupKey] = gameState.setPiece;\r\n      posManager.reset();\r\n\r\n      const playerJobs = new Map<string, PlayerJobAssignment>();\r\n      const validTeammates = getValidPlayers(teammates).filter(p => p.role !== 'GK');\r\n      const validOpponents = getValidPlayers(opponents).filter(p => p.role !== 'GK');\r\n\r\n      const opponentMap = new Map(validOpponents.map(p => [String(p.id), p]));\r\n      (gameState as any)._cornerOpponentMap = opponentMap;\r\n\r\n      const assigned = new Set<string>();\r\n\r\n      if (useManMarking) {\r\n        // Man-marking: Assign best defenders to dangerous attackers\r\n        const dangerousAttackers = sortedLists.opponents.mostDangerous.slice(0, Math.min(6, validTeammates.length));\r\n        const bestMarkers = sortedLists.teammates.bestDefenders;\r\n\r\n        dangerousAttackers.forEach((attacker: Player, idx: number) => {\r\n          if (bestMarkers[idx]) {\r\n            const markerId = String(bestMarkers[idx].id);\r\n            playerJobs.set(markerId, {\r\n              x: 0, // Will be updated dynamically\r\n              y: 0, // Will be updated dynamically\r\n              role: `MARK_${attacker.id}`,\r\n              movement: 'tight_man_mark',\r\n              targetId: String(attacker.id),\r\n              priority: 10\r\n            });\r\n            assigned.add(markerId);\r\n          }\r\n        });\r\n      } else {\r\n        // Zonal marking with intelligent positioning\r\n        const zonalAssignments = [\r\n          { zone: 'nearPost6Y' as keyof DefensiveCornerZones, priority: 10, count: 1 },\r\n          { zone: 'farPost6Y' as keyof DefensiveCornerZones, priority: 10, count: 1 },\r\n          { zone: 'central' as keyof DefensiveCornerZones, priority: 9, count: 1 },\r\n          { zone: 'penaltySpot' as keyof DefensiveCornerZones, priority: 8, count: 1 },\r\n          { zone: 'nearPostPenalty' as keyof DefensiveCornerZones, priority: 7, count: 1 },\r\n          { zone: 'farPostPenalty' as keyof DefensiveCornerZones, priority: 7, count: 1 }\r\n        ];\r\n\r\n        let playerIdx = 0;\r\n        zonalAssignments.forEach(assignment => {\r\n          for (let i = 0; i < assignment.count && playerIdx < validTeammates.length; i++) {\r\n            const p = validTeammates[playerIdx];\r\n            if (!p) {\r\n              playerIdx++;\r\n              continue;\r\n            }\r\n            const playerId = String(p.id);\r\n\r\n            if (!assigned.has(playerId)) {\r\n              const zonePos = ZONES[assignment.zone] as Vector2D;\r\n              const finalPos = posManager.findValidPosition(zonePos);\r\n\r\n              playerJobs.set(playerId, {\r\n                ...finalPos,\r\n                movement: `zone_${assignment.zone}`,\r\n                role: `ZONE_${assignment.zone.toUpperCase()}`,\r\n                priority: assignment.priority\r\n              });\r\n              assigned.add(playerId);\r\n            }\r\n            playerIdx++;\r\n          }\r\n        });\r\n      }\r\n\r\n      // Short corner presser - fast player\r\n      const fastPlayer = sortedLists.teammates.fastest.find((p: Player) => !assigned.has(String(p.id)));\r\n      if (fastPlayer) {\r\n        const finalPos = posManager.findValidPosition(ZONES.shortCornerPress);\r\n        playerJobs.set(String(fastPlayer.id), {\r\n          ...finalPos,\r\n          movement: 'short_corner_press',\r\n          role: 'SHORT_PRESS',\r\n          priority: 6\r\n        });\r\n        assigned.add(String(fastPlayer.id));\r\n      }\r\n\r\n      // Remaining players - edge of box\r\n      validTeammates.forEach((p: Player) => {\r\n        if (!assigned.has(String(p.id))) {\r\n          const finalPos = posManager.findValidPosition(ZONES.edgeBox);\r\n          playerJobs.set(String(p.id), {\r\n            ...finalPos,\r\n            movement: 'edge_box_cover',\r\n            role: 'EDGE_COVER',\r\n            priority: 5\r\n          });\r\n        }\r\n      });\r\n\r\n      (gameState as any)._cornerDefJobAssignments = playerJobs;\r\n    }\r\n\r\n    const playerIdStr = String(player.id);\r\n    const myPositionData = (gameState as any)._cornerDefJobAssignments?.get(playerIdStr);\r\n\r\n    if (myPositionData) {\r\n      let finalPos: PlayerJobAssignment = { ...myPositionData };\r\n\r\n      // Dynamic man-marking updates\r\n      if (finalPos.role?.startsWith('MARK_')) {\r\n        const targetIdStr = finalPos.targetId || finalPos.role.split('_')[1];\r\n        const target = (gameState as any)._cornerOpponentMap?.get(targetIdStr);\r\n\r\n        if (target) {\r\n          // Stay goal-side and slightly offset\r\n          finalPos = {\r\n            ...finalPos,\r\n            x: target.x - direction * 8,\r\n            y: target.y + (Math.random() - 0.5) * 4,\r\n            movement: 'active_man_mark'\r\n          };\r\n        } else {\r\n          // Target lost - drop into zone\r\n          finalPos = { ...ZONES.central, movement: 'zone_fallback', role: finalPos.role, priority: finalPos.priority };\r\n        }\r\n      }\r\n\r\n      return sanitizePosition(finalPos, { player, gameState, behavior: 'ProfessionalCornerDefending' });\r\n    }\r\n\r\n    const activePos = getPlayerActivePosition(player, gameState.currentHalf);\r\n    return sanitizePosition({ x: activePos.x, y: activePos.y, movement: 'fallback_corner_def' }, { player });\r\n  }\r\n};\r\n\r\n", "/**\r\n * Free Kick Behaviors - TypeScript Migration\r\n *\r\n * Professional free kick positioning system with:\r\n * - Attacking free kick formations (direct shots and crossing routines)\r\n * - Defensive free kick positioning (wall formation and zonal marking)\r\n * - Man-marking dangerous opponents\r\n * - Offside-aware positioning\r\n * - Context-aware tactical decisions\r\n *\r\n * This is the largest behavior file with complex wall calculations,\r\n * marking systems, and multiple attacking routines.\r\n *\r\n * @module setpieces/behaviors/freeKick\r\n * @migrated-from js/setpieces/behaviors/freeKick.js\r\n */\r\n\r\nimport type { Player, GameState, Vector2D } from '../../types';\r\nimport {\r\n  sanitizePosition,\r\n  TacticalContext,\r\n  PositionManager,\r\n  getValidPlayers,\r\n  getSortedLists,\r\n  checkAndAdjustOffsidePosition\r\n} from '../utils';\r\nimport { GAME_CONFIG } from '../../config';\r\nimport { getAttackingGoalX } from '../../utils/ui';\r\nimport { getPlayerActivePosition } from '../../ai/movement';\r\nimport { distance as getDistance } from '../../utils/math';\r\n\r\n// ============================================================================\r\n// TYPE DEFINITIONS\r\n// ============================================================================\r\n\r\ninterface FreeKickZones {\r\n  kicker: Vector2D;\r\n  dummyRunner: Vector2D;\r\n  secondKicker: Vector2D;\r\n  standingAttacker: Vector2D;\r\n  nearPostStart: Vector2D;\r\n  nearPostTarget: Vector2D;\r\n  farPostStart: Vector2D;\r\n  farPostTarget: Vector2D;\r\n  strikerPosition: Vector2D;\r\n  penaltySpotStart: Vector2D;\r\n  penaltySpotTarget: Vector2D;\r\n  edgeBox: Vector2D;\r\n  edgeBoxLeft: Vector2D;\r\n  edgeBoxRight: Vector2D;\r\n  wideRunnerStart: Vector2D;\r\n  wideRunnerTarget: Vector2D;\r\n  defensiveMidfield: Vector2D[];\r\n}\r\n\r\ninterface DefensiveFreeKickZones {\r\n  wallBase: Vector2D;\r\n  nearPostZone: Vector2D;\r\n  farPostZone: Vector2D;\r\n  centralZone: Vector2D;\r\n  edgeBoxZone: Vector2D;\r\n  pressKicker: Vector2D;\r\n  counterOutlet: Vector2D[];\r\n}\r\n\r\nexport interface PlayerJobAssignment extends Vector2D {\r\n  movement: string;\r\n  role: string;\r\n  priority: number;\r\n  targetX?: number;\r\n  targetY?: number;\r\n  runTiming?: string;\r\n  wallIndex?: number;\r\n  targetId?: string;\r\n}\r\n\r\nexport interface SortedLists {\r\n  teammates: {\r\n    bestKickers: Player[];\r\n    bestHeaders: Player[];\r\n    fastest: Player[];\r\n    bestDefenders: Player[];\r\n  };\r\n  opponents: {\r\n    mostDangerous: Player[];\r\n  };\r\n}\r\n\r\n// ============================================================================\r\n// HELPER FUNCTIONS (Internal - Not Exported from utils.ts)\r\n// ============================================================================\r\n\r\nfunction getSafeStat(stats: any, key: string, defaultValue: number = 0): number {\r\n  if (!stats || typeof stats !== 'object') return defaultValue;\r\n  const val = stats[key];\r\n  return typeof val === 'number' && isFinite(val) ? val : defaultValue;\r\n}\r\n\r\nfunction getRoleBasedFallbackPosition(role: string | undefined, context: any = {}): any {\r\n  const PITCH_WIDTH = GAME_CONFIG.PITCH_WIDTH;\r\n  const PITCH_HEIGHT = GAME_CONFIG.PITCH_HEIGHT;\r\n\r\n  let fallbackX = PITCH_WIDTH / 2;\r\n  let fallbackY = PITCH_HEIGHT / 2;\r\n\r\n  // Simple role-based positioning\r\n  if (role?.includes('ST') || role?.includes('CF')) {\r\n    fallbackX = context.player?.isHome ? PITCH_WIDTH - 150 : 150;\r\n  }\r\n\r\n  fallbackX = Math.max(10, Math.min(PITCH_WIDTH - 10, fallbackX));\r\n  fallbackY = Math.max(10, Math.min(PITCH_HEIGHT - 10, fallbackY));\r\n\r\n  return sanitizePosition({ x: fallbackX, y: fallbackY, movement: 'fallback_position' }, context);\r\n}\r\n\r\n// ============================================================================\r\n// PROFESSIONAL FREE KICK BEHAVIORS\r\n// ============================================================================\r\n\r\nexport const ProfessionalFreeKickBehaviors = {\r\n  getAttackingFreeKickPosition(\r\n    player: Player,\r\n    fkPos: Vector2D,\r\n    opponentGoalX: number,\r\n    distToGoal: number,\r\n    sortedLists: SortedLists | null,\r\n    gameState: GameState,\r\n    teammates: Player[]\r\n  ) {\r\n    if (!gameState || !player || !fkPos) {\r\n      return sanitizePosition({ x: player?.x ?? 400, y: player?.y ?? 300, movement: 'error_fk_att' }, { player });\r\n    }\r\n\r\n    if (player.role === 'GK') {\r\n      const gkX = getAttackingGoalX(!player.isHome, gameState.currentHalf);\r\n      return sanitizePosition({ x: gkX, y: 300, movement: 'gk_stay_goal' }, { player });\r\n    }\r\n\r\n    const direction = Math.sign(opponentGoalX - 400);\r\n    if (!isFinite(direction) || direction === 0) {\r\n      return getRoleBasedFallbackPosition(player.role, { player, gameState });\r\n    }\r\n\r\n    const PITCH_WIDTH = GAME_CONFIG.PITCH_WIDTH;\r\n    const PITCH_HEIGHT = GAME_CONFIG.PITCH_HEIGHT;\r\n    const activeConfig = { GOAL_Y_TOP: 225, GOAL_Y_BOTTOM: 375 };\r\n\r\n    const isDangerous = distToGoal < 280;\r\n    const isCentral = Math.abs(fkPos.y - 300) < 100;\r\n    const isShootingPosition = isDangerous && isCentral;\r\n\r\n    if (!sortedLists) sortedLists = getSortedLists(teammates, getValidPlayers(gameState ? (player.isHome ? gameState.awayPlayers : gameState.homePlayers) : []));\r\n\r\n    // Professional free kick zones with realistic spacing\r\n    const ZONES: FreeKickZones = {\r\n      // Direct shot setup (kicker and options)\r\n      kicker: { x: fkPos.x - direction * 8, y: fkPos.y },\r\n      dummyRunner: { x: fkPos.x - direction * 22, y: fkPos.y + 18 },\r\n      secondKicker: { x: fkPos.x - direction * 22, y: fkPos.y - 18 },\r\n      standingAttacker: { x: fkPos.x - direction * 35, y: fkPos.y },\r\n\r\n      // Near post runner (timing run for flick-ons) - PROFESSIONAL: Deep starting position for momentum\r\n      // Players attack from penalty area with proper run-up space\r\n      nearPostStart: { x: fkPos.x + direction * 50, y: fkPos.y - 75 },\r\n      nearPostTarget: { x: opponentGoalX - direction * 100, y: activeConfig.GOAL_Y_TOP + 50 },\r\n\r\n      // Far post target (power header) - PROFESSIONAL: Deep starting position for powerful run\r\n      // Players attack from penalty area with maximum momentum\r\n      farPostStart: { x: fkPos.x + direction * 60, y: fkPos.y + 85 },\r\n      farPostTarget: { x: opponentGoalX - direction * 110, y: activeConfig.GOAL_Y_BOTTOM - 50 },\r\n\r\n      // Central striker (flick-on/lay-off or shot) - PROFESSIONAL: Penalty spot area\r\n      strikerPosition: { x: opponentGoalX - direction * 105, y: PITCH_HEIGHT / 2 },\r\n\r\n      // Penalty spot threat (if ball is crossed)\r\n      penaltySpotStart: { x: fkPos.x + direction * 60, y: PITCH_HEIGHT / 2 + (fkPos.y < 300 ? 30 : -30) },\r\n      penaltySpotTarget: { x: opponentGoalX - direction * 108, y: PITCH_HEIGHT / 2 },\r\n\r\n      // Edge of box positions (rebounds/cutbacks/long shots)\r\n      edgeBox: { x: opponentGoalX - direction * 188, y: PITCH_HEIGHT / 2 },\r\n      edgeBoxLeft: { x: opponentGoalX - direction * 185, y: PITCH_HEIGHT / 2 - 55 },\r\n      edgeBoxRight: { x: opponentGoalX - direction * 185, y: PITCH_HEIGHT / 2 + 55 },\r\n\r\n      // Wide runner (creates space, exploits gaps)\r\n      wideRunnerStart: { x: fkPos.x + direction * 50, y: fkPos.y < 300 ? 520 : 80 },\r\n      wideRunnerTarget: { x: opponentGoalX - direction * 95, y: fkPos.y < 300 ? activeConfig.GOAL_Y_BOTTOM - 20 : activeConfig.GOAL_Y_TOP + 20 },\r\n\r\n      // Defensive cover (counter-attack prevention)\r\n      defensiveMidfield: [\r\n        { x: PITCH_WIDTH / 2 - direction * 55, y: 215 },\r\n        { x: PITCH_WIDTH / 2 - direction * 55, y: 385 },\r\n        { x: PITCH_WIDTH / 2 - direction * 85, y: PITCH_HEIGHT / 2 }\r\n      ]\r\n    };\r\n\r\n    if (!(gameState as any)._fkAttPosManager) (gameState as any)._fkAttPosManager = new PositionManager();\r\n    const posManager = (gameState as any)._fkAttPosManager;\r\n\r\n    const setupKey = `_lastFkAttSetup_H${gameState.currentHalf}`;\r\n    if (!(gameState as any)[setupKey] || (gameState as any)[setupKey] !== gameState.setPiece) {\r\n      (gameState as any)[setupKey] = gameState.setPiece;\r\n      posManager.reset();\r\n\r\n      const playerJobs = new Map<string, PlayerJobAssignment>();\r\n      const validTeammates = getValidPlayers(teammates).filter(p => p.role !== 'GK');\r\n\r\n      const kickers = sortedLists.teammates.bestKickers;\r\n      const headers = sortedLists.teammates.bestHeaders;\r\n      const runners = sortedLists.teammates.fastest;\r\n      const defenders = sortedLists.teammates.bestDefenders;\r\n\r\n      const assigned = new Set<string>();\r\n\r\n      if (isShootingPosition) {\r\n        // Shooting free kick routine - Direct attempt on goal\r\n        if (kickers[0]) {\r\n          playerJobs.set(String(kickers[0].id), {\r\n            ...ZONES.kicker,\r\n            movement: 'primary_kicker_shoot',\r\n            role: 'PRIMARY_KICKER',\r\n            priority: 10\r\n          });\r\n          assigned.add(String(kickers[0].id));\r\n        }\r\n\r\n        // Dummy runner - creates confusion for goalkeeper\r\n        if (runners[0] && !assigned.has(String(runners[0].id))) {\r\n          playerJobs.set(String(runners[0].id), {\r\n            ...ZONES.dummyRunner,\r\n            movement: 'dummy_run',\r\n            role: 'DUMMY_RUNNER',\r\n            runTiming: 'ON_WHISTLE',\r\n            priority: 9\r\n          });\r\n          assigned.add(String(runners[0].id));\r\n        }\r\n\r\n        // Second kicker option - variation\r\n        if (kickers[1] && !assigned.has(String(kickers[1].id))) {\r\n          playerJobs.set(String(kickers[1].id), {\r\n            ...ZONES.secondKicker,\r\n            movement: 'second_kicker_option',\r\n            role: 'SECOND_KICKER',\r\n            priority: 9\r\n          });\r\n          assigned.add(String(kickers[1].id));\r\n        }\r\n\r\n        // Standing attacker - blocks keeper's view\r\n        const standingPlayer = headers.find(p => !assigned.has(String(p.id)));\r\n        if (standingPlayer) {\r\n          playerJobs.set(String(standingPlayer.id), {\r\n            ...ZONES.standingAttacker,\r\n            movement: 'standing_attacker',\r\n            role: 'STANDING_ATTACKER',\r\n            priority: 8\r\n          });\r\n          assigned.add(String(standingPlayer.id));\r\n        }\r\n\r\n        // Near post crasher - rebound opportunity\r\n        if (headers[0] && !assigned.has(String(headers[0].id))) {\r\n          playerJobs.set(String(headers[0].id), {\r\n            ...ZONES.nearPostStart,\r\n            targetX: ZONES.nearPostTarget.x,\r\n            targetY: ZONES.nearPostTarget.y,\r\n            movement: 'near_post_crash',\r\n            role: 'NEAR_POST_RUNNER',\r\n            runTiming: 'ON_KICK',\r\n            priority: 8\r\n          });\r\n          assigned.add(String(headers[0].id));\r\n        }\r\n\r\n        // Far post crasher - follow-up\r\n        if (headers[1] && !assigned.has(String(headers[1].id))) {\r\n          playerJobs.set(String(headers[1].id), {\r\n            ...ZONES.farPostStart,\r\n            targetX: ZONES.farPostTarget.x,\r\n            targetY: ZONES.farPostTarget.y,\r\n            movement: 'far_post_crash',\r\n            role: 'FAR_POST_RUNNER',\r\n            runTiming: 'ON_KICK',\r\n            priority: 8\r\n          });\r\n          assigned.add(String(headers[1].id));\r\n        }\r\n      } else {\r\n        // Crossing/playmaking free kick - Deliver into the box\r\n        if (kickers[0]) {\r\n          playerJobs.set(String(kickers[0].id), {\r\n            ...ZONES.kicker,\r\n            movement: 'primary_kicker_cross',\r\n            role: 'PRIMARY_KICKER',\r\n            priority: 10\r\n          });\r\n          assigned.add(String(kickers[0].id));\r\n        }\r\n\r\n        // Target striker - central presence\r\n        if (headers[0] && !assigned.has(String(headers[0].id))) {\r\n          const finalPos = posManager.findValidPosition(ZONES.strikerPosition);\r\n          playerJobs.set(String(headers[0].id), {\r\n            ...finalPos,\r\n            movement: 'target_man_fk',\r\n            role: 'TARGET_STRIKER',\r\n            priority: 9\r\n          });\r\n          assigned.add(String(headers[0].id));\r\n        }\r\n\r\n        // Near post runner - timing run\r\n        if (runners[0] && !assigned.has(String(runners[0].id))) {\r\n          playerJobs.set(String(runners[0].id), {\r\n            ...ZONES.nearPostStart,\r\n            targetX: ZONES.nearPostTarget.x,\r\n            targetY: ZONES.nearPostTarget.y,\r\n            movement: 'near_post_run_cross',\r\n            role: 'NEAR_POST_RUNNER',\r\n            runTiming: 'ON_KICK',\r\n            priority: 9\r\n          });\r\n          assigned.add(String(runners[0].id));\r\n        }\r\n\r\n        // Far post header\r\n        if (headers[1] && !assigned.has(String(headers[1].id))) {\r\n          playerJobs.set(String(headers[1].id), {\r\n            ...ZONES.farPostStart,\r\n            targetX: ZONES.farPostTarget.x,\r\n            targetY: ZONES.farPostTarget.y,\r\n            movement: 'far_post_header',\r\n            role: 'FAR_POST_HEADER',\r\n            runTiming: 'DELAYED',\r\n            priority: 9\r\n          });\r\n          assigned.add(String(headers[1].id));\r\n        }\r\n\r\n        // Penalty spot runner\r\n        if (headers[2] && !assigned.has(String(headers[2].id))) {\r\n          playerJobs.set(String(headers[2].id), {\r\n            ...ZONES.penaltySpotStart,\r\n            targetX: ZONES.penaltySpotTarget.x,\r\n            targetY: ZONES.penaltySpotTarget.y,\r\n            movement: 'penalty_spot_run',\r\n            role: 'PENALTY_SPOT',\r\n            runTiming: 'IMMEDIATE',\r\n            priority: 8\r\n          });\r\n          assigned.add(String(headers[2].id));\r\n        }\r\n\r\n        // Wide runner - exploit space\r\n        const wideRunner = runners.find(p => !assigned.has(String(p.id)));\r\n        if (wideRunner) {\r\n          playerJobs.set(String(wideRunner.id), {\r\n            ...ZONES.wideRunnerStart,\r\n            targetX: ZONES.wideRunnerTarget.x,\r\n            targetY: ZONES.wideRunnerTarget.y,\r\n            movement: 'wide_runner',\r\n            role: 'WIDE_RUNNER',\r\n            runTiming: 'ON_KICK',\r\n            priority: 7\r\n          });\r\n          assigned.add(String(wideRunner.id));\r\n        }\r\n      }\r\n\r\n      // Edge of box positions - three players for rebounds/cutbacks/long shots\r\n      const edgePositions = [ZONES.edgeBox, ZONES.edgeBoxLeft, ZONES.edgeBoxRight];\r\n      const edgePlayers = validTeammates\r\n        .filter(p => !assigned.has(String(p.id)) && (p.role.includes('CM') || p.role.includes('CDM') || p.role.includes('CAM')))\r\n        .slice(0, 3);\r\n\r\n      edgePlayers.forEach((edgePlayer, idx) => {\r\n        if (edgePositions[idx]) {\r\n          const finalPos = posManager.findValidPosition(edgePositions[idx]);\r\n          playerJobs.set(String(edgePlayer.id), {\r\n            ...finalPos,\r\n            movement: `edge_box_fk_${idx}`,\r\n            role: `EDGE_BOX_${idx}`,\r\n            priority: 7\r\n          });\r\n          assigned.add(String(edgePlayer.id));\r\n        }\r\n      });\r\n\r\n      // Defensive cover - three players for counter-attack prevention\r\n      let defIdx = 0;\r\n      defenders.forEach(def => {\r\n        if (!assigned.has(String(def.id)) && defIdx < ZONES.defensiveMidfield.length) {\r\n          const finalPos = posManager.findValidPosition(ZONES.defensiveMidfield[defIdx]);\r\n          playerJobs.set(String(def.id), {\r\n            ...finalPos,\r\n            movement: 'defensive_cover_fk',\r\n            role: `DEFENSIVE_COVER_${defIdx}`,\r\n            priority: 6\r\n          });\r\n          assigned.add(String(def.id));\r\n          defIdx++;\r\n        }\r\n      });\r\n\r\n      // Support players\r\n      let supportIdx = 0;\r\n      validTeammates.forEach(p => {\r\n        if (!assigned.has(String(p.id))) {\r\n          const activePos = getPlayerActivePosition(p, gameState.currentHalf);\r\n          const finalPos = posManager.findValidPosition(activePos);\r\n          playerJobs.set(String(p.id), {\r\n            ...finalPos,\r\n            movement: 'support_fk',\r\n            role: `SUPPORT_${supportIdx}`,\r\n            priority: 5\r\n          });\r\n          supportIdx++;\r\n        }\r\n      });\r\n\r\n      (gameState as any)._fkJobAssignments = playerJobs;\r\n    }\r\n\r\n    const playerIdStr = String(player.id);\r\n    const myPositionData = (gameState as any)._fkJobAssignments?.get(playerIdStr);\r\n\r\n    if (myPositionData) {\r\n      // OFSAYT KONTROL\u00DC: Free kick h\u00FCcum pozisyonlar\u0131nda ofsayt kontrol\u00FC yap\r\n      const opponents = getValidPlayers(player.isHome ? gameState.awayPlayers : gameState.homePlayers);\r\n      const adjustedPosition = checkAndAdjustOffsidePosition(\r\n        myPositionData,\r\n        player,\r\n        opponentGoalX,\r\n        opponents,\r\n        gameState\r\n      );\r\n      return sanitizePosition(adjustedPosition, { player, gameState, behavior: 'ProfessionalFreeKickAttacking' });\r\n    }\r\n\r\n    const activePos = getPlayerActivePosition(player, gameState.currentHalf);\r\n    return sanitizePosition({ x: activePos.x, y: activePos.y, movement: 'fallback_fk_att' }, { player });\r\n  },\r\n\r\n  getDefendingFreeKickPosition(\r\n    player: Player,\r\n    fkPos: Vector2D,\r\n    ownGoalX: number,\r\n    distToGoal: number,\r\n    sortedLists: SortedLists | null,\r\n    opponents: Player[],\r\n    gameState: GameState,\r\n    teammates: Player[]\r\n  ) {\r\n    if (!gameState || !player || !fkPos) {\r\n      return sanitizePosition({ x: player?.x ?? 400, y: player?.y ?? 300, movement: 'error_fk_def' }, { player });\r\n    }\r\n\r\n    if (player.role === 'GK') {\r\n      // GK positioning - off-center for visibility\r\n      const offsetY = fkPos.y > 300 ? -20 : 20;\r\n      return sanitizePosition({ x: ownGoalX, y: 300 + offsetY, movement: 'gk_fk_positioning' }, { player });\r\n    }\r\n\r\n    const direction = Math.sign(ownGoalX - 400);\r\n    if (!isFinite(direction) || direction === 0) {\r\n      return getRoleBasedFallbackPosition(player.role, { player, gameState });\r\n    }\r\n\r\n    const PITCH_WIDTH = GAME_CONFIG.PITCH_WIDTH;\r\n    const PITCH_HEIGHT = GAME_CONFIG.PITCH_HEIGHT;\r\n    const SET_PIECE_TYPES = { FREE_KICK: 'FREE_KICK' };\r\n    const activeConfig = { GOAL_Y_TOP: 225, GOAL_Y_BOTTOM: 375 };\r\n\r\n    const isCentral = Math.abs(fkPos.y - 300) < 130;\r\n    const isDangerous = distToGoal < 280;\r\n    const needsWall = isDangerous && isCentral;\r\n\r\n    // Calculate professional wall size\r\n    let wallSize = 0;\r\n    if (needsWall) {\r\n      if (distToGoal < 140) wallSize = 6;\r\n      else if (distToGoal < 160) wallSize = 5;\r\n      else if (distToGoal < 180) wallSize = 4;\r\n      else if (distToGoal < 220) wallSize = 3;\r\n      else wallSize = 2;\r\n    }\r\n\r\n    if (!sortedLists) sortedLists = getSortedLists(teammates, opponents);\r\n\r\n    const ZONES: DefensiveFreeKickZones = {\r\n      // Wall setup zone\r\n      wallBase: { x: fkPos.x, y: fkPos.y },\r\n\r\n      // FIXED: Zonal defenders OUTSIDE 6-yard box (professional positioning)\r\n      // 6-yard box is ~55px, so defenders should be 100-110px from goal minimum\r\n      nearPostZone: { x: ownGoalX - direction * 100, y: activeConfig.GOAL_Y_TOP + 45 },\r\n      farPostZone: { x: ownGoalX - direction * 100, y: activeConfig.GOAL_Y_BOTTOM - 45 },\r\n      centralZone: { x: ownGoalX - direction * 110, y: PITCH_HEIGHT / 2 },\r\n      edgeBoxZone: { x: ownGoalX - direction * 180, y: PITCH_HEIGHT / 2 },\r\n\r\n      // Press/counter outlets\r\n      pressKicker: { x: fkPos.x + direction * 20, y: fkPos.y },\r\n      counterOutlet: [\r\n        { x: PITCH_WIDTH / 2 - direction * 120, y: 180 },\r\n        { x: PITCH_WIDTH / 2 - direction * 120, y: 420 }\r\n      ]\r\n    };\r\n\r\n    if (!(gameState as any)._fkDefPosManager) (gameState as any)._fkDefPosManager = new PositionManager();\r\n    const posManager = (gameState as any)._fkDefPosManager;\r\n\r\n    const setupKey = `_lastFkDefSetup_H${gameState.currentHalf}`;\r\n    if (!(gameState as any)[setupKey] || (gameState as any)[setupKey] !== gameState.setPiece) {\r\n      (gameState as any)[setupKey] = gameState.setPiece;\r\n      posManager.reset();\r\n\r\n      const playerJobs = new Map<string, PlayerJobAssignment>();\r\n      const validTeammates = getValidPlayers(teammates).filter(p => p.role !== 'GK');\r\n      const validOpponents = getValidPlayers(opponents).filter(p => p.role !== 'GK');\r\n\r\n      (gameState as any)._fkOpponentMap = new Map(validOpponents.map(p => [String(p.id), p]));\r\n      (gameState as any)._currentWallSize = wallSize;\r\n\r\n      const assigned = new Set<string>();\r\n\r\n      // Assign wall players (tallest/strongest)\r\n      if (needsWall) {\r\n        const wallPlayers = [...sortedLists.teammates.bestDefenders]\r\n          .slice(0, wallSize)\r\n          .sort((a, b) => getSafeStat((b as any).stats, 'heading', 70) - getSafeStat((a as any).stats, 'heading', 70));\r\n\r\n        wallPlayers.forEach((p, idx) => {\r\n          playerJobs.set(String(p.id), {\r\n            x: 0, // Will be calculated dynamically\r\n            y: 0, // Will be calculated dynamically\r\n            role: `JOB_WALL_${idx}`,\r\n            movement: 'wall_formation',\r\n            wallIndex: idx,\r\n            priority: 10\r\n          });\r\n          assigned.add(String(p.id));\r\n        });\r\n      }\r\n\r\n      // Press the kicker if appropriate\r\n      const context = new TacticalContext(gameState, SET_PIECE_TYPES.FREE_KICK);\r\n      const shouldPress = !isDangerous || context.shouldCommitForward(player.isHome);\r\n\r\n      if (shouldPress) {\r\n        const presser = sortedLists.teammates.fastest.find(p => !assigned.has(String(p.id)));\r\n        if (presser) {\r\n          const finalPos = posManager.findValidPosition(ZONES.pressKicker);\r\n          playerJobs.set(String(presser.id), {\r\n            ...finalPos,\r\n            movement: 'press_kicker',\r\n            role: 'PRESS_KICKER',\r\n            priority: 9\r\n          });\r\n          assigned.add(String(presser.id));\r\n        }\r\n      }\r\n\r\n      // Man-mark dangerous opponents\r\n      const dangerousOpponents = sortedLists.opponents.mostDangerous.slice(0, 3);\r\n      const availableMarkers = validTeammates.filter(p => !assigned.has(String(p.id))).slice(0, 3);\r\n\r\n      dangerousOpponents.forEach((opp, idx) => {\r\n        if (availableMarkers[idx]) {\r\n          playerJobs.set(String(availableMarkers[idx].id), {\r\n            x: 0, // Will be calculated dynamically\r\n            y: 0, // Will be calculated dynamically\r\n            role: `JOB_MARK_${opp.id}`,\r\n            movement: 'man_mark_fk',\r\n            targetId: String(opp.id),\r\n            priority: 8\r\n          });\r\n          assigned.add(String(availableMarkers[idx].id));\r\n        }\r\n      });\r\n\r\n      // Zonal coverage - REDUCED for dangerous free kicks to avoid crowding\r\n      // For dangerous FKs: Only 1 central zone (wall already covers posts)\r\n      // For non-dangerous: 3 zones for better coverage\r\n      const zonalAssignments = isDangerous\r\n        ? [{ zone: 'centralZone' as const, role: 'CENTRAL_ZONE', priority: 7 }] // Only 1 for dangerous\r\n        : [\r\n            { zone: 'centralZone' as const, role: 'CENTRAL_ZONE', priority: 7 },\r\n            { zone: 'nearPostZone' as const, role: 'NEAR_POST_ZONE', priority: 7 },\r\n            { zone: 'farPostZone' as const, role: 'FAR_POST_ZONE', priority: 7 }\r\n          ];\r\n\r\n      zonalAssignments.forEach(assignment => {\r\n        const zonePlayer = validTeammates.find(p => !assigned.has(String(p.id)));\r\n        if (zonePlayer) {\r\n          const finalPos = posManager.findValidPosition(ZONES[assignment.zone]);\r\n          playerJobs.set(String(zonePlayer.id), {\r\n            ...finalPos,\r\n            movement: assignment.zone,\r\n            role: assignment.role,\r\n            priority: assignment.priority\r\n          });\r\n          assigned.add(String(zonePlayer.id));\r\n        }\r\n      });\r\n\r\n      // Counter-attack outlets\r\n      let outletIdx = 0;\r\n      sortedLists.teammates.fastest.forEach(fast => {\r\n        if (!assigned.has(String(fast.id)) && outletIdx < 2) {\r\n          const finalPos = posManager.findValidPosition(ZONES.counterOutlet[outletIdx]);\r\n          playerJobs.set(String(fast.id), {\r\n            ...finalPos,\r\n            movement: 'counter_outlet',\r\n            role: `COUNTER_OUTLET_${outletIdx}`,\r\n            priority: 6\r\n          });\r\n          assigned.add(String(fast.id));\r\n          outletIdx++;\r\n        }\r\n      });\r\n\r\n      // Remaining players - compact shape\r\n      validTeammates.forEach(p => {\r\n        if (!assigned.has(String(p.id))) {\r\n          // \u2705 FIX: Clamp compact position to stay within bounds [10-790]\r\n          const rawX = ownGoalX + direction * 120;\r\n          const clampedX = Math.max(10, Math.min(790, rawX));\r\n          const compactPos = { x: clampedX, y: 300 };\r\n          const finalPos = posManager.findValidPosition(compactPos);\r\n          playerJobs.set(String(p.id), {\r\n            ...finalPos,\r\n            movement: 'compact_shape',\r\n            role: 'COMPACT',\r\n            priority: 5\r\n          });\r\n        }\r\n      });\r\n\r\n      (gameState as any)._fkDefJobAssignments = playerJobs;\r\n    }\r\n\r\n    const playerIdStr = String(player.id);\r\n    const myPositionData = (gameState as any)._fkDefJobAssignments?.get(playerIdStr);\r\n\r\n    if (myPositionData) {\r\n      let finalPos = { ...myPositionData };\r\n\r\n      // Dynamic updates\r\n      if (finalPos.role?.startsWith('JOB_WALL_')) {\r\n        finalPos = this.calculateWallPosition(finalPos, wallSize, fkPos, ownGoalX, direction, player, gameState);\r\n      } else if (finalPos.role?.startsWith('JOB_MARK_')) {\r\n        finalPos = this.calculateMarkingPosition(finalPos, direction, (gameState as any)._fkOpponentMap, player, gameState, ownGoalX);\r\n      }\r\n\r\n      // Encroachment rule\r\n      const dist = getDistance({ x: finalPos.x, y: finalPos.y }, fkPos);\r\n      if (dist < 92 && !finalPos.role?.startsWith('JOB_WALL_')) {\r\n        const angle = Math.atan2(finalPos.y - fkPos.y, finalPos.x - fkPos.x);\r\n        finalPos.x = fkPos.x + Math.cos(angle) * 92;\r\n        finalPos.y = fkPos.y + Math.sin(angle) * 92;\r\n      }\r\n\r\n      return sanitizePosition(finalPos, { player, gameState, behavior: 'ProfessionalFreeKickDefending' });\r\n    }\r\n\r\n    const activePos = getPlayerActivePosition(player, gameState.currentHalf);\r\n    return sanitizePosition({ x: activePos.x, y: activePos.y, movement: 'fallback_fk_def' }, { player });\r\n  },\r\n\r\n  calculateWallPosition(\r\n    positionData: PlayerJobAssignment,\r\n    wallSize: number,\r\n    fkPos: Vector2D,\r\n    ownGoalX: number,\r\n    direction: number,\r\n    player: Player,\r\n    gameState: GameState\r\n  ) {\r\n    try {\r\n      const roleParts = positionData.role.split('_');\r\n      const wallIndex = positionData.wallIndex ?? (roleParts[2] ? parseInt(roleParts[2]) : 0);\r\n      if (isNaN(wallIndex) || wallSize <= 0) {\r\n        return getRoleBasedFallbackPosition(positionData.role, { player, gameState });\r\n      }\r\n\r\n      const PITCH_WIDTH = GAME_CONFIG.PITCH_WIDTH;\r\n      const PITCH_HEIGHT = GAME_CONFIG.PITCH_HEIGHT;\r\n      const activeConfig = { GOAL_Y_TOP: 225, GOAL_Y_BOTTOM: 375 };\r\n\r\n      // Calculate wall base position to cover near post\r\n      const wallDistance = 92; // 10 yards\r\n      const angleToNearPost = Math.atan2(activeConfig.GOAL_Y_TOP - fkPos.y, ownGoalX - fkPos.x);\r\n      const angleToFarPost = Math.atan2(activeConfig.GOAL_Y_BOTTOM - fkPos.y, ownGoalX - fkPos.x);\r\n\r\n      // Wall covers near post side\r\n      const coverageAngle = angleToNearPost + (angleToFarPost - angleToNearPost) * 0.3;\r\n\r\n      let wallBaseX = fkPos.x + Math.cos(coverageAngle) * wallDistance;\r\n      let wallBaseY = fkPos.y + Math.sin(coverageAngle) * wallDistance;\r\n\r\n      // CRITICAL FIX: Ensure wall base is between free kick and own goal (not behind goal)\r\n      // Wall should always be positioned BETWEEN the ball and the goal\r\n      if (direction > 0) {\r\n        // Own goal is on right, wall should be left of goal\r\n        wallBaseX = Math.min(wallBaseX, ownGoalX - 20);\r\n      } else {\r\n        // Own goal is on left, wall should be right of goal\r\n        wallBaseX = Math.max(wallBaseX, ownGoalX + 20);\r\n      }\r\n\r\n      // Perpendicular spacing\r\n      const wallPerpendicularAngle = coverageAngle + Math.PI / 2;\r\n      const spacing = 18; // Shoulder to shoulder\r\n      const offset = (wallIndex - (wallSize - 1) / 2) * spacing;\r\n\r\n      let wallX = wallBaseX + Math.cos(wallPerpendicularAngle) * offset;\r\n      let wallY = wallBaseY + Math.sin(wallPerpendicularAngle) * offset;\r\n\r\n      // CRITICAL FIX: Clamp wall positions to pitch bounds BEFORE sanitizePosition\r\n      // This prevents sanitizePosition from clamping and triggering warnings\r\n      wallX = Math.max(10, Math.min(PITCH_WIDTH - 10, wallX));\r\n      wallY = Math.max(10, Math.min(PITCH_HEIGHT - 10, wallY));\r\n\r\n      return sanitizePosition({\r\n        x: wallX,\r\n        y: wallY,\r\n        movement: 'wall_positioned',\r\n        role: positionData.role\r\n      }, { player, gameState });\r\n    } catch (error) {\r\n      console.error(`[FreeKick] Error calculating wall position for ${player.name} (${positionData.role}):`, error);\r\n      return getRoleBasedFallbackPosition(positionData.role, { player, gameState });\r\n    }\r\n  },\r\n\r\n  calculateMarkingPosition(\r\n    positionData: PlayerJobAssignment,\r\n    direction: number,\r\n    opponentMap: Map<string, Player> | undefined,\r\n    player: Player,\r\n    gameState: GameState,\r\n    ownGoalX: number\r\n  ) {\r\n    try {\r\n      const targetIdStr = positionData.targetId || positionData.role.split('_').pop();\r\n      const target = opponentMap?.get(targetIdStr || '');\r\n\r\n      if (target) {\r\n        // Goal-side marking with tight distance\r\n        let markX = target.x - direction * 10;\r\n        let markY = target.y + (Math.random() - 0.5) * 3;\r\n\r\n        // CRITICAL FIX: Prevent markers from entering 6-yard box\r\n        // 6-yard box is approximately 55px from goal line\r\n        // Enforce minimum distance of 65px from goal to keep 0-2 players in box (only wall if needed)\r\n        const SIX_YARD_BOX_DISTANCE = 65;\r\n        if (direction < 0) { // Own goal on left, players must be to the right of the line\r\n          const minAllowedX = ownGoalX + SIX_YARD_BOX_DISTANCE;\r\n          markX = Math.max(markX, minAllowedX);\r\n        } else { // Own goal on right, players must be to the left of the line\r\n          const maxAllowedX = ownGoalX - SIX_YARD_BOX_DISTANCE;\r\n          markX = Math.min(markX, maxAllowedX);\r\n        }\r\n\r\n        // Also don't get pulled too far forward\r\n        const maxForwardXDistance = 150;\r\n        if (direction < 0) { // Own goal on left\r\n          const maxAllowedX = ownGoalX + maxForwardXDistance;\r\n          markX = Math.min(markX, maxAllowedX);\r\n        } else { // Own goal on right\r\n          const minAllowedX = ownGoalX - maxForwardXDistance;\r\n          markX = Math.max(markX, minAllowedX);\r\n        }\r\n\r\n        return sanitizePosition({\r\n          ...positionData,\r\n          x: markX,\r\n          y: markY,\r\n          movement: 'tight_marking'\r\n        }, { player, gameState });\r\n      } else {\r\n        // Target lost - drop into central zone (also outside 6-yard box)\r\n        return sanitizePosition({\r\n          x: ownGoalX + direction * 100,\r\n          y: 300,\r\n          movement: 'zone_fallback',\r\n          role: 'ZONE_FALLBACK'\r\n        }, { player, gameState });\r\n      }\r\n    } catch (error) {\r\n      console.error(`[FreeKick] Error calculating marking position for ${player.name} (${positionData.role}):`, error);\r\n      return getRoleBasedFallbackPosition(positionData.role, { player, gameState });\r\n    }\r\n  }\r\n};\r\n\r\n", "/**\r\n * Goal Kick Behaviors - TypeScript Migration\r\n *\r\n * Professional goal kick positioning system with:\r\n * - Attacking goal kick formations (short build-up and long direct play)\r\n * - Defensive goal kick positioning (high press and mid-block)\r\n * - Formation-aware positioning for remaining players\r\n * - Penalty area rule compliance for defending team\r\n * - Role-based player assignments with tactical variations\r\n *\r\n * @module setpieces/behaviors/goalKick\r\n * @migrated-from js/setpieces/behaviors/goalKick.js\r\n */\r\n\r\nimport type { Player, GameState, Vector2D } from '../../types';\r\nimport {\r\n  sanitizePosition,\r\n  TacticalContext,\r\n  PositionManager,\r\n  getValidPlayers,\r\n  getSortedLists\r\n} from '../utils';\r\nimport { GAME_CONFIG } from '../../config';\r\nimport { getPlayerActivePosition } from '../../ai/movement';\r\n\r\n// ============================================================================\r\n// TYPE DEFINITIONS\r\n// ============================================================================\r\n\r\ninterface PlayerJobAssignment {\r\n  x: number;\r\n  y: number;\r\n  movement: string;\r\n  role: string;\r\n  priority: number;\r\n}\r\n\r\n// ============================================================================\r\n// HELPER FUNCTIONS\r\n// ============================================================================\r\n\r\nfunction getFormationAnchorForPlayer(player: Player, gameState: GameState): Vector2D | null {\r\n  if (!player || !gameState) return null;\r\n\r\n  const PITCH_WIDTH = GAME_CONFIG.PITCH_WIDTH;\r\n  const PITCH_HEIGHT = GAME_CONFIG.PITCH_HEIGHT;\r\n\r\n  const currentHalf = gameState.currentHalf ?? 1;\r\n\r\n  const hasHomeCoords = typeof (player as any).homeX === 'number' && typeof (player as any).homeY === 'number';\r\n  if (hasHomeCoords) {\r\n    const mirrorX = currentHalf === 2\r\n      ? PITCH_WIDTH - (player as any).homeX\r\n      : (player as any).homeX;\r\n    const safeX = Math.max(10, Math.min(PITCH_WIDTH - 10, mirrorX));\r\n    const safeY = Math.max(10, Math.min(PITCH_HEIGHT - 10, (player as any).homeY));\r\n    return { x: safeX, y: safeY };\r\n  }\r\n\r\n  if (typeof window !== 'undefined' && typeof getPlayerActivePosition === 'function') {\r\n    return getPlayerActivePosition(player, currentHalf);\r\n  }\r\n\r\n  return {\r\n    x: player?.x ?? PITCH_WIDTH / 2,\r\n    y: player?.y ?? PITCH_HEIGHT / 2\r\n  };\r\n}\r\n\r\n// ============================================================================\r\n// PROFESSIONAL GOAL KICK BEHAVIORS\r\n// ============================================================================\r\n\r\nexport const ProfessionalGoalKickBehaviors = {\r\n  getGoalKickPosition(\r\n    player: Player,\r\n    ownGoalX: number,\r\n    tactic: string,\r\n    playShort: boolean,\r\n    gameState: GameState,\r\n    teammates: Player[]\r\n  ) {\r\n    if (!gameState || !player) {\r\n      return sanitizePosition({ x: player?.x ?? 400, y: player?.y ?? 300, movement: 'error_gk' }, { player });\r\n    }\r\n\r\n    const PITCH_WIDTH = GAME_CONFIG.PITCH_WIDTH;\r\n    const PITCH_HEIGHT = GAME_CONFIG.PITCH_HEIGHT;\r\n\r\n    if (player.role === 'GK') {\r\n      const gkX = ownGoalX + (ownGoalX < 400 ? 70 : -70);\r\n      return sanitizePosition({ x: gkX, y: 300, movement: 'gk_take_kick' }, { player, role: 'GK' });\r\n    }\r\n\r\n    const shouldBuildFromBack = playShort || tactic === 'possession';\r\n    // \u2705 FIX: Players should move AWAY from own goal, towards opponent goal\r\n    // If ownGoalX < 400 (left side), direction should be +1 (move right)\r\n    // If ownGoalX > 400 (right side), direction should be -1 (move left)\r\n    const direction = ownGoalX < 400 ? 1 : -1;\r\n\r\n    if (!(gameState as any)._goalKickPosManager) (gameState as any)._goalKickPosManager = new PositionManager();\r\n    const posManager = (gameState as any)._goalKickPosManager;\r\n\r\n    const setupKey = `_lastGoalKickSetup_H${gameState.currentHalf}`;\r\n    if (!(gameState as any)[setupKey] || (gameState as any)[setupKey] !== gameState.setPiece) {\r\n      (gameState as any)[setupKey] = gameState.setPiece;\r\n      posManager.reset();\r\n\r\n      const playerJobs = new Map<string, PlayerJobAssignment>();\r\n      const validTeammates = getValidPlayers(teammates).filter(p => p.role !== 'GK');\r\n      const sortedLists = getSortedLists(validTeammates, []);\r\n\r\n      const assigned = new Set<string>();\r\n\r\n      if (shouldBuildFromBack) {\r\n        // Short goal kick - modern build-up play pattern\r\n        const defenders = sortedLists.teammates.bestDefenders.slice(0, 4);\r\n        const midfielders = validTeammates.filter(p =>\r\n          ['CM', 'CDM', 'CAM'].some(r => p.role.includes(r))\r\n        ).slice(0, 3);\r\n\r\n        // Center backs - split wide to create passing lanes\r\n        if (defenders[0]) {\r\n          const finalPos = posManager.findValidPosition({\r\n            x: ownGoalX + direction * 85,\r\n            y: 195\r\n          });\r\n          playerJobs.set(String(defenders[0].id), {\r\n            ...finalPos,\r\n            movement: 'cb_build_left',\r\n            role: 'CB_LEFT',\r\n            priority: 10\r\n          });\r\n          assigned.add(String(defenders[0].id));\r\n        }\r\n\r\n        if (defenders[1]) {\r\n          const finalPos = posManager.findValidPosition({\r\n            x: ownGoalX + direction * 135,\r\n            y: 405\r\n          });\r\n          playerJobs.set(String(defenders[1].id), {\r\n            ...finalPos,\r\n            movement: 'cb_build_right',\r\n            role: 'CB_RIGHT',\r\n            priority: 10\r\n          });\r\n          assigned.add(String(defenders[1].id));\r\n        }\r\n\r\n        // Full backs push very wide - modern width\r\n        if (defenders[2]) {\r\n          const finalPos = posManager.findValidPosition({\r\n            x: ownGoalX + direction * 185,\r\n            y: 90\r\n          });\r\n          playerJobs.set(String(defenders[2].id), {\r\n            ...finalPos,\r\n            movement: 'fb_wide_left',\r\n            role: 'FB_LEFT',\r\n            priority: 9\r\n          });\r\n          assigned.add(String(defenders[2].id));\r\n        }\r\n\r\n        if (defenders[3]) {\r\n          const finalPos = posManager.findValidPosition({\r\n            x: ownGoalX + direction * 185,\r\n            y: 510\r\n          });\r\n          playerJobs.set(String(defenders[3].id), {\r\n            ...finalPos,\r\n            movement: 'fb_wide_right',\r\n            role: 'FB_RIGHT',\r\n            priority: 9\r\n          });\r\n          assigned.add(String(defenders[3].id));\r\n        }\r\n\r\n        // Holding midfielder drops between CBs (pivot)\r\n        const pivot = midfielders.find(p => p.role.includes('CDM')) || midfielders[0];\r\n        if (pivot && !assigned.has(String(pivot.id))) {\r\n          const finalPos = posManager.findValidPosition({\r\n            x: ownGoalX + direction * 250,\r\n            y: 300\r\n          });\r\n          playerJobs.set(String(pivot.id), {\r\n            ...finalPos,\r\n            movement: 'pivot_drop',\r\n            role: 'PIVOT',\r\n            priority: 9\r\n          });\r\n          assigned.add(String(pivot.id));\r\n        }\r\n\r\n        // Central midfielders show for pass - staggered positions\r\n        const remainingMids = midfielders.filter(p => !assigned.has(String(p.id)));\r\n        remainingMids.forEach((mid, idx) => {\r\n          const yPos = idx === 0 ? 220 : 380;\r\n          const xOffset = idx === 0 ? 175 : 185; // Slightly staggered\r\n          const finalPos = posManager.findValidPosition({\r\n            x: ownGoalX + direction * xOffset,\r\n            y: yPos\r\n          });\r\n          playerJobs.set(String(mid.id), {\r\n            ...finalPos,\r\n            movement: 'midfield_show',\r\n            role: `MID_RECEIVER_${idx}`,\r\n            priority: 8\r\n          });\r\n          assigned.add(String(mid.id));\r\n        });\r\n\r\n        // Striker drops slightly to offer outlet\r\n        const striker = validTeammates.find(p =>\r\n          p.role.includes('ST') && !assigned.has(String(p.id))\r\n        );\r\n        if (striker) {\r\n          const finalPos = posManager.findValidPosition({\r\n            x: ownGoalX + direction * 400,\r\n            y: 300\r\n          });\r\n          playerJobs.set(String(striker.id), {\r\n            ...finalPos,\r\n            movement: 'striker_drop_outlet',\r\n            role: 'STRIKER_OUTLET',\r\n            priority: 7\r\n          });\r\n          assigned.add(String(striker.id));\r\n        }\r\n      } else {\r\n        // Long goal kick - direct play to forwards\r\n        const targetMen = sortedLists.teammates.bestHeaders.slice(0, 2);\r\n        const wingers = validTeammates.filter(p =>\r\n          ['LW', 'RW', 'RM', 'LM'].some(r => p.role.includes(r))\r\n        ).slice(0, 2);\r\n\r\n        // Primary target striker - central, in opponent half\r\n        if (targetMen[0] && !assigned.has(String(targetMen[0].id))) {\r\n          const finalPos = posManager.findValidPosition({\r\n            x: PITCH_WIDTH / 2 + direction * 125,\r\n            y: 300\r\n          });\r\n          playerJobs.set(String(targetMen[0].id), {\r\n            ...finalPos,\r\n            movement: 'target_striker_long',\r\n            role: 'TARGET_STRIKER',\r\n            priority: 10\r\n          });\r\n          assigned.add(String(targetMen[0].id));\r\n        }\r\n\r\n        // Secondary target - offset for variation\r\n        if (targetMen[1] && !assigned.has(String(targetMen[1].id))) {\r\n          const finalPos = posManager.findValidPosition({\r\n            x: PITCH_WIDTH / 2 + direction * 115,\r\n            y: 240\r\n          });\r\n          playerJobs.set(String(targetMen[1].id), {\r\n            ...finalPos,\r\n            movement: 'target_secondary',\r\n            role: 'SECONDARY_TARGET',\r\n            priority: 9\r\n          });\r\n          assigned.add(String(targetMen[1].id));\r\n        }\r\n\r\n        // Wingers on flanks - positioned for flick-ons and second balls\r\n        if (wingers[0] && !assigned.has(String(wingers[0].id))) {\r\n          const finalPos = posManager.findValidPosition({\r\n            x: PITCH_WIDTH / 2 + direction * 90,\r\n            y: 115\r\n          });\r\n          playerJobs.set(String(wingers[0].id), {\r\n            ...finalPos,\r\n            movement: 'winger_flank_left',\r\n            role: 'WINGER_LEFT',\r\n            priority: 8\r\n          });\r\n          assigned.add(String(wingers[0].id));\r\n        }\r\n\r\n        if (wingers[1] && !assigned.has(String(wingers[1].id))) {\r\n          const finalPos = posManager.findValidPosition({\r\n            x: PITCH_WIDTH / 2 + direction * 90,\r\n            y: 485\r\n          });\r\n          playerJobs.set(String(wingers[1].id), {\r\n            ...finalPos,\r\n            movement: 'winger_flank_right',\r\n            role: 'WINGER_RIGHT',\r\n            priority: 8\r\n          });\r\n          assigned.add(String(wingers[1].id));\r\n        }\r\n\r\n        // Attacking midfielders push up for second balls\r\n        const attackingMids = validTeammates.filter(p =>\r\n          !assigned.has(String(p.id)) &&\r\n          ['CM', 'CAM'].some(r => p.role.includes(r))\r\n        ).slice(0, 2);\r\n\r\n        attackingMids.forEach((mid, idx) => {\r\n          const yPos = idx === 0 ? 245 : 355;\r\n          const finalPos = posManager.findValidPosition({\r\n            x: PITCH_WIDTH / 2 + direction * 30,\r\n            y: yPos\r\n          });\r\n          playerJobs.set(String(mid.id), {\r\n            ...finalPos,\r\n            movement: 'second_ball_mid',\r\n            role: `SECOND_BALL_${idx}`,\r\n            priority: 7\r\n          });\r\n          assigned.add(String(mid.id));\r\n        });\r\n\r\n        // Holding midfielder stays back for defensive security\r\n        const holdingMid = validTeammates.find(p =>\r\n          !assigned.has(String(p.id)) &&\r\n          p.role.includes('CDM')\r\n        );\r\n        if (holdingMid) {\r\n          const finalPos = posManager.findValidPosition({\r\n            x: PITCH_WIDTH / 2 - direction * 20,\r\n            y: 300\r\n          });\r\n          playerJobs.set(String(holdingMid.id), {\r\n            ...finalPos,\r\n            movement: 'holding_mid_security',\r\n            role: 'HOLDING_MID',\r\n            priority: 6\r\n          });\r\n          assigned.add(String(holdingMid.id));\r\n        }\r\n      }\r\n\r\n      // Remaining players - spread them out based on their FORMATION positions\r\n      const remainingPlayers = validTeammates.filter(p => !assigned.has(String(p.id)));\r\n\r\n      remainingPlayers.forEach((p) => {\r\n        // 1. Get the player's ACTUAL formation position for this half.\r\n        // This is the \"original location\" we want to trust.\r\n        const formationAnchor = getFormationAnchorForPlayer(p, gameState);\r\n\r\n        if (!formationAnchor) {\r\n          // This should not happen, but as a fallback, place them in a safe zone.\r\n          console.warn(`Goal Kick: Could not find formation anchor for ${p.name}`);\r\n          // \u2705 FIX: Clamp fallback position to safe bounds\r\n          let fallbackX = ownGoalX + direction * 150 + (Math.random() - 0.5) * 40;\r\n          fallbackX = Math.max(50, Math.min(750, fallbackX)); // Ensure within pitch bounds\r\n          const fallbackPos = {\r\n            x: fallbackX,\r\n            y: (PITCH_HEIGHT / 2) + (Math.random() - 0.5) * 100\r\n          };\r\n          const finalPos = posManager.findValidPosition(fallbackPos);\r\n\r\n          playerJobs.set(String(p.id), {\r\n            ...finalPos,\r\n            movement: 'support_gk_fallback',\r\n            role: 'SUPPORT',\r\n            priority: 5\r\n          });\r\n          return; // Skip to next player\r\n        }\r\n\r\n        let targetX = formationAnchor.x;\r\n        let targetY = formationAnchor.y; // Trust the original Y position\r\n\r\n        // 2. Enforce the ONLY rule that matters: Stay in your own half.\r\n        const halfBuffer = 10; // 10px from center line\r\n        const midLine = PITCH_WIDTH / 2;\r\n\r\n        if (direction === 1) { // ownGoalX is on left (direction is to the right)\r\n          // Player must be left of the midline\r\n          targetX = Math.min(targetX, midLine - halfBuffer);\r\n        } else { // ownGoalX is on right (direction is to the left)\r\n          // Player must be right of the midline\r\n          targetX = Math.max(targetX, midLine + halfBuffer);\r\n        }\r\n\r\n        // 3. REMOVED all X and Y clamping.\r\n        // We let the player go to their real Y position (e.g., y: 40 for a wide fullback).\r\n        // The PositionManager will handle any collisions.\r\n        const spreadPos = {\r\n          x: targetX,\r\n          y: targetY\r\n        };\r\n\r\n        const finalPos = posManager.findValidPosition(spreadPos);\r\n\r\n        playerJobs.set(String(p.id), {\r\n          ...finalPos,\r\n          movement: 'support_gk_formation', // New descriptive movement name\r\n          role: 'SUPPORT',\r\n          priority: 5\r\n        });\r\n      });\r\n\r\n      (gameState as any)._goalKickJobAssignments = playerJobs;\r\n    }\r\n\r\n    const playerIdStr = String(player.id);\r\n    const myPositionData = (gameState as any)._goalKickJobAssignments?.get(playerIdStr);\r\n\r\n    if (myPositionData) {\r\n      return sanitizePosition(myPositionData, { player, gameState, behavior: 'ProfessionalGoalKick' });\r\n    }\r\n\r\n    const activePos = getPlayerActivePosition(player, gameState.currentHalf);\r\n    return sanitizePosition({ x: activePos.x, y: activePos.y, movement: 'fallback_goal_kick' }, { player });\r\n  },\r\n\r\n  getDefendingGoalKickPosition(\r\n    player: Player,\r\n    opponentGoalX: number,\r\n    ownGoalX: number,\r\n    gameState: GameState,\r\n    _opponents: Player[],\r\n    teammates: Player[]\r\n  ) {\r\n    if (!gameState || !player || player.role === 'GK') {\r\n      return sanitizePosition({ x: ownGoalX, y: 300, movement: 'gk_stay_goal' }, { player, role: 'GK' });\r\n    }\r\n\r\n    const PITCH_WIDTH = GAME_CONFIG.PITCH_WIDTH;\r\n    const PITCH_HEIGHT = GAME_CONFIG.PITCH_HEIGHT;\r\n    const SET_PIECE_TYPES = { GOAL_KICK: 'GOAL_KICK' };\r\n\r\n    const context = new TacticalContext(gameState, SET_PIECE_TYPES.GOAL_KICK);\r\n    const shouldPress = context.shouldCommitForward(player.isHome);\r\n    const direction = Math.sign(opponentGoalX - 400);\r\n\r\n    if (!(gameState as any)._goalKickDefPosManager) (gameState as any)._goalKickDefPosManager = new PositionManager();\r\n    const posManager = (gameState as any)._goalKickDefPosManager;\r\n\r\n    const setupKey = `_lastGoalKickDefSetup_H${gameState.currentHalf}`;\r\n    if (!(gameState as any)[setupKey] || (gameState as any)[setupKey] !== gameState.setPiece) {\r\n      (gameState as any)[setupKey] = gameState.setPiece;\r\n      posManager.reset();\r\n\r\n      const playerJobs = new Map<string, PlayerJobAssignment>();\r\n      const validTeammates = getValidPlayers(teammates).filter(p => p.role !== 'GK');\r\n      const sortedLists = getSortedLists(validTeammates, []);\r\n\r\n      const assigned = new Set<string>();\r\n\r\n      if (shouldPress) {\r\n        // High press on goal kick - RESPECT PENALTY AREA RULE\r\n        // Opposing players MUST stay OUTSIDE the penalty area (18 yards = ~165px from goal line)\r\n        // Players can only enter after the ball leaves the penalty area\r\n        const PENALTY_AREA_DISTANCE = 170; // 18 yards + safety margin\r\n        const pressers = sortedLists.teammates.fastest.slice(0, 3);\r\n\r\n        pressers.forEach((presser, idx) => {\r\n          const yPos = 200 + idx * 100;\r\n          // Position OUTSIDE penalty area - minimum 170 pixels from goal\r\n          const finalPos = posManager.findValidPosition({\r\n            x: opponentGoalX - direction * PENALTY_AREA_DISTANCE,\r\n            y: yPos\r\n          });\r\n          playerJobs.set(String(presser.id), {\r\n            ...finalPos,\r\n            movement: 'high_press_gk_outside_box',\r\n            role: `PRESSER_${idx}`,\r\n            priority: 9\r\n          });\r\n          assigned.add(String(presser.id));\r\n        });\r\n\r\n        // Block passing lanes - also stay outside penalty area\r\n        const laneBlockers = validTeammates.filter(p =>\r\n          !assigned.has(String(p.id))\r\n        ).slice(0, 4);\r\n\r\n        laneBlockers.forEach((blocker, idx) => {\r\n          const xPos = opponentGoalX - direction * (PENALTY_AREA_DISTANCE + 20); // Extra margin for lane blockers\r\n          const yPos = 150 + idx * 100;\r\n          const finalPos = posManager.findValidPosition({ x: xPos, y: yPos });\r\n          playerJobs.set(String(blocker.id), {\r\n            ...finalPos,\r\n            movement: 'block_lane_outside_box',\r\n            role: `LANE_BLOCK_${idx}`,\r\n            priority: 8\r\n          });\r\n          assigned.add(String(blocker.id));\r\n        });\r\n      } else {\r\n        // Mid-block shape: Use formation anchors, not clustering logic\r\n        validTeammates.forEach((p) => {\r\n          if (!assigned.has(String(p.id))) {\r\n\r\n            // 1. Get the player's ACTUAL formation position\r\n            const formationAnchor = getFormationAnchorForPlayer(p, gameState);\r\n\r\n            if (!formationAnchor) {\r\n              // Fallback if anchor is missing\r\n              const fallbackPos = {\r\n                x: PITCH_WIDTH / 2 - direction * 50,\r\n                y: PITCH_HEIGHT / 2 + (Math.random() - 0.5) * 200\r\n              };\r\n              const finalPos = posManager.findValidPosition(fallbackPos);\r\n              playerJobs.set(String(p.id), {\r\n                ...finalPos,\r\n                movement: 'mid_block_fallback',\r\n                role: 'MID_BLOCK',\r\n                priority: 7\r\n              });\r\n              assigned.add(String(p.id));\r\n              return; // Skip to next player\r\n            }\r\n\r\n            // 2. Use the formation anchor as the base\r\n            let targetX = formationAnchor.x;\r\n            let targetY = formationAnchor.y; // <-- This respects the player's Y-position\r\n\r\n            // 3. Define the mid-block line (e.g., 50px in own half)\r\n            const midBlockLineX = PITCH_WIDTH / 2 - direction * 50;\r\n\r\n            // 4. Pull players back to the mid-block line IF they are ahead of it\r\n            // (e.g., pull STRIKERS back, but leave DEFENDERS where they are)\r\n            if (direction === 1) { // Attacking right\r\n              // Pull players back to be LEFT of the line\r\n              targetX = Math.min(targetX, midBlockLineX);\r\n            } else { // Attacking left\r\n              // Pull players back to be RIGHT of the line\r\n              targetX = Math.max(targetX, midBlockLineX);\r\n            }\r\n\r\n            // 5. Use the PositionManager to find a valid spot\r\n            const finalPos = posManager.findValidPosition({ x: targetX, y: targetY });\r\n\r\n            playerJobs.set(String(p.id), {\r\n              ...finalPos,\r\n              movement: 'mid_block_formation',\r\n              role: 'MID_BLOCK',\r\n              priority: 7\r\n            });\r\n            assigned.add(String(p.id));\r\n          }\r\n        });\r\n      }\r\n\r\n      (gameState as any)._goalKickDefJobAssignments = playerJobs;\r\n    }\r\n\r\n    const playerIdStr = String(player.id);\r\n    const myPositionData = (gameState as any)._goalKickDefJobAssignments?.get(playerIdStr);\r\n\r\n    if (myPositionData) {\r\n      return sanitizePosition(myPositionData, { player, gameState, behavior: 'ProfessionalGoalKickDefending' });\r\n    }\r\n\r\n    const activePos = getPlayerActivePosition(player, gameState.currentHalf);\r\n    return sanitizePosition({ x: activePos.x, y: activePos.y, movement: 'fallback_goal_kick_def' }, { player });\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// BROWSER EXPORTS\r\n// ============================================================================\r\n\r\n// Functions are now exported via ES6 modules - no window exports needed\r\nconsole.log('\u2705 GOAL KICK BEHAVIORS LOADED (TypeScript)');\r\n", "import type { Player, GameState } from '../types';\nimport { getDistance, getAttackingGoalX } from '../utils/ui';\nimport { sanitizePosition, getValidPlayers, isPlayerAttacking, getFormationAwarePosition } from './utils';\nimport { getPlayerActivePosition } from '../ai/movement';\nimport { KickoffBehaviors } from './behaviors/kickoff';\nimport { PenaltyKickBehaviors as PenaltyBehaviors } from './behaviors/penalty';\nimport { ThrowInBehaviors } from './behaviors/throwIn';\nimport { ProfessionalCornerBehaviors as CornerKickBehaviors } from './behaviors/cornerKick';\nimport { ProfessionalFreeKickBehaviors as FreeKickBehaviors } from './behaviors/freeKick';\nimport { ProfessionalGoalKickBehaviors as GoalKickBehaviors } from './behaviors/goalKick';\nimport { GAME_CONFIG } from '../config';\nimport { isSetPieceStatus } from '../utils/ui';\n\nconst GAME_CONFIG_SPB_DEFAULT = {\n    PITCH_WIDTH: 800,\n    PITCH_HEIGHT: 600,\n    MIN_PLAYER_SPACING: 30,\n    GOAL_Y_TOP: 240,\n    GOAL_Y_BOTTOM: 360\n};\n\nconst activeConfig = (typeof GAME_CONFIG !== 'undefined') ? GAME_CONFIG : GAME_CONFIG_SPB_DEFAULT;\nconst PITCH_WIDTH = activeConfig.PITCH_WIDTH;\nconst PITCH_HEIGHT = activeConfig.PITCH_HEIGHT;\n\nconst SET_PIECE_TYPES = {\n    CORNER_KICK: 'CORNER_KICK',\n    FREE_KICK: 'FREE_KICK',\n    THROW_IN: 'THROW_IN',\n    GOAL_KICK: 'GOAL_KICK',\n    PENALTY: 'PENALTY',\n    KICK_OFF: 'KICK_OFF'\n};\n\nfunction handleGoalkeeperSetPiecePosition(player: Player, gameState: GameState, setPieceType: string, isAttacking: boolean, ownGoalX: number, setPiecePos: { x: number; y: number }) {\n    try {\n        const opponentGoalX = getAttackingGoalX(player.isHome, gameState.currentHalf);\n\n        switch (setPieceType) {\n            case SET_PIECE_TYPES.CORNER_KICK:\n                if (!isAttacking) {\n                    const isRightCorner = setPiecePos.y < (PITCH_HEIGHT / 2);\n                    const gkY = isRightCorner ? activeConfig.GOAL_Y_TOP + 50 : activeConfig.GOAL_Y_BOTTOM - 50;\n                    return sanitizePosition({ x: ownGoalX, y: gkY, movement: 'gk_corner_positioning', role: 'GK' }, { player });\n                }\n                break;\n\n            case SET_PIECE_TYPES.FREE_KICK:\n                if (!isAttacking) {\n                    const offsetY = setPiecePos.y > 300 ? -20 : 20;\n                    return sanitizePosition({ x: ownGoalX, y: 300 + offsetY, movement: 'gk_fk_positioning', role: 'GK' }, { player });\n                }\n                break;\n\n            case SET_PIECE_TYPES.PENALTY:\n                return PenaltyBehaviors.getPenaltyArcPosition(player, setPiecePos, isAttacking, gameState);\n\n            case SET_PIECE_TYPES.GOAL_KICK:\n                const teammates = getValidPlayers(player.isHome ? gameState.homePlayers : gameState.awayPlayers);\n                const opponents = getValidPlayers(player.isHome ? gameState.awayPlayers : gameState.homePlayers);\n                const teamTactic = player.isHome ? gameState.homeTactic : gameState.awayTactic;\n\n                return isAttacking ?\n                    GoalKickBehaviors.getGoalKickPosition(player, ownGoalX, teamTactic, true, gameState, teammates) :\n                    GoalKickBehaviors.getDefendingGoalKickPosition(player, opponentGoalX, ownGoalX, gameState, opponents, teammates);\n        }\n\n        return sanitizePosition({ x: ownGoalX, y: 300, movement: 'gk_default' }, { player });\n    } catch (error) {\n        console.error(`GK positioning error:`, error);\n        const fallbackGoalX = getAttackingGoalX(!player.isHome, gameState?.currentHalf ?? 1);\n        return sanitizePosition({ x: fallbackGoalX, y: 300, movement: 'gk_error' }, { player });\n    }\n}\n\nfunction getSafeFallbackPosition(player: Player, reason: string, gameState: GameState) {\n    const activePos = getPlayerActivePosition(player, gameState?.currentHalf ?? 1);\n    return sanitizePosition(\n        { x: activePos?.x ?? PITCH_WIDTH / 2, y: activePos?.y ?? PITCH_HEIGHT / 2, movement: `fallback_${reason}` },\n        { player, behavior: 'Fallback' }\n    );\n}\n\nfunction calculateSetPiecePositionWithSafety(player: Player, gameState: GameState, setPieceType: string, isAttacking: boolean, setPiecePos: { x: number; y: number }) {\n    const ownGoalX = getAttackingGoalX(!player.isHome, gameState.currentHalf);\n    const opponentGoalX = getAttackingGoalX(player.isHome, gameState.currentHalf);\n    const teammates = getValidPlayers(player.isHome ? gameState.homePlayers : gameState.awayPlayers);\n    const opponents = getValidPlayers(player.isHome ? gameState.awayPlayers : gameState.homePlayers);\n\n    try {\n        switch (setPieceType) {\n            case SET_PIECE_TYPES.FREE_KICK:\n                const distToGoal = getDistance(setPiecePos, { x: (isAttacking ? opponentGoalX : ownGoalX), y: 300 });\n                return isAttacking ?\n                    FreeKickBehaviors.getAttackingFreeKickPosition(player, setPiecePos, opponentGoalX, distToGoal, null, gameState, teammates) :\n                    FreeKickBehaviors.getDefendingFreeKickPosition(player, setPiecePos, ownGoalX, distToGoal, null, opponents, gameState, teammates);\n\n            case SET_PIECE_TYPES.CORNER_KICK:\n                return isAttacking ?\n                    CornerKickBehaviors.getAttackingCornerPosition(player, setPiecePos, opponentGoalX, teammates, null, (gameState.setPiece as any)?.routine, gameState) :\n                    CornerKickBehaviors.getDefendingCornerPosition(player, setPiecePos, ownGoalX, opponents, null, (gameState.setPiece as any)?.defensiveSystem, gameState, teammates);\n\n            case SET_PIECE_TYPES.THROW_IN:\n                return ThrowInBehaviors.getThrowInPosition(player, setPiecePos, ownGoalX, opponentGoalX, gameState, teammates, opponents);\n\n            case SET_PIECE_TYPES.GOAL_KICK:\n                const teamTactic = player.isHome ? gameState.homeTactic : gameState.awayTactic;\n                return isAttacking ?\n                    GoalKickBehaviors.getGoalKickPosition(player, ownGoalX, teamTactic, true, gameState, teammates) :\n                    GoalKickBehaviors.getDefendingGoalKickPosition(player, opponentGoalX, ownGoalX, gameState, opponents, teammates);\n\n            case SET_PIECE_TYPES.PENALTY:\n                if (isAttacking) {\n                    const isKicker = (gameState.setPiece as any).kicker && String((gameState.setPiece as any).kicker.id) === String(player.id);\n                    if (isKicker) {\n                        return PenaltyBehaviors.getKickerPosition(setPiecePos);\n                    }\n                }\n                return PenaltyBehaviors.getPenaltyArcPosition(player, setPiecePos, isAttacking, gameState);\n\n            case SET_PIECE_TYPES.KICK_OFF:\n                if (typeof KickoffBehaviors.getKickoffPosition !== 'undefined') {\n                    const kickingTeamIsHome = typeof (gameState.setPiece as any).team === 'boolean'\n                        ? (gameState.setPiece as any).team\n                        : (gameState.setPiece as any).team === 'home';\n                    const isKickingTeam = player.isHome === kickingTeamIsHome;\n                    return KickoffBehaviors.getKickoffPosition(player, setPiecePos, isKickingTeam, gameState);\n                }\n                return sanitizePosition({ x: player.x, y: player.y, movement: 'kickoff_fallback', role: player.role }, { player, gameState });\n\n            default:\n                return getSafeFallbackPosition(player, `unknown_type_${setPieceType}`, gameState);\n        }\n    } catch (error) {\n        console.error(`Set piece calculation error:`, error);\n        return getSafeFallbackPosition(player, `calculation_error`, gameState);\n    }\n}\n\nfunction getSetPiecePosition(player: Player, gameState: GameState) {\n    try {\n        if (!gameState || !player || !gameState.setPiece || !gameState.setPiece.position) {\n            return getSafeFallbackPosition(player, 'invalid_state', gameState);\n        }\n\n        const setPieceType = gameState.status;\n        const isAttacking = isPlayerAttacking(player, gameState);\n        const setPiecePos = gameState.setPiece.position;\n\n        if (player.role === 'GK' || (player as any).role === 'goalkeeper') {\n            const ownGoalX = getAttackingGoalX(!player.isHome, gameState.currentHalf);\n            return handleGoalkeeperSetPiecePosition(player, gameState, setPieceType, isAttacking, ownGoalX, setPiecePos);\n        }\n\n        let position = calculateSetPiecePositionWithSafety(player, gameState, setPieceType, isAttacking, setPiecePos);\n\n        position = getFormationAwarePosition(player, position, gameState, isAttacking);\n\n        return sanitizePosition(position, {\n            player,\n            setPieceType,\n            behavior: 'MainSetPieceDispatch',\n            role: (position as any)?.role || player?.role || 'UNKNOWN',\n            gameState\n        });\n\n    } catch (error) {\n        console.error('Critical error in getSetPiecePosition:', error);\n        return getSafeFallbackPosition(player, 'critical_error', gameState);\n    }\n}\n\nfunction shouldLockSetPiecePosition(player: Player, gameState: GameState): boolean {\n    if (!gameState || !player || !gameState.setPiece) return false;\n\n    if (gameState.status === 'KICK_OFF') {\n        return true;\n    }\n\n    const movement = (player as any).setPieceMovement || getSetPieceMovementType(player, gameState);\n    const movementLower = typeof movement === 'string' ? movement.toLowerCase() : '';\n\n    const lockKeywords = ['kicker', 'thrower', 'wall'];\n    if (lockKeywords.some(keyword => movementLower.includes(keyword))) {\n        return getDistance(player, (gameState.setPiece as any).position) < 15;\n    }\n\n    if (!(gameState.setPiece as any).executionTime) return false;\n    const timeUntilExecution = (gameState.setPiece as any).executionTime - Date.now();\n    return timeUntilExecution < 1500 && timeUntilExecution > -500;\n}\n\nfunction getSetPieceMovementType(player: Player, gameState: GameState): string {\n    if (!gameState || !player) return 'standard_position';\n    if ((player as any).setPieceMovement) return (player as any).setPieceMovement;\n\n    const position = getSetPiecePosition(player, gameState);\n    const movement = (position as any)?.movement || 'standard_position';\n    (player as any).setPieceMovement = movement;\n    return movement;\n}\n\nfunction isSetPieceActive(gameState: GameState): boolean {\n    if (!gameState || !gameState.status) return false;\n\n    if (typeof isSetPieceStatus === 'function') {\n        return isSetPieceStatus(gameState.status);\n    }\n\n    return [\n        SET_PIECE_TYPES.CORNER_KICK,\n        SET_PIECE_TYPES.FREE_KICK,\n        SET_PIECE_TYPES.THROW_IN,\n        SET_PIECE_TYPES.GOAL_KICK,\n        SET_PIECE_TYPES.PENALTY,\n        SET_PIECE_TYPES.KICK_OFF\n    ].includes(gameState.status);\n}\n\nexport const SetPieceBehaviorSystem = {\n    getSetPiecePosition,\n    shouldLockSetPiecePosition,\n    getSetPieceMovementType,\n    isSetPieceActive\n};\n", "/**\n * Set Piece Execution Module\n * @migrated-from js/setpieces/setPieceExecution.js\n *\n * This module handles the execution of all set pieces:\n * - Corner kicks (enhanced)\n * - Free kicks (enhanced)\n * - Throw-ins (enhanced)\n * - Goal kicks (enhanced)\n * - Kick-offs (enhanced)\n * - Router for dispatching set piece execution\n */\n\nimport type { GameState, Player } from '../types';\nimport { distance as getDistance } from '../utils/math';\nimport { getAttackingGoalX } from '../utils/ui';\nimport { getSafeStat } from './utils';\nimport { assignSetPieceKicker, executeSetPiece_PostExecution } from './integration';\nimport { passBall } from '../ai/decisions';\nimport { GAME_CONFIG } from '../config';\n\n// ============================================================================\n// ENHANCED CORNER KICK EXECUTION\n// ============================================================================\n\nexport function executeCornerKick_Enhanced(gameState: GameState): boolean {\n    if (!gameState || !gameState.setPiece || !gameState.setPiece.position) return false;\n    const setPiece = gameState.setPiece;\n\n    // Validate ball position\n    if (!isFinite(setPiece.position.x) || !isFinite(setPiece.position.y)) {\n        console.error(\"\u274C Corner Kick: Invalid ball position detected, aborting\");\n        return false;\n    }\n\n    const takingTeam = setPiece.team;\n    // Tak\u0131m oyuncular\u0131n\u0131 gameState'den al\n    const allPlayers = [...(gameState.homePlayers || []), ...(gameState.awayPlayers || [])];\n    // \u2705 FIXED: Normalize team value to boolean for comparison\n    const takingTeamIsHome = (typeof takingTeam === 'boolean') ? takingTeam : (takingTeam === 'home');\n    const takingTeamPlayers = allPlayers.filter(p => p && p.isHome === takingTeamIsHome);\n    if (takingTeamPlayers.length === 0) return false;\n\n    const opponentGoalX = getAttackingGoalX(takingTeamIsHome, gameState.currentHalf);\n    const routine = (setPiece as any).routine || 'standard'; // 'cornerRoutine' yerine\n\n    // En iyi korner at\u0131c\u0131s\u0131n\u0131 se\u00E7 (realStats veya base stats kullan)\n    const taker = takingTeamPlayers\n        .filter(p => p.role !== 'GK')\n        .sort((a, b) => {\n            const aSkill = getSafeStat(a.realStats, 'crossesAccuracy', a.passing || 50) + (a.passing || 50);\n            const bSkill = getSafeStat(b.realStats, 'crossesAccuracy', b.passing || 50) + (b.passing || 50);\n            return bSkill - aSkill;\n        })[0];\n\n   if (!taker) {\n       assignSetPieceKicker(null);\n       console.warn(\"Korner: At\u0131c\u0131 bulunamad\u0131.\");\n       return false;\n   }\n\n   assignSetPieceKicker(taker);\n\n    let targetX: number, targetY: number, speed: number, accuracy: number;\n    const isRightCorner = setPiece.position.y < (GAME_CONFIG.PITCH_HEIGHT / 2 || 300);\n    const direction = Math.sign(opponentGoalX - (GAME_CONFIG.PITCH_WIDTH / 2 || 400));\n    const goalYTop = GAME_CONFIG.GOAL_Y_TOP || 240;\n    const goalYBottom = GAME_CONFIG.GOAL_Y_BOTTOM || 360;\n    const pitchHeight = GAME_CONFIG.PITCH_HEIGHT || 600;\n\n    switch (routine) {\n        case 'short':\n            const shortTarget = takingTeamPlayers\n                .filter(p => String(p.id) !== String(taker.id) && p.role !== 'GK')\n                .sort((a, b) => getDistance(a, setPiece.position) - getDistance(b, setPiece.position))[0];\n            if (shortTarget) {\n                targetX = shortTarget.x; targetY = shortTarget.y; speed = 420; accuracy = 0.95;\n            } else { // K\u0131sa pas hedefi yoksa standarda d\u00F6n\n                targetX = opponentGoalX - direction * 110; targetY = pitchHeight / 2; speed = 650; accuracy = 0.80;\n            }\n            break;\n        case 'inswinger':\n            targetX = opponentGoalX - direction * 28; targetY = isRightCorner ? goalYTop + 20 : goalYBottom - 20; speed = 680; accuracy = 0.78;\n            break;\n        case 'outswinger':\n            targetX = opponentGoalX - direction * 32; targetY = isRightCorner ? goalYBottom - 10 : goalYTop + 10; speed = 700; accuracy = 0.76;\n            break;\n        default: // standard\n            targetX = opponentGoalX - direction * 110; targetY = pitchHeight / 2; speed = 650; accuracy = 0.80;\n    }\n\n    // Yetenek bazl\u0131 isabet ayar\u0131\n    const skillModifier = getSafeStat(taker.realStats, 'crossesAccuracy', taker.passing || 50) / 100;\n    accuracy *= (0.7 + skillModifier * 0.3);\n\n    if (typeof passBall === 'function') {\n        passBall(taker, setPiece.position.x, setPiece.position.y, targetX, targetY, accuracy, speed, false); // `false` = pas (\u015Fut de\u011Fil)\n        console.log(`\u26BD Corner executed: ${routine} by ${taker.name}`);\n        return true;\n    } else { console.error(\"executeCornerKick: passBall function not found!\"); }\n\n    return false;\n}\n\n// ============================================================================\n// ENHANCED FREE KICK EXECUTION\n// ============================================================================\n\nexport function executeFreeKick_Enhanced(gameState: GameState): boolean {\n    if (!gameState || !gameState.setPiece || !gameState.setPiece.position) return false;\n    const setPiece = gameState.setPiece;\n\n    // Validate ball position\n    if (!isFinite(setPiece.position.x) || !isFinite(setPiece.position.y)) {\n        console.error(\"\u274C Free Kick: Invalid ball position detected, aborting\");\n        return false;\n    }\n\n    const takingTeam = setPiece.team;\n    const allPlayers = [...(gameState.homePlayers || []), ...(gameState.awayPlayers || [])];\n    // \u2705 FIXED: Normalize team value to boolean for comparison\n    const takingTeamIsHome = (typeof takingTeam === 'boolean') ? takingTeam : (takingTeam === 'home');\n    const takingTeamPlayers = allPlayers.filter(p => p && p.isHome === takingTeamIsHome);\n    const opponents = allPlayers.filter(p => p && p.isHome !== takingTeamIsHome);\n    if (takingTeamPlayers.length === 0) return false;\n\n    const opponentGoalX = getAttackingGoalX(takingTeamIsHome, gameState.currentHalf);\n    const distToGoal = getDistance(setPiece.position, {x: opponentGoalX, y: 300}); // Mesafeyi hedefe g\u00F6re hesapla\n    const angleToGoal = Math.abs(setPiece.position.y - 300);\n\n    // En iyi serbest vuru\u015F\u00E7uyu se\u00E7 (realStats veya base stats kullan)\n    const taker = takingTeamPlayers\n        .filter(p => p.role !== 'GK')\n        .sort((a, b) => {\n             // 'freekicks' verisi yok, 'shooting' ve 'passing' kullan\u0131l\u0131yor\n            const aSkill = (a.shooting || 50) + (a.passing || 50);\n            const bSkill = (b.shooting || 50) + (b.passing || 50);\n            return bSkill - aSkill;\n        })[0];\n\n   if (!taker) {\n       assignSetPieceKicker(null);\n       console.warn(\"Serbest Vuru\u015F: At\u0131c\u0131 bulunamad\u0131.\");\n       return false;\n   }\n\n   assignSetPieceKicker(taker);\n\n    const isShootingRange = distToGoal < 280;\n    const isGoodAngle = angleToGoal < 130;\n\n    // Baraj\u0131 tespit et (yakla\u015F\u0131k 10 yarda = 92px)\n    const wallPlayers = opponents.filter(p => {\n        const distToFK = getDistance(p, setPiece.position);\n        return distToFK > 80 && distToFK < 105; // Biraz daha geni\u015F aral\u0131k\n    });\n    const hasWall = wallPlayers.length >= ((gameState as any)._currentWallSize || 3); // Kurulumdaki baraj boyutunu kontrol et\n\n    if (isShootingRange && isGoodAngle) {\n        // \u015EUT DENEMES\u0130\n        const shootingSkill = (taker.shooting || 50) / 100;\n        const shootingChance = shootingSkill * (hasWall ? 0.55 : 0.82) * (distToGoal < 200 ? 1.1 : 0.9); // Yak\u0131nsa \u015Fans artar\n\n        if (Math.random() < shootingChance) {\n            let targetY = 300;\n            const goalYTop = GAME_CONFIG.GOAL_Y_TOP || 240;\n            const goalYBottom = GAME_CONFIG.GOAL_Y_BOTTOM || 360;\n\n            if (hasWall && wallPlayers.length > 0) {\n                // Baraj\u0131 ge\u00E7mek i\u00E7in k\u00F6\u015Felere ni\u015Fan al\n                const wallYs = wallPlayers.map(p => p.y);\n                const wallTop = Math.min(...wallYs);\n                const wallBottom = Math.max(...wallYs);\n                const wallCenterY = (wallTop + wallBottom) / 2;\n\n                // Baraj\u0131n \u00FCst\u00FCnden veya yan\u0131ndan\n                if (Math.random() < 0.6) { // %60 \u00FCst\u00FCnden\n                     targetY = wallCenterY > 300 ? goalYTop + 10 : goalYBottom - 10; // \u00DCst k\u00F6\u015Fe\n                } else { // %40 yan\u0131ndan\n                    targetY = wallCenterY > 300 ? wallBottom + 25 : wallTop - 25; // Baraj\u0131n bitti\u011Fi yer\n                    targetY = Math.max(goalYTop + 5, Math.min(goalYBottom - 5, targetY)); // Kale i\u00E7inde kal\n                }\n                targetY += (Math.random() - 0.5) * 30; // Hafif sapma ekle\n\n            } else {\n                // Baraj yok - k\u00F6\u015Felere veya ortaya ni\u015Fan al\n                const options = [goalYTop + 15, 300, goalYBottom - 15];\n                targetY = options[Math.floor(Math.random() * options.length)] || 300;\n                targetY += (Math.random() - 0.5) * 25;\n            }\n\n            // G\u00FCc\u00FC mesafeye g\u00F6re ayarla\n            const powerFactor = Math.min(distToGoal / 220, 1.3); // 220px referans mesafe\n            const speed = 700 + powerFactor * 200; // Daha g\u00FC\u00E7l\u00FC \u015Futlar\n            const accuracy = 0.65 + shootingSkill * 0.20 - (hasWall ? 0.12 : 0); // \u0130sabet barajdan daha \u00E7ok etkilenir\n\n            if (typeof passBall === 'function') {\n                passBall(taker, setPiece.position.x, setPiece.position.y,\n                        opponentGoalX, targetY, accuracy, speed, true); // `true` = \u015Fut\n                console.log(`\u26BD Free Kick SHOT by ${taker.name}`);\n                return true;\n            } else { console.error(\"executeFreeKick (Shot): passBall function not found!\"); }\n        }\n    }\n\n    // PAS VERME\n    // Daha ak\u0131ll\u0131 hedef se\u00E7imi: Bo\u015Fluk + kaleye yak\u0131nl\u0131k\n    const targets = takingTeamPlayers\n        .filter(p => String(p.id) !== String(taker.id) && p.role !== 'GK')\n        .map(t => {\n            const distToTargetGoal = getDistance(t, {x: opponentGoalX, y: 300});\n            const space = opponents.length > 0\n                ? Math.min(100, ...opponents.map(o => getDistance(o, t)))\n                : 100; // No opponents = max space\n            // \u00C7ok yak\u0131ndaki hedefleri daha az tercih et (zor pas)\n            const distPenalty = Math.max(0, 30 - getDistance(t, setPiece.position));\n            return {\n                player: t,\n                score: (400 - distToTargetGoal) + space * 1.5 - distPenalty // Bo\u015Flu\u011Fa daha \u00E7ok \u00F6nem ver\n            };\n        })\n        .filter(t => t.score > 0) // Negatif skorlular\u0131 ele\n        .sort((a, b) => b.score - a.score);\n\n    const target = targets[0]?.player;\n\n    if (target && typeof passBall === 'function') {\n        const passAccuracy = 0.85 + getSafeStat(taker.realStats, 'passAccuracy', taker.passing || 70) / 300;\n        const passSpeed = 450 + distToGoal / 3; // Mesafeye g\u00F6re h\u0131z\n        passBall(taker, setPiece.position.x, setPiece.position.y,\n                target.x, target.y, passAccuracy, passSpeed, false); // `false` = pas\n        console.log(`\u26BD Free Kick PASS by ${taker.name} to ${target.name}`);\n        return true;\n    } else { console.warn(\"Serbest Vuru\u015F: Pas hedefi bulunamad\u0131.\"); }\n\n    return false;\n}\n\n// ============================================================================\n// ENHANCED THROW-IN EXECUTION\n// ============================================================================\n\nexport function executeThrowIn_Enhanced(gameState: GameState): boolean {\n    if (!gameState || !gameState.setPiece || !gameState.setPiece.position) return false;\n    const setPiece = gameState.setPiece;\n\n    // Validate ball position\n    if (!isFinite(setPiece.position.x) || !isFinite(setPiece.position.y)) {\n        console.error(\"\u274C Throw In: Invalid ball position detected, aborting\");\n        return false;\n    }\n\n    const takingTeam = setPiece.team;\n    const allPlayers = [...(gameState.homePlayers || []), ...(gameState.awayPlayers || [])];\n    // \u2705 FIXED: Normalize team value to boolean for comparison\n    const takingTeamIsHome = (typeof takingTeam === 'boolean') ? takingTeam : (takingTeam === 'home');\n    const takingTeamPlayers = allPlayers.filter(p => p && p.isHome === takingTeamIsHome);\n    const opponents = allPlayers.filter(p => p && p.isHome !== takingTeamIsHome);\n    if (takingTeamPlayers.length === 0) return false;\n\n    // FIXED: Prefer fullbacks/wingbacks for throw-ins (professional positioning)\n    // First try pre-assigned thrower from setup, then prioritize wide defenders\n    let thrower = takingTeamPlayers.find(p =>\n        (gameState as any)._throwInAssignments?.get(String(p.id))?.role === 'THROWER'\n    );\n\n    if (!thrower) {\n        // Prioritize fullbacks and wingbacks (best for throw-ins)\n        const wideDefenders = takingTeamPlayers.filter(p =>\n            ['RB', 'LB', 'RWB', 'LWB'].some(role => p.role.includes(role))\n        );\n\n        if (wideDefenders.length > 0) {\n            // Pick closest wide defender to throw position\n            thrower = wideDefenders.sort((a, b) =>\n                getDistance(a, setPiece.position) - getDistance(b, setPiece.position)\n            )[0];\n        } else {\n            // Fallback: any outfield player (except GK)\n            thrower = takingTeamPlayers\n                .filter(p => p.role !== 'GK')\n                .sort((a, b) => getDistance(a, setPiece.position) - getDistance(b, setPiece.position))[0];\n        }\n    }\n\n   if (!thrower) {\n       assignSetPieceKicker(null);\n       console.warn(\"Ta\u00E7: At\u0131c\u0131 bulunamad\u0131.\");\n       return false;\n   }\n\n   assignSetPieceKicker(thrower);\n\n    // En iyi al\u0131c\u0131y\u0131 bul (Bo\u015Fluk + Yak\u0131nl\u0131k)\n    const receivers = takingTeamPlayers\n        .filter(p => String(p.id) !== String(thrower.id) && p.role !== 'GK')\n        .map(p => {\n            const distToThrower = getDistance(p, setPiece.position);\n            const space = Math.min(100, ...opponents.map(o => getDistance(o, p))); // Max 100px bo\u015Fluk\n            const inRange = distToThrower < 180; // Biraz daha uzun at\u0131\u015F menzili\n\n            // A\u00E7\u0131k alandaki oyuncular\u0131 ve k\u0131sa opsiyonlar\u0131 \u00F6nceliklendir\n            let score = 0;\n            if (inRange) {\n                 score = space * 2.5 - distToThrower * 0.5;\n                 // K\u0131sa pas opsiyonuna bonus\n                 if ((gameState as any)._throwInAssignments?.get(String(p.id))?.role === 'SHORT_OPTION') {\n                     score += 50;\n                 }\n            }\n            return { player: p, score: score };\n        })\n\n        .sort((a, b) => b.score - a.score);\n\n    const target = receivers[0]?.player;\n\n    if (target && typeof passBall === 'function') {\n        const dist = getDistance(setPiece.position, target); // At\u0131\u015F pozisyonundan hedefe uzakl\u0131k\n        const throwPower = 300 + dist * 1.5; // Mesafeye g\u00F6re g\u00FC\u00E7 ayar\u0131\n        const accuracy = 0.90 + (thrower.physicality || 60) / 500; // Fizik g\u00FCc\u00FCne hafif ba\u011Fl\u0131 isabet\n        passBall(thrower, setPiece.position.x, setPiece.position.y,\n                target.x, target.y, accuracy, Math.min(throwPower, 600), false); // Max h\u0131z 600\n        console.log(`\u26BD Throw-in by ${thrower.name} to ${target.name}`);\n        return true;\n    } else { console.warn(\"Ta\u00E7: Uygun al\u0131c\u0131 bulunamad\u0131.\"); }\n\n    return false;\n}\n\n// ============================================================================\n// ENHANCED GOAL KICK EXECUTION\n// ============================================================================\n\nexport function executeGoalKick_Enhanced(gameState: GameState): boolean {\n    // --- 1. SETUP (Gerekli) ---\n    if (!gameState || !gameState.setPiece || !gameState.setPiece.position) {\n        console.warn(\"\u26A0\uFE0F Goal Kick: Invalid game state or setPiece\");\n        return false;\n    }\n    const setPiece = gameState.setPiece;\n    const takingTeam = setPiece.team;\n    const allPlayers = [...(gameState.homePlayers || []), ...(gameState.awayPlayers || [])];\n    // \u2705 FIXED: Normalize team value to boolean for comparison\n    const takingTeamIsHome = (typeof takingTeam === 'boolean') ? takingTeam : (takingTeam === 'home');\n    const takingTeamPlayers = allPlayers.filter(p => p && p.isHome === takingTeamIsHome);\n    const opponents = allPlayers.filter(p => p && p.isHome !== takingTeamIsHome);\n\n    if (takingTeamPlayers.length === 0) {\n        console.warn(\"\u26A0\uFE0F Goal Kick: No players for taking team\");\n        return false;\n    }\n\n    const goalkeeper = takingTeamPlayers.find(p => p.role === 'GK');\n\n    if (!goalkeeper) {\n        console.error(\"\u274C Goal Kick: Goalkeeper not found\");\n        assignSetPieceKicker(null);\n        return false;\n    }\n\n    // \u2705 FIX #5: CRITICAL - Assign ball holder BEFORE kicking\n    gameState.ballHolder = goalkeeper;\n    goalkeeper.hasBallControl = true;\n    goalkeeper.ballReceivedTime = Date.now();\n    assignSetPieceKicker(goalkeeper);\n\n    // \u2705 FIX #6: CRITICAL - Validate ball position before execution\n    if (!isFinite(setPiece.position.x) || !isFinite(setPiece.position.y)) {\n        console.error(\"\u274C Goal Kick: Invalid ball position detected, resetting\");\n        const ownGoalX = getAttackingGoalX(!takingTeamIsHome, gameState.currentHalf);\n        const direction = Math.sign(400 - ownGoalX);\n        setPiece.position.x = ownGoalX + direction * 70;\n        setPiece.position.y = 300;\n        gameState.ballPosition.x = setPiece.position.x;\n        gameState.ballPosition.y = setPiece.position.y;\n    }\n    gameState.ballVelocity = { x: 0, y: 0 };\n\n    if (typeof passBall !== 'function') {\n        console.error(\"\u274C Goal Kick: passBall function not available\");\n        return false;\n    }\n\n\n    const opponentGoalX = getAttackingGoalX(takingTeamIsHome, gameState.currentHalf);\n    const direction = Math.sign(opponentGoalX - 400);\n\n    // playShort bilgisini setPiece'den al\n    const playShort = (setPiece as any).playShort !== false;\n\n    console.log(`\u26BD Goal Kick: ${playShort ? 'K\u0131sa' : 'Uzun'} oyun plan\u0131`);\n\n    if (playShort && Math.random() < 0.75) {\n        // KISA PAS SENARYOSU\n        const shortTargets = takingTeamPlayers\n            .filter(p => p.role !== 'GK' && String(p.id) !== String(goalkeeper.id))\n            .map(p => {\n                const dist = getDistance(p, setPiece.position);\n                const space = Math.min(120, ...opponents.map(o => getDistance(o, p)));\n                const inShortRange = dist < 260;\n\n                let score = 0;\n                if (inShortRange) {\n                    score = space * 2.0 - dist * 0.3;\n                    if (['CB', 'RB', 'LB', 'CDM'].includes(p.role)) {\n                        score += 40;\n                    }\n                }\n                return { player: p, score: score, space: space };\n            })\n            .filter(t => t.score > 15)\n            .sort((a, b) => b.score - a.score);\n\n        if (shortTargets.length > 0 && shortTargets[0] && shortTargets[0].space > 30) {\n            const target = shortTargets[0].player;\n            const accuracy = 0.92 + getSafeStat(goalkeeper.realStats, 'passAccuracy', 70) / 400;\n            const speed = 380 + getDistance(setPiece.position, target) * 1.2;\n\n            passBall(goalkeeper, setPiece.position.x, setPiece.position.y,\n                    target.x, target.y, accuracy, Math.min(speed, 550), false);\n            console.log(`\u26BD Goal Kick SHORT PASS by ${goalkeeper.name} to ${target.name}`);\n            return true;\n        }\n    }\n\n    // UZUN TOP SENARYOSU - PROFESSIONAL: Prioritize strikers for aerial duels\n    const midX = 400;\n    const longTargets = takingTeamPlayers\n        .filter(p => p.role !== 'GK' && String(p.id) !== String(goalkeeper.id))\n        .map(p => {\n            const distToOpponentGoal = Math.abs(p.x - opponentGoalX);\n            const space = Math.min(100, ...opponents.map(o => getDistance(o, p)));\n            const isForward = distToOpponentGoal < 350;\n\n            let score = 0;\n            if (Math.abs(p.x - midX) < 200 || isForward) {\n                score = space * 1.8 + (isForward ? 50 : 0);\n\n                // FIXED: Prioritize strikers first for long balls (aerial duels)\n                if (['ST', 'CF'].some(role => p.role.includes(role))) {\n                    score += 120; // HIGHEST priority for strikers\n                } else if (['RW', 'LW', 'CAM', 'LM', 'RM'].includes(p.role)) {\n                    score += 70; // Attacking players second\n                } else if (['CM', 'CDM'].includes(p.role)) {\n                    score += 30; // Midfielders last resort\n                }\n\n                // Heading ability is crucial for long balls\n                const physicalBonus = getSafeStat(p.realStats, 'heading', p.physicality || 60) / 8;\n                score += physicalBonus;\n            }\n\n            return { player: p, score: score };\n        })\n        .filter(t => t.score > 0)\n        .sort((a, b) => b.score - a.score);\n\n    let targetX: number, targetY: number, target: Player | null = null;\n\n    if (longTargets.length > 0 && longTargets[0] && Math.random() < 0.7) {\n        target = longTargets[0].player;\n        if (target) {\n            targetX = target.x + direction * 20;\n            targetY = target.y + (Math.random() - 0.5) * 25;\n        } else {\n            targetX = midX + direction * (Math.random() * 120 + 80);\n            targetY = 300 + (Math.random() * 180 - 90);\n        }\n    } else {\n        targetX = midX + direction * (Math.random() * 120 + 80);\n        targetY = 300 + (Math.random() * 180 - 90);\n    }\n\n    const longBallSkill = getSafeStat(goalkeeper.realStats, 'longBallAccuracy', 50);\n    const accuracy = 0.55 + (longBallSkill / 250);\n    const speed = 800 + Math.random() * 150;\n\n    passBall(goalkeeper, setPiece.position.x, setPiece.position.y,\n             targetX, targetY, accuracy, speed, false);\n\n    const targetInfo = target ? ` to ${target.name}` : ' to midfield';\n    console.log(`\u26BD Goal Kick LONG BALL by ${goalkeeper.name}${targetInfo}`);\n    return true;\n}\n\n// ============================================================================\n// ENHANCED KICK-OFF EXECUTION\n// ============================================================================\n\nexport function executeKickOff_Enhanced(gameState: GameState): boolean {\n    if (!gameState || !gameState.setPiece) {\n        console.warn(\"\u26A0\uFE0F Kick-off: Invalid game state or setPiece\");\n        return false;\n    }\n\n    // Validate and ensure ball position (kickoff is always at center)\n    if (!gameState.ballPosition || !isFinite(gameState.ballPosition.x) || !isFinite(gameState.ballPosition.y)) {\n        console.warn(\"\u26A0\uFE0F Kick-off: Invalid ball position, resetting to center\");\n        gameState.ballPosition = { x: 400, y: 300 };\n    }\n\n    const takingTeam = gameState.setPiece.team;\n    const allPlayers = [...(gameState.homePlayers || []), ...(gameState.awayPlayers || [])];\n    const takingTeamIsHome = (typeof takingTeam === 'boolean') ? takingTeam : (takingTeam === 'home');\n    const takingTeamPlayers = allPlayers.filter(p => p && p.isHome === takingTeamIsHome);\n\n    if (takingTeamPlayers.length === 0) {\n        console.warn(\"\u26A0\uFE0F Kick-off: No players for taking team\");\n        return false;\n    }\n\n    // \u2705 FIX #1: Find kicker with better priority logic\n    const kicker = takingTeamPlayers\n        .filter(p => p.role !== 'GK')\n        .filter(p => ['ST', 'RW', 'LW', 'CAM', 'CM', 'CDM'].includes(p.role))\n        .sort((a, b) => getDistance(a, {x: 400, y: 300}) - getDistance(b, {x: 400, y: 300}))[0];\n\n    if (!kicker) {\n        console.error(\"\u274C Kick-off: No suitable kicker found\");\n        assignSetPieceKicker(null);\n        return false;\n    }\n\n    // \u2705 FIX #2: CRITICAL - Assign ball holder BEFORE passing\n    gameState.ballHolder = kicker;\n    kicker.hasBallControl = true;\n    kicker.ballReceivedTime = Date.now();\n    assignSetPieceKicker(kicker);\n\n    const passTarget = takingTeamPlayers\n        .filter(p => p.id !== kicker.id && p.role !== 'GK')\n        .sort((a, b) => getDistance(a, kicker) - getDistance(b, kicker))[0];\n\n    // \u2705 FIX #3: CRITICAL - Ensure ball position is valid before passing\n    if (!isFinite(gameState.ballPosition.x) || !isFinite(gameState.ballPosition.y)) {\n        console.error(\"\u274C Kick-off: Invalid ball position detected, resetting to center\");\n        gameState.ballPosition = { x: 400, y: 300 };\n    }\n    gameState.ballVelocity = { x: 0, y: 0 };\n\n    if (!passTarget) {\n        console.warn(\"\u26A0\uFE0F Kick-off: No pass target, dribbling forward\");\n        // If no target, move ball forward slightly to start play\n        const opponentGoalX = getAttackingGoalX(takingTeamIsHome, gameState.currentHalf);\n        const direction = Math.sign(opponentGoalX - 400);\n        gameState.ballVelocity = { x: direction * 2, y: 0 };\n        return true;\n    }\n\n    // \u2705 FIX #4: Ensure passBall function exists before calling\n    if (typeof passBall !== 'function') {\n        console.error(\"\u274C Kick-off: passBall function not available, manual pass\");\n        // Manual pass simulation as fallback\n        const dx = passTarget.x - 400;\n        const dy = passTarget.y - 300;\n        const dist = Math.hypot(dx, dy);\n        const speed = 350;\n        gameState.ballVelocity = { x: (dx / dist) * speed / 60, y: (dy / dist) * speed / 60 };\n        gameState.ballTrajectory = {\n            startX: 400,\n            startY: 300,\n            endX: passTarget.x,\n            endY: passTarget.y,\n            startTime: Date.now(),\n            duration: (dist / speed) * 1000,\n            maxHeight: 0,\n            isShot: false,\n            passType: 'ground' as const,\n            passQuality: 0.98,\n            dist: dist,\n            speed: speed\n        };\n        return true;\n    }\n\n    // \u2705 Normal execution with passBall\n    passBall(kicker, 400, 300, passTarget.x, passTarget.y, 0.98, 350, false);\n\n    // \u2705 FIX: Set calmness period after kick-off to prevent immediate aggressive actions\n    // Players should settle into play gradually, not immediately shoot or make wild passes\n    (gameState as any).kickOffCompletedTime = Date.now();\n    (gameState as any).postKickOffCalmPeriod = true;\n\n    console.log(`\u26BD Kick-off executed successfully by ${kicker.name} to ${passTarget.name} - Calm period active`);\n    return true;\n}\n\n// ============================================================================\n// SET PIECE ROUTER\n// ============================================================================\n\nexport function executeSetPiece_Router(gameState: GameState): void {\n    if (!gameState || !gameState.setPiece) {\n        console.warn(\"\u26A0\uFE0F Set Piece Router: Invalid game state or setPiece\");\n        return;\n    }\n\n    // \u2705 FIX #7: Prevent duplicate execution\n    if ((gameState.setPiece as any).executed || (gameState as any).setPieceExecuting) {\n        return; // Already executed or currently executing\n    }\n\n    const status = gameState.status;\n    let success = false;\n\n    // \u2705 FIX #8: Ensure execution flag is ALWAYS cleared with try-finally\n    try {\n        // Set execution flag\n        (gameState as any).setPieceExecuting = true;\n\n        // \u2705 FIX #9: Validate game state before execution\n        if (!gameState.ballPosition || !isFinite(gameState.ballPosition.x) || !isFinite(gameState.ballPosition.y)) {\n            console.error(`\u274C Set Piece Router: Invalid ball position before ${status}`);\n            gameState.ballPosition = gameState.setPiece.position || { x: 400, y: 300 };\n        }\n\n        switch (status) {\n            case 'CORNER_KICK':\n                success = executeCornerKick_Enhanced(gameState);\n                break;\n            case 'FREE_KICK':\n                success = executeFreeKick_Enhanced(gameState);\n                break;\n            case 'THROW_IN':\n                success = executeThrowIn_Enhanced(gameState);\n                break;\n            case 'KICK_OFF':\n                success = executeKickOff_Enhanced(gameState);\n                break;\n            case 'GOAL_KICK':\n                success = executeGoalKick_Enhanced(gameState);\n                break;\n            case 'PENALTY':\n                // Penalty uses its own system\n                (gameState as any).setPieceExecuting = false;\n                return;\n            default:\n                console.warn(`\u26A0\uFE0F Unknown set piece type: ${status}`);\n                success = false;\n        }\n    } catch (e) {\n        console.error(`\u274C CRITICAL ERROR during set piece execution (${status}):`, e);\n        console.error((e as Error).stack);\n        success = false;\n    } finally {\n        // \u2705 FIX #10: ALWAYS clear execution flag, even on error\n        if (!success) {\n            (gameState as any).setPieceExecuting = false;\n            // If execution failed, immediately transition to playing to avoid stuck state\n            console.error(`\u274C Set piece ${status} execution failed, transitioning to playing`);\n            gameState.status = 'playing';\n            gameState.setPiece = null;\n        }\n    }\n\n    if (success) {\n        // Only proceed to post-execution cleanup if successful\n        executeSetPiece_PostExecution();\n    }\n}\n\n// ============================================================================\n// BROWSER EXPORTS\n// ============================================================================\n// Functions are now exported via ES6 modules - no window exports needed\n", "import type { Player } from '../types';\nimport { getDistance, getAttackingGoalX } from '../utils/ui';\nimport { gameState } from '../globalExports';\nimport { eventBus } from '../eventBus';\nimport { EVENT_TYPES } from '../types/events';\nimport { executeSetPiece_PostExecution } from '../setpieces/integration';\n\nexport const offsideTracker = {\n    lastPassTime: 0,\n    playersOffsideWhenBallPlayed: new Set<string>(),\n    lastPassingTeam: null as 'home' | 'away' | null\n};\n\nexport function isPlayerInOffsidePosition(player: Player, ball: { x: number; y: number }, opponents: Player[]): boolean {\n    const opponentGoalX = getAttackingGoalX(player.isHome, gameState.currentHalf);\n    const ownGoalX = getAttackingGoalX(!player.isHome, gameState.currentHalf);\n\n    const attackingDirection = opponentGoalX > ownGoalX ? 1 : -1;\n    const isInOpponentHalf = attackingDirection > 0 ?\n        player.x > 400 :\n        player.x < 400;\n\n    if (!isInOpponentHalf) {\n        return false;\n    }\n\n    const isBehindBall = attackingDirection > 0 ?\n        player.x <= ball.x :\n        player.x >= ball.x;\n\n    if (isBehindBall) {\n        return false;\n    }\n\n    const opponentsAheadOfPlayer = opponents.filter(opp => {\n        if (opp.role === 'GK') return false;\n\n        const oppDistToGoal = attackingDirection > 0 ?\n            opp.x :\n            800 - opp.x;\n        const playerDistToGoal = attackingDirection > 0 ?\n            player.x :\n            800 - player.x;\n\n        return oppDistToGoal < playerDistToGoal;\n    });\n\n    return opponentsAheadOfPlayer.length < 2;\n}\n\nexport function recordOffsidePositions(passingPlayer: Player, allPlayers: Player[]): void {\n    if (!passingPlayer || !Array.isArray(allPlayers) || allPlayers.length === 0) {\n        return;\n    }\n\n    allPlayers.forEach(p => {\n        if ((p as any).wasOffsideWhenBallPlayed) {\n            delete (p as any).wasOffsideWhenBallPlayed;\n        }\n    });\n\n    offsideTracker.lastPassTime = Date.now();\n    offsideTracker.lastPassingTeam = passingPlayer.isHome ? 'home' : 'away';\n    offsideTracker.playersOffsideWhenBallPlayed.clear();\n\n    const teammates = allPlayers.filter(p =>\n        p.isHome === passingPlayer.isHome &&\n        p.id !== passingPlayer.id\n    );\n    const opponents = allPlayers.filter(p => p.isHome !== passingPlayer.isHome);\n\n    if (!gameState.ballPosition) {\n        return;\n    }\n\n    teammates.forEach(teammate => {\n        if (isPlayerInOffsidePosition(teammate, gameState.ballPosition, opponents)) {\n            offsideTracker.playersOffsideWhenBallPlayed.add(String(teammate.id));\n            (teammate as any).wasOffsideWhenBallPlayed = true;\n        }\n    });\n}\n\nexport function checkOffsidePenalty(player: Player): boolean {\n    if (!player || !offsideTracker.playersOffsideWhenBallPlayed) {\n        return false;\n    }\n\n    if (!offsideTracker.playersOffsideWhenBallPlayed.has(String(player.id))) {\n        return false;\n    }\n\n    return true;\n}\n\nexport function awardOffsideFreeKick(offsidePlayer: Player): void {\n    const offenseTeam = offsidePlayer.isHome ? 'home' : 'away';\n\n    console.log(`\u00F0\u0178\u0161\u00A9 OFFSIDE! ${offsidePlayer.name} was in offside position`);\n\n    gameState.ballTrajectory = null;\n    gameState.ballHolder = null;\n    gameState.shotInProgress = false;\n    gameState.ballVelocity = { x: 0, y: 0 };\n\n    gameState.commentary.push({\n        text: `${Math.floor(gameState.timeElapsed)}' OFFSIDE - ${offsidePlayer.name}`,\n        type: 'attack'\n    });\n\n    if (typeof eventBus !== 'undefined' && typeof EVENT_TYPES !== 'undefined') {\n        eventBus.publish(EVENT_TYPES.OFFSIDE_CALLED, {\n            player: offsidePlayer,\n            time: Math.floor(gameState.timeElapsed)\n        });\n    }\n\n    if (typeof recordOffsideStatistic === 'function') {\n        recordOffsideStatistic(offsidePlayer);\n    }\n\n    const freeKickX = Math.max(50, Math.min(750, offsidePlayer.x));\n    const freeKickY = Math.max(50, Math.min(550, offsidePlayer.y));\n\n    const defenders = offenseTeam === 'home' ?\n        gameState.awayPlayers :\n        gameState.homePlayers;\n\n    if (!defenders || defenders.length === 0) {\n        console.error('No defenders available to take the offside free kick.');\n\n        // Ensure proper cleanup if transitioning from set piece\n        if (gameState.setPiece) {\n            executeSetPiece_PostExecution();\n        }\n\n        gameState.status = 'playing';\n        offsideTracker.playersOffsideWhenBallPlayed.clear();\n        return;\n    }\n\n    const freeKickTaker = defenders\n        .filter(p => p && p.x !== undefined && p.y !== undefined)\n        .reduce((closest, current) => {\n            const distToClosest = getDistance(closest, { x: freeKickX, y: freeKickY });\n            const distToCurrent = getDistance(current, { x: freeKickX, y: freeKickY });\n            return distToCurrent < distToClosest ? current : closest;\n        });\n\n    if (!freeKickTaker) {\n        console.error('Could not find a suitable free kick taker.');\n\n        // Ensure proper cleanup if transitioning from set piece\n        if (gameState.setPiece) {\n            executeSetPiece_PostExecution();\n        }\n\n        gameState.status = 'playing';\n        offsideTracker.playersOffsideWhenBallPlayed.clear();\n        return;\n    }\n\n    const offsideCallTime = Date.now();\n    setTimeout(() => {\n        // Validate game state hasn't changed significantly\n        if (gameState.status === 'finished' || gameState.status === 'goal_scored') {\n            return;\n        }\n\n        // Only proceed if no new possession or set piece has started\n        if (gameState.ballHolder && gameState.ballHolder.id !== freeKickTaker.id) {\n            return;\n        }\n\n        gameState.ballPosition.x = freeKickX;\n        gameState.ballPosition.y = freeKickY;\n        gameState.ballVelocity.x = 0;\n        gameState.ballVelocity.y = 0;\n        gameState.ballHolder = freeKickTaker;\n        freeKickTaker.hasBallControl = true;\n        (freeKickTaker as any).ballReceivedTime = offsideCallTime;\n        offsideTracker.playersOffsideWhenBallPlayed.clear();\n    }, 1000);\n}\n\nexport function drawOffsideLines(ctx: CanvasRenderingContext2D): void {\n    if (!gameState.contexts || !gameState.contexts.game) return;\n\n    const allPlayers = [...gameState.homePlayers, ...gameState.awayPlayers];\n\n    const awayDefenders = gameState.awayPlayers\n        .filter(p => p.role !== 'GK')\n        .sort((a, b) => a.x - b.x);\n\n    if (awayDefenders.length >= 2) {\n        const secondLastDefender = awayDefenders[1];\n        if (secondLastDefender) {\n            ctx.strokeStyle = 'rgba(255, 0, 0, 0.3)';\n            ctx.lineWidth = 2;\n            ctx.setLineDash([5, 5]);\n            ctx.beginPath();\n            ctx.moveTo(secondLastDefender.x, 0);\n            ctx.lineTo(secondLastDefender.x, 600);\n            ctx.stroke();\n            ctx.setLineDash([]);\n        }\n    }\n\n    const homeDefenders = gameState.homePlayers\n        .filter(p => p.role !== 'GK')\n        .sort((a, b) => b.x - a.x);\n\n    if (homeDefenders.length >= 2) {\n        const secondLastDefender = homeDefenders[1];\n        if (secondLastDefender) {\n            ctx.strokeStyle = 'rgba(0, 0, 255, 0.3)';\n            ctx.lineWidth = 2;\n            ctx.setLineDash([5, 5]);\n            ctx.beginPath();\n            ctx.moveTo(secondLastDefender.x, 0);\n            ctx.lineTo(secondLastDefender.x, 600);\n            ctx.stroke();\n            ctx.setLineDash([]);\n        }\n    }\n\n    allPlayers.forEach(player => {\n        if ((player as any).wasOffsideWhenBallPlayed) {\n            ctx.strokeStyle = 'rgba(255, 0, 0, 0.8)';\n            ctx.lineWidth = 3;\n            ctx.setLineDash([3, 3]);\n            ctx.beginPath();\n            ctx.arc(player.x, player.y, 20, 0, Math.PI * 2);\n            ctx.stroke();\n            ctx.setLineDash([]);\n        }\n    });\n}\n\nexport function shouldAvoidOffside(player: Player, ball: { x: number; y: number }, opponents: Player[]): boolean {\n    const opponentGoalX = getAttackingGoalX(player.isHome, gameState.currentHalf);\n    const distToGoal = Math.abs(player.x - opponentGoalX);\n\n    if (distToGoal > 300) return false;\n\n    if (isPlayerInOffsidePosition(player, ball, opponents)) {\n        const distToBall = getDistance(player, ball);\n\n        if (distToBall < 150) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nexport function initOffsideStats(): void {\n    (gameState.stats.home as any).offsides = 0;\n    (gameState.stats.away as any).offsides = 0;\n}\n\nexport function recordOffsideStatistic(player: Player): void {\n    const teamStats = player.isHome ? gameState.stats.home : gameState.stats.away;\n    (teamStats as any).offsides++;\n}\n", "import type { Player, BallTrajectory } from '../types';\nimport { distance } from '../utils/math';\nimport { isSetPieceStatus, getAttackingGoalX } from '../utils/ui';\nimport { gameState } from '../globalExports';\nimport { assignBallChasers } from '../physics';\nimport { applyFirstTouch, handleFailedFirstTouch, handlePoorFirstTouch, handleSuccessfulFirstTouch } from '../ai/playerFirstTouch';\nimport { checkOffsidePenalty, awardOffsideFreeKick } from './offside';\nimport { handleFoul_V2 } from '../core';\nimport { SetPieceEnforcement } from '../setpieces/enforcement';\nimport { PHYSICS } from '../config';\n\nexport function resolveBallControl(allPlayers: Player[]): void {\n    const isSetPiece = isSetPieceStatus(gameState.status);\n\n    if (isSetPiece) {\n        return;\n    }\n\n    if (!gameState.ballPosition || !Array.isArray(allPlayers) || allPlayers.length === 0) {\n        return;\n    }\n    if (gameState.ballTrajectory || (gameState.ballHolder && gameState.ballHolder.hasBallControl)) {\n        return;\n    }\n\n    const eligiblePlayers = allPlayers.filter(p => !((p as any).stunnedUntil && Date.now() < (p as any).stunnedUntil));\n    if (eligiblePlayers.length === 0) return;\n\n    const BALL_CONTROL_DISTANCE = (typeof PHYSICS !== 'undefined') ? PHYSICS.BALL_CONTROL_DISTANCE : 25;\n\n    const controlCandidates = eligiblePlayers.map(player => {\n        const distToBall = distance(player, gameState.ballPosition);\n        let effectiveControlDistance = BALL_CONTROL_DISTANCE * (player.isChasingBall ? 2.0 : 1.0);\n        if (distToBall > effectiveControlDistance) {\n            return { player, score: 0, distToBall };\n        }\n        let score = Math.max(0, 150 - distToBall);\n        score += (player.dribbling / 100) * 20;\n        if (player.isChasingBall) score += 200;\n        return { player, score, distToBall };\n    }).filter(item => item.score > 50).sort((a, b) => b.score - a.score);\n\n    if (controlCandidates.length === 0) return;\n\n    let controllingPlayer;\n\n    const vel = gameState.ballVelocity;\n    const ballSpeed = vel ? Math.sqrt(vel.x ** 2 + vel.y ** 2) : 0;\n    // Check for 50/50 duel scenario: slow ball with two close contenders\n    if (ballSpeed < 5 && controlCandidates.length >= 2 &&\n        controlCandidates[0]!.distToBall < 30 &&\n        controlCandidates[1]!.distToBall < 30) {\n        const contender1 = controlCandidates[0]!.player;\n        const contender2 = controlCandidates[1]!.player;\n\n        const p1_strength = (contender1.physicality * 0.6) + (contender1.pace * 0.2) + (Math.random() * 20);\n        const p2_strength = (contender2.physicality * 0.6) + (contender2.pace * 0.2) + (Math.random() * 20);\n\n        if (p1_strength >= p2_strength) {\n            controllingPlayer = contender1;\n            (contender2 as any).stunnedUntil = Date.now() + 250;\n        } else {\n            controllingPlayer = contender2;\n            (contender1 as any).stunnedUntil = Date.now() + 250;\n        }\n    } else if (controlCandidates.length > 0) {\n        controllingPlayer = controlCandidates[0]!.player;\n    }\n\n    if (!controllingPlayer) return;\n\n    gameState.lastTouchedBy = controllingPlayer;\n\n    if (gameState.status === 'playing' && typeof checkOffsidePenalty === 'function') {\n        if (checkOffsidePenalty(controllingPlayer)) {\n            if (typeof awardOffsideFreeKick === 'function') {\n                awardOffsideFreeKick(controllingPlayer);\n            } else {\n                console.error(\"awardOffsideFreeKick is not defined!\");\n            }\n            return;\n        }\n    }\n\n    const touchResult = applyFirstTouch(controllingPlayer, null, allPlayers);\n    if (touchResult.outcome === 'failed') {\n        handleFailedFirstTouch(controllingPlayer, allPlayers);\n    } else if (touchResult.outcome === 'poor') {\n        handlePoorFirstTouch(controllingPlayer, touchResult);\n    } else {\n        handleSuccessfulFirstTouch(controllingPlayer, touchResult);\n    }\n}\n\nexport function canControlBall(player: Player, ball: { x: number, y: number }): boolean {\n    const BALL_CONTROL_DISTANCE = (typeof PHYSICS !== 'undefined') ? PHYSICS.BALL_CONTROL_DISTANCE : 25;\n    const dist = distance(player, ball);\n\n    const isSetPiece = ['GOAL_KICK', 'FREE_KICK', 'CORNER_KICK', 'THROW_IN', 'KICK_OFF', 'PENALTY'].includes(gameState.status);\n    if (isSetPiece && gameState.setPiece && !(gameState.setPiece as any).executed) {\n        const isDesignatedTaker = (player as any).setPieceRole && (\n            (player as any).setPieceRole.includes('KICKER') ||\n            (player as any).setPieceRole.includes('THROWER') ||\n            (player as any).setPieceRole === 'CORNER_KICKER' ||\n            (player as any).setPieceRole === 'PRIMARY_KICKER'\n        );\n        const isGoalkeeper = player.role === 'GK' || (player as any).role === 'goalkeeper';\n\n        if (!isDesignatedTaker && !isGoalkeeper) {\n            return false;\n        }\n    }\n\n    return dist < BALL_CONTROL_DISTANCE && !gameState.ballTrajectory;\n}\n\nexport function action_attemptTackle(player: Player, allPlayers: Player[]): boolean {\n    const isRestart = isSetPieceStatus(gameState.status);\n    if (isRestart) {\n        return false;\n    }\n    const attacker = gameState.ballHolder;\n    if (!attacker) return false;\n\n    if (attacker.role === 'GK' || (attacker as any).role === 'goalkeeper') {\n        if (typeof SetPieceEnforcement !== 'undefined' && SetPieceEnforcement.protectGoalkeeper) {\n            SetPieceEnforcement.protectGoalkeeper(player, attacker, gameState);\n        } else {\n            console.log(`\uD83D\uDEAB [gk-protection] ${player.name} cannot tackle goalkeeper ${attacker.name}`);\n        }\n        return false;\n    }\n\n    const defenderStat = (player.defending * 0.6) + (player.physicality * 0.4);\n    const attackerStat = (attacker.dribbling * 0.6) + (attacker.pace * 0.4);\n    const successChance = 0.5 + ((defenderStat - attackerStat) / 120);\n    const teamStats = player.isHome ? gameState.stats.home : gameState.stats.away;\n\n    if (!teamStats) return false;\n\n    const outcome = Math.random();\n\n    if (outcome < successChance) {\n        if (Math.random() < 0.6) {\n            gameState.ballHolder = player;\n            player.hasBallControl = true;\n            (player as any).ballReceivedTime = Date.now();\n            gameState.commentary.push({ text: `${Math.floor(gameState.timeElapsed)}' ${player.name} wins the ball!`, type: 'attack' });\n        } else {\n            gameState.ballHolder = null;\n            gameState.ballTrajectory = null;\n            const angle = Math.atan2(attacker.y - player.y, attacker.x - player.x);\n            if (gameState.ballVelocity) {\n                gameState.ballVelocity.x = Math.cos(angle) * 150;\n                gameState.ballVelocity.y = Math.sin(angle) * 150;\n            }\n            gameState.commentary.push({ text: `${Math.floor(gameState.timeElapsed)}' 50/50 challenge! The ball is loose!`, type: 'attack' });\n            assignBallChasers(allPlayers);\n        }\n        if (teamStats.tackles !== undefined) {\n            teamStats.tackles++;\n        }\n    } else {\n        (player as any).stunnedUntil = Date.now() + 750;\n        attacker.speedBoost = 1.2;\n\n        if (Math.random() < 0.15) {\n            if (typeof handleFoul_V2 === 'function') {\n                handleFoul_V2(player, attacker);\n            } else {\n                console.error(\"handleFoul_V2 is not defined!\");\n            }\n        } else {\n            gameState.commentary.push({ text: `${Math.floor(gameState.timeElapsed)}' ${attacker.name} skips past ${player.name}!`, type: 'attack' });\n        }\n    }\n    return true;\n}\n\nexport function handleBallInterception(progress: number): void {\n    const allPlayers = [...gameState.homePlayers, ...gameState.awayPlayers];\n    const trajectory = gameState.ballTrajectory;\n    if (!trajectory) return;\n\n    const HEADER_HEIGHT_THRESHOLD = (typeof PHYSICS !== 'undefined') ? PHYSICS.HEADER_HEIGHT_THRESHOLD : 0.6;\n    const PASS_INTERCEPT_DISTANCE = (typeof PHYSICS !== 'undefined') ? PHYSICS.PASS_INTERCEPT_DISTANCE : 25;\n\n    const isAerial = trajectory.passType === 'aerial';\n    const isHeaderOpportunity = isAerial && gameState.ballHeight > HEADER_HEIGHT_THRESHOLD;\n\n    if (progress >= 1 || progress < 0.2) return;\n\n    if (isHeaderOpportunity) {\n        const contenders = allPlayers.filter(player =>\n            !((player as any).stunnedUntil && Date.now() < (player as any).stunnedUntil)\n        ).map(player => ({\n            player,\n            dist: distance(player, gameState.ballPosition)\n        })).filter(c => c.dist < 28);\n\n        if (contenders.length > 1) {\n            contenders.sort((a, b) => {\n                const aScore = (a.player.physicality * 0.7) + (Math.random() * 30);\n                const bScore = (b.player.physicality * 0.7) + (Math.random() * 30);\n                return bScore - aScore;\n            });\n\n            const winner = contenders[0]?.player;\n            const loser = contenders[1]?.player;\n\n            if (winner) {\n                handleWonHeader(winner);\n            }\n            if (loser) {\n                (loser as any).stunnedUntil = Date.now() + 500;\n            }\n\n            if (winner && loser) {\n                const headerText = `${Math.floor(gameState.timeElapsed)}' ${winner.name} wins the header against ${loser.name}!`;\n                gameState.commentary.push({ text: headerText, type: 'attack' });\n            }\n\n            return;\n        }\n    }\n\n    for (const player of allPlayers) {\n        if ((player as any).stunnedUntil && Date.now() < (player as any).stunnedUntil) continue;\n        if (gameState.currentPassReceiver && player.id === gameState.currentPassReceiver.id) continue;\n\n        const distToBall = distance(player, gameState.ballPosition);\n\n        if (!isAerial && distToBall < PASS_INTERCEPT_DISTANCE) {\n            const interceptionChance = calculateInterceptionChance(player, distToBall, trajectory);\n            if (Math.random() < interceptionChance) {\n                handleInterception(player);\n                const teamStats = player.isHome ? gameState.stats.home : gameState.stats.away;\n                teamStats.interceptions++;\n                break;\n            }\n        }\n    }\n}\n\nfunction calculateInterceptionChance(player: Player, ballDistance: number, trajectory: BallTrajectory): number {\n    const realStats = player.realStats || {};\n    const baseDefending = player.defending / 100;\n    const interceptionModifier = realStats.interceptions > 0 ? Math.min(realStats.interceptions / 15, 0.3) : 0;\n    const recoveryBonus = realStats.recoveries > 0 ? Math.min(realStats.recoveries / 20, 0.15) : 0;\n    const ratingBonus = (player.rating - 6.5) / 10;\n    const distancePenalty = Math.min(ballDistance / 100, 0.3);\n    const passQualityBonus = (trajectory as any).passQuality ? (1.0 - (trajectory as any).passQuality) * 0.4 : 0;\n    const interceptionChance = baseDefending + interceptionModifier + recoveryBonus + ratingBonus - distancePenalty + passQualityBonus;\n    return Math.max(0.05, Math.min(0.8, interceptionChance));\n}\n\nfunction handleInterception(player: Player): void {\n    gameState.ballTrajectory = null;\n    gameState.ballHolder = player;\n    player.hasBallControl = true;\n    (player as any).ballReceivedTime = Date.now();\n    if (gameState.ballChasers) {\n        gameState.ballChasers.clear();\n    }\n    gameState.lastPossessionChange = Date.now();\n    gameState.currentPassReceiver = null;\n\n    const interceptText = `${Math.floor(gameState.timeElapsed)}' ${player.name} intercepts!`;\n    if (gameState.commentary) {\n        gameState.commentary.push({ text: interceptText, type: 'attack' });\n        gameState.commentary = gameState.commentary.slice(-6);\n    }\n}\n\nfunction handleWonHeader(player: Player): void {\n    const opponentGoalX = getAttackingGoalX(player.isHome, gameState.currentHalf);\n    const directionToGoal = Math.sign(opponentGoalX - player.x);\n\n    gameState.ballTrajectory = null;\n    gameState.ballHolder = null;\n    gameState.ballHeight = 0;\n\n    if (gameState.ballPosition) {\n        gameState.ballPosition.x = player.x + directionToGoal * 15;\n        gameState.ballPosition.y = player.y;\n    }\n    if (gameState.ballVelocity) {\n        gameState.ballVelocity.x = directionToGoal * 50;\n        gameState.ballVelocity.y = (Math.random() - 0.5) * 30;\n    }\n\n    const allPlayers = [...(gameState.homePlayers || []), ...(gameState.awayPlayers || [])];\n    assignBallChasers(allPlayers, player);\n}\n", "/**\n * Physics System\n * Handles ball physics, player movement, and collision detection\n *\n * \u2705 Migrated from JavaScript with zero functional changes\n * \u2705 Full type safety with strict TypeScript\n * \u2705 NaN-safe calculations throughout\n */\n\nimport type { Player, GameState } from './types';\nimport { distance as getDistance, safeSqrt, safeDiv } from './utils/math';\nimport { getAttackingGoalX, isSetPieceStatus } from './utils/ui';\nimport { gameState } from './globalExports';\nimport { handleBallInterception } from './rules/ballControl';\n\n// Debug flag (replaces window.DEBUG_PHYSICS)\nconst DEBUG_PHYSICS = false;\n\n// ============================================================================\n// GLOBAL DECLARATIONS\n// ============================================================================\n\ndeclare global {\n  interface Window {\n    DEBUG_PHYSICS?: boolean;\n    gameState: GameState;\n    updatePhysics: typeof updatePhysics;\n    updatePlayerPhysics: typeof updatePlayerPhysics;\n    updateBallWithHolder: typeof updateBallWithHolder;\n    updateBallTrajectory: typeof updateBallTrajectory;\n    validateBallState: typeof validateBallState;\n    updateParticles?: (dt: number) => void;\n    handleBallInterception?: (progress: number) => void;\n    handleBallOutOfBounds?: () => void;\n    handleThrowIn?: () => void;\n    resolveBallControl?: (allPlayers: Player[]) => void;\n    getPlayerFacingDirection?: (player: Player) => number;\n    passBall?: (\n      passingPlayer: Player,\n      fromX: number,\n      fromY: number,\n      toX: number,\n      toY: number,\n      passQuality: number,\n      speed: number,\n      isShot: boolean\n    ) => void;\n  }\n}\n\n// ============================================================================\n// BALL TRAJECTORY UPDATE\n// ============================================================================\n\n/**\n * Update ball trajectory during passes and shots\n */\nexport function updateBallTrajectory(_dt: number): void {\n  if (!gameState.ballTrajectory) {\n    gameState.ballHeight = 0;\n    return;\n  }\n\n  const traj = gameState.ballTrajectory;\n  const elapsed = Date.now() - traj.startTime;\n  const progress = Math.min(elapsed / traj.duration, 1);\n\n  gameState.ballPosition.x = traj.startX + (traj.endX - traj.startX) * progress;\n  gameState.ballPosition.y = traj.startY + (traj.endY - traj.startY) * progress;\n\n  const heightProgress = Math.sin(progress * Math.PI);\n  gameState.ballHeight = heightProgress * traj.maxHeight;\n\n  // Check for out of bounds during aerial passes\n  if (traj.passType === 'aerial' && gameState.ballHeight > 0.5) {\n    if (gameState.ballPosition.y < 20 || gameState.ballPosition.y > 580) {\n      if (DEBUG_PHYSICS) {\n        console.log(`[Physics] Ball out of bounds during aerial pass (y=${gameState.ballPosition.y}), resetting to center`);\n      }\n      gameState.ballTrajectory = null;\n      gameState.ballHeight = 0;\n      gameState.ballPosition = { x: 400, y: 300 };\n      const outText = `${Math.floor(gameState.timeElapsed)}' Ball out of play!`;\n      gameState.commentary.push({ text: outText, type: 'attack' });\n      gameState.commentary = gameState.commentary.slice(-6);\n      return;\n    }\n  }\n\n  // Handle interception during pass\n  if (!traj.isShot && progress > 0.2 && progress < 0.9) {\n    if (typeof handleBallInterception === 'function') {\n      handleBallInterception(progress);\n    }\n  }\n\n  // Trajectory complete\n  if (progress >= 1) {\n    const direction = Math.atan2(traj.endY - traj.startY, traj.endX - traj.startX);\n    const landingSpeed = traj.speed * 0.3;\n\n    gameState.ballVelocity.x = Math.cos(direction) * landingSpeed;\n    gameState.ballVelocity.y = Math.sin(direction) * landingSpeed;\n\n    if (DEBUG_PHYSICS) {\n      console.log(`[Physics] Ball trajectory complete (${traj.passType}): landed at (${gameState.ballPosition.x.toFixed(1)}, ${gameState.ballPosition.y.toFixed(1)}), velocity=(${gameState.ballVelocity.x.toFixed(1)}, ${gameState.ballVelocity.y.toFixed(1)})`);\n    }\n\n    gameState.ballTrajectory = null;\n    gameState.ballHeight = 0;\n    gameState.shotInProgress = false;\n    gameState.shooter = null;\n    gameState.currentShotXG = null;\n    gameState.currentPassReceiver = null;\n  }\n}\n\n// ============================================================================\n// BALL STATE VALIDATION (Prevents NaN propagation)\n// ============================================================================\n\n/**\n * Validate and sanitize ball state to prevent NaN propagation\n */\nexport function validateBallState(): void {\n  // Validate position\n  if (!isFinite(gameState.ballPosition.x) || !isFinite(gameState.ballPosition.y)) {\n    console.warn('[Physics] \u26A0\uFE0F Ball position invalid, resetting to center. Previous value:', gameState.ballPosition);\n    gameState.ballPosition = { x: 400, y: 300 };\n  }\n\n  // Clamp to pitch bounds with margin\n  const oldX = gameState.ballPosition.x;\n  const oldY = gameState.ballPosition.y;\n  gameState.ballPosition.x = Math.max(5, Math.min(795, gameState.ballPosition.x));\n  gameState.ballPosition.y = Math.max(5, Math.min(595, gameState.ballPosition.y));\n\n  if (DEBUG_PHYSICS && (oldX !== gameState.ballPosition.x || oldY !== gameState.ballPosition.y)) {\n    console.log(`[Physics] Ball position clamped from (${oldX.toFixed(1)}, ${oldY.toFixed(1)}) to (${gameState.ballPosition.x.toFixed(1)}, ${gameState.ballPosition.y.toFixed(1)})`);\n  }\n\n  // Validate velocity\n  if (!isFinite(gameState.ballVelocity.x) || !isFinite(gameState.ballVelocity.y)) {\n    console.warn('[Physics] \u26A0\uFE0F Ball velocity invalid, resetting to zero. Previous value:', gameState.ballVelocity);\n    gameState.ballVelocity = { x: 0, y: 0 };\n  }\n\n  // Clamp extreme velocities (prevent physics explosions)\n  const maxVelocity = 1000;\n  const speed = Math.sqrt(\n    gameState.ballVelocity.x * gameState.ballVelocity.x +\n    gameState.ballVelocity.y * gameState.ballVelocity.y\n  );\n  if (speed > maxVelocity) {\n    const scale = maxVelocity / speed;\n    if (DEBUG_PHYSICS) {\n      console.log(`[Physics] Ball velocity clamped from ${speed.toFixed(1)} to ${maxVelocity} (scale=${scale.toFixed(2)})`);\n    }\n    gameState.ballVelocity.x *= scale;\n    gameState.ballVelocity.y *= scale;\n  }\n\n  // Validate height\n  if (!isFinite(gameState.ballHeight) || gameState.ballHeight < 0) {\n    gameState.ballHeight = 0;\n  }\n}\n\n// ============================================================================\n// BALL HOLDER VALIDATION\n// ============================================================================\n\n/**\n * Validate ball holder player object\n */\nexport function validateBallHolder(player: Player | null): Player | null {\n  if (!player) return null;\n\n  if (typeof player.isHome !== 'boolean') {\n    console.warn('Ball holder missing isHome property', player);\n    return null;\n  }\n\n  if (typeof player.x !== 'number' || typeof player.y !== 'number') {\n    console.warn('Ball holder missing position', player);\n    return null;\n  }\n\n  return player;\n}\n\n// ============================================================================\n// MAIN PHYSICS UPDATE\n// ============================================================================\n\n/**\n * Main physics update function called every frame\n */\nexport function updatePhysics(dt: number): void {\n  // Validate ball state first to prevent NaN propagation\n  validateBallState();\n\n  const isSetPiece = isSetPieceStatus(gameState.status);\n\n  if (isSetPiece) {\n    if (gameState.setPiece && gameState.setPiece.position) {\n      gameState.ballPosition.x = gameState.setPiece.position.x;\n      gameState.ballPosition.y = gameState.setPiece.position.y;\n      gameState.ballVelocity = { x: 0, y: 0 };\n      gameState.ballHeight = 0;\n      gameState.ballTrajectory = null;\n    }\n    const allPlayers = [...gameState.homePlayers, ...gameState.awayPlayers];\n    updatePlayerPhysics(allPlayers, dt);\n    return;\n  }\n\n  const allPlayers = [...gameState.homePlayers, ...gameState.awayPlayers];\n  updateBallTrajectory(dt);\n  if (!gameState.ballTrajectory) {\n    updateBallWithHolder(allPlayers, dt);\n  }\n  updatePlayerPhysics(allPlayers, dt);\n\n  // Update particles and camera shake if functions exist\n  if (typeof window.updateParticles === 'function') {\n    window.updateParticles(dt);\n  }\n  updateCameraShake(dt);\n}\n\n// ============================================================================\n// BALL WITH HOLDER UPDATE\n// ============================================================================\n\n/**\n * Update ball position when held by a player\n */\nexport function updateBallWithHolder(allPlayers: Player[], dt: number): void {\n  const holder = gameState.ballHolder;\n\n  if (holder && allPlayers.includes(holder)) {\n    const facingAngle = typeof window.getPlayerFacingDirection === 'function'\n      ? window.getPlayerFacingDirection(holder)\n      : 0;\n    const ballOffsetDistance = 12;\n    const offsetX = Math.cos(facingAngle) * ballOffsetDistance;\n    const offsetY = Math.sin(facingAngle) * ballOffsetDistance;\n    gameState.ballPosition.x = holder.x + offsetX;\n    gameState.ballPosition.y = holder.y + offsetY;\n\n    if (holder.role === 'GK') {\n      handleGoalkeeperBallHold(holder, allPlayers);\n    }\n  } else {\n    if (holder) {\n      console.log('Clearing invalid ball holder');\n      gameState.ballHolder = null;\n    }\n\n    const currentSpeed = Math.sqrt(\n      gameState.ballVelocity.x * gameState.ballVelocity.x +\n      gameState.ballVelocity.y * gameState.ballVelocity.y\n    );\n\n    // Apply friction\n    const FRICTION = window.BALL_PHYSICS?.FRICTION ?? 0.985;\n    const frictionDecay = Math.pow(FRICTION, dt);\n    gameState.ballVelocity.x *= frictionDecay;\n    gameState.ballVelocity.y *= frictionDecay;\n\n    if (currentSpeed < 5) {\n      gameState.ballVelocity.x = 0;\n      gameState.ballVelocity.y = 0;\n    }\n\n    gameState.ballPosition.x += gameState.ballVelocity.x * dt;\n    gameState.ballPosition.y += gameState.ballVelocity.y * dt;\n\n    // Handle out of bounds\n    if (gameState.ballPosition.x < 5 || gameState.ballPosition.x > 795) {\n      if (typeof window.handleBallOutOfBounds === 'function') {\n        window.handleBallOutOfBounds();\n      }\n      return;\n    }\n\n    if (gameState.ballPosition.y < 5 || gameState.ballPosition.y > 595) {\n      if (typeof window.handleThrowIn === 'function') {\n        window.handleThrowIn();\n      }\n      return;\n    }\n\n    // Ball control resolution\n    const now = Date.now();\n    const timeSinceLastAttempt = now - (gameState.lastControlAttempt || 0);\n    const minInterval = currentSpeed > 100 ? 100 : 200;\n\n    if (timeSinceLastAttempt > minInterval) {\n      if (typeof window.resolveBallControl === 'function') {\n        window.resolveBallControl(allPlayers);\n      }\n      gameState.lastControlAttempt = now;\n    }\n  }\n}\n\n// ============================================================================\n// PLAYER PHYSICS UPDATE\n// ============================================================================\n\ninterface PhysicsDefaults {\n  MOVEMENT_THRESHOLD: number;\n  ACCELERATION: number;\n  MAX_SPEED: number;\n  DRIBBLE_SPEED_PENALTY: number;\n  FRICTION: number;\n  BALL_CONTROL_DISTANCE: number;\n  HEADER_HEIGHT_THRESHOLD: number;\n  PASS_INTERCEPT_DISTANCE: number;\n  LONG_PASS_THRESHOLD: number;\n}\n\nconst PHYSICS_DEFAULTS: PhysicsDefaults = {\n  MOVEMENT_THRESHOLD: 2,\n  ACCELERATION: 1200,\n  MAX_SPEED: 220,\n  DRIBBLE_SPEED_PENALTY: 0.8,\n  FRICTION: 0.88,\n  BALL_CONTROL_DISTANCE: 25,\n  HEADER_HEIGHT_THRESHOLD: 0.6,\n  PASS_INTERCEPT_DISTANCE: 25,\n  LONG_PASS_THRESHOLD: 150\n};\n\n/**\n * Update all player physics (movement, stamina, etc.)\n */\nexport function updatePlayerPhysics(allPlayers: Player[], dt: number): void {\n  const PHYSICS = window.PHYSICS ?? PHYSICS_DEFAULTS;\n\n  allPlayers.forEach(player => {\n    // Validate player position\n    if (!isFinite(player.x) || !isFinite(player.y)) {\n      console.error('Player position corrupted:', player.name);\n      player.x = (player as Player & { homeX?: number }).homeX ?? 400;\n      player.y = (player as Player & { homeY?: number }).homeY ?? 300;\n      player.vx = 0;\n      player.vy = 0;\n      return;\n    }\n\n    if (!isFinite(player.targetX) || !isFinite(player.targetY)) {\n      player.targetX = player.x;\n      player.targetY = player.y;\n    }\n\n    const dx = player.targetX - player.x;\n    const dy = player.targetY - player.y;\n    const dist = Math.sqrt(dx * dx + dy * dy);\n\n    if (dist > PHYSICS.MOVEMENT_THRESHOLD) {\n      updatePlayerVelocity(player, dx, dy, dist, dt);\n\n      const speed = Math.sqrt(player.vx * player.vx + player.vy * player.vy);\n      const distCovered = (player as Player & { distanceCovered?: number }).distanceCovered ?? 0;\n      (player as Player & { distanceCovered: number }).distanceCovered = distCovered + speed * dt;\n\n      // Stamina drain based on speed\n      let drainRate = 0.15;\n      if (speed > 180) drainRate = 1.8;\n      else if (speed > 140) drainRate = 1.0;\n      else if (speed > 100) drainRate = 0.5;\n\n      if (player.isChasingBall) drainRate *= 1.2;\n\n      const stamina = (player as Player & { stamina?: number }).stamina ?? 100;\n      (player as Player & { stamina: number }).stamina = Math.max(0, stamina - drainRate * dt);\n\n      if (stamina < 20) {\n        player.speedBoost = Math.max(player.speedBoost * 0.90, 0.6);\n      } else if (stamina < 40) {\n        player.speedBoost = Math.max(player.speedBoost * 0.95, 0.8);\n      }\n    } else {\n      applyPlayerFriction(player, dt);\n\n      const speed = Math.sqrt(player.vx * player.vx + player.vy * player.vy);\n      const recoveryRate = speed < 10 ? 1.2 : 0.6;\n\n      const stamina = (player as Player & { stamina?: number }).stamina ?? 100;\n      (player as Player & { stamina: number }).stamina = Math.min(100, stamina + recoveryRate * dt);\n    }\n\n    // Update position\n    player.x += player.vx * dt;\n    player.y += player.vy * dt;\n\n    // Clamp to pitch bounds\n    player.x = Math.max(20, Math.min(780, player.x));\n    player.y = Math.max(20, Math.min(580, player.y));\n  });\n}\n\n// ============================================================================\n// BALL CHASERS ASSIGNMENT\n// ============================================================================\n\ninterface ChaseEvaluation {\n  player: Player;\n  score: number;\n  distToBall: number;\n}\n\n/**\n * Assign which players should chase the loose ball\n */\nexport function assignBallChasers(allPlayers: Player[], priorityChaser: Player | null = null): void {\n  gameState.ballChasers.clear();\n\n  if (gameState.ballHolder?.hasBallControl || gameState.ballTrajectory) {\n    allPlayers.forEach(p => { p.isChasingBall = false; });\n    return;\n  }\n\n  if (!gameState.ballPosition) return;\n\n  const chaseEvaluations: ChaseEvaluation[] = allPlayers\n    .filter(p => p.role !== 'GK')\n    .map(player => {\n      const distToBall = getDistance(player, gameState.ballPosition);\n      if (distToBall > 150) return { player, score: 0, distToBall };\n\n      let score = 100;\n      score += Math.max(0, 100 - distToBall);\n      score += (player.pace / 100) * 30;\n\n      const aggressiveRoles = ['ST', 'CAM', 'CDM', 'CM'];\n      if (aggressiveRoles.includes(player.role)) score += 20;\n\n      if (player.vx || player.vy) {\n        const playerAngle = Math.atan2(player.vy, player.vx);\n        const ballAngle = Math.atan2(\n          gameState.ballPosition.y - player.y,\n          gameState.ballPosition.x - player.x\n        );\n        let angleDiff = Math.abs(playerAngle - ballAngle);\n        if (angleDiff > Math.PI) angleDiff = 2 * Math.PI - angleDiff;\n\n        if (angleDiff < Math.PI / 3) score += 25;\n      }\n\n      const stamina = (player as Player & { stamina?: number }).stamina ?? 100;\n      if (stamina < 40) score *= 0.7;\n\n      const ownGoalX = getAttackingGoalX(!player.isHome, gameState.currentHalf);\n      const ballDistToOwnGoal = Math.abs(gameState.ballPosition.x - ownGoalX);\n\n      if (ballDistToOwnGoal < 250) {\n        if (['CB', 'RB', 'LB', 'CDM'].includes(player.role)) {\n          score += 30;\n        }\n      }\n\n      return { player, score, distToBall };\n    })\n    .filter(item => item.score > 0)\n    .sort((a, b) => b.score - a.score);\n\n  const MAX_CHASERS_PER_TEAM = 2;\n\n  const homeChasers = chaseEvaluations\n    .filter(e => e.player.isHome)\n    .slice(0, MAX_CHASERS_PER_TEAM);\n\n  const awayChasers = chaseEvaluations\n    .filter(e => !e.player.isHome)\n    .slice(0, MAX_CHASERS_PER_TEAM);\n\n  [...homeChasers, ...awayChasers].forEach(evaluation => {\n    evaluation.player.isChasingBall = true;\n    (gameState.ballChasers as Set<unknown>).add(evaluation.player.id);\n  });\n\n  if (priorityChaser) {\n    priorityChaser.isChasingBall = true;\n    (gameState.ballChasers as Set<unknown>).add(priorityChaser.id);\n  }\n}\n\n// ============================================================================\n// GOALKEEPER BALL HOLDING\n// ============================================================================\n\n/**\n * Handle goalkeeper holding the ball and distribution\n */\nfunction handleGoalkeeperBallHold(holder: Player, allPlayers: Player[]): void {\n  if (!holder.ballReceivedTime) {\n    holder.ballReceivedTime = Date.now();\n  }\n\n  const GK_HOLD_TIME = window.GAME_CONFIG?.GK_HOLD_TIME ?? 5000;\n\n  if (holder.ballReceivedTime && holder === gameState.ballHolder) {\n    const holdTime = Date.now() - holder.ballReceivedTime;\n    if (holdTime > GK_HOLD_TIME) {\n      const teammates = allPlayers.filter(p => p.isHome === holder.isHome && p.role !== 'GK');\n      if (teammates.length === 0) return;\n\n      const teamState = holder.isHome ? gameState.homeTeamState : gameState.awayTeamState;\n      let target: Player;\n\n      if (teamState === 'COUNTER_ATTACK') {\n        const forwards = teammates.filter(p => ['ST', 'RW', 'LW', 'CAM'].includes(p.role));\n        target = forwards.length > 0 ? forwards[Math.floor(Math.random() * forwards.length)]! : teammates[0]!;\n      } else {\n        const defenders = teammates\n          .filter(p => ['CB', 'RB', 'LB', 'CDM'].includes(p.role))\n          .sort((a, b) => getDistance(a, holder) - getDistance(b, holder));\n        target = defenders.length > 0 ? defenders[0]! : teammates[0]!;\n      }\n\n      if (target && typeof window.passBall === 'function') {\n        window.passBall(holder, holder.x, holder.y, target.x, target.y, 0.9, 450, false);\n        holder.ballReceivedTime = null;\n      }\n    }\n  }\n}\n\n// ============================================================================\n// PLAYER VELOCITY UPDATE\n// ============================================================================\n\n/**\n * Update player velocity using steering behaviors\n */\nfunction updatePlayerVelocity(player: Player, dx: number, dy: number, dist: number, dt: number): void {\n  // Safe math guards - prevent NaN propagation\n  if (!isFinite(dx) || !isFinite(dy) || !isFinite(dist) || dist === 0) {\n    return;\n  }\n\n  const PHYSICS = window.PHYSICS ?? PHYSICS_DEFAULTS;\n  const SLOWING_RADIUS = 50;\n\n  const physicalityBonus = (player.physicality / 100) * 0.15;\n  const speedMultiplier = player.speedBoost || 1.0;\n  const paceFactor = 0.3 + (player.pace / 100) * 0.7;\n  const accel = PHYSICS.ACCELERATION * (paceFactor + physicalityBonus) * speedMultiplier;\n  const maxSpeed = PHYSICS.MAX_SPEED * paceFactor * speedMultiplier;\n\n  const effectiveMaxSpeed = player.hasBallControl ? maxSpeed * PHYSICS.DRIBBLE_SPEED_PENALTY : maxSpeed;\n\n  let desiredSpeed = effectiveMaxSpeed;\n  if (dist < SLOWING_RADIUS) {\n    desiredSpeed = effectiveMaxSpeed * (dist / SLOWING_RADIUS);\n  }\n\n  // Use safe division\n  const dirX = safeDiv(dx, dist, 0);\n  const dirY = safeDiv(dy, dist, 0);\n\n  const desiredVX = dirX * desiredSpeed;\n  const desiredVY = dirY * desiredSpeed;\n\n  const steeringForceX = desiredVX - player.vx;\n  const steeringForceY = desiredVY - player.vy;\n\n  const maxForce = accel * dt;\n  const steeringMagnitude = Math.sqrt(steeringForceX * steeringForceX + steeringForceY * steeringForceY);\n\n  if (steeringMagnitude > maxForce) {\n    const ratio = maxForce / steeringMagnitude;\n    player.vx += steeringForceX * ratio;\n    player.vy += steeringForceY * ratio;\n  } else {\n    player.vx += steeringForceX;\n    player.vy += steeringForceY;\n  }\n\n  // Validate velocity\n  const currentSpeed = safeSqrt(player.vx * player.vx + player.vy * player.vy, 0);\n  (player as Player & { currentSpeed?: number }).currentSpeed = currentSpeed;\n\n  // Safe velocity clamping\n  if (currentSpeed > effectiveMaxSpeed && currentSpeed > 0) {\n    const ratio = safeDiv(effectiveMaxSpeed, currentSpeed, 1);\n    player.vx *= ratio;\n    player.vy *= ratio;\n  }\n}\n\n// ============================================================================\n// PLAYER FRICTION\n// ============================================================================\n\n/**\n * Apply friction to slow down player when not moving\n */\nfunction applyPlayerFriction(player: Player, dt: number): void {\n  const PHYSICS_FRICTION = window.PHYSICS?.FRICTION ?? 0.88;\n\n  const physicalityPenalty = (player.physicality / 100) * 0.05;\n  const effectiveFriction = PHYSICS_FRICTION - physicalityPenalty;\n  const frictionDecay = Math.pow(effectiveFriction, dt);\n\n  player.vx *= frictionDecay;\n  player.vy *= frictionDecay;\n\n  if (Math.abs(player.vx) < 5) player.vx = 0;\n  if (Math.abs(player.vy) < 5) player.vy = 0;\n  (player as Player & { currentSpeed?: number }).currentSpeed = 0;\n}\n\n// ============================================================================\n// CAMERA SHAKE\n// ============================================================================\n\n/**\n * Update camera shake effect\n */\nfunction updateCameraShake(dt: number): void {\n  const cameraShake = (gameState as GameState & { cameraShake?: number }).cameraShake ?? 0;\n  if (cameraShake > 0) {\n    const newShake = cameraShake - cameraShake * 18 * dt;\n    (gameState as GameState & { cameraShake: number }).cameraShake = newShake < 0.1 ? 0 : newShake;\n  }\n}\n\n// ============================================================================\n// GLOBAL EXPORTS FOR BROWSER COMPATIBILITY\n// ============================================================================\n\nif (typeof window !== 'undefined') {\n  window.updatePhysics = updatePhysics;\n  window.updatePlayerPhysics = updatePlayerPhysics;\n  window.updateBallWithHolder = updateBallWithHolder;\n  window.updateBallTrajectory = updateBallTrajectory;\n  window.validateBallState = validateBallState;\n\n  console.log('\u2705 Physics System loaded (TypeScript)');\n}\n", "import type { Player, BallTrajectory } from '../types';\nimport { getDistance } from '../utils/ui';\nimport { gameState } from '../globalExports';\nimport { eventBus } from '../eventBus';\nimport { EVENT_TYPES } from '../types';\nimport { assignBallChasers } from '../physics';\nimport { getPlayerFacingDirection } from './playerVision';\n\nexport const FIRST_TOUCH_CONFIG = {\n    // Control quality thresholds\n    PERFECT_TOUCH_THRESHOLD: 0.85,    // Takes ball in stride\n    GOOD_TOUCH_THRESHOLD: 0.70,       // Controls but slows\n    POOR_TOUCH_THRESHOLD: 0.30,       // Heavy touch, ball gets away\n    // Below 0.50 = complete loss of control\n\n    // Speed penalties after control\n    PERFECT_TOUCH_SPEED: 1.0,         // No slowdown\n    GOOD_TOUCH_SPEED: 0.7,            // Slows to control\n    POOR_TOUCH_SPEED: 0.4,            // Nearly stops\n\n    // Time to settle ball\n    PERFECT_TOUCH_SETTLE_TIME: 0,     // Immediate\n    GOOD_TOUCH_SETTLE_TIME: 300,      // ms\n    POOR_TOUCH_SETTLE_TIME: 600,      // ms\n\n    // Bounce distances for failed control\n    MIN_BOUNCE_DISTANCE: 30,          // pixels\n    MAX_BOUNCE_DISTANCE: 70,         // pixels\n\n    // Ball speed thresholds (pixels/second)\n    SLOW_PASS_SPEED: 200,\n    FAST_PASS_SPEED: 450,\n\n    // Pressure effect\n    PRESSURE_DISTANCE: 30,            // Opponent this close affects control\n    PRESSURE_PENALTY_PER_OPP: 0.12    // Each opponent reduces control\n};\n\nfunction calculateFirstTouchQuality(player: Player, ballSpeed: number, nearbyOpponents: Player[]): number {\n    const baseAbility = player.dribbling / 100;\n\n    const realStats = player.realStats || {};\n    const ballControlBonus = realStats.dribblesSucceeded ?\n        (realStats.dribblesSucceeded / 90) * 0.15 : 0;\n\n    const speedDifficulty = Math.min(\n        (ballSpeed - FIRST_TOUCH_CONFIG.SLOW_PASS_SPEED) /\n        (FIRST_TOUCH_CONFIG.FAST_PASS_SPEED - FIRST_TOUCH_CONFIG.SLOW_PASS_SPEED),\n        1.0\n    );\n    const speedPenalty = speedDifficulty * 0.25; // Up to 25% harder\n\n    const opponentsInRange = nearbyOpponents.filter(opp =>\n        getDistance(player, opp) < FIRST_TOUCH_CONFIG.PRESSURE_DISTANCE\n    );\n    const pressurePenalty = opponentsInRange.length *\n        FIRST_TOUCH_CONFIG.PRESSURE_PENALTY_PER_OPP;\n\n    const fatiguePenalty = (100 - (player as any).stamina) / 90 * 0.15;\n\n    const ballAngle = Math.atan2(\n        gameState.ballPosition.y - player.y,\n        gameState.ballPosition.x - player.x\n    );\n    const facingAngle = (player as any).facingAngle || getPlayerFacingDirection(player);\n    let angleDiff = Math.abs(ballAngle - facingAngle);\n    if (angleDiff > Math.PI) angleDiff = 2 * Math.PI - angleDiff;\n\n    const bodyPositionPenalty = (angleDiff / Math.PI) * 0.2;\n\n    let quality = baseAbility + ballControlBonus + 0.1 - // Base + bonus + slight advantage\n        speedPenalty -\n        pressurePenalty -\n        fatiguePenalty -\n        bodyPositionPenalty;\n\n    const variance = (Math.random() - 0.5) * 0.15;\n    quality += variance;\n\n    // Clamp to 0-1\n    return Math.max(0, Math.min(1, quality));\n}\n\n\nexport function applyFirstTouch(player: Player, trajectory: BallTrajectory | null, allPlayers: Player[]): { outcome: string; quality: number; settleTime: number; speedMultiplier: number; } {\n    const ballSpeed = trajectory ?\n        Math.sqrt(\n            Math.pow((trajectory.endX - trajectory.startX) / (trajectory.duration / 1000), 2) +\n            Math.pow((trajectory.endY - trajectory.startY) / (trajectory.duration / 1000), 2)\n        ) : 200; // Default for loose balls\n\n    const opponents = allPlayers.filter(p => p.isHome !== player.isHome);\n    const nearbyOpponents = opponents.filter(opp =>\n        getDistance(player, opp) < FIRST_TOUCH_CONFIG.PRESSURE_DISTANCE * 1.5\n    );\n\n    // Calculate touch quality\n    const touchQuality = calculateFirstTouchQuality(player, ballSpeed, nearbyOpponents);\n\n    // Determine outcome based on quality\n    let outcome;\n    let settleTime;\n    let speedMultiplier;\n\n    if (touchQuality >= FIRST_TOUCH_CONFIG.PERFECT_TOUCH_THRESHOLD) {\n        outcome = 'perfect';\n        settleTime = FIRST_TOUCH_CONFIG.PERFECT_TOUCH_SETTLE_TIME;\n        speedMultiplier = FIRST_TOUCH_CONFIG.PERFECT_TOUCH_SPEED;\n    } else if (touchQuality >= FIRST_TOUCH_CONFIG.GOOD_TOUCH_THRESHOLD) {\n        outcome = 'good';\n        settleTime = FIRST_TOUCH_CONFIG.GOOD_TOUCH_SETTLE_TIME;\n        speedMultiplier = FIRST_TOUCH_CONFIG.GOOD_TOUCH_SPEED;\n    } else if (touchQuality >= FIRST_TOUCH_CONFIG.POOR_TOUCH_THRESHOLD) {\n        outcome = 'poor';\n        settleTime = FIRST_TOUCH_CONFIG.POOR_TOUCH_SETTLE_TIME;\n        speedMultiplier = FIRST_TOUCH_CONFIG.POOR_TOUCH_SPEED;\n    } else {\n        outcome = 'failed';\n        settleTime = 0;\n        speedMultiplier = 0;\n    }\n\n    (player as any).firstTouchQuality = touchQuality;\n    (player as any).firstTouchTime = Date.now();\n    (player as any).ballSettleTime = settleTime;\n    player.speedBoost = speedMultiplier;\n\n    console.log(`\u00AF ${player.name} first touch: ${outcome} (${(touchQuality * 100).toFixed(0)}%)`);\n\n    return {\n        outcome: outcome,\n        quality: touchQuality,\n        settleTime: settleTime,\n        speedMultiplier: speedMultiplier\n    };\n}\n\nexport function handleFailedFirstTouch(player: Player, allPlayers: Player[]): void {\n    console.log(` ${player.name} loses control completely!`);\n\n    const ballDirection = Math.random() * Math.PI * 2;\n    const bounceSpeed = 150 + Math.random() * 100;\n    gameState.ballVelocity.x = Math.cos(ballDirection) * bounceSpeed;\n    gameState.ballVelocity.y = Math.sin(ballDirection) * bounceSpeed;\n\n    gameState.ballPosition.x = player.x + Math.cos(ballDirection) * 25;\n    gameState.ballPosition.y = player.y + Math.sin(ballDirection) * 25;\n\n    gameState.ballTrajectory = null;\n    gameState.ballHolder = null;\n    gameState.currentPassReceiver = null;\n    player.hasBallControl = false;\n\n    gameState.commentary.push({\n        text: `${Math.floor(gameState.timeElapsed)}' ${player.name} loses control!`,\n        type: 'attack'\n    });\n\n    if (typeof eventBus !== 'undefined') {\n        eventBus.publish(EVENT_TYPES.BALL_LOST, {\n            player: player,\n            reason: 'poor_first_touch'\n        });\n    }\n    assignBallChasers(allPlayers, player);\n}\n\nexport function handlePoorFirstTouch(player: Player, touchResult: { outcome: string; quality: number; settleTime: number; speedMultiplier: number; }): void {\n    console.log(` ${player.name} heavy touch`);\n\n    const movementAngle = (player as any).facingAngle || getPlayerFacingDirection(player);\n    const pushDistance = 40 + Math.random() * 30;\n\n    gameState.ballPosition.x = player.x + Math.cos(movementAngle) * pushDistance;\n    gameState.ballPosition.y = player.y + Math.sin(movementAngle) * pushDistance;\n\n    // Player still has control but it's not ideal\n    gameState.ballTrajectory = null;\n    gameState.ballHolder = player;\n    player.hasBallControl = true;\n    (player as any).ballReceivedTime = Date.now();\n    gameState.ballChasers.clear();\n\n    player.speedBoost = touchResult.speedMultiplier;\n\n    setTimeout(() => {\n        if (player.hasBallControl) {\n            player.speedBoost = 1.0;\n            delete (player as any).ballSettleTime;\n        }\n    }, touchResult.settleTime);\n}\n\nexport function handleSuccessfulFirstTouch(player: Player, touchResult: { outcome: string; quality: number; settleTime: number; speedMultiplier: number; }): void {\n    const wasPerfect = touchResult.outcome === 'perfect';\n\n    if (wasPerfect) {\n        console.log(`\u00A8 ${player.name} perfect touch!`);\n    }\n\n    // Track possession change\n    const previousHolder = gameState.ballHolder;\n    if (!previousHolder || previousHolder.isHome !== player.isHome) {\n        gameState.lastPossessionChange = Date.now();\n        gameState.possessionChanges++;\n    }\n\n    // Update pass statistics\n    if (previousHolder && previousHolder.isHome === player.isHome && previousHolder.id !== player.id) {\n        const teamStats = player.isHome ? gameState.stats.home : gameState.stats.away;\n        teamStats.passesCompleted++;\n    }\n\n    // FIXED: Clear all control-related states\n    gameState.ballTrajectory = null;\n    gameState.ballHolder = player;\n    player.hasBallControl = true;\n    (player as any).ballReceivedTime = Date.now();\n    gameState.ballChasers.clear();\n    gameState.currentPassReceiver = null;\n\n    // FIXED: Clear chase flags from all players\n    const allPlayers = [...gameState.homePlayers, ...gameState.awayPlayers];\n    allPlayers.forEach(p => {\n        if (p.id !== player.id) {\n            p.isChasingBall = false;\n            (p as any).chaseStartTime = null;\n        }\n    });\n\n    // Apply speed modifier\n    player.speedBoost = touchResult.speedMultiplier;\n\n    // Perfect touch? Can immediately move at full speed\n    if (wasPerfect) {\n        player.speedBoost = 1.0; // No penalty\n        // Bonus: Slightly ahead of original position (takes ball in stride)\n        const moveAngle = (player as any).facingAngle || getPlayerFacingDirection(player);\n        gameState.ballPosition.x = player.x + Math.cos(moveAngle) * 15;\n        gameState.ballPosition.y = player.y + Math.sin(moveAngle) * 15;\n    } else {\n        // Good touch: Need time to settle\n        setTimeout(() => {\n            if (player.hasBallControl && gameState.ballHolder === player) {\n                player.speedBoost = 1.0;\n                delete (player as any).ballSettleTime;\n                delete (player as any).firstTouchTime;\n            }\n        }, touchResult.settleTime);\n    }\n}\n\nexport function canPlayerActOnBall(player: Player): boolean {\n    if (!player.hasBallControl) return false;\n\n    // Still settling the ball?\n    if ((player as any).ballSettleTime && (player as any).firstTouchTime) {\n        const timeSinceTouch = Date.now() - (player as any).firstTouchTime;\n        if (timeSinceTouch < (player as any).ballSettleTime) {\n            return false; // Still controlling, can't pass/shoot yet\n        }\n    }\n\n    return true;\n}\n\nexport function drawFirstTouchIndicator(ctx: CanvasRenderingContext2D, player: Player): void {\n    if (!(player as any).firstTouchTime) return;\n\n    const timeSinceTouch = Date.now() - (player as any).firstTouchTime;\n    const maxDisplayTime = 1000; // Show for 1 second\n\n    if (timeSinceTouch > maxDisplayTime) {\n        delete (player as any).firstTouchTime;\n        delete (player as any).firstTouchQuality;\n        return;\n    }\n\n    const quality = (player as any).firstTouchQuality || 0;\n    const alpha = 1 - (timeSinceTouch / maxDisplayTime);\n\n    // Color based on quality\n    let color;\n    if (quality >= 0.85) {\n        color = `rgba(34, 197, 94, ${alpha})`; // Green - perfect\n    } else if (quality >= 0.70) {\n        color = `rgba(59, 130, 246, ${alpha})`; // Blue - good\n    } else if (quality >= 0.50) {\n        color = `rgba(251, 191, 36, ${alpha})`; // Yellow - poor\n    } else {\n        color = `rgba(239, 68, 68, ${alpha})`; // Red - failed\n    }\n\n    ctx.save();\n    ctx.strokeStyle = color;\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    ctx.arc(player.x, player.y, 22, 0, Math.PI * 2);\n    ctx.stroke();\n    ctx.restore();\n}\n\nexport function initFirstTouchStats(): void {\n    (gameState.stats.home as any).firstTouches = {\n        perfect: 0,\n        good: 0,\n        poor: 0,\n        failed: 0,\n        total: 0\n    };\n    (gameState.stats.away as any).firstTouches = {\n        perfect: 0,\n        good: 0,\n        poor: 0,\n        failed: 0,\n        total: 0\n    };\n}\n\nexport function recordFirstTouchStatistic(player: Player, outcome: string): void {\n    const teamStats = player.isHome ? gameState.stats.home : gameState.stats.away;\n    (teamStats as any).firstTouches[outcome]++;\n    (teamStats as any).firstTouches.total++;\n}\n", "import { gameState } from './globalExports';\nimport { GAME_CONFIG, GAME_LOOP } from './config';\nimport { updatePlayerAI_V2 } from './core';\nimport { updatePhysics, assignBallChasers } from './physics';\nimport * as SetPieceIntegration from './setpieces/integration';\nimport { processPendingEvents, switchSides, updateMatchStats } from './main';\nimport { selectBestTeam, selectBestTactic, initializePlayers } from './gameSetup';\nimport { isSetPieceStatus } from './utils/ui';\n\ndeclare const spatialSystem: any;\ndeclare const penaltySystem: any;\n\ninterface Match {\n    id: number;\n    homeTeam: string;\n    awayTeam: string;\n}\n\ninterface MatchResult {\n    matchId: number;\n    homeTeam: string;\n    awayTeam: string;\n    homeScore: number;\n    awayScore: number;\n    homeXG: string;\n    awayXG: string;\n    homePossession: number;\n    awayPossession: number;\n    homeShots: number;\n    awayShots: number;\n    homeShotsOnTarget: number;\n    awayShotsOnTarget: number;\n    homePassAccuracy: number;\n    awayPassAccuracy: number;\n    winner: string;\n    goalEvents: any[];\n    cardEvents: any[];\n}\n\nexport const CustomFixtureSimulator = {\n    matchList: [] as Match[],\n    isRunning: false,\n    results: [] as MatchResult[],\n    currentMatchIndex: 0,\n\n    addMatch(homeTeam: string, awayTeam: string) {\n        if (!homeTeam || !awayTeam) {\n            alert('\u26A0\uFE0F Please select both teams!');\n            return;\n        }\n\n        if (homeTeam === awayTeam) {\n            alert('\u26A0\uFE0F A team cannot play against itself!');\n            return;\n        }\n\n        this.matchList.push({\n            id: Date.now() + Math.random(),\n            homeTeam: homeTeam,\n            awayTeam: awayTeam\n        });\n\n        console.log(`\u2705 Added match: ${homeTeam} vs ${awayTeam}`);\n        if (typeof gameState !== 'undefined' && gameState.status === 'setup') {\n            this.renderMatchList();\n        }\n    },\n\n    removeMatch(matchId: number) {\n        this.matchList = this.matchList.filter(m => m.id !== matchId);\n        if (typeof gameState !== 'undefined' && gameState.status === 'setup') {\n            this.renderMatchList();\n        }\n        console.log(`\uD83D\uDDD1\uFE0F Removed match`);\n    },\n\n    clearAll() {\n        if (this.matchList.length === 0) return;\n\n        if (confirm('\uD83D\uDDD1\uFE0F Clear all matches?')) {\n            this.matchList = [];\n            if (typeof gameState !== 'undefined' && gameState.status === 'setup') {\n                this.renderMatchList();\n            }\n            console.log('\uD83E\uDDF9 Match list cleared');\n        }\n    },\n\n    renderMatchList() {\n        const container = document.getElementById('custom-match-list');\n        if (!container || typeof gameState === 'undefined' || !gameState.teamLogos) {\n            console.warn(\"Cannot render match list: container or gameState not ready.\");\n            return;\n        }\n\n        if (this.matchList.length === 0) {\n            container.innerHTML = `\n                <div style=\"text-align: center; padding: 40px; opacity: 0.5;\">\n                    <div style=\"font-size: 48px; margin-bottom: 10px;\">\u26BD</div>\n                    <div>No matches added yet</div>\n                    <div style=\"font-size: 14px; margin-top: 5px;\">Add matches below to start</div>\n                </div>\n            `;\n\n            const simulateBtn = document.getElementById('simulate-all-btn') as HTMLButtonElement;\n            if (simulateBtn) {\n                simulateBtn.disabled = true;\n                simulateBtn.style.opacity = '0.5';\n            }\n            return;\n        }\n\n        const simulateBtn = document.getElementById('simulate-all-btn') as HTMLButtonElement;\n        if (simulateBtn) {\n            simulateBtn.disabled = false;\n            simulateBtn.style.opacity = '1';\n        }\n\n        container.innerHTML = `\n            <div style=\"max-height: 400px; overflow-y: auto; padding-right: 10px;\">\n                ${this.matchList.map((match) => `\n                    <div class=\"match-item\" style=\"display: flex; align-items: center; justify-content: space-between; padding: 15px; margin-bottom: 10px; background: rgba(255,255,255,0.05); border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease;\">\n                        <div style=\"flex: 1; display: flex; align-items: center; gap: 10px; min-width: 0;\">\n                            <img src=\"${gameState.teamLogos[match.homeTeam] || ''}\" style=\"width: 24px; height: 24px; object-fit: contain; flex-shrink: 0;\">\n                            <span style=\"font-weight: 700; color: #4facfe; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;\">${match.homeTeam}</span>\n                            <span style=\"margin: 0 10px; opacity: 0.5;\">vs</span>\n                            <span style=\"font-weight: 700; color: #fa709a; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;\">${match.awayTeam}</span>\n                            <img src=\"${gameState.teamLogos[match.awayTeam] || ''}\" style=\"width: 24px; height: 24px; object-fit: contain; flex-shrink: 0;\">\n                        </div>\n                        <button onclick=\"CustomFixtureSimulator.removeMatch(${match.id})\" style=\"padding: 8px 15px; background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; border-radius: 6px; color: #ef4444; cursor: pointer; font-size: 14px; transition: all 0.3s; margin-left: 10px; flex-shrink: 0;\">\n                            \uD83D\uDDD1\uFE0F Remove\n                        </button>\n                    </div>\n                `).join('')}\n            </div>\n            <div style=\"margin-top: 15px; padding: 10px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; text-align: center; font-size: 14px;\">\n                \u2705 <strong>${this.matchList.length}</strong> matches ready to simulate\n            </div>\n        `;\n    },\n\n    async simulateAll() {\n        if (this.matchList.length === 0) {\n            alert('\u26A0\uFE0F No matches to simulate!');\n            return;\n        }\n        const requiredFuncs = [\n            'selectBestTeam', 'selectBestTactic', 'initializePlayers',\n            'updatePlayerAI_V2', 'updatePhysics', 'assignBallChasers',\n            'SetPieceIntegration', 'processPendingEvents', 'updateMatchStats',\n            'switchSides', 'getPlayerActivePosition', 'getAttackingGoalX',\n            'resetAfterGoal', 'handleShotAttempt'\n        ];\n        for (const funcName of requiredFuncs) {\n            if (typeof (window as any)[funcName] !== 'function' && typeof (window as any)[funcName] !== 'object') {\n                alert(`\u274C Error: Required function \"${funcName}\" is missing. Cannot start simulation.`);\n                console.error(`Missing function: ${funcName}`);\n                return;\n            }\n        }\n\n        this.isRunning = true;\n        this.results = [];\n        this.currentMatchIndex = 0;\n\n        console.log(`\uD83D\uDE80 Starting batch simulation: ${this.matchList.length} matches`);\n\n        this.showSimulationScreen();\n\n        for (let i = 0; i < this.matchList.length; i++) {\n            if (!this.isRunning) break;\n\n            this.currentMatchIndex = i;\n            const match = this.matchList[i];\n            if (!match) {\n                console.error(`Match at index ${i} is invalid.`);\n                continue;\n            }\n\n            this.highlightMatchCard(match.id, 'playing');\n\n            try {\n                const result = await this.simulateSingleMatch(match.homeTeam, match.awayTeam, match.id);\n                if (result) {\n                    this.results.push(result);\n                    this.updateMatchCard(result);\n                    this.highlightMatchCard(match.id, 'finished');\n                } else {\n                    console.error(`Simulation for match ${match.id} (${match.homeTeam} vs ${match.awayTeam}) returned invalid result.`);\n                    this.highlightMatchCard(match.id, 'error');\n                }\n            } catch (error) {\n                console.error(`Error simulating match ${match.id} (${match.homeTeam} vs ${match.awayTeam}):`, error);\n                this.highlightMatchCard(match.id, 'error');\n            }\n        }\n\n        this.isRunning = false;\n        console.log('\u2705 All matches simulated');\n\n        this.showCompletionControls();\n    },\n\n    async simulateSingleMatch(homeTeam: string, awayTeam: string, matchId: number): Promise<MatchResult | null> {\n        if (typeof gameState === 'undefined') {\n            console.error(\"simulateSingleMatch: gameState is not defined!\");\n            return null;\n        }\n\n        return new Promise((resolve, reject) => {\n            const originals = {\n                renderGame: (window as any).renderGame,\n                updateGameUI: (window as any).updateGameUI,\n                render: (window as any).render,\n                drawPitchBackground: (window as any).drawPitchBackground,\n                introRenderLoop: (window as any).introRenderLoop,\n                setupKickOff: (window as any).setupKickOff,\n                handleHalfTime: (window as any).handleHalfTime,\n                handleFullTime: (window as any).handleFullTime,\n                showGoalAnimation: (window as any).showGoalAnimation,\n                createGoalExplosion: (window as any).createGoalExplosion,\n                gameSpeed: GAME_LOOP.GAME_SPEED,\n                gameContext: gameState.contexts?.game\n            };\n\n            if ((window as any).DEBUG_BATCH_SIM) {\n                console.log(`[BatchSim] Disabling rendering for match ${matchId}`);\n            }\n            (window as any).renderGame = () => { };\n            (window as any).updateGameUI = () => { };\n            (window as any).render = () => { };\n            (window as any).drawPitchBackground = () => { };\n            (window as any).introRenderLoop = () => { };\n            if (typeof (window as any).showGoalAnimation === 'function') (window as any).showGoalAnimation = () => { };\n            if (typeof (window as any).createGoalExplosion === 'function') (window as any).createGoalExplosion = () => { };\n\n            (window as any).setupKickOff = (teamWithBall: 'home' | 'away') => {\n                if (typeof originals.setupKickOff === 'function') {\n                    originals.setupKickOff(teamWithBall);\n                    if (gameState.setPiece) {\n                        (gameState.setPiece as any).executionTime = Date.now();\n                    }\n                } else {\n                    gameState.status = 'KICK_OFF';\n                    gameState.setPiece = { type: 'KICK_OFF', team: teamWithBall === 'home', position: { x: 400, y: 300 }, executionTime: Date.now() } as any;\n                }\n            };\n\n            (window as any).handleHalfTime = () => {\n                if (gameState.status === 'halftime') return;\n                gameState.status = 'halftime';\n                switchSides();\n                gameState.currentHalf = 2;\n                gameState.timeElapsed = 45;\n                (window as any).setupKickOff('away');\n            };\n\n            (window as any).handleFullTime = () => {\n                gameState.status = 'finished';\n                if ((window as any).batchGameIntervalId) {\n                    clearInterval((window as any).batchGameIntervalId);\n                    (window as any).batchGameIntervalId = null;\n                }\n            };\n\n            try {\n                GAME_LOOP.GAME_SPEED = 500;\n\n                if (!gameState.contexts) {\n                    gameState.contexts = {\n                        background: null,\n                        game: null,\n                        ui: null\n                    };\n                }\n                gameState.contexts.game = {\n                    dummy: true,\n                    clearRect: () => { }, beginPath: () => { }, moveTo: () => { }, lineTo: () => { },\n                    arc: () => { }, fill: () => { }, stroke: () => { }, fillRect: () => { },\n                    strokeRect: () => { }, save: () => { }, restore: () => { },\n                    translate: () => { }, rotate: () => { }, scale: () => { }, createLinearGradient: () => ({ addColorStop: () => { } }),\n                    createRadialGradient: () => ({ addColorStop: () => { } }), drawImage: () => { },\n                    setTransform: () => { }, fillText: () => { }, measureText: () => ({ width: 0 }), setLineDash: () => { }\n                } as any;\n\n                gameState.homeTeam = homeTeam;\n                gameState.awayTeam = awayTeam;\n\n                const homeTeamObj = selectBestTeam(homeTeam);\n                const awayTeamObj = selectBestTeam(awayTeam);\n\n                if (!homeTeamObj || !awayTeamObj || !homeTeamObj.players || !awayTeamObj.players) {\n                    throw new Error(\"Could not select valid teams.\");\n                }\n\n                gameState.homeFormation = homeTeamObj.formation;\n                gameState.awayFormation = awayTeamObj.formation;\n                gameState.homeTactic = selectBestTactic(homeTeamObj.players);\n                gameState.awayTactic = selectBestTactic(awayTeamObj.players);\n\n                const initialized = initializePlayers(\n                    homeTeamObj.players, awayTeamObj.players,\n                    homeTeamObj.formation, awayTeamObj.formation\n                );\n\n                if (!initialized || !initialized.home || !initialized.away) {\n                    throw new Error(\"Could not initialize players.\");\n                }\n\n                gameState.homePlayers = initialized.home;\n                gameState.awayPlayers = initialized.away;\n\n                gameState.status = 'KICK_OFF';\n                gameState.timeElapsed = 0; gameState.currentHalf = 1; gameState.homeScore = 0; gameState.awayScore = 0;\n                gameState.ballPosition = { x: 400, y: 300 }; gameState.ballVelocity = { x: 0, y: 0 }; gameState.ballHeight = 0;\n                gameState.ballTrajectory = null; gameState.ballHolder = null; gameState.commentary = []; gameState.particles = [];\n                gameState.ballChasers = new Set(); gameState.shotInProgress = false; gameState.shooter = null;\n                (gameState as any).goalEvents = []; (gameState as any).cardEvents = []; gameState.fouls = 0; (gameState as any).yellowCards = []; (gameState as any).redCards = [];\n                (gameState as any).stats = { home: { possession: 0, passesCompleted: 0, passesAttempted: 0, shotsOnTarget: 0, shotsOffTarget: 0, xGTotal: 0, offsides: 0 }, away: { possession: 0, passesCompleted: 0, passesAttempted: 0, shotsOnTarget: 0, shotsOffTarget: 0, xGTotal: 0, offsides: 0 }, possessionTimer: { home: 0, away: 0 }, lastPossessionUpdate: Date.now() };\n\n                (window as any).setupKickOff('home');\n\n                let lastFrameTimeSim = performance.now();\n                let physicsAccumulatorSim = 0;\n                (window as any).gameTime = 0;\n\n                if ((window as any).batchGameIntervalId) clearInterval((window as any).batchGameIntervalId);\n\n                const simulationStep = () => {\n                    const nowSim = performance.now();\n                    let real_dt = (nowSim - lastFrameTimeSim) / 1000.0;\n                    lastFrameTimeSim = nowSim;\n                    real_dt = Math.max(0, Math.min(real_dt, 0.1));\n                    const game_dt = real_dt * GAME_LOOP.GAME_SPEED;\n\n                    let steps = 0;\n\n                    try {\n                        const allPlayers = [...(gameState.homePlayers || []), ...(gameState.awayPlayers || [])];\n                        const validPlayers = allPlayers.filter(p => p);\n\n                        if (typeof spatialSystem !== 'undefined' && typeof spatialSystem.buildGrid === 'function') {\n                            spatialSystem.buildGrid(validPlayers, GAME_CONFIG.PITCH_WIDTH, GAME_CONFIG.PITCH_HEIGHT);\n                        }\n\n                        if (gameState.status === 'playing' && !gameState.ballHolder?.hasBallControl && !gameState.ballTrajectory) {\n                            if (typeof assignBallChasers === 'function') assignBallChasers(validPlayers);\n                        }\n\n                        const isGameActive = !['paused', 'finished', 'halftime', 'goal_scored'].includes(gameState.status);\n                        const isSetPieceOrKickOff = (typeof isSetPieceStatus === 'function')\n                            ? isSetPieceStatus(gameState.status)\n                            : ['GOAL_KICK', 'CORNER_KICK', 'THROW_IN', 'FREE_KICK', 'KICK_OFF', 'PENALTY'].includes(gameState.status);\n\n                        if (isSetPieceOrKickOff || isGameActive) {\n                            validPlayers.forEach(player => {\n                                if (typeof updatePlayerAI_V2 === 'function') {\n                                    updatePlayerAI_V2(player, gameState.ballPosition, validPlayers, gameState);\n                                }\n                            });\n\n                            if (isSetPieceOrKickOff && gameState.status !== 'PENALTY') {\n                                if (typeof SetPieceIntegration !== 'undefined' && (SetPieceIntegration as any).executeSetPiece_Router) {\n                                    (SetPieceIntegration as any).executeSetPiece_Router(gameState);\n                                }\n                            }\n                            if (gameState.status === 'PENALTY' && typeof penaltySystem !== 'undefined' && typeof penaltySystem.update === 'function') {\n                                penaltySystem.update(gameState);\n                            }\n                        }\n\n                        if (isGameActive || isSetPieceOrKickOff) {\n                            if (gameState.status === 'playing') {\n                                (window as any).gameTime += game_dt;\n                            }\n                            if (typeof processPendingEvents === 'function') {\n                                processPendingEvents((window as any).gameTime);\n                            }\n\n                            physicsAccumulatorSim += game_dt;\n                            steps = 0;\n                            const maxSteps = 10;\n\n                            if (typeof updatePhysics === 'function') {\n                                while (physicsAccumulatorSim >= GAME_LOOP.FIXED_TIMESTEP && steps < maxSteps) {\n                                    updatePhysics(GAME_LOOP.FIXED_TIMESTEP);\n                                    physicsAccumulatorSim -= GAME_LOOP.FIXED_TIMESTEP;\n                                    steps++;\n                                }\n                                if (steps >= maxSteps) {\n                                    physicsAccumulatorSim = 0;\n                                }\n                            }\n                        }\n\n                        if (gameState.status === 'playing') {\n                            const timeIncrementThisStep = (GAME_LOOP.FIXED_TIMESTEP * steps) / 60.0;\n                            gameState.timeElapsed += timeIncrementThisStep;\n                        }\n                        if (typeof updateMatchStats === 'function') updateMatchStats();\n\n                        if (gameState.timeElapsed >= 45 && gameState.currentHalf === 1) {\n                            (window as any).handleHalfTime();\n                        }\n                        if (gameState.timeElapsed >= 90) {\n                            (window as any).handleFullTime();\n                        }\n\n                    } catch (stepError) {\n                        console.error(`Error during simulation step for match ${matchId}:`, stepError);\n                        if ((window as any).batchGameIntervalId) clearInterval((window as any).batchGameIntervalId);\n                        (window as any).batchGameIntervalId = null;\n                        reject(stepError);\n                        return;\n                    }\n\n                    if (gameState.status === 'finished') {\n                        if ((window as any).batchGameIntervalId) clearInterval((window as any).batchGameIntervalId);\n                        (window as any).batchGameIntervalId = null;\n\n                        Object.assign(window, {\n                            renderGame: originals.renderGame,\n                            updateGameUI: originals.updateGameUI,\n                            render: originals.render,\n                            drawPitchBackground: originals.drawPitchBackground,\n                            introRenderLoop: originals.introRenderLoop,\n                            setupKickOff: originals.setupKickOff,\n                            handleHalfTime: originals.handleHalfTime,\n                            handleFullTime: originals.handleFullTime,\n                            showGoalAnimation: originals.showGoalAnimation,\n                            createGoalExplosion: originals.createGoalExplosion\n                        });\n                        GAME_LOOP.GAME_SPEED = originals.gameSpeed;\n                        if (gameState.contexts) gameState.contexts.game = originals.gameContext ?? null;\n\n                        if ((window as any).DEBUG_BATCH_SIM) {\n                            console.log(`[BatchSim] Restored rendering functions for match ${matchId}`);\n                        }\n\n                        const homePassAcc = ((gameState.stats.home as any).passesAttempted || 0) > 0 ? Math.round(((gameState.stats.home as any).passesCompleted / (gameState.stats.home as any).passesAttempted) * 100) : 0;\n                        const awayPassAcc = ((gameState.stats.away as any).passesAttempted || 0) > 0 ? Math.round(((gameState.stats.away as any).passesCompleted / (gameState.stats.away as any).passesAttempted) * 100) : 0;\n                        const result: MatchResult = {\n                            matchId: matchId, homeTeam: homeTeam, awayTeam: awayTeam,\n                            homeScore: gameState.homeScore ?? 0, awayScore: gameState.awayScore ?? 0,\n                            homeXG: ((gameState.stats.home as any).xGTotal || 0).toFixed(2), awayXG: ((gameState.stats.away as any).xGTotal || 0).toFixed(2),\n                            homePossession: (gameState.stats.home as any).possession || 0, awayPossession: (gameState.stats.away as any).possession || 0,\n                            homeShots: ((gameState.stats.home as any).shotsOnTarget || 0) + ((gameState.stats.home as any).shotsOffTarget || 0),\n                            awayShots: ((gameState.stats.away as any).shotsOnTarget || 0) + ((gameState.stats.away as any).shotsOffTarget || 0),\n                            homeShotsOnTarget: (gameState.stats.home as any).shotsOnTarget || 0, awayShotsOnTarget: (gameState.stats.away as any).shotsOnTarget || 0,\n                            homePassAccuracy: homePassAcc, awayPassAccuracy: awayPassAcc,\n                            winner: (gameState.homeScore ?? 0) > (gameState.awayScore ?? 0) ? homeTeam : (gameState.awayScore ?? 0) > (gameState.homeScore ?? 0) ? awayTeam : 'Draw',\n                            goalEvents: [...((gameState as any).goalEvents || [])], cardEvents: [...((gameState as any).cardEvents || [])]\n                        };\n                        resolve(result);\n                    }\n                };\n\n                const intervalTime = 5;\n                (window as any).batchGameIntervalId = setInterval(simulationStep, intervalTime);\n\n            } catch (setupError) {\n                console.error(`Error setting up simulation for match ${matchId}:`, setupError);\n                Object.assign(window, {\n                    renderGame: originals.renderGame, updateGameUI: originals.updateGameUI, render: originals.render,\n                    drawPitchBackground: originals.drawPitchBackground, introRenderLoop: originals.introRenderLoop,\n                    setupKickOff: originals.setupKickOff, handleHalfTime: originals.handleHalfTime, handleFullTime: originals.handleFullTime,\n                    showGoalAnimation: originals.showGoalAnimation, createGoalExplosion: originals.createGoalExplosion\n                });\n                GAME_LOOP.GAME_SPEED = originals.gameSpeed;\n                if (gameState.contexts) gameState.contexts.game = originals.gameContext ?? null;\n                reject(setupError);\n            }\n        });\n    },\n\n    showSimulationScreen() {\n        const app = document.getElementById('app');\n        if (!app) return;\n\n        this.injectStyles();\n\n        app.innerHTML = `\n            <div class=\"container\" style=\"padding: 40px; max-width: 800px; margin: auto;\">\n                <h1 style=\"text-align: center; font-size: 32px; margin-bottom: 10px; color: #fff; font-weight: 800; text-shadow: 0 2px 4px rgba(0,0,0,0.5);\">\n                    LIVE SIMULATION\n                </h1>\n\n                <div id=\"toggle-container\" style=\"max-width: 800px; margin: -10px auto 20px; text-align: right; padding-right: 20px;\"></div>\n\n                <p style=\"text-align: center; font-size: 16px; margin-bottom: 30px; color: #eee; text-shadow: 0 1px 3px rgba(0,0,0,0.5);\">\n                    Matches are being simulated... <span id=\"progress-indicator\"></span>\n                </p>\n\n                <div id=\"simulation-match-list\" class=\"simulation-container\">\n                    ${this.matchList.map(match => match ? this.renderMatchCard(match) : '').join('')}\n                </div>\n\n                <div id=\"simulation-controls\" style=\"text-align: center; margin-top: 40px; display: none;\">\n                    <button onclick=\"CustomFixtureSimulator.backToSetup()\" class=\"btn\" style=\"padding: 18px 40px; font-size: 16px; background: #10b981; box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);\">\n                        \uD83D\uDD04 Run New Batch Simulation\n                    </button>\n                    <button onclick=\"CustomFixtureSimulator.exportResults()\" class=\"btn\" style=\"margin-left: 15px; padding: 18px 40px; font-size: 16px; background: #3b82f6; box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);\">\n                        \uD83D\uDCBE Export Results (JSON)\n                    </button>\n                </div>\n            </div>\n        `;\n\n        const toggleContainer = document.getElementById('toggle-container');\n        if (toggleContainer) {\n            const toggleBtn = document.createElement('button');\n            toggleBtn.id = 'orientationToggleBtn';\n\n            toggleBtn.style.background = 'rgba(255,255,255,0.1)';\n            toggleBtn.style.border = '1px solid rgba(255,255,255,0.2)';\n            toggleBtn.style.color = 'white';\n            toggleBtn.style.padding = '5px 10px';\n            toggleBtn.style.borderRadius = '5px';\n            toggleBtn.style.cursor = 'pointer';\n            toggleBtn.style.fontSize = '10px';\n            toggleBtn.style.opacity = '0.5';\n            toggleBtn.style.transition = 'opacity 0.3s';\n\n            if (typeof gameState !== 'undefined') {\n                toggleBtn.innerText = (gameState as any).isVertical ? 'View: Horizontal' : 'View: Vertical';\n            } else {\n                toggleBtn.innerText = 'View: Vertical';\n            }\n\n            toggleBtn.onmouseover = () => toggleBtn.style.opacity = '1';\n            toggleBtn.onmouseout = () => toggleBtn.style.opacity = '0.5';\n\n            if (typeof (window as any).toggleOrientation === 'function') {\n                toggleBtn.addEventListener('click', (window as any).toggleOrientation);\n            }\n\n            toggleContainer.innerHTML = '';\n            toggleContainer.appendChild(toggleBtn);\n        }\n\n        this.updateProgressIndicator();\n    },\n\n    renderMatchCard(match: Match) {\n        if (!match || !match.id || !match.homeTeam || !match.awayTeam) {\n            console.error(\"Invalid match data provided to renderMatchCard:\", match);\n            return '<div class=\"match-card-live error\">Invalid Match Data</div>';\n        }\n        const homeLogo = (gameState.teamLogos && gameState.teamLogos[match.homeTeam]) || '';\n        const awayLogo = (gameState.teamLogos && gameState.teamLogos[match.awayTeam]) || '';\n\n        return `\n            <div class=\"match-card-live\" id=\"match-card-${match.id}\">\n                <div class=\"mc-header\">\n                    <div class=\"mc-team home\">\n                        <span class=\"mc-team-name\">${match.homeTeam}</span>\n                        <img src=\"${homeLogo}\" class=\"mc-team-logo\" alt=\"${match.homeTeam} logo\" onerror=\"this.style.display='none'\">\n                    </div>\n                    <div class=\"mc-score\" id=\"score-${match.id}\">\n                        <div class=\"mc-score-pending\">\n                            <div class=\"spinner\"></div>\n                        </div>\n                    </div>\n                    <div class=\"mc-team away\">\n                        <img src=\"${awayLogo}\" class=\"mc-team-logo\" alt=\"${match.awayTeam} logo\" onerror=\"this.style.display='none'\">\n                        <span class=\"mc-team-name\">${match.awayTeam}</span>\n                    </div>\n                </div>\n                <div class=\"mc-body\" id=\"body-${match.id}\">\n                    </div>\n            </div>\n        `;\n    },\n\n    updateMatchCard(result: MatchResult) {\n        if (!result || !result.matchId) return;\n\n        const card = document.getElementById(`match-card-${result.matchId}`);\n        const scoreEl = document.getElementById(`score-${result.matchId}`);\n        const bodyEl = document.getElementById(`body-${result.matchId}`);\n\n        if (!card || !scoreEl || !bodyEl) {\n            console.warn(`Elements for match card ${result.matchId} not found.`);\n            return;\n        }\n\n        scoreEl.innerHTML = `\n            <div class=\"mc-score-final\">\n                <span class=\"home-score ${result.homeScore > result.awayScore ? 'win' : ''}\">${result.homeScore}</span>\n                <span class=\"separator\">-</span>\n                <span class=\"away-score ${result.awayScore > result.homeScore ? 'win' : ''}\">${result.awayScore}</span>\n            </div>\n        `;\n\n        const allEvents = [\n            ...(result.goalEvents || []).map(e => ({ ...e, type: 'goal' })),\n            ...(result.cardEvents || []).map(e => ({ ...e, type: 'card' }))\n        ];\n\n        const homeEventsHTML = this._groupEventsByPlayer(allEvents, 'home');\n        const awayEventsHTML = this._groupEventsByPlayer(allEvents, 'away');\n\n        if (homeEventsHTML.length > 0 || awayEventsHTML.length > 0) {\n            bodyEl.innerHTML = `\n                <div class=\"mc-events-container\">\n                    <div class=\"mc-events-list home\">\n                        ${homeEventsHTML}\n                    </div>\n                    <div class=\"mc-events-list away\">\n                        ${awayEventsHTML}\n                    </div>\n                </div>\n            `;\n        }\n        this.updateProgressIndicator();\n    },\n\n    _groupEventsByPlayer(allEvents: any[], teamName: string) {\n        if (!Array.isArray(allEvents)) return '';\n        const playerMap: { [key: string]: { time: number; icon: string }[] } = {};\n\n        const teamEvents = allEvents.filter(e => e && (e.isHome === (teamName === 'home')));\n\n        for (const event of teamEvents) {\n            let playerName = ''; let icon = '';\n\n            if (event.type === 'goal') { playerName = event.scorer; icon = '\u26BD\uFE0F'; }\n            else if (event.type === 'card') { playerName = event.player; icon = event.card === 'yellow' ? '\uD83D\uDFE8' : '\uD83D\uDFE5'; }\n\n            if (!playerName) continue;\n\n            if (!playerMap[playerName]) playerMap[playerName] = [];\n            playerMap[playerName]!.push({ time: event.time ?? 0, icon: icon });\n        }\n\n        const summaryLines: string[] = [];\n        const sortedPlayerNames = Object.keys(playerMap).sort();\n\n        for (const playerName of sortedPlayerNames) {\n            const playerEvents = playerMap[playerName];\n            if (playerEvents) {\n                playerEvents.sort((a, b) => a.time - b.time);\n                const eventStrings = playerEvents.map(e => `${e.icon} '${e.time ?? ''}`).join(', ');\n\n                summaryLines.push(`\n                    <div class=\"mc-event-item\">\n                        <span class=\"mc-event-player\">${playerName}</span>\n                        <span class=\"mc-event-time\">(${eventStrings})</span>\n                    </div>\n                `);\n            }\n        }\n        return summaryLines.join('');\n    },\n\n    highlightMatchCard(matchId: number, state: 'playing' | 'finished' | 'error') {\n        if (!matchId) return;\n        const card = document.getElementById(`match-card-${matchId}`);\n        if (!card) return;\n\n        card.classList.remove('playing', 'finished', 'error');\n        if (state === 'playing') card.classList.add('playing');\n        else if (state === 'finished') card.classList.add('finished');\n        else if (state === 'error') card.classList.add('error');\n\n        this.updateProgressIndicator();\n    },\n\n    updateProgressIndicator() {\n        const indicator = document.getElementById('progress-indicator');\n        if (indicator) {\n            const totalMatches = this.matchList.length;\n            const finishedMatches = this.results.length;\n            indicator.textContent = `(${finishedMatches}/${totalMatches} completed)`;\n        }\n    },\n\n    showCompletionControls() {\n        const controls = document.getElementById('simulation-controls');\n        if (controls) controls.style.display = 'block';\n    },\n\n    injectStyles() {\n        let style = document.getElementById('batch-sim-styles');\n        if (style) return;\n\n        style = document.createElement('style');\n        style.id = 'batch-sim-styles';\n        style.innerHTML = `\n            body.simulating { overflow: hidden; }\n            .simulation-container { display: grid; grid-template-columns: 1fr; gap: 20px; }\n            .match-card-live { background: rgba(31, 41, 55, 0.75); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-radius: 16px; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4); overflow: hidden; transition: all 0.3s ease; opacity: 0.6; }\n            .match-card-live.playing { opacity: 1; border-color: #3b82f6; box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }\n            .match-card-live.finished { opacity: 0.9; border-color: rgba(16, 185, 129, 0.4); }\n            .match-card-live.error { opacity: 0.7; border-color: #ef4444; }\n            .mc-header { display: flex; align-items: center; justify-content: space-between; padding: 18px 20px; background: rgba(0, 0, 0, 0.2); border-bottom: 1px solid rgba(255, 255, 255, 0.1); }\n            .mc-team { display: flex; align-items: center; gap: 12px; flex: 1; min-width: 0; } .mc-team.home { justify-content: flex-start; } .mc-team.away { justify-content: flex-end; }\n            .mc-team-name { font-size: 18px; font-weight: 700; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; } .mc-team.away .mc-team-name { text-align: right; }\n            .mc-team-logo { width: 32px; height: 32px; object-fit: contain; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }\n            .mc-score { margin: 0 15px; min-width: 90px; text-align: center; }\n            .mc-score-pending { font-size: 20px; font-weight: 700; color: #777; display: flex; justify-content: center; align-items: center; height: 36px; }\n            .mc-score-final { font-family: 'Inter', sans-serif; font-size: 30px; font-weight: 900; color: #fff; display: flex; justify-content: center; align-items: center; gap: 8px; animation: fadeInScore 0.5s ease; height: 36px; }\n            @keyframes fadeInScore { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }\n            .mc-score-final .separator { color: #888; font-weight: 700; font-size: 24px; } .mc-score-final .win { color: #f59e0b; }\n            .mc-body { padding: 15px 20px 20px 20px; height: auto; min-height: 60px; overflow-y: auto; animation: fadeInBody 0.8s ease 0.2s; animation-fill-mode: backwards; border-top: 1px solid rgba(255,255,255,0.05); }\n            @keyframes fadeInBody { from { opacity: 0; } to { opacity: 1; } }\n            .mc-no-events { font-size: 12px; color: #888; text-align: center; padding-top: 10px; }\n            .mc-events-container { display: flex; justify-content: space-between; gap: 15px; margin-bottom: 10px; max-height: 80px; overflow-y: auto; padding-right: 5px; }\n            .mc-events-list { flex: 1; display: flex; flex-direction: column; gap: 5px; max-width: 48%; }\n            .mc-event-item { display: flex; align-items: center; justify-content: space-between; font-size: 12px; color: #ccc; font-weight: 500; line-height: 1.4; overflow: hidden; white-space: nowrap; }\n            .mc-event-player { font-weight: 600; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1; min-width: 0; text-align: left; }\n            .mc-events-list.away .mc-event-player { text-align: left; }\n            .mc-event-time { font-size: 11px; color: #888; font-weight: 700; white-space: nowrap; flex-shrink: 0; margin-left: 5px; }\n            .mc-events-container::-webkit-scrollbar { width: 4px; }\n            .mc-events-container::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 4px; }\n            .mc-events-container::-webkit-scrollbar-track { background: transparent; }\n            .mc-body::-webkit-scrollbar { width: 4px; }\n            .mc-body::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 4px; }\n            .mc-body::-webkit-scrollbar-track { background: transparent; }\n            .spinner { width: 18px; height: 18px; border: 3px solid rgba(255, 255, 255, 0.2); border-top-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; margin: auto; }\n            @keyframes spin { to { transform: rotate(360deg); } }\n            .match-item:hover { background: rgba(255,255,255,0.1); }\n            .match-item button:hover { background: rgba(239, 68, 68, 0.4); }\n        `;\n        document.head.appendChild(style);\n    },\n\n    exportResults() {\n        if (this.results.length === 0) {\n            alert(\"\u26A0\uFE0F No results to export yet.\");\n            return;\n        }\n        const jsonData = JSON.stringify(this.results, null, 2);\n        const blob = new Blob([jsonData], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `batch_simulation_results_${new Date().toISOString().split('T')[0]}.json`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n        console.log(\"\uD83D\uDCBE Results exported as JSON.\");\n    },\n\n    cancel() {\n        this.isRunning = false;\n        if ((window as any).batchGameIntervalId) {\n            clearInterval((window as any).batchGameIntervalId);\n            (window as any).batchGameIntervalId = null;\n        }\n        console.log(\"\uD83D\uDED1 Batch simulation cancelled.\");\n        this.backToSetup();\n    },\n\n    backToSetup() {\n        this.isRunning = false;\n        this.matchList = [];\n        this.results = [];\n        if ((window as any).batchGameIntervalId) {\n            clearInterval((window as any).batchGameIntervalId);\n            (window as any).batchGameIntervalId = null;\n        }\n        if (typeof gameState !== 'undefined') {\n            gameState.status = 'setup';\n            if (typeof (window as any).render === 'function') {\n                (window as any).render();\n            } else {\n                console.error(\"Render function not found, cannot return to setup screen visually.\");\n            }\n        } else {\n            console.error(\"gameState not found, cannot return to setup screen.\");\n        }\n    }\n};\n\nconsole.log('\u2705 batch-simulator.ts (v2.2 - Player Grouping, Robustness) loaded');\n\nif (typeof gameState !== 'undefined' && typeof (window as any).render === 'function') {\n    const originalRender = (window as any).render;\n    (window as any).render = () => {\n        originalRender();\n        if (gameState.status === 'setup' && CustomFixtureSimulator) {\n            if (document.getElementById('custom-match-list')) {\n                CustomFixtureSimulator.renderMatchList();\n            }\n        }\n    }\n}\n", "/**\r\n * Global Exports for Browser Compatibility\r\n * Exports all configuration and systems to window object\r\n *\r\n * This module ensures backward compatibility with the existing JavaScript architecture\r\n * that relies on global window object access\r\n */\r\n\r\nimport {\r\n  GAME_LOOP,\r\n  PHYSICS,\r\n  BALL_PHYSICS,\r\n  GAME_CONFIG,\r\n  POSITION_CONFIGS,\r\n  TACTICS,\r\n  TEAM_STATE_MODIFIERS,\r\n  BT_CONFIG,\r\n  FORMATIONS,\r\n  positionToRoleMap,\r\n  getRoleFromPosition,\r\n  drawGroundShadow,\r\n  toggleOrientation,\r\n  validatePhysicsRealism\r\n} from './config';\r\n\r\nimport type {\r\n  GameState\r\n} from './types';\r\n\r\nimport {\r\n  selectBestTeam,\r\n  selectBestTactic,\r\n  selectBestFormation,\r\n  initializePlayers,\r\n  getFormationPositions,\r\n  applyFormationConstraint,\r\n  getFormationPosition,\r\n  initializeGameSetup\r\n} from './gameSetup';\r\n\r\n// Phase 9: Player Vision System\r\nimport {\r\n  getVisibleTeammates\r\n} from './ai/playerVision';\r\nimport {\r\n  canPlayerActOnBall\r\n} from './ai/playerFirstTouch';\r\nimport {\r\n  selectBestAttackingMovement\r\n} from './ai/MovementPatterns';\r\n\r\n// Phase 9: First Touch System\r\nimport {\r\n  initFirstTouchStats\r\n} from './ai/playerFirstTouch';\r\n\r\n// Phase 9: Set Piece Integration\r\nimport {\r\n  ensureCorrectSetPiecePlacement,\r\n  assignSetPieceKicker,\r\n  getCornerKickPosition,\r\n  getGoalKickPosition,\r\n  positionForSetPiece_Unified,\r\n  updatePlayerAI_V2_SetPieceEnhancement,\r\n  executeSetPiece_PostExecution\r\n} from './setpieces/integration';\r\nimport {\r\n  configureSetPieceRoutines,\r\n  executeSetPiece_PreConfiguration\r\n} from './setpieces/config';\r\nimport {\r\n  executeSetPiece_Router\r\n} from './setpieces/execution';\r\n\r\n// Phase 10: UI Components and Main Functions (for dynamic onclick handlers)\r\nimport {\r\n  switchSummaryTab\r\n} from './ui/uiComponents';\r\nimport {\r\n  switchSimulationMode,\r\n  addMatchToBatch\r\n} from './ui/uiScreens';\r\nimport {\r\n  CustomFixtureSimulator\r\n} from './batch-simulator';\r\nimport {\r\n  startMatch,\r\n  resetMatch,\r\n  handleFileUpload\r\n} from './main';\r\n\r\n// ============================================================================\r\n// GLOBAL TYPE DECLARATIONS\r\n// ============================================================================\r\n\r\ndeclare global {\r\n  interface Window {\r\n    GAME_LOOP: typeof GAME_LOOP;\r\n    PHYSICS: typeof PHYSICS;\r\n    BALL_PHYSICS: typeof BALL_PHYSICS;\r\n    GAME_CONFIG: typeof GAME_CONFIG;\r\n    POSITION_CONFIGS: typeof POSITION_CONFIGS;\r\n    TACTICS: typeof TACTICS;\r\n    TEAM_STATE_MODIFIERS: typeof TEAM_STATE_MODIFIERS;\r\n    BT_CONFIG: typeof BT_CONFIG;\r\n    FORMATIONS: typeof FORMATIONS;\r\n    positionToRoleMap: typeof positionToRoleMap;\r\n    getRoleFromPosition: typeof getRoleFromPosition;\r\n    drawGroundShadow: typeof drawGroundShadow;\r\n    toggleOrientation: typeof toggleOrientation;\r\n    validatePhysicsRealism: typeof validatePhysicsRealism;\r\n    selectBestTeam: typeof selectBestTeam;\r\n    selectBestTactic: typeof selectBestTactic;\r\n    selectBestFormation: typeof selectBestFormation;\r\n    initializePlayers: typeof initializePlayers;\r\n    getFormationPositions: typeof getFormationPositions;\r\n    applyFormationConstraint: typeof applyFormationConstraint;\r\n    getFormationPosition: typeof getFormationPosition;\r\n    initializeGameSetup: typeof initializeGameSetup;\r\n    // Phase 9: Vision, First Touch, Set Piece Integration\r\n    getVisibleTeammates: typeof getVisibleTeammates;\r\n    canPlayerActOnBall: typeof canPlayerActOnBall;\r\n    selectBestAttackingMovement: typeof selectBestAttackingMovement;\r\n    initFirstTouchStats: typeof initFirstTouchStats;\r\n    ensureCorrectSetPiecePlacement: typeof ensureCorrectSetPiecePlacement;\r\n    assignSetPieceKicker: typeof assignSetPieceKicker;\r\n    getCornerKickPosition: typeof getCornerKickPosition;\r\n    getGoalKickPosition: typeof getGoalKickPosition;\r\n    executeSetPiece_PostExecution: typeof executeSetPiece_PostExecution;\r\n    positionForSetPiece_Unified: typeof positionForSetPiece_Unified;\r\n    updatePlayerAI_V2_SetPieceEnhancement: typeof updatePlayerAI_V2_SetPieceEnhancement;\r\n    configureSetPieceRoutines: typeof configureSetPieceRoutines;\r\n    executeSetPiece_PreConfiguration: typeof executeSetPiece_PreConfiguration;\r\n    executeSetPiece_Router: typeof executeSetPiece_Router;\r\n    SetPieceIntegration: {\r\n      positionForSetPiece_Unified: typeof positionForSetPiece_Unified;\r\n      updatePlayerAI_V2_SetPieceEnhancement: typeof updatePlayerAI_V2_SetPieceEnhancement;\r\n      executeSetPiece_PostExecution: typeof executeSetPiece_PostExecution;\r\n      ensureCorrectSetPiecePlacement: typeof ensureCorrectSetPiecePlacement;\r\n      configureSetPieceRoutines: typeof configureSetPieceRoutines;\r\n      executeSetPiece_Router: typeof executeSetPiece_Router;\r\n      [key: string]: any;\r\n    };\r\n    SetPieceEnforcement: any;\r\n    // Phase 10: UI Components and Main Functions (onclick handlers)\r\n    switchSummaryTab: typeof switchSummaryTab;\r\n    switchSimulationMode: typeof switchSimulationMode;\r\n    addMatchToBatch: typeof addMatchToBatch;\r\n    CustomFixtureSimulator: typeof CustomFixtureSimulator;\r\n    startMatch: typeof startMatch;\r\n    resetMatch: typeof resetMatch;\r\n    handleFileUpload: typeof handleFileUpload;\r\n    gameState: GameState;\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// GAME STATE INITIALIZATION\r\n// ============================================================================\r\n\r\n/**\r\n * Initialize global game state\r\n * Creates the central game state object if it doesn't exist\r\n */\r\nexport function initializeGameState(): GameState {\r\n  const initialState: GameState = {\r\n    status: 'upload',\r\n    players: [],\r\n    teams: [],\r\n    teamJerseys: {},\r\n    teamCoaches: {},\r\n    teamLogos: {},\r\n    homeTeam: '',\r\n    awayTeam: '',\r\n    homeFormation: '4-3-3',\r\n    awayFormation: '4-3-3',\r\n    homeTactic: 'balanced',\r\n    awayTactic: 'balanced',\r\n    homeTacticManuallySet: false,\r\n    awayTacticManuallySet: false,\r\n    homePlayers: [],\r\n    awayPlayers: [],\r\n    homeScore: 0,\r\n    awayScore: 0,\r\n    timeElapsed: 0,\r\n    currentHalf: 1,\r\n    ballPosition: { x: 400, y: 300 },\r\n    ballVelocity: { x: 0, y: 0 },\r\n    ballHeight: 0,\r\n    ballTrajectory: null,\r\n    ballHolder: null,\r\n    ballChasers: new Set(),\r\n    currentPassReceiver: null,\r\n    lastTouchedBy: null,\r\n    commentary: [],\r\n    particles: [],\r\n    stats: {\r\n      home: {\r\n        possession: 0,\r\n        possessionTime: 0,\r\n        passesCompleted: 0,\r\n        passesAttempted: 0,\r\n        shotsOnTarget: 0,\r\n        shotsOffTarget: 0,\r\n        tackles: 0,\r\n        interceptions: 0,\r\n        xGTotal: 0\r\n      },\r\n      away: {\r\n        possession: 0,\r\n        possessionTime: 0,\r\n        passesCompleted: 0,\r\n        passesAttempted: 0,\r\n        shotsOnTarget: 0,\r\n        shotsOffTarget: 0,\r\n        tackles: 0,\r\n        interceptions: 0,\r\n        xGTotal: 0\r\n      },\r\n      possession: { home: 50, away: 50 },\r\n      possessionTimer: { home: 0, away: 0 },\r\n      lastPossessionUpdate: Date.now()\r\n    },\r\n    homeDefensiveLine: 200,\r\n    awayDefensiveLine: 600,\r\n    homeTeamState: 'BALANCED',\r\n    awayTeamState: 'BALANCED',\r\n    lastTeamStateUpdate: Date.now(),\r\n    lastPossessionChange: 0,\r\n    possessionChanges: 0,\r\n    postKickOffCalmPeriod: false,\r\n    kickOffCompletedTime: 0,\r\n    totalPasses: 0,\r\n    totalShots: 0,\r\n    totalTackles: 0,\r\n    shotInProgress: false,\r\n    shooter: null,\r\n    currentShotXG: null,\r\n    fouls: 0,\r\n    yellowCards: [],\r\n    redCards: [],\r\n    lastGoalScorer: null,\r\n    goalEvents: [],\r\n    cardEvents: [],\r\n    setPiece: null,\r\n    setPieceExecuting: false,\r\n    lastControlAttempt: 0,\r\n    lastEventTime: Date.now(),\r\n    canvases: { background: null, game: null, ui: null },\r\n    contexts: { background: null, game: null, ui: null },\r\n    backgroundDrawn: false,\r\n    gameUIDisplayed: false,\r\n    summaryDrawn: false,\r\n    isVertical: false,\r\n    orientationChanged: false,\r\n    commentaryFadeTimeout: null,\r\n    offscreenPitch: null,\r\n    homeJerseyColor: '#ef4444',\r\n    awayJerseyColor: '#3b82f6',\r\n    cameraShake: 0,\r\n    _teamCacheVersion: 0\r\n  };\r\n\r\n  return initialState;\r\n}\r\n\r\n// ============================================================================\r\n// BROWSER EXPORT\r\n// ============================================================================\r\n\r\n/**\r\n * Export all configuration to window object for browser compatibility\r\n */\r\nexport function exportToWindow(): void {\r\n  if (typeof window === 'undefined') {\r\n    console.warn('\u26A0\uFE0F Not in browser environment, skipping window exports');\r\n    return;\r\n  }\r\n\r\n  // Export configuration objects\r\n  window.GAME_LOOP = window.GAME_LOOP || GAME_LOOP;\r\n  window.PHYSICS = window.PHYSICS || PHYSICS;\r\n  window.BALL_PHYSICS = window.BALL_PHYSICS || BALL_PHYSICS;\r\n  window.GAME_CONFIG = window.GAME_CONFIG || GAME_CONFIG;\r\n  window.POSITION_CONFIGS = window.POSITION_CONFIGS || POSITION_CONFIGS;\r\n  window.FORMATIONS = window.FORMATIONS || FORMATIONS;\r\n  window.TACTICS = window.TACTICS || TACTICS;\r\n  window.TEAM_STATE_MODIFIERS = window.TEAM_STATE_MODIFIERS || TEAM_STATE_MODIFIERS;\r\n  window.BT_CONFIG = window.BT_CONFIG || BT_CONFIG;\r\n\r\n  // Export functions and mappings\r\n  window.positionToRoleMap = positionToRoleMap;\r\n  window.getRoleFromPosition = getRoleFromPosition;\r\n  window.drawGroundShadow = drawGroundShadow;\r\n  window.toggleOrientation = toggleOrientation;\r\n  window.validatePhysicsRealism = validatePhysicsRealism;\r\n\r\n  // Export game setup functions\r\n  window.selectBestTeam = selectBestTeam;\r\n  window.selectBestTactic = selectBestTactic;\r\n  window.selectBestFormation = selectBestFormation;\r\n  window.initializePlayers = initializePlayers;\r\n  window.getFormationPositions = getFormationPositions;\r\n  window.applyFormationConstraint = applyFormationConstraint;\r\n  window.getFormationPosition = getFormationPosition;\r\n  window.initializeGameSetup = initializeGameSetup;\r\n\r\n  // Phase 9: Export vision, first touch, and set piece integration functions\r\n  window.getVisibleTeammates = getVisibleTeammates;\r\n  window.canPlayerActOnBall = canPlayerActOnBall;\r\n  window.selectBestAttackingMovement = selectBestAttackingMovement;\r\n  window.initFirstTouchStats = initFirstTouchStats;\r\n  window.ensureCorrectSetPiecePlacement = ensureCorrectSetPiecePlacement;\r\n  window.assignSetPieceKicker = assignSetPieceKicker;\r\n  window.getCornerKickPosition = getCornerKickPosition;\r\n  window.getGoalKickPosition = getGoalKickPosition;\r\n  window.executeSetPiece_PostExecution = executeSetPiece_PostExecution;\r\n  window.positionForSetPiece_Unified = positionForSetPiece_Unified;\r\n  window.updatePlayerAI_V2_SetPieceEnhancement = updatePlayerAI_V2_SetPieceEnhancement;\r\n  window.configureSetPieceRoutines = configureSetPieceRoutines;\r\n  window.executeSetPiece_PreConfiguration = executeSetPiece_PreConfiguration;\r\n  window.executeSetPiece_Router = executeSetPiece_Router;\r\n\r\n  // Export SetPieceIntegration object for compatibility\r\n  window.SetPieceIntegration = {\r\n    positionForSetPiece_Unified,\r\n    executeSetPiece_PreConfiguration,\r\n    updatePlayerAI_V2_SetPieceEnhancement,\r\n    executeSetPiece_PostExecution,\r\n    ensureCorrectSetPiecePlacement,\r\n    assignSetPieceKicker,\r\n    getCornerKickPosition,\r\n    getGoalKickPosition,\r\n    configureSetPieceRoutines,\r\n    executeSetPiece_Router\r\n  };\r\n\r\n  // Phase 10: Export UI components and main functions for dynamic onclick handlers\r\n  window.switchSummaryTab = switchSummaryTab;\r\n  window.switchSimulationMode = switchSimulationMode;\r\n  window.addMatchToBatch = addMatchToBatch;\r\n  window.CustomFixtureSimulator = CustomFixtureSimulator;\r\n  window.startMatch = startMatch;\r\n  window.resetMatch = resetMatch;\r\n  window.handleFileUpload = handleFileUpload;\r\n\r\n  // Initialize game state if it doesn't exist\r\n  if (typeof window.gameState === 'undefined') {\r\n    window.gameState = initializeGameState();\r\n    console.log('\u2713 Game state initialized (TypeScript)');\r\n  }\r\n\r\n  // Validate physics realism in development\r\n  if (window.location.hostname === 'localhost') {\r\n    validatePhysicsRealism();\r\n  }\r\n\r\n  console.log('\u2705 Configuration exported to window (TypeScript)');\r\n}\r\n\r\n// Auto-export to window when module loads\r\nexportToWindow();\r\n\r\n// Export gameState for direct TypeScript module imports\r\nexport const gameState: GameState = typeof window !== 'undefined' && window.gameState\r\n  ? window.gameState\r\n  : initializeGameState();\r\n", "/**\r\n * @migrated-from js/SetPieceBehaviorSystem.js\r\n *\r\n * Professional Set Piece Behavior System v6.0\r\n * Champions League Grade Tactical AI - ENHANCED EDITION\r\n *\r\n * Key Improvements v6.0:\r\n * 1. Position-specific tactical intelligence (defenders defend, attackers attack)\r\n * 2. Ball possession awareness - dynamic positioning based on team having ball\r\n * 3. Professional spacing and movement patterns matching real football\r\n * 4. Enhanced throw-in tactical system with position-based roles\r\n * 5. Improved corner and free kick variations with attacking mentality\r\n * 6. Formation-aware positioning - players maintain team shape\r\n * 7. Context-aware decision making based on game state and position\r\n *\r\n * @module behavior/setPieceBehavior\r\n */\r\n\r\nimport type { Player, GameState, Vector2D } from '../types';\r\nimport {\r\n  sanitizePosition,\r\n  getValidPlayers,\r\n  getSortedLists,\r\n  isPlayerAttacking,\r\n  determineSetPieceTeam,\r\n  getFormationAwarePosition,\r\n  checkAndAdjustOffsidePosition,\r\n  checkAndAdjustOffsidePositionWithAudit,\r\n  PenaltyKickBehaviors,\r\n  KickoffBehaviors,\r\n  ThrowInBehaviors,\r\n  ProfessionalCornerBehaviors,\r\n  ProfessionalGoalKickBehaviors,\r\n  ProfessionalFreeKickBehaviors\r\n} from '../setpieces';\r\nimport type { PositionWithMovement } from '../setpieces/utils';\r\nimport { GAME_CONFIG } from '../config';\r\nimport { getAttackingGoalX, isSetPieceStatus } from '../utils/ui';\r\nimport { getPlayerActivePosition } from '../ai/movement';\r\nimport { distance as getDistance } from '../utils/math';\r\n\r\n// ============================================================================\r\n// CONFIGURATION\r\n// ============================================================================\r\n\r\nconst activeConfig = GAME_CONFIG;\r\n\r\nconst SET_PIECE_TYPES = {\r\n  CORNER_KICK: 'CORNER_KICK',\r\n  FREE_KICK: 'FREE_KICK',\r\n  THROW_IN: 'THROW_IN',\r\n  GOAL_KICK: 'GOAL_KICK',\r\n  PENALTY: 'PENALTY',\r\n  KICK_OFF: 'KICK_OFF'\r\n} as const;\r\n\r\nconst PITCH_WIDTH = activeConfig.PITCH_WIDTH;\r\nconst PITCH_HEIGHT = activeConfig.PITCH_HEIGHT;\r\n\r\n// ============================================================================\r\n// MAIN FUNCTIONS\r\n// ============================================================================\r\n\r\nfunction handleGoalkeeperSetPiecePosition(\r\n  player: Player,\r\n  gameState: GameState,\r\n  setPieceType: string,\r\n  isAttacking: boolean,\r\n  ownGoalX: number,\r\n  setPiecePos: Vector2D\r\n): PositionWithMovement {\r\n  try {\r\n    const opponentGoalX = getAttackingGoalX(player.isHome, gameState.currentHalf);\r\n\r\n    switch (setPieceType) {\r\n      case SET_PIECE_TYPES.CORNER_KICK:\r\n        if (!isAttacking) {\r\n          const isRightCorner = setPiecePos.y < (PITCH_HEIGHT / 2);\r\n          const gkY = isRightCorner ? activeConfig.GOAL_Y_TOP + 50 : activeConfig.GOAL_Y_BOTTOM - 50;\r\n          return sanitizePosition({ x: ownGoalX, y: gkY, movement: 'gk_corner_positioning', role: 'GK' }, { player });\r\n        }\r\n        break;\r\n\r\n      case SET_PIECE_TYPES.FREE_KICK:\r\n        if (!isAttacking) {\r\n          const offsetY = setPiecePos.y > 300 ? -20 : 20;\r\n          return sanitizePosition({ x: ownGoalX, y: 300 + offsetY, movement: 'gk_fk_positioning', role: 'GK' }, { player });\r\n        }\r\n        break;\r\n\r\n      case SET_PIECE_TYPES.PENALTY:\r\n        return PenaltyKickBehaviors.getPenaltyArcPosition(player, setPiecePos, isAttacking, gameState);\r\n\r\n      case SET_PIECE_TYPES.GOAL_KICK:\r\n        const teammates = getValidPlayers(player.isHome ? gameState.homePlayers : gameState.awayPlayers);\r\n        const opponents = getValidPlayers(player.isHome ? gameState.awayPlayers : gameState.homePlayers);\r\n        const teamTactic = player.isHome ? gameState.homeTactic : gameState.awayTactic;\r\n\r\n        return isAttacking ?\r\n          ProfessionalGoalKickBehaviors.getGoalKickPosition(player, ownGoalX, teamTactic, true, gameState, teammates) :\r\n          ProfessionalGoalKickBehaviors.getDefendingGoalKickPosition(player, opponentGoalX, ownGoalX, gameState, opponents, teammates);\r\n    }\r\n\r\n    return sanitizePosition({ x: ownGoalX, y: 300, movement: 'gk_default' }, { player });\r\n  } catch (error) {\r\n    console.error(`GK positioning error:`, error);\r\n    const fallbackGoalX = getAttackingGoalX(!player.isHome, gameState?.currentHalf ?? 1);\r\n    return sanitizePosition({ x: fallbackGoalX, y: 300, movement: 'gk_error' }, { player });\r\n  }\r\n}\r\n\r\nfunction getSafeFallbackPosition(player: Player, reason: string, gameState: GameState | null | undefined): PositionWithMovement {\r\n  const activePos = getPlayerActivePosition(player, gameState?.currentHalf ?? 1);\r\n  return sanitizePosition(\r\n    { x: activePos?.x ?? PITCH_WIDTH / 2, y: activePos?.y ?? PITCH_HEIGHT / 2, movement: `fallback_${reason}` },\r\n    { player, behavior: 'Fallback' }\r\n  );\r\n}\r\n\r\nfunction calculateSetPiecePositionWithSafety(\r\n  player: Player,\r\n  gameState: GameState,\r\n  setPieceType: string,\r\n  isAttacking: boolean,\r\n  setPiecePos: Vector2D\r\n): PositionWithMovement {\r\n  const ownGoalX = getAttackingGoalX(!player.isHome, gameState.currentHalf);\r\n  const opponentGoalX = getAttackingGoalX(player.isHome, gameState.currentHalf);\r\n  const teammates = getValidPlayers(player.isHome ? gameState.homePlayers : gameState.awayPlayers);\r\n  const opponents = getValidPlayers(player.isHome ? gameState.awayPlayers : gameState.homePlayers);\r\n\r\n  try {\r\n    switch (setPieceType) {\r\n      case SET_PIECE_TYPES.FREE_KICK:\r\n        const distToGoal = getDistance(setPiecePos, { x: (isAttacking ? opponentGoalX : ownGoalX), y: 300 });\r\n        return isAttacking ?\r\n          ProfessionalFreeKickBehaviors.getAttackingFreeKickPosition(player, setPiecePos, opponentGoalX, distToGoal, null, gameState, teammates) :\r\n          ProfessionalFreeKickBehaviors.getDefendingFreeKickPosition(player, setPiecePos, ownGoalX, distToGoal, null, opponents, gameState, teammates);\r\n\r\n      case SET_PIECE_TYPES.CORNER_KICK:\r\n        return isAttacking ?\r\n          ProfessionalCornerBehaviors.getAttackingCornerPosition(player, setPiecePos, opponentGoalX, teammates, null, (gameState.setPiece as any)?.routine, gameState) :\r\n          ProfessionalCornerBehaviors.getDefendingCornerPosition(player, setPiecePos, ownGoalX, opponents, null, (gameState.setPiece as any)?.defensiveSystem, gameState, teammates);\r\n\r\n      case SET_PIECE_TYPES.THROW_IN:\r\n        return ThrowInBehaviors.getThrowInPosition(player, setPiecePos, ownGoalX, opponentGoalX, gameState, teammates, opponents);\r\n\r\n      case SET_PIECE_TYPES.GOAL_KICK:\r\n        const teamTactic = player.isHome ? gameState.homeTactic : gameState.awayTactic;\r\n        return isAttacking ?\r\n          ProfessionalGoalKickBehaviors.getGoalKickPosition(player, ownGoalX, teamTactic, true, gameState, teammates) :\r\n          ProfessionalGoalKickBehaviors.getDefendingGoalKickPosition(player, opponentGoalX, ownGoalX, gameState, opponents, teammates);\r\n\r\n      case SET_PIECE_TYPES.PENALTY:\r\n        if (isAttacking && gameState.setPiece) {\r\n          const isKicker = gameState.setPiece.kicker && String(gameState.setPiece.kicker.id) === String(player.id);\r\n          if (isKicker) {\r\n            return PenaltyKickBehaviors.getKickerPosition(setPiecePos);\r\n          }\r\n        }\r\n        return PenaltyKickBehaviors.getPenaltyArcPosition(player, setPiecePos, isAttacking, gameState);\r\n\r\n      case SET_PIECE_TYPES.KICK_OFF:\r\n        if (typeof KickoffBehaviors !== 'undefined' && gameState.setPiece) {\r\n          const kickingTeamIsHome = typeof gameState.setPiece.team === 'boolean'\r\n            ? gameState.setPiece.team\r\n            : gameState.setPiece.team === 'home';\r\n          const isKickingTeam = player.isHome === kickingTeamIsHome;\r\n          return KickoffBehaviors.getKickoffPosition(player, setPiecePos, isKickingTeam, gameState);\r\n        }\r\n        // Fallback if KickoffBehaviors not loaded\r\n        return sanitizePosition({ x: player.x, y: player.y, movement: 'kickoff_fallback', role: player.role }, { player, gameState });\r\n\r\n      default:\r\n        return getSafeFallbackPosition(player, `unknown_type_${setPieceType}`, gameState);\r\n    }\r\n  } catch (error) {\r\n    console.error(`Set piece calculation error:`, error);\r\n    return getSafeFallbackPosition(player, `calculation_error`, gameState);\r\n  }\r\n}\r\n\r\nfunction getSetPiecePosition(player: Player, gameState: GameState): PositionWithMovement {\r\n  try {\r\n    if (!gameState || !player || !gameState.setPiece || !gameState.setPiece.position) {\r\n      return getSafeFallbackPosition(player, 'invalid_state', gameState);\r\n    }\r\n\r\n    const setPieceType = gameState.status;\r\n    const isAttacking = isPlayerAttacking(player, gameState);\r\n    const setPiecePos = gameState.setPiece.position;\r\n\r\n    if (player.role === 'GK' || (player.role as string) === 'goalkeeper') {\r\n      const ownGoalX = getAttackingGoalX(!player.isHome, gameState.currentHalf);\r\n      return handleGoalkeeperSetPiecePosition(player, gameState, setPieceType, isAttacking, ownGoalX, setPiecePos);\r\n    }\r\n\r\n    let position = calculateSetPiecePositionWithSafety(player, gameState, setPieceType, isAttacking, setPiecePos);\r\n\r\n    // Apply formation-aware positioning discipline\r\n    position = getFormationAwarePosition(player, position, gameState, isAttacking);\r\n\r\n    return sanitizePosition(position, {\r\n      player,\r\n      setPieceType,\r\n      behavior: 'MainSetPieceDispatch',\r\n      role: position?.role || player?.role || 'UNKNOWN',\r\n      gameState\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Critical error in getSetPiecePosition:', error);\r\n    return getSafeFallbackPosition(player, 'critical_error', gameState);\r\n  }\r\n}\r\n\r\nfunction shouldLockSetPiecePosition(player: Player, gameState: GameState | null | undefined): boolean {\r\n  if (!gameState || !player || !gameState.setPiece) return false;\r\n\r\n  // SPECIAL CASE: KICKOFF - ALL players must be locked in position\r\n  // until execution to enforce the \"players in own half\" rule\r\n  if (gameState.status === 'KICK_OFF') {\r\n    return true; // Lock everyone during kickoff setup\r\n  }\r\n\r\n  const movement = (player as any).setPieceMovement || getSetPieceMovementType(player, gameState);\r\n  const movementLower = typeof movement === 'string' ? movement.toLowerCase() : '';\r\n\r\n  const lockKeywords = ['kicker', 'thrower', 'wall'];\r\n  if (lockKeywords.some(keyword => movementLower.includes(keyword))) {\r\n    return getDistance(player, gameState.setPiece.position) < 15;\r\n  }\r\n\r\n  if (!gameState.setPiece.executionTime) return false;\r\n  const timeUntilExecution = gameState.setPiece.executionTime - Date.now();\r\n  return timeUntilExecution < 1500 && timeUntilExecution > -500;\r\n}\r\n\r\nfunction getSetPieceMovementType(player: Player, gameState: GameState | null | undefined): string {\r\n  if (!gameState || !player) return 'standard_position';\r\n  if ((player as any).setPieceMovement) return (player as any).setPieceMovement;\r\n\r\n  const position = getSetPiecePosition(player, gameState);\r\n  const movement = (position as any)?.movement || 'standard_position';\r\n  (player as any).setPieceMovement = movement;\r\n  return movement;\r\n}\r\n\r\nfunction isSetPieceActive(gameState: GameState | null | undefined): boolean {\r\n  if (!gameState || !gameState.status) return false;\r\n\r\n  if (typeof isSetPieceStatus === 'function') {\r\n    return isSetPieceStatus(gameState.status);\r\n  }\r\n\r\n  return [\r\n    SET_PIECE_TYPES.CORNER_KICK,\r\n    SET_PIECE_TYPES.FREE_KICK,\r\n    SET_PIECE_TYPES.THROW_IN,\r\n    SET_PIECE_TYPES.GOAL_KICK,\r\n    SET_PIECE_TYPES.PENALTY,\r\n    SET_PIECE_TYPES.KICK_OFF\r\n  ].includes(gameState.status as any);\r\n}\r\n\r\n// ============================================================================\r\n// EXPORTS\r\n// ============================================================================\r\n\r\nexport const SetPieceBehaviorSystem = {\r\n  getSetPiecePosition,\r\n  shouldLockSetPiecePosition,\r\n  getSetPieceMovementType,\r\n  isSetPieceActive,\r\n  checkAndAdjustOffsidePosition,\r\n  checkAndAdjustOffsidePositionWithAudit,\r\n  ProfessionalCornerBehaviors,\r\n  ProfessionalFreeKickBehaviors,\r\n  ThrowInBehaviors,\r\n  ProfessionalGoalKickBehaviors,\r\n  PenaltyKickBehaviors,\r\n  KickoffBehaviors: typeof KickoffBehaviors !== 'undefined' ? KickoffBehaviors : null,\r\n  SET_PIECE_TYPES,\r\n  determineSetPieceTeam,\r\n  isPlayerAttacking,\r\n  getFormationAwarePosition,\r\n  sanitizePosition,\r\n  getSafeFallbackPosition,\r\n  handleGoalkeeperSetPiecePosition,\r\n  calculateSetPiecePositionWithSafety,\r\n  getValidPlayers,\r\n  getSortedLists\r\n};\r\n\r\n// ============================================================================\r\n// BROWSER EXPORTS\r\n// ============================================================================\r\n\r\n// Functions are now exported via ES6 modules - no window exports needed\r\nconsole.log('\u2705 PROFESSIONAL SET PIECE BEHAVIOR SYSTEM v6.0 (World Class) LOADED');\r\nconsole.log('   \u2713 Formation-aware positioning');\r\nconsole.log('   \u2713 Professional throw-in system');\r\nconsole.log('   \u2713 Enhanced corner & free kick patterns');\r\nconsole.log('   \u2713 FIX #8: Registered with DependencyRegistry');\r\nconsole.log('   \u2713 FIX #12: Offside audit trail enabled');\r\nconsole.log('   \u2713 Modern goal kick build-up play');\r\n", "/**\r\n * Behavioral Dynamics Engine\r\n * @migrated-from js/BehaviorSystem.js\r\n *\r\n * Comprehensive role-based player intelligence system implementing tactical\r\n * behaviors across all phases of play. Integrates with existing AI.\r\n */\r\n\r\nimport type {\r\n  Player,\r\n  Vector2D,\r\n  GameState\r\n} from '../types';\r\nimport { distance as getDistance } from '../utils/math';\r\nimport { SetPieceBehaviorSystem } from '../setpieces/SetPieceBehaviorSystem';\r\n\r\n// ============================================================================\r\n// TYPE DEFINITIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Behavior execution result with target position and metadata\r\n */\r\nexport interface BehaviorResultSuccess {\r\n  available: true;\r\n  target: Vector2D;\r\n  speedMultiplier: number;\r\n  description: string;\r\n  shouldLock: boolean;\r\n  error: null;\r\n  duration?: number;\r\n}\r\n\r\n/**\r\n * Unavailable behavior result with reason\r\n */\r\nexport interface BehaviorResultUnavailable {\r\n  available: false;\r\n  target: null;\r\n  speedMultiplier: number;\r\n  description: string;\r\n  shouldLock: false;\r\n  error: string;\r\n  duration?: number;\r\n}\r\n\r\n/**\r\n * Union type for behavior results\r\n */\r\nexport type BehaviorResultType = BehaviorResultSuccess | BehaviorResultUnavailable;\r\n\r\n/**\r\n * Game phases for tactical behavior selection\r\n */\r\nexport type GamePhase =\r\n  | 'defensive'\r\n  | 'attacking'\r\n  | 'transition_attack'\r\n  | 'transition_defense'\r\n  | 'SET_PIECE';\r\n\r\n/**\r\n * Tactical system types\r\n */\r\nexport type TacticalSystemType =\r\n  | 'possession'\r\n  | 'high_press'\r\n  | 'counter_attack'\r\n  | 'low_block'\r\n  | 'balanced';\r\n\r\n// ============================================================================\r\n// BEHAVIOR RESULT HELPER\r\n// ============================================================================\r\n\r\n/**\r\n * Helper object for creating consistent behavior results\r\n * \u2705 FIX #9: CONSISTENT BEHAVIOR RESULT TYPE\r\n */\r\nexport const BehaviorResult = {\r\n  /**\r\n   * Create successful behavior result\r\n   */\r\n  success(\r\n    target: Vector2D,\r\n    speedMultiplier: number = 1.0,\r\n    description: string = '',\r\n    shouldLock: boolean = false\r\n  ): BehaviorResultSuccess {\r\n    return {\r\n      available: true,\r\n      target,\r\n      speedMultiplier,\r\n      description,\r\n      shouldLock,\r\n      error: null\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Create unavailable behavior result with reason\r\n   */\r\n  unavailable(reason: string = 'Conditions not met'): BehaviorResultUnavailable {\r\n    return {\r\n      available: false,\r\n      target: null,\r\n      speedMultiplier: 1.0,\r\n      description: '',\r\n      shouldLock: false,\r\n      error: reason\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Check if result is valid and available\r\n   */\r\n  isValid(result: BehaviorResultType | null): result is BehaviorResultSuccess {\r\n    return result !== null && typeof result === 'object' && result.available === true;\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// PHASE CONSTANTS\r\n// ============================================================================\r\n\r\nexport const PHASES = {\r\n  DEFENSIVE: 'defensive' as const,\r\n  ATTACKING: 'attacking' as const,\r\n  TRANSITION_TO_ATTACK: 'transition_attack' as const,\r\n  TRANSITION_TO_DEFENSE: 'transition_defense' as const\r\n};\r\n\r\n// ============================================================================\r\n// GOALKEEPER BEHAVIORS\r\n// ============================================================================\r\n\r\nexport const GoalkeeperBehaviors = {\r\n  /**\r\n   * Sweeper-keeper: Actively defend space behind high defensive line\r\n   */\r\n  sweeperKeeping(\r\n    _gk: Player,\r\n    ball: Vector2D,\r\n    teammates: Player[],\r\n    opponents: Player[],\r\n    ownGoalX: number\r\n  ): BehaviorResultSuccess | null {\r\n    const defenders = teammates.filter(t => ['CB', 'RB', 'LB'].includes(t.role as string));\r\n    if (defenders.length === 0) return null; // No defenders = no sweeping needed\r\n\r\n    const defensiveLine = Math.max(...defenders.map(t => Math.abs(t.x - ownGoalX)));\r\n\r\n    // Only sweep if defensive line is pushed high (>200 units from goal)\r\n    if (defensiveLine < 200) return null;\r\n\r\n    \r\n    const threatBehindLine = opponents.find(opp => {\r\n      const oppDistToGoal = Math.abs(opp.x - ownGoalX);\r\n      return oppDistToGoal < defensiveLine - 50 && getDistance(opp, ball) < 100;\r\n    });\r\n\r\n    if (threatBehindLine) {\r\n      const interceptPoint = {\r\n        x: ownGoalX + Math.sign(ball.x - ownGoalX) * Math.min(defensiveLine * 0.6, 180),\r\n        y: ball.y\r\n      };\r\n\r\n      return {\r\n        available: true,\r\n        target: interceptPoint,\r\n        speedMultiplier: 1.8,\r\n        description: 'sweeper-keeper intercept',\r\n        shouldLock: true,\r\n        error: null\r\n      };\r\n    }\r\n\r\n    return null;\r\n  },\r\n\r\n  /**\r\n   * Build-up play: GK as first attacker providing +1 option\r\n   */\r\n  buildUpSupport(\r\n    _gk: Player,\r\n    holder: Player | null,\r\n    _teammates: Player[],\r\n    ownGoalX: number\r\n  ): BehaviorResultSuccess | null {\r\n    if (!holder || holder.role === 'GK') return null;\r\n\r\n    const holderDistToGoal = Math.abs(holder.x - ownGoalX);\r\n\r\n    // Only support if ball is in own half\r\n    if (holderDistToGoal > 400) return null;\r\n\r\n    const safeZone = {\r\n      x: ownGoalX + Math.sign(holder.x - ownGoalX) * 80,\r\n      y: 300\r\n    };\r\n\r\n    return {\r\n      available: true,\r\n      target: safeZone,\r\n      speedMultiplier: 1.0,\r\n      description: 'GK build-up support',\r\n      shouldLock: false,\r\n      error: null\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Positioning for shot-stopping: Narrow the angle\r\n   */\r\n  angleNarrowing(\r\n    _gk: Player,\r\n    ball: Vector2D,\r\n    _shooter: Player | null,\r\n    ownGoalX: number\r\n  ): BehaviorResultSuccess {\r\n    \r\n    const goalCenter = { x: ownGoalX, y: 300 };\r\n    const ballToGoalDist = getDistance(ball, goalCenter);\r\n\r\n    // Position on line between ball and goal center\r\n    const optimalDist = Math.min(ballToGoalDist * 0.35, 60);\r\n    const angle = Math.atan2(ball.y - goalCenter.y, ball.x - goalCenter.x);\r\n\r\n    return {\r\n      available: true,\r\n      target: {\r\n        x: goalCenter.x + Math.cos(angle) * optimalDist,\r\n        y: goalCenter.y + Math.sin(angle) * optimalDist\r\n      },\r\n      speedMultiplier: 1.4,\r\n      description: 'angle narrowing',\r\n      shouldLock: true,\r\n      error: null\r\n    };\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// DEFENSIVE UNIT BEHAVIORS\r\n// ============================================================================\r\n\r\nexport const DefensiveBehaviors = {\r\n  /**\r\n   * Collective line movement: Ball-oriented shifting\r\n   */\r\n  defensiveLineShift(\r\n    player: Player,\r\n    ball: Vector2D,\r\n    teammates: Player[],\r\n    ownGoalX: number\r\n  ): BehaviorResultSuccess | null {\r\n    if (!['CB', 'RB', 'LB'].includes(player.role as string)) return null;\r\n\r\n    \r\n    const defensiveLine = teammates.filter(t =>\r\n      ['CB', 'RB', 'LB'].includes(t.role as string)\r\n    );\r\n\r\n    if (defensiveLine.length < 2) return null;\r\n\r\n    // Calculate average line position\r\n    const avgLineX = defensiveLine.reduce((sum, p) => sum + p.x, 0) / defensiveLine.length;\r\n    const targetLineX = avgLineX + (ball.y - 300) * 0.15; // Horizontal shift with ball\r\n\r\n    // Vertical position: push up or drop based on pressure\r\n    const ballPressure = Math.min(...teammates.map(t => getDistance(t, ball)));\r\n    const verticalAdjust = ballPressure < 50 ? 25 : -15; // Push up if ball under pressure\r\n\r\n    return {\r\n      available: true,\r\n      target: {\r\n        x: player.x + Math.sign(targetLineX - avgLineX) * 20 + verticalAdjust * Math.sign(ownGoalX - player.x),\r\n        y: player.y + (ball.y - player.y) * 0.2 // Shift laterally\r\n      },\r\n      speedMultiplier: 1.0,\r\n      description: 'defensive line shift',\r\n      shouldLock: false,\r\n      error: null\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Full-back covering: Prevent crosses and track wide threats\r\n   */\r\n  fullBackCovering(\r\n    fb: Player,\r\n    _ball: Vector2D,\r\n    opponents: Player[],\r\n    _ownGoalX: number\r\n  ): BehaviorResultSuccess | null {\r\n    if (!['RB', 'LB'].includes(fb.role as string)) return null;\r\n\r\n    \r\n    const isRightBack = fb.role === 'RB';\r\n    const wideThreats = opponents.filter(opp =>\r\n      (isRightBack && opp.y < 200) || (!isRightBack && opp.y > 400)\r\n    );\r\n\r\n    if (wideThreats.length === 0) return null;\r\n\r\n    const nearestThreat = wideThreats.sort((a, b) =>\r\n      getDistance(a, fb) - getDistance(b, fb)\r\n    )[0];\r\n\r\n    if (!nearestThreat) return null;\r\n\r\n    const distToThreat = getDistance(nearestThreat, fb);\r\n\r\n    // If threat is advancing with ball, close down aggressively\r\n    if (distToThreat < 150) {\r\n      const interceptAngle = Math.atan2(nearestThreat.y - fb.y, nearestThreat.x - fb.x);\r\n\r\n      return {\r\n        available: true,\r\n        target: {\r\n          x: fb.x + Math.cos(interceptAngle) * 50,\r\n          y: fb.y + Math.sin(interceptAngle) * 50\r\n        },\r\n        speedMultiplier: 1.5,\r\n        description: 'full-back pressing winger',\r\n        shouldLock: true,\r\n        error: null\r\n      };\r\n    }\r\n\r\n    return null;\r\n  },\r\n\r\n  /**\r\n   * Center-back covering and marking\r\n   */\r\n  centerBackMarking(\r\n    cb: Player,\r\n    opponents: Player[],\r\n    _teammates: Player[],\r\n    ownGoalX: number\r\n  ): BehaviorResultSuccess | null {\r\n    if (!['CB'].includes(cb.role as string)) return null;\r\n\r\n    \r\n    const strikers = opponents.filter(opp => ['ST', 'CF'].includes(opp.role as string));\r\n    if (strikers.length === 0) return null;\r\n\r\n    const nearestStriker = strikers.sort((a, b) =>\r\n      getDistance(a, cb) - getDistance(b, cb)\r\n    )[0];\r\n\r\n    if (!nearestStriker) return null;\r\n\r\n    // Maintain tight marking within danger zone\r\n    const inDangerZone = Math.abs(nearestStriker.x - ownGoalX) < 200;\r\n\r\n    if (inDangerZone) {\r\n      const markingDist = 15;\r\n      const angle = Math.atan2(nearestStriker.y - ownGoalX, nearestStriker.x - ownGoalX);\r\n\r\n      return {\r\n        available: true,\r\n        target: {\r\n          x: nearestStriker.x - Math.cos(angle) * markingDist,\r\n          y: nearestStriker.y - Math.sin(angle) * markingDist\r\n        },\r\n        speedMultiplier: 1.3,\r\n        description: 'CB tight marking',\r\n        shouldLock: true,\r\n        error: null\r\n      };\r\n    }\r\n\r\n    return null;\r\n  },\r\n\r\n  /**\r\n   * Inverted full-back: Move into central midfield during possession\r\n   */\r\n  invertedFullBack(\r\n    fb: Player,\r\n    holder: Player | null,\r\n    teammates: Player[],\r\n    ownGoalX: number\r\n  ): BehaviorResultSuccess | null {\r\n    if (!['RB', 'LB'].includes(fb.role as string)) return null;\r\n    if (!holder || holder.isHome !== fb.isHome) return null;\r\n\r\n    // Only invert when ball is in own half\r\n    const ballInOwnHalf = Math.abs(holder.x - ownGoalX) < 400;\r\n    if (!ballInOwnHalf) return null;\r\n\r\n    // Check if there's space in midfield\r\n    const midfielders = teammates.filter(t =>\r\n      ['CM', 'CDM', 'CAM'].includes(t.role as string)\r\n    );\r\n\r\n    const midFieldCongestion = midfielders.reduce((sum, m) =>\r\n      sum + (Math.abs(m.y - 300) < 100 ? 1 : 0), 0\r\n    );\r\n\r\n    if (midFieldCongestion > 2) return null;\r\n\r\n    return {\r\n      available: true,\r\n      target: {\r\n        x: ownGoalX + Math.sign(holder.x - ownGoalX) * 250,\r\n        y: 300 // Move to center\r\n      },\r\n      speedMultiplier: 1.1,\r\n      description: 'inverted full-back',\r\n      shouldLock: false,\r\n      error: null\r\n    };\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// MIDFIELD BEHAVIORS\r\n// ============================================================================\r\n\r\nexport const MidfieldBehaviors = {\r\n  /**\r\n   * Defensive midfielder screening the defense\r\n   */\r\n  cdmScreening(\r\n    cdm: Player,\r\n    ball: Vector2D,\r\n    _opponents: Player[],\r\n    teammates: Player[],\r\n    _ownGoalX: number\r\n  ): BehaviorResultSuccess | null {\r\n    if (!['CDM'].includes(cdm.role as string)) return null;\r\n\r\n    const defensiveLine = teammates.filter(t =>\r\n      ['CB', 'RB', 'LB'].includes(t.role as string)\r\n    );\r\n\r\n    if (defensiveLine.length === 0) return null;\r\n\r\n    const avgDefLineX = defensiveLine.reduce((sum, p) => sum + p.x, 0) / defensiveLine.length;\r\n\r\n    // Position between ball and defense\r\n    const screeningX = avgDefLineX + Math.sign(ball.x - avgDefLineX) * 80;\r\n    const screeningY = 300 + (ball.y - 300) * 0.4; // Shift laterally with ball\r\n\r\n    return {\r\n      available: true,\r\n      target: { x: screeningX, y: screeningY },\r\n      speedMultiplier: 1.0,\r\n      description: 'CDM screening defense',\r\n      shouldLock: false,\r\n      error: null\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Box-to-box midfielder: Late runs into penalty area\r\n   */\r\n  boxToBoxLateRun(\r\n    cm: Player,\r\n    ball: Vector2D,\r\n    holder: Player | null,\r\n    teammates: Player[],\r\n    opponentGoalX: number\r\n  ): BehaviorResultSuccess | null {\r\n    if (!['CM'].includes(cm.role as string)) return null;\r\n    if (!holder || holder.isHome !== cm.isHome) return null;\r\n\r\n    const ballInFinalThird = Math.abs(ball.x - opponentGoalX) < 250;\r\n    const alreadyForward = Math.abs(cm.x - opponentGoalX) < 180;\r\n    const playersInBox = teammates.filter(t =>\r\n      Math.abs(t.x - opponentGoalX) < 150\r\n    ).length;\r\n\r\n    if (!ballInFinalThird || alreadyForward || playersInBox > 2) return null;\r\n\r\n    return {\r\n      available: true,\r\n      target: {\r\n        x: opponentGoalX - Math.sign(opponentGoalX - 400) * 100,\r\n        y: 300 + (Math.random() - 0.5) * 120\r\n      },\r\n      speedMultiplier: 1.7,\r\n      description: 'box-to-box late run',\r\n      shouldLock: true,\r\n      error: null\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Regista/Deep-lying playmaker: Dictate tempo from deep\r\n   */\r\n  registaTempoDictation(\r\n    cm: Player,\r\n    holder: Player | null,\r\n    _teammates: Player[],\r\n    ownGoalX: number\r\n  ): BehaviorResultSuccess | null {\r\n    if (!['CM', 'CDM'].includes(cm.role as string)) return null;\r\n    if (!holder || holder.isHome !== cm.isHome) return null;\r\n\r\n    // Stay deep to provide passing options\r\n    const deepPosition = {\r\n      x: ownGoalX + Math.sign(holder.x - ownGoalX) * 200,\r\n      y: 300\r\n    };\r\n\r\n    const inDeepZone = Math.abs(cm.x - deepPosition.x) < 60;\r\n\r\n    if (inDeepZone) return null;\r\n\r\n    return {\r\n      available: true,\r\n      target: deepPosition,\r\n      speedMultiplier: 0.9,\r\n      description: 'regista deep positioning',\r\n      shouldLock: false,\r\n      error: null\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Attacking midfielder: Find pockets between the lines\r\n   */\r\n  camBetweenLines(\r\n    cam: Player,\r\n    opponents: Player[],\r\n    opponentGoalX: number\r\n  ): BehaviorResultSuccess | null {\r\n    if (!['CAM'].includes(cam.role as string)) return null;\r\n\r\n    // Find defensive and midfield lines of opposition\r\n    const oppDefenders = opponents.filter(o =>\r\n      ['CB', 'RB', 'LB', 'CDM'].includes(o.role as string)\r\n    );\r\n\r\n    if (oppDefenders.length < 2) return null;\r\n\r\n    const avgDefX = oppDefenders.reduce((sum, p) => sum + p.x, 0) / oppDefenders.length;\r\n    const pocketX = avgDefX + Math.sign(opponentGoalX - avgDefX) * 60;\r\n\r\n    return {\r\n      available: true,\r\n      target: {\r\n        x: pocketX,\r\n        y: 300 + (Math.random() - 0.5) * 80\r\n      },\r\n      speedMultiplier: 1.2,\r\n      description: 'CAM finding pocket',\r\n      shouldLock: false,\r\n      error: null\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Central midfielder pressing trigger\r\n   */\r\n  cmPressTrigger(\r\n    cm: Player,\r\n    _ball: Vector2D,\r\n    _opponents: Player[],\r\n    holder: Player | null\r\n  ): BehaviorResultSuccess | null {\r\n    if (!['CM'].includes(cm.role as string)) return null;\r\n    if (!holder || holder.isHome === cm.isHome) return null;\r\n\r\n    \r\n    // Trigger press when opposition midfielder has ball in central areas\r\n    const holderInCenter = Math.abs(holder.y - 300) < 150;\r\n    const distToHolder = getDistance(cm, holder);\r\n\r\n    if (holderInCenter && distToHolder < 80) {\r\n      return {\r\n        available: true,\r\n        target: {\r\n          x: holder.x,\r\n          y: holder.y\r\n        },\r\n        speedMultiplier: 1.6,\r\n        description: 'CM press trigger',\r\n        shouldLock: true,\r\n        error: null\r\n      };\r\n    }\r\n\r\n    return null;\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// FORWARD BEHAVIORS\r\n// ============================================================================\r\n\r\nexport const ForwardBehaviors = {\r\n  /**\r\n   * Winger: Stretch defense by staying wide\r\n   */\r\n  wingerWidthProviding(\r\n    winger: Player,\r\n    holder: Player | null,\r\n    _teammates: Player[]\r\n  ): BehaviorResultSuccess | null {\r\n    if (!['RW', 'LW', 'RM', 'LM'].includes(winger.role as string)) return null;\r\n    if (!holder || holder.isHome !== winger.isHome) return null;\r\n\r\n    const isRight = ['RW', 'RM'].includes(winger.role as string);\r\n    const targetY = isRight ? 80 : 520;\r\n    const currentlyWide = Math.abs(winger.y - targetY) < 40;\r\n\r\n    if (currentlyWide) return null;\r\n\r\n    return {\r\n      available: true,\r\n      target: {\r\n        x: winger.x + Math.sign(holder.x - winger.x) * 30,\r\n        y: targetY\r\n      },\r\n      speedMultiplier: 1.1,\r\n      description: 'winger providing width',\r\n      shouldLock: false,\r\n      error: null\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Inverted winger: Cut inside to shoot\r\n   */\r\n  invertedWingerCutInside(\r\n    winger: Player,\r\n    _ball: Vector2D,\r\n    opponentGoalX: number\r\n  ): BehaviorResultSuccess | null {\r\n    if (!['RW', 'LW'].includes(winger.role as string)) return null;\r\n\r\n    const distToGoal = Math.abs(winger.x - opponentGoalX);\r\n    const isWide = (winger.role === 'RW' && winger.y < 150) ||\r\n                   (winger.role === 'LW' && winger.y > 450);\r\n\r\n    // Cut inside when approaching final third\r\n    if (distToGoal < 280 && isWide) {\r\n      return {\r\n        available: true,\r\n        target: {\r\n          x: opponentGoalX - Math.sign(opponentGoalX - winger.x) * 100,\r\n          y: 300 + (Math.random() - 0.5) * 100\r\n        },\r\n        speedMultiplier: 1.4,\r\n        description: 'inverted winger cutting inside',\r\n        shouldLock: true,\r\n        error: null\r\n      };\r\n    }\r\n\r\n    return null;\r\n  },\r\n\r\n  /**\r\n   * Striker: Runs in behind defense\r\n   */\r\n  strikerRunsInBehind(\r\n    striker: Player,\r\n    holder: Player | null,\r\n    opponents: Player[],\r\n    opponentGoalX: number\r\n  ): BehaviorResultSuccess | null {\r\n    if (!['ST', 'CF'].includes(striker.role as string)) return null;\r\n    if (!holder || holder.isHome !== striker.isHome) return null;\r\n\r\n    \r\n    const oppDefenders = opponents.filter(o =>\r\n      ['CB', 'RB', 'LB'].includes(o.role as string)\r\n    );\r\n\r\n    if (oppDefenders.length === 0) return null;\r\n\r\n    const lastDefender = oppDefenders.sort((a, b) =>\r\n      Math.abs(b.x - opponentGoalX) - Math.abs(a.x - opponentGoalX)\r\n    )[0];\r\n\r\n    if (!lastDefender) return null;\r\n\r\n    const runTargetX = lastDefender.x + Math.sign(opponentGoalX - lastDefender.x) * 30;\r\n    const distToLastDefender = Math.abs(striker.x - lastDefender.x);\r\n\r\n    // Only make run if not already ahead and holder can see the pass\r\n    if (distToLastDefender < 20 || getDistance(holder, striker) > 250) return null;\r\n\r\n    return {\r\n      available: true,\r\n      target: {\r\n        x: runTargetX,\r\n        y: 300 + (Math.random() - 0.5) * 120\r\n      },\r\n      speedMultiplier: 1.6,\r\n      description: 'striker run in behind',\r\n      shouldLock: true,\r\n      error: null\r\n    };\r\n  },\r\n\r\n  /**\r\n   * False 9: Drop deep to create space\r\n   */\r\n  false9DropDeep(\r\n    striker: Player,\r\n    holder: Player | null,\r\n    teammates: Player[],\r\n    opponentGoalX: number\r\n  ): BehaviorResultSuccess | null {\r\n    if (!['ST', 'CF'].includes(striker.role as string)) return null;\r\n    if (!holder || holder.isHome !== striker.isHome) return null;\r\n\r\n    // Only drop if wingers/CAM making forward runs\r\n    const forwardRunners = teammates.filter(t =>\r\n      ['RW', 'LW', 'CAM'].includes(t.role as string) &&\r\n      Math.abs(t.vx) > 50\r\n    );\r\n\r\n    if (forwardRunners.length === 0) return null;\r\n\r\n    const dropPosition = {\r\n      x: striker.x - Math.sign(opponentGoalX - striker.x) * 120,\r\n      y: 300\r\n    };\r\n\r\n    return {\r\n      available: true,\r\n      target: dropPosition,\r\n      speedMultiplier: 1.2,\r\n      description: 'false 9 dropping deep',\r\n      shouldLock: true,\r\n      error: null\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Target striker: Hold up play\r\n   */\r\n  targetStrikerHoldUp(\r\n    striker: Player,\r\n    _ball: Vector2D,\r\n    opponents: Player[]\r\n  ): BehaviorResultSuccess | null {\r\n    if (!['ST', 'CF'].includes(striker.role as string)) return null;\r\n\r\n    \r\n    const nearbyOpponents = opponents.filter(o =>\r\n      getDistance(o, striker) < 60\r\n    );\r\n\r\n    // If under pressure, shield the ball\r\n    if (nearbyOpponents.length > 0 && getDistance(striker, _ball) < 25) {\r\n      return {\r\n        available: true,\r\n        target: {\r\n          x: striker.x,\r\n          y: striker.y\r\n        },\r\n        speedMultiplier: 0.7,\r\n        description: 'target striker holding up',\r\n        shouldLock: true,\r\n        error: null\r\n      };\r\n    }\r\n\r\n    return null;\r\n  },\r\n\r\n  /**\r\n   * Striker pressing: Lead the press against center-backs\r\n   */\r\n  strikerPressingTrigger(\r\n    striker: Player,\r\n    opponents: Player[],\r\n    ball: Vector2D,\r\n    ownGoalX: number\r\n  ): BehaviorResultSuccess | null {\r\n    if (!['ST', 'CF'].includes(striker.role as string)) return null;\r\n\r\n    \r\n    const oppCBs = opponents.filter(o =>\r\n      ['CB', 'GK'].includes(o.role as string)\r\n    );\r\n\r\n    if (oppCBs.length === 0) return null;\r\n\r\n    const nearestCB = oppCBs.sort((a, b) =>\r\n      getDistance(a, ball) - getDistance(b, ball)\r\n    )[0];\r\n\r\n    if (!nearestCB) return null;\r\n\r\n    const distToCB = getDistance(striker, nearestCB);\r\n\r\n    // Trigger press if close enough\r\n    if (distToCB < 100 && Math.abs(nearestCB.x - ownGoalX) > 400) {\r\n      return {\r\n        available: true,\r\n        target: {\r\n          x: nearestCB.x,\r\n          y: nearestCB.y\r\n        },\r\n        speedMultiplier: 1.7,\r\n        description: 'striker leading press',\r\n        shouldLock: true,\r\n        error: null\r\n      };\r\n    }\r\n\r\n    return null;\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// TRANSITION BEHAVIORS\r\n// ============================================================================\r\n\r\nexport const TransitionBehaviors = {\r\n  /**\r\n   * Counter-attack: Explosive forward runs\r\n   */\r\n  counterAttackRun(\r\n    player: Player,\r\n    _ball: Vector2D,\r\n    opponentGoalX: number,\r\n    justWonPossession: boolean\r\n  ): BehaviorResultSuccess | null {\r\n    if (!justWonPossession) return null;\r\n    if (!['ST', 'RW', 'LW', 'CAM', 'CM'].includes(player.role as string)) return null;\r\n\r\n    const spaceAhead = Math.abs(player.x - opponentGoalX);\r\n\r\n    // Forwards sprint into space immediately\r\n    if (['ST', 'RW', 'LW'].includes(player.role as string) && spaceAhead > 150) {\r\n      return {\r\n        available: true,\r\n        target: {\r\n          x: opponentGoalX - Math.sign(opponentGoalX - player.x) * 80,\r\n          y: player.role === 'ST' ? 300 : player.y\r\n        },\r\n        speedMultiplier: 2.0,\r\n        description: 'counter-attack sprint',\r\n        shouldLock: true,\r\n        error: null,\r\n        duration: 3000 // Lock for 3 seconds\r\n      };\r\n    }\r\n\r\n    // Midfielders support the counter\r\n    if (['CAM', 'CM'].includes(player.role as string)) {\r\n      return {\r\n        available: true,\r\n        target: {\r\n          x: player.x + Math.sign(opponentGoalX - player.x) * 120,\r\n          y: 300\r\n        },\r\n        speedMultiplier: 1.6,\r\n        description: 'counter-attack support',\r\n        shouldLock: true,\r\n        error: null,\r\n        duration: 2500\r\n      };\r\n    }\r\n\r\n    return null;\r\n  },\r\n\r\n  /**\r\n   * Counter-press (Gegenpressing): Immediate pressure after losing ball\r\n   */\r\n  counterPress(\r\n    player: Player,\r\n    ball: Vector2D,\r\n    justLostPossession: boolean,\r\n    _opponentGoalX: number\r\n  ): BehaviorResultSuccess | null {\r\n    if (!justLostPossession) return null;\r\n\r\n    \r\n    const distToBall = getDistance(player, ball);\r\n\r\n    // Only players within 80 units press immediately\r\n    if (distToBall > 80) return null;\r\n\r\n    return {\r\n      available: true,\r\n      target: {\r\n        x: ball.x,\r\n        y: ball.y\r\n      },\r\n      speedMultiplier: 1.9,\r\n      description: 'counter-press',\r\n      shouldLock: true,\r\n      error: null,\r\n      duration: 4000 // Press aggressively for 4 seconds\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Recovery runs: Sprint back to defensive shape\r\n   */\r\n  recoveryRun(\r\n    player: Player,\r\n    ball: Vector2D,\r\n    ownGoalX: number,\r\n    justLostPossession: boolean\r\n  ): BehaviorResultSuccess | null {\r\n    if (!justLostPossession) return null;\r\n\r\n    \r\n    const distToBall = getDistance(player, ball);\r\n\r\n    // Players far from ball make recovery runs\r\n    if (distToBall < 100) return null;\r\n\r\n    const homePositionX = (player as any).homePosition?.x || (ownGoalX + Math.sign(player.x - ownGoalX) * 200);\r\n\r\n    return {\r\n      available: true,\r\n      target: {\r\n        x: homePositionX,\r\n        y: (player as any).homePosition?.y || 300\r\n      },\r\n      speedMultiplier: 1.7,\r\n      description: 'recovery run',\r\n      shouldLock: true,\r\n      error: null,\r\n      duration: 3000\r\n    };\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// TACTICAL SYSTEM MODIFIERS\r\n// ============================================================================\r\n\r\nexport const TacticalSystemModifiers = {\r\n  /**\r\n   * Possession-based: Constant movement for passing options\r\n   */\r\n  possessionSystem(\r\n    player: Player,\r\n    holder: Player | null,\r\n    teammates: Player[]\r\n  ): BehaviorResultSuccess | null {\r\n    if (!holder || holder.isHome !== player.isHome) return null;\r\n\r\n    \r\n    // Create passing triangles\r\n    const nearbyTeammates = teammates.filter(t =>\r\n      getDistance(t, holder) < 150 && t.id !== player.id && t.id !== holder.id\r\n    );\r\n\r\n    if (nearbyTeammates.length < 1) return null;\r\n\r\n    // Position to form triangle\r\n    const avgX = nearbyTeammates.reduce((sum, t) => sum + t.x, holder.x) / (nearbyTeammates.length + 1);\r\n    const avgY = nearbyTeammates.reduce((sum, t) => sum + t.y, holder.y) / (nearbyTeammates.length + 1);\r\n\r\n    return {\r\n      available: true,\r\n      target: {\r\n        x: avgX + (Math.random() - 0.5) * 40,\r\n        y: avgY + (Math.random() - 0.5) * 40\r\n      },\r\n      speedMultiplier: 0.9, // Controlled movement\r\n      description: 'possession triangle formation',\r\n      shouldLock: false,\r\n      error: null\r\n    };\r\n  },\r\n\r\n  /**\r\n   * High-press: Compressed formation in opponent's half\r\n   */\r\n  highPressSystem(\r\n    player: Player,\r\n    _ball: Vector2D,\r\n    _teammates: Player[],\r\n    opponentGoalX: number\r\n  ): BehaviorResultSuccess | null {\r\n    const teamPushUp = Math.abs(player.x - opponentGoalX) > 300;\r\n\r\n    if (!teamPushUp) return null;\r\n\r\n    // Push entire team into opponent's half\r\n    const targetX = opponentGoalX - Math.sign(opponentGoalX - player.x) * 250;\r\n\r\n    return {\r\n      available: true,\r\n      target: {\r\n        x: targetX,\r\n        y: player.y\r\n      },\r\n      speedMultiplier: 1.2,\r\n      description: 'high-press positioning',\r\n      shouldLock: false,\r\n      error: null\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Low-block: Deep defensive shape\r\n   */\r\n  lowBlockSystem(\r\n    player: Player,\r\n    ownGoalX: number,\r\n    _teammates: Player[]\r\n  ): BehaviorResultSuccess | null {\r\n    const defensiveThird = ownGoalX + Math.sign(player.x - ownGoalX) * 200;\r\n    const tooAdvanced = Math.abs(player.x - defensiveThird) > 150;\r\n\r\n    if (!tooAdvanced) return null;\r\n\r\n    return {\r\n      available: true,\r\n      target: {\r\n        x: defensiveThird,\r\n        y: 300 + (player.y - 300) * 0.7 // Narrower shape\r\n      },\r\n      speedMultiplier: 1.0,\r\n      description: 'low-block positioning',\r\n      shouldLock: false,\r\n      error: null\r\n    };\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// MASTER BEHAVIORAL SELECTOR\r\n// ============================================================================\r\n\r\n/**\r\n * Main function to select the best behavior for a player based on game phase\r\n * and tactical context. Integrates with existing AI system.\r\n */\r\nexport function selectPlayerBehavior(\r\n  player: Player,\r\n  gameState: GameState,\r\n  phase: GamePhase,\r\n  tacticalSystem?: TacticalSystemType\r\n): BehaviorResultSuccess | null {\r\n  const allPlayers = [...(gameState.homePlayers || []), ...(gameState.awayPlayers || [])];\r\n  const teammates = allPlayers.filter(p => p.isHome === player.isHome && p.id !== player.id);\r\n  const opponents = allPlayers.filter(p => p.isHome !== player.isHome);\r\n  const ball = gameState.ballPosition;\r\n  const holder = gameState.ballHolder;\r\n\r\n  // Calculate goal positions\r\n  const ownGoalX = player.isHome ?\r\n    (gameState.currentHalf === 1 ? 50 : 750) :\r\n    (gameState.currentHalf === 1 ? 750 : 50);\r\n  const opponentGoalX = player.isHome ?\r\n    (gameState.currentHalf === 1 ? 750 : 50) :\r\n    (gameState.currentHalf === 1 ? 50 : 750);\r\n\r\n  // Possession transition detection\r\n  const timeSinceChange = Date.now() - ((gameState as any).lastPossessionChange || 0);\r\n  const justWonPossession = timeSinceChange < 5000 && holder?.isHome === player.isHome;\r\n  const justLostPossession = timeSinceChange < 5000 && holder?.isHome !== player.isHome;\r\n\r\n  // ++++++++++ NEW SAFETY CHECK (CONFLICT FIX) ++++++++++\r\n  // If game status is 'SET_PIECE', this system should return null\r\n  // to allow SetPieceIntegration.js to take control.\r\n  // This prevents players from \"ghosting\" during set pieces.\r\n  if (phase === 'SET_PIECE') {\r\n    (player as any).currentBehavior = 'set_piece_hold';\r\n    return null; // Allow SetPieceIntegration to take control\r\n  }\r\n  // ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\r\n\r\n  const behaviors: (BehaviorResultSuccess | null)[] = [];\r\n\r\n  // PHASE 1: TRANSITION TO ATTACK\r\n  if (phase === PHASES.TRANSITION_TO_ATTACK || justWonPossession) {\r\n    behaviors.push(\r\n      TransitionBehaviors.counterAttackRun(player, ball, opponentGoalX, justWonPossession)\r\n    );\r\n  }\r\n\r\n  // PHASE 2: TRANSITION TO DEFENSE\r\n  if (phase === PHASES.TRANSITION_TO_DEFENSE || justLostPossession) {\r\n    behaviors.push(\r\n      TransitionBehaviors.counterPress(player, ball, justLostPossession, opponentGoalX),\r\n      TransitionBehaviors.recoveryRun(player, ball, ownGoalX, justLostPossession)\r\n    );\r\n  }\r\n\r\n  // PHASE 3: DEFENSIVE PHASE\r\n  if (phase === PHASES.DEFENSIVE || (holder && holder.isHome !== player.isHome)) {\r\n    // Goalkeeper behaviors\r\n    if (player.role === 'GK') {\r\n      behaviors.push(\r\n        GoalkeeperBehaviors.sweeperKeeping(player, ball, teammates, opponents, ownGoalX),\r\n        GoalkeeperBehaviors.angleNarrowing(player, ball, holder, ownGoalX)\r\n      );\r\n    }\r\n\r\n    // Defensive unit behaviors\r\n    behaviors.push(\r\n      DefensiveBehaviors.defensiveLineShift(player, ball, teammates, ownGoalX),\r\n      DefensiveBehaviors.fullBackCovering(player, ball, opponents, ownGoalX),\r\n      DefensiveBehaviors.centerBackMarking(player, opponents, teammates, ownGoalX)\r\n    );\r\n\r\n    // Midfield defensive behaviors\r\n    behaviors.push(\r\n      MidfieldBehaviors.cdmScreening(player, ball, opponents, teammates, ownGoalX),\r\n      MidfieldBehaviors.cmPressTrigger(player, ball, opponents, holder)\r\n    );\r\n\r\n    // Forward defensive behaviors\r\n    behaviors.push(\r\n      ForwardBehaviors.strikerPressingTrigger(player, opponents, ball, ownGoalX)\r\n    );\r\n  }\r\n\r\n  // PHASE 4: ATTACKING PHASE\r\n  if (phase === PHASES.ATTACKING || (holder && holder.isHome === player.isHome)) {\r\n    // Goalkeeper behaviors\r\n    if (player.role === 'GK') {\r\n      behaviors.push(\r\n        GoalkeeperBehaviors.buildUpSupport(player, holder, teammates, ownGoalX)\r\n      );\r\n    }\r\n\r\n    // Defensive unit attacking behaviors\r\n    behaviors.push(\r\n      DefensiveBehaviors.invertedFullBack(player, holder, teammates, ownGoalX)\r\n    );\r\n\r\n    // Midfield attacking behaviors\r\n    behaviors.push(\r\n      MidfieldBehaviors.boxToBoxLateRun(player, ball, holder, teammates, opponentGoalX),\r\n      MidfieldBehaviors.registaTempoDictation(player, holder, teammates, ownGoalX),\r\n      MidfieldBehaviors.camBetweenLines(player, opponents, opponentGoalX)\r\n    );\r\n\r\n    // Forward attacking behaviors\r\n    behaviors.push(\r\n      ForwardBehaviors.wingerWidthProviding(player, holder, teammates),\r\n      ForwardBehaviors.invertedWingerCutInside(player, ball, opponentGoalX),\r\n      ForwardBehaviors.strikerRunsInBehind(player, holder, opponents, opponentGoalX),\r\n      ForwardBehaviors.false9DropDeep(player, holder, teammates, opponentGoalX),\r\n      ForwardBehaviors.targetStrikerHoldUp(player, ball, opponents)\r\n    );\r\n  }\r\n\r\n  // TACTICAL SYSTEM OVERLAYS\r\n  if (tacticalSystem === 'possession') {\r\n    behaviors.push(\r\n      TacticalSystemModifiers.possessionSystem(player, holder, teammates)\r\n    );\r\n  } else if (tacticalSystem === 'high_press') {\r\n    behaviors.push(\r\n      TacticalSystemModifiers.highPressSystem(player, ball, teammates, opponentGoalX)\r\n    );\r\n  } else if (tacticalSystem === 'low_block' || tacticalSystem === 'counter_attack') {\r\n    behaviors.push(\r\n      TacticalSystemModifiers.lowBlockSystem(player, ownGoalX, teammates)\r\n    );\r\n  }\r\n\r\n  // Find first valid behavior\r\n  const validBehavior = behaviors.find(b => b !== null);\r\n\r\n  if (validBehavior) (player as any).currentBehavior = validBehavior.description; // Debug info\r\n  return validBehavior || null;\r\n}\r\n\r\n// ============================================================================\r\n// PHASE DETECTION\r\n// ============================================================================\r\n\r\n/**\r\n * Detect current game phase based on possession and timing\r\n */\r\nexport function detectGamePhase(gameState: GameState): GamePhase {\r\n  // INTEGRATION: Added per SetPieceIntegration.js instructions\r\n  if (SetPieceBehaviorSystem.isSetPieceActive(gameState)) {\r\n    return 'SET_PIECE'; // Special phase\r\n  }\r\n\r\n  const holder = gameState.ballHolder;\r\n  const timeSinceChange = Date.now() - ((gameState as any).lastPossessionChange || 0);\r\n\r\n  // Transition phases last 5 seconds after possession change\r\n  if (timeSinceChange < 5000) {\r\n    if (holder) {\r\n      return PHASES.TRANSITION_TO_ATTACK;\r\n    } else {\r\n      return PHASES.TRANSITION_TO_DEFENSE;\r\n    }\r\n  }\r\n\r\n  // Stable phases\r\n  if (holder) {\r\n    return PHASES.ATTACKING;\r\n  }\r\n\r\n  return PHASES.DEFENSIVE;\r\n}\r\n\r\n// ============================================================================\r\n// INTEGRATION HELPERS\r\n// ============================================================================\r\n\r\n/**\r\n * Map tactic names to system types\r\n */\r\nexport function getTacticalSystemType(tacticName?: string): TacticalSystemType {\r\n  const systemMap: Record<string, TacticalSystemType> = {\r\n    'possession': 'possession',\r\n    'tiki_taka': 'possession',\r\n    'high_press': 'high_press',\r\n    'gegenpress': 'high_press',\r\n    'counter_attack': 'counter_attack',\r\n    'defensive': 'low_block',\r\n    'park_bus': 'low_block'\r\n  };\r\n\r\n  return systemMap[tacticName?.toLowerCase() || ''] || 'balanced';\r\n}\r\n\r\n// ============================================================================\r\n// BROWSER EXPORTS\r\n// ============================================================================\r\n\r\n// Functions are now exported via ES6 modules - no window exports needed\r\nconsole.log('\u2705 BEHAVIORAL DYNAMICS ENGINE LOADED');\r\nconsole.log('   \u2713 11 role-specific behavior sets');\r\nconsole.log('   \u2713 4 game phases supported');\r\nconsole.log('   \u2713 3 tactical system modifiers');\r\nconsole.log('   \u2713 FIX #9: BehaviorResult wrapper for consistent returns');\r\nconsole.log('   \u2713 Ready for integration');\r\n"],
  "mappings": "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",
  "names": ["BehaviorResult", "DefensiveBehaviors", "ForwardBehaviors", "GoalkeeperBehaviors", "MidfieldBehaviors", "PHASES", "SetPieceBehaviorSystem", "TacticalSystemModifiers", "TransitionBehaviors", "calculateXG", "detectGamePhase", "ensureStatsShape", "gameTime", "getTacticalSystemType", "getValidStat", "lastFrameTime", "penaltySystem", "physicsAccumulator", "selectPlayerBehavior", "spatialSystem", "EVENT_TYPES", "gameState", "activeConfig", "pointToLineDistance", "opponentGoalX", "distance", "pointToLineDistance", "EVENT_TYPES", "getDistance", "distance", "gameState", "gameState", "drawGroundShadow", "gameState", "row", "spatialSystem", "gameState", "defenderSkill", "PITCH_WIDTH", "penaltySystem", "gameState", "CFG", "ensureStatsShape", "SET_PIECE_STATUSES", "getDistance", "calculateXG", "getDistance", "getValidStat", "lightenColor", "CFG", "lastFrameTime", "gameTime", "physicsAccumulator", "CFG", "resolveSide", "invertSide", "getDistance", "realStats", "targetY", "EVENT_TYPES", "getDistance", "markingPointX", "markingPointY", "x", "y", "spaceRating", "gameState", "PITCH_WIDTH", "PITCH_HEIGHT", "gameState", "gameState", "gameState", "PITCH_WIDTH", "PITCH_HEIGHT", "activePos", "gameState", "SET_PIECE_TYPES", "PITCH_WIDTH", "PITCH_HEIGHT", "activeConfig", "activePos", "getSafeStat", "getRoleBasedFallbackPosition", "PITCH_WIDTH", "PITCH_HEIGHT", "gameState", "activeConfig", "activePos", "SET_PIECE_TYPES", "gameState", "PITCH_WIDTH", "PITCH_HEIGHT", "finalPos", "SET_PIECE_TYPES", "gameState", "gameState", "direction", "target", "accuracy", "speed", "gameState", "EVENT_TYPES", "isGoalkeeper", "allPlayers", "PHYSICS", "simulateBtn", "activeConfig", "SET_PIECE_TYPES", "PITCH_WIDTH", "PITCH_HEIGHT", "handleGoalkeeperSetPiecePosition", "gameState", "getSafeFallbackPosition", "calculateSetPiecePositionWithSafety", "getSetPiecePosition", "shouldLockSetPiecePosition", "getSetPieceMovementType", "isSetPieceActive", "SetPieceBehaviorSystem", "BehaviorResult", "PHASES", "GoalkeeperBehaviors", "DefensiveBehaviors", "MidfieldBehaviors", "ForwardBehaviors", "TransitionBehaviors", "TacticalSystemModifiers", "selectPlayerBehavior", "gameState", "detectGamePhase", "getTacticalSystemType"]
}
